{"version":3,"sources":["calendar.js"],"names":[],"mappings":"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","file":"calendar-compiled.js","sourcesContent":["/*\r\n*  AngularJs Fullcalendar Wrapper for the JQuery FullCalendar\r\n*  API @ http://arshaw.com/fullcalendar/\r\n*\r\n*  Angular Calendar Directive that takes in the [eventSources] nested array object as the ng-model and watches it deeply changes.\r\n*       Can also take in multiple event urls as a source object(s) and feed the events per view.\r\n*       The calendar will watch any eventSource array and update itself when a change is made.\r\n*\r\n*/\r\n\r\nangular.module('ui.calendar', [])\r\n  .constant('uiCalendarConfig', {})\r\n  .controller('uiCalendarCtrl', ['$scope', '$timeout', function($scope, $timeout){\r\n\r\n      var sourceSerialId = 1,\r\n          eventSerialId = 1,\r\n          sources = $scope.eventSources,\r\n          extraEventSignature = $scope.calendarWatchEvent ? $scope.calendarWatchEvent : angular.noop,\r\n\r\n          wrapFunctionWithScopeApply = function(functionToWrap){\r\n              var wrapper;\r\n\r\n              if (functionToWrap){\r\n                  wrapper = function(){\r\n                      // This happens outside of angular context so we need to wrap it in a timeout which has an implied apply.\r\n                      // In this way the function will be safely executed on the next digest.\r\n\r\n                      var args = arguments;\r\n                      $timeout(function(){\r\n                          functionToWrap.apply(this, args);\r\n                      });\r\n                  };\r\n              }\r\n\r\n              return wrapper;\r\n          };\r\n\r\n      this.eventsFingerprint = function(e) {\r\n        if (!e.__uiCalId) {\r\n          e.__uiCalId = eventSerialId++;\r\n        }\r\n        // This extracts all the information we need from the event. http://jsperf.com/angular-calendar-events-fingerprint/3\r\n        return \"\" + e.__uiCalId + (e.id || '') + (e.title || '') + (e.url || '') + (+e.start || '') + (+e.end || '') +\r\n          (e.allDay || '') + (e.className || '') + extraEventSignature(e) || '';\r\n      };\r\n\r\n      this.sourcesFingerprint = function(source) {\r\n          return source.__id || (source.__id = sourceSerialId++);\r\n      };\r\n\r\n      this.allEvents = function() {\r\n        // return sources.flatten(); but we don't have flatten\r\n        var arraySources = [];\r\n        for (var i = 0, srcLen = sources.length; i < srcLen; i++) {\r\n          var source = sources[i];\r\n          if (angular.isArray(source)) {\r\n            // event source as array\r\n            arraySources.push(source);\r\n          } else if(angular.isObject(source) && angular.isArray(source.events)){\r\n            // event source as object, ie extended form\r\n            var extEvent = {};\r\n            for(var key in source){\r\n              if(key !== '_uiCalId' && key !== 'events'){\r\n                 extEvent[key] = source[key];\r\n              }\r\n            }\r\n            for(var eI = 0;eI < source.events.length;eI++){\r\n              angular.extend(source.events[eI],extEvent);\r\n            }\r\n            arraySources.push(source.events);\r\n          }\r\n        }\r\n\r\n        return Array.prototype.concat.apply([], arraySources);\r\n      };\r\n\r\n      // Track changes in array by assigning id tokens to each element and watching the scope for changes in those tokens\r\n      // arguments:\r\n      //  arraySource array of function that returns array of objects to watch\r\n      //  tokenFn function(object) that returns the token for a given object\r\n      this.changeWatcher = function(arraySource, tokenFn) {\r\n        var self;\r\n        var getTokens = function() {\r\n          var array = angular.isFunction(arraySource) ? arraySource() : arraySource;\r\n          var result = [], token, el;\r\n          for (var i = 0, n = array.length; i < n; i++) {\r\n            el = array[i];\r\n            token = tokenFn(el);\r\n            map[token] = el;\r\n            result.push(token);\r\n          }\r\n          return result;\r\n        };\r\n        // returns elements in that are in a but not in b\r\n        // subtractAsSets([4, 5, 6], [4, 5, 7]) => [6]\r\n        var subtractAsSets = function(a, b) {\r\n          var result = [], inB = {}, i, n;\r\n          for (i = 0, n = b.length; i < n; i++) {\r\n            inB[b[i]] = true;\r\n          }\r\n          for (i = 0, n = a.length; i < n; i++) {\r\n            if (!inB[a[i]]) {\r\n              result.push(a[i]);\r\n            }\r\n          }\r\n          return result;\r\n        };\r\n\r\n        // Map objects to tokens and vice-versa\r\n        var map = {};\r\n\r\n        var applyChanges = function(newTokens, oldTokens) {\r\n          var i, n, el, token;\r\n          var replacedTokens = {};\r\n          var removedTokens = subtractAsSets(oldTokens, newTokens);\r\n          for (i = 0, n = removedTokens.length; i < n; i++) {\r\n            var removedToken = removedTokens[i];\r\n            el = map[removedToken];\r\n            delete map[removedToken];\r\n            var newToken = tokenFn(el);\r\n            // if the element wasn't removed but simply got a new token, its old token will be different from the current one\r\n            if (newToken === removedToken) {\r\n              self.onRemoved(el);\r\n            } else {\r\n              replacedTokens[newToken] = removedToken;\r\n              self.onChanged(el);\r\n            }\r\n          }\r\n\r\n          var addedTokens = subtractAsSets(newTokens, oldTokens);\r\n          for (i = 0, n = addedTokens.length; i < n; i++) {\r\n            token = addedTokens[i];\r\n            el = map[token];\r\n            if (!replacedTokens[token]) {\r\n              self.onAdded(el);\r\n            }\r\n          }\r\n        };\r\n        return self = {\r\n          subscribe: function(scope, onChanged) {\r\n            scope.$watch(getTokens, function(newTokens, oldTokens) {\r\n              if (!onChanged || onChanged(newTokens, oldTokens) !== false) {\r\n                applyChanges(newTokens, oldTokens);\r\n              }\r\n            }, true);\r\n          },\r\n          onAdded: angular.noop,\r\n          onChanged: angular.noop,\r\n          onRemoved: angular.noop\r\n        };\r\n      };\r\n\r\n      this.getFullCalendarConfig = function(calendarSettings, uiCalendarConfig){\r\n          var config = {};\r\n\r\n          angular.extend(config, uiCalendarConfig);\r\n          angular.extend(config, calendarSettings);\r\n         \r\n          angular.forEach(config, function(value,key){\r\n            if (typeof value === 'function'){\r\n              config[key] = wrapFunctionWithScopeApply(config[key]);\r\n            }\r\n          });\r\n\r\n          return config;\r\n      };\r\n  }])\r\n  .directive('uiCalendar', ['uiCalendarConfig', '$locale', function(uiCalendarConfig, $locale) {\r\n    // Configure to use locale names by default\r\n    var tValues = function(data) {\r\n      // convert {0: \"Jan\", 1: \"Feb\", ...} to [\"Jan\", \"Feb\", ...]\r\n      var r, k;\r\n      r = [];\r\n      for (k in data) {\r\n        r[k] = data[k];\r\n      }\r\n      return r;\r\n    };\r\n    var dtf = $locale.DATETIME_FORMATS;\r\n    uiCalendarConfig = angular.extend({\r\n      monthNames: tValues(dtf.MONTH),\r\n      monthNamesShort: tValues(dtf.SHORTMONTH),\r\n      dayNames: tValues(dtf.DAY),\r\n      dayNamesShort: tValues(dtf.SHORTDAY)\r\n    }, uiCalendarConfig || {});\r\n\r\n    return {\r\n      restrict: 'A',\r\n      scope: {eventSources:'=ngModel',calendarWatchEvent: '&'},\r\n      controller: 'uiCalendarCtrl',\r\n      link: function(scope, elm, attrs, controller) {\r\n\r\n        var sources = scope.eventSources,\r\n            sourcesChanged = false,\r\n            eventSourcesWatcher = controller.changeWatcher(sources, controller.sourcesFingerprint),\r\n            eventsWatcher = controller.changeWatcher(controller.allEvents, controller.eventsFingerprint),\r\n            options = null;\r\n\r\n        function getOptions(){\r\n          var calendarSettings = attrs.uiCalendar ? scope.$parent.$eval(attrs.uiCalendar) : {},\r\n              fullCalendarConfig;\r\n\r\n          fullCalendarConfig = controller.getFullCalendarConfig(calendarSettings, uiCalendarConfig);\r\n\r\n          options = { eventSources: sources };\r\n          angular.extend(options, fullCalendarConfig);\r\n\r\n          var options2 = {};\r\n          for(var o in options){\r\n            if(o !== 'eventSources'){\r\n              options2[o] = options[o];\r\n            }\r\n          }\r\n          return JSON.stringify(options2);\r\n        }\r\n\r\n        scope.destroy = function(){\r\n          if(attrs.calendar) {\r\n            scope.calendar = scope.$parent[attrs.calendar] =  elm.html('');\r\n          } else {\r\n            scope.calendar = elm.html('');\r\n          }\r\n        };\r\n\r\n        scope.init = function(){\r\n          scope.calendar.fullCalendar(options);\r\n        };\r\n\r\n        eventSourcesWatcher.onAdded = function(source) {\r\n          scope.calendar.fullCalendar('addEventSource', source);\r\n          sourcesChanged = true;\r\n        };\r\n\r\n        eventSourcesWatcher.onRemoved = function(source) {\r\n          scope.calendar.fullCalendar('removeEventSource', source);\r\n          sourcesChanged = true;\r\n        };\r\n\r\n        eventsWatcher.onAdded = function(event) {\r\n          scope.calendar.fullCalendar('renderEvent', event);\r\n        };\r\n\r\n        eventsWatcher.onRemoved = function(event) {\r\n          scope.calendar.fullCalendar('removeEvents', function(e) { return e === event; });\r\n        };\r\n\r\n        eventsWatcher.onChanged = function(event) {\r\n          scope.calendar.fullCalendar('updateEvent', event);\r\n        };\r\n\r\n        eventSourcesWatcher.subscribe(scope);\r\n        eventsWatcher.subscribe(scope, function(newTokens, oldTokens) {\r\n          if (sourcesChanged === true) {\r\n            sourcesChanged = false;\r\n            // prevent incremental updates in this case\r\n            return false;\r\n          }\r\n        });\r\n\r\n        scope.$watch(getOptions, function(newO,oldO){\r\n            scope.destroy();\r\n            scope.init();\r\n        });\r\n      }\r\n    };\r\n}]);"]}