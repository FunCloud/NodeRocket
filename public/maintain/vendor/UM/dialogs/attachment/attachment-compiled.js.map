{"version":3,"sources":["attachment.js"],"names":[],"mappings":"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","file":"attachment-compiled.js","sourcesContent":["/**\n * User: Jinqn\n * Date: 14-04-08\n * Time: 下午16:34\n * 上传图片对话框逻辑代码,包括tab: 远程图片/上传图片/在线图片/搜索图片\n */\n\n(function () {\n\n    var uploadFile,\n        onlineFile;\n\n    window.onload = function () {\n        initTabs();\n        initButtons();\n    };\n\n    /* 初始化tab标签 */\n    function initTabs() {\n        var tabs = $G('tabhead').children;\n        for (var i = 0; i < tabs.length; i++) {\n            domUtils.on(tabs[i], \"click\", function (e) {\n                var target = e.target || e.srcElement;\n                setTabFocus(target.getAttribute('data-content-id'));\n            });\n        }\n\n        setTabFocus('upload');\n    }\n\n    /* 初始化tabbody */\n    function setTabFocus(id) {\n        if(!id) return;\n        var i, bodyId, tabs = $G('tabhead').children;\n        for (i = 0; i < tabs.length; i++) {\n            bodyId = tabs[i].getAttribute('data-content-id')\n            if (bodyId == id) {\n                domUtils.addClass(tabs[i], 'focus');\n                domUtils.addClass($G(bodyId), 'focus');\n            } else {\n                domUtils.removeClasses(tabs[i], 'focus');\n                domUtils.removeClasses($G(bodyId), 'focus');\n            }\n        }\n        switch (id) {\n            case 'upload':\n                uploadFile = uploadFile || new UploadFile('queueList');\n                break;\n            case 'online':\n                onlineFile = onlineFile || new OnlineFile('fileList');\n                break;\n        }\n    }\n\n    /* 初始化onok事件 */\n    function initButtons() {\n\n        dialog.onok = function () {\n            var list = [], id, tabs = $G('tabhead').children;\n            for (var i = 0; i < tabs.length; i++) {\n                if (domUtils.hasClass(tabs[i], 'focus')) {\n                    id = tabs[i].getAttribute('data-content-id');\n                    break;\n                }\n            }\n\n            switch (id) {\n                case 'upload':\n                    list = uploadFile.getInsertList();\n                    var count = uploadFile.getQueueCount();\n                    if (count) {\n                        $('.info', '#queueList').html('<span style=\"color:red;\">' + '还有2个未上传文件'.replace(/[\\d]/, count) + '</span>');\n                        return false;\n                    }\n                    break;\n                case 'online':\n                    list = onlineFile.getInsertList();\n                    break;\n            }\n\n            editor.execCommand('insertfile', list);\n        };\n    }\n\n\n    /* 上传附件 */\n    function UploadFile(target) {\n        this.$wrap = target.constructor == String ? $('#' + target) : $(target);\n        this.init();\n    }\n    UploadFile.prototype = {\n        init: function () {\n            this.fileList = [];\n            this.initContainer();\n            this.initUploader();\n        },\n        initContainer: function () {\n            this.$queue = this.$wrap.find('.filelist');\n        },\n        /* 初始化容器 */\n        initUploader: function () {\n            var _this = this,\n                $ = jQuery,    // just in case. Make sure it's not an other libaray.\n                $wrap = _this.$wrap,\n            // 图片容器\n                $queue = $wrap.find('.filelist'),\n            // 状态栏，包括进度和控制按钮\n                $statusBar = $wrap.find('.statusBar'),\n            // 文件总体选择信息。\n                $info = $statusBar.find('.info'),\n            // 上传按钮\n                $upload = $wrap.find('.uploadBtn'),\n            // 上传按钮\n                $filePickerBtn = $wrap.find('.filePickerBtn'),\n            // 上传按钮\n                $filePickerBlock = $wrap.find('.filePickerBlock'),\n            // 没选择文件之前的内容。\n                $placeHolder = $wrap.find('.placeholder'),\n            // 总体进度条\n                $progress = $statusBar.find('.progress').hide(),\n            // 添加的文件数量\n                fileCount = 0,\n            // 添加的文件总大小\n                fileSize = 0,\n            // 优化retina, 在retina下这个值是2\n                ratio = window.devicePixelRatio || 1,\n            // 缩略图大小\n                thumbnailWidth = 113 * ratio,\n                thumbnailHeight = 113 * ratio,\n            // 可能有pedding, ready, uploading, confirm, done.\n                state = '',\n            // 所有文件的进度信息，key为file id\n                percentages = {},\n                supportTransition = (function () {\n                    var s = document.createElement('p').style,\n                        r = 'transition' in s ||\n                            'WebkitTransition' in s ||\n                            'MozTransition' in s ||\n                            'msTransition' in s ||\n                            'OTransition' in s;\n                    s = null;\n                    return r;\n                })(),\n            // WebUploader实例\n                uploader,\n                actionUrl = editor.getActionUrl(editor.getOpt('fileActionName')),\n                fileMaxSize = editor.getOpt('fileMaxSize'),\n                acceptExtensions = (editor.getOpt('fileAllowFiles') || []).join('').replace(/\\./g, ',').replace(/^[,]/, '');;\n\n            if (!WebUploader.Uploader.support()) {\n                $('#filePickerReady').after($('<div>').html(lang.errorNotSupport)).hide();\n                return;\n            } else if (!editor.getOpt('fileActionName')) {\n                $('#filePickerReady').after($('<div>').html(lang.errorLoadConfig)).hide();\n                return;\n            }\n\n            uploader = _this.uploader = WebUploader.create({\n                pick: {\n                    id: '#filePickerReady',\n                    label: lang.uploadSelectFile\n                },\n                swf: '../../third-party/webuploader/Uploader.swf',\n                server: actionUrl,\n                fileVal: editor.getOpt('fileFieldName'),\n                duplicate: true,\n                fileSingleSizeLimit: fileMaxSize,\n                compress: false\n            });\n            uploader.addButton({\n                id: '#filePickerBlock'\n            });\n            uploader.addButton({\n                id: '#filePickerBtn',\n                label: lang.uploadAddFile\n            });\n\n            setState('pedding');\n\n            // 当有文件添加进来时执行，负责view的创建\n            function addFile(file) {\n                var $li = $('<li id=\"' + file.id + '\">' +\n                        '<p class=\"title\">' + file.name + '</p>' +\n                        '<p class=\"imgWrap\"></p>' +\n                        '<p class=\"progress\"><span></span></p>' +\n                        '</li>'),\n\n                    $btns = $('<div class=\"file-panel\">' +\n                        '<span class=\"cancel\">' + lang.uploadDelete + '</span>' +\n                        '<span class=\"rotateRight\">' + lang.uploadTurnRight + '</span>' +\n                        '<span class=\"rotateLeft\">' + lang.uploadTurnLeft + '</span></div>').appendTo($li),\n                    $prgress = $li.find('p.progress span'),\n                    $wrap = $li.find('p.imgWrap'),\n                    $info = $('<p class=\"error\"></p>').hide().appendTo($li),\n\n                    showError = function (code) {\n                        switch (code) {\n                            case 'exceed_size':\n                                text = lang.errorExceedSize;\n                                break;\n                            case 'interrupt':\n                                text = lang.errorInterrupt;\n                                break;\n                            case 'http':\n                                text = lang.errorHttp;\n                                break;\n                            case 'not_allow_type':\n                                text = lang.errorFileType;\n                                break;\n                            default:\n                                text = lang.errorUploadRetry;\n                                break;\n                        }\n                        $info.text(text).show();\n                    };\n\n                if (file.getStatus() === 'invalid') {\n                    showError(file.statusText);\n                } else {\n                    $wrap.text(lang.uploadPreview);\n                    if ('|png|jpg|jpeg|bmp|gif|'.indexOf('|'+file.ext.toLowerCase()+'|') == -1) {\n                        $wrap.empty().addClass('notimage').append('<i class=\"file-preview file-type-' + file.ext.toLowerCase() + '\"></i>' +\n                        '<span class=\"file-title\" title=\"' + file.name + '\">' + file.name + '</span>');\n                    } else {\n                        if (browser.ie && browser.version <= 7) {\n                            $wrap.text(lang.uploadNoPreview);\n                        } else {\n                            uploader.makeThumb(file, function (error, src) {\n                                if (error || !src) {\n                                    $wrap.text(lang.uploadNoPreview);\n                                } else {\n                                    var $img = $('<img src=\"' + src + '\">');\n                                    $wrap.empty().append($img);\n                                    $img.on('error', function () {\n                                        $wrap.text(lang.uploadNoPreview);\n                                    });\n                                }\n                            }, thumbnailWidth, thumbnailHeight);\n                        }\n                    }\n                    percentages[ file.id ] = [ file.size, 0 ];\n                    file.rotation = 0;\n\n                    /* 检查文件格式 */\n                    if (!file.ext || acceptExtensions.indexOf(file.ext.toLowerCase()) == -1) {\n                        showError('not_allow_type');\n                        uploader.removeFile(file);\n                    }\n                }\n\n                file.on('statuschange', function (cur, prev) {\n                    if (prev === 'progress') {\n                        $prgress.hide().width(0);\n                    } else if (prev === 'queued') {\n                        $li.off('mouseenter mouseleave');\n                        $btns.remove();\n                    }\n                    // 成功\n                    if (cur === 'error' || cur === 'invalid') {\n                        showError(file.statusText);\n                        percentages[ file.id ][ 1 ] = 1;\n                    } else if (cur === 'interrupt') {\n                        showError('interrupt');\n                    } else if (cur === 'queued') {\n                        percentages[ file.id ][ 1 ] = 0;\n                    } else if (cur === 'progress') {\n                        $info.hide();\n                        $prgress.css('display', 'block');\n                    } else if (cur === 'complete') {\n                    }\n\n                    $li.removeClass('state-' + prev).addClass('state-' + cur);\n                });\n\n                $li.on('mouseenter', function () {\n                    $btns.stop().animate({height: 30});\n                });\n                $li.on('mouseleave', function () {\n                    $btns.stop().animate({height: 0});\n                });\n\n                $btns.on('click', 'span', function () {\n                    var index = $(this).index(),\n                        deg;\n\n                    switch (index) {\n                        case 0:\n                            uploader.removeFile(file);\n                            return;\n                        case 1:\n                            file.rotation += 90;\n                            break;\n                        case 2:\n                            file.rotation -= 90;\n                            break;\n                    }\n\n                    if (supportTransition) {\n                        deg = 'rotate(' + file.rotation + 'deg)';\n                        $wrap.css({\n                            '-webkit-transform': deg,\n                            '-mos-transform': deg,\n                            '-o-transform': deg,\n                            'transform': deg\n                        });\n                    } else {\n                        $wrap.css('filter', 'progid:DXImageTransform.Microsoft.BasicImage(rotation=' + (~~((file.rotation / 90) % 4 + 4) % 4) + ')');\n                    }\n\n                });\n\n                $li.insertBefore($filePickerBlock);\n            }\n\n            // 负责view的销毁\n            function removeFile(file) {\n                var $li = $('#' + file.id);\n                delete percentages[ file.id ];\n                updateTotalProgress();\n                $li.off().find('.file-panel').off().end().remove();\n            }\n\n            function updateTotalProgress() {\n                var loaded = 0,\n                    total = 0,\n                    spans = $progress.children(),\n                    percent;\n\n                $.each(percentages, function (k, v) {\n                    total += v[ 0 ];\n                    loaded += v[ 0 ] * v[ 1 ];\n                });\n\n                percent = total ? loaded / total : 0;\n\n                spans.eq(0).text(Math.round(percent * 100) + '%');\n                spans.eq(1).css('width', Math.round(percent * 100) + '%');\n                updateStatus();\n            }\n\n            function setState(val, files) {\n\n                if (val != state) {\n\n                    var stats = uploader.getStats();\n\n                    $upload.removeClass('state-' + state);\n                    $upload.addClass('state-' + val);\n\n                    switch (val) {\n\n                        /* 未选择文件 */\n                        case 'pedding':\n                            $queue.addClass('element-invisible');\n                            $statusBar.addClass('element-invisible');\n                            $placeHolder.removeClass('element-invisible');\n                            $progress.hide(); $info.hide();\n                            uploader.refresh();\n                            break;\n\n                        /* 可以开始上传 */\n                        case 'ready':\n                            $placeHolder.addClass('element-invisible');\n                            $queue.removeClass('element-invisible');\n                            $statusBar.removeClass('element-invisible');\n                            $progress.hide(); $info.show();\n                            $upload.text(lang.uploadStart);\n                            uploader.refresh();\n                            break;\n\n                        /* 上传中 */\n                        case 'uploading':\n                            $progress.show(); $info.hide();\n                            $upload.text(lang.uploadPause);\n                            break;\n\n                        /* 暂停上传 */\n                        case 'paused':\n                            $progress.show(); $info.hide();\n                            $upload.text(lang.uploadContinue);\n                            break;\n\n                        case 'confirm':\n                            $progress.show(); $info.hide();\n                            $upload.text(lang.uploadStart);\n\n                            stats = uploader.getStats();\n                            if (stats.successNum && !stats.uploadFailNum) {\n                                setState('finish');\n                                return;\n                            }\n                            break;\n\n                        case 'finish':\n                            $progress.hide(); $info.show();\n                            if (stats.uploadFailNum) {\n                                $upload.text(lang.uploadRetry);\n                            } else {\n                                $upload.text(lang.uploadStart);\n                            }\n                            break;\n                    }\n\n                    state = val;\n                    updateStatus();\n\n                }\n\n                if (!_this.getQueueCount()) {\n                    $upload.addClass('disabled')\n                } else {\n                    $upload.removeClass('disabled')\n                }\n\n            }\n\n            function updateStatus() {\n                var text = '', stats;\n\n                if (state === 'ready') {\n                    text = lang.updateStatusReady.replace('_', fileCount).replace('_KB', WebUploader.formatSize(fileSize));\n                } else if (state === 'confirm') {\n                    stats = uploader.getStats();\n                    if (stats.uploadFailNum) {\n                        text = lang.updateStatusConfirm.replace('_', stats.successNum).replace('_', stats.successNum);\n                    }\n                } else {\n                    stats = uploader.getStats();\n                    text = lang.updateStatusFinish.replace('_', fileCount).\n                        replace('_KB', WebUploader.formatSize(fileSize)).\n                        replace('_', stats.successNum);\n\n                    if (stats.uploadFailNum) {\n                        text += lang.updateStatusError.replace('_', stats.uploadFailNum);\n                    }\n                }\n\n                $info.html(text);\n            }\n\n            uploader.on('fileQueued', function (file) {\n                fileCount++;\n                fileSize += file.size;\n\n                if (fileCount === 1) {\n                    $placeHolder.addClass('element-invisible');\n                    $statusBar.show();\n                }\n\n                addFile(file);\n            });\n\n            uploader.on('fileDequeued', function (file) {\n                fileCount--;\n                fileSize -= file.size;\n\n                removeFile(file);\n                updateTotalProgress();\n            });\n\n            uploader.on('filesQueued', function (file) {\n                if (!uploader.isInProgress() && (state == 'pedding' || state == 'finish' || state == 'confirm' || state == 'ready')) {\n                    setState('ready');\n                }\n                updateTotalProgress();\n            });\n\n            uploader.on('all', function (type, files) {\n                switch (type) {\n                    case 'uploadFinished':\n                        setState('confirm', files);\n                        break;\n                    case 'startUpload':\n                        /* 添加额外的GET参数 */\n                        var params = utils.serializeParam(editor.queryCommandValue('serverparam')) || '',\n                            url = utils.formatUrl(actionUrl + (actionUrl.indexOf('?') == -1 ? '?':'&') + 'encode=utf-8&' + params);\n                        uploader.option('server', url);\n                        setState('uploading', files);\n                        break;\n                    case 'stopUpload':\n                        setState('paused', files);\n                        break;\n                }\n            });\n\n            uploader.on('uploadBeforeSend', function (file, data, header) {\n                //这里可以通过data对象添加POST参数\n                header['X_Requested_With'] = 'XMLHttpRequest';\n            });\n\n            uploader.on('uploadProgress', function (file, percentage) {\n                var $li = $('#' + file.id),\n                    $percent = $li.find('.progress span');\n\n                $percent.css('width', percentage * 100 + '%');\n                percentages[ file.id ][ 1 ] = percentage;\n                updateTotalProgress();\n            });\n\n            uploader.on('uploadSuccess', function (file, ret) {\n                var $file = $('#' + file.id);\n                try {\n                    var responseText = (ret._raw || ret),\n                        json = utils.str2json(responseText);\n                    if (json.state == 'SUCCESS') {\n                        _this.fileList.push(json);\n                        $file.append('<span class=\"success\"></span>');\n                    } else {\n                        $file.find('.error').text(json.state).show();\n                    }\n                } catch (e) {\n                    $file.find('.error').text(lang.errorServerUpload).show();\n                }\n            });\n\n            uploader.on('uploadError', function (file, code) {\n            });\n            uploader.on('error', function (code, file) {\n                if (code == 'Q_TYPE_DENIED' || code == 'F_EXCEED_SIZE') {\n                    addFile(file);\n                }\n            });\n            uploader.on('uploadComplete', function (file, ret) {\n            });\n\n            $upload.on('click', function () {\n                if ($(this).hasClass('disabled')) {\n                    return false;\n                }\n\n                if (state === 'ready') {\n                    uploader.upload();\n                } else if (state === 'paused') {\n                    uploader.upload();\n                } else if (state === 'uploading') {\n                    uploader.stop();\n                }\n            });\n\n            $upload.addClass('state-' + state);\n            updateTotalProgress();\n        },\n        getQueueCount: function () {\n            var file, i, status, readyFile = 0, files = this.uploader.getFiles();\n            for (i = 0; file = files[i++]; ) {\n                status = file.getStatus();\n                if (status == 'queued' || status == 'uploading' || status == 'progress') readyFile++;\n            }\n            return readyFile;\n        },\n        getInsertList: function () {\n            var i, link, data, list = [],\n                prefix = editor.getOpt('fileUrlPrefix');\n            for (i = 0; i < this.fileList.length; i++) {\n                data = this.fileList[i];\n                link = data.url;\n                list.push({\n                    title: data.original || link.substr(link.lastIndexOf('/') + 1),\n                    url: prefix + link\n                });\n            }\n            return list;\n        }\n    };\n\n\n    /* 在线附件 */\n    function OnlineFile(target) {\n        this.container = utils.isString(target) ? document.getElementById(target) : target;\n        this.init();\n    }\n    OnlineFile.prototype = {\n        init: function () {\n            this.initContainer();\n            this.initEvents();\n            this.initData();\n        },\n        /* 初始化容器 */\n        initContainer: function () {\n            this.container.innerHTML = '';\n            this.list = document.createElement('ul');\n            this.clearFloat = document.createElement('li');\n\n            domUtils.addClass(this.list, 'list');\n            domUtils.addClass(this.clearFloat, 'clearFloat');\n\n            this.list.appendChild(this.clearFloat);\n            this.container.appendChild(this.list);\n        },\n        /* 初始化滚动事件,滚动到地步自动拉取数据 */\n        initEvents: function () {\n            var _this = this;\n\n            /* 滚动拉取图片 */\n            domUtils.on($G('fileList'), 'scroll', function(e){\n                var panel = this;\n                if (panel.scrollHeight - (panel.offsetHeight + panel.scrollTop) < 10) {\n                    _this.getFileData();\n                }\n            });\n            /* 选中图片 */\n            domUtils.on(this.list, 'click', function (e) {\n                var target = e.target || e.srcElement,\n                    li = target.parentNode;\n\n                if (li.tagName.toLowerCase() == 'li') {\n                    if (domUtils.hasClass(li, 'selected')) {\n                        domUtils.removeClasses(li, 'selected');\n                    } else {\n                        domUtils.addClass(li, 'selected');\n                    }\n                }\n            });\n        },\n        /* 初始化第一次的数据 */\n        initData: function () {\n\n            /* 拉取数据需要使用的值 */\n            this.state = 0;\n            this.listSize = editor.getOpt('fileManagerListSize');\n            this.listIndex = 0;\n            this.listEnd = false;\n\n            /* 第一次拉取数据 */\n            this.getFileData();\n        },\n        /* 向后台拉取图片列表数据 */\n        getFileData: function () {\n            var _this = this;\n\n            if(!_this.listEnd && !this.isLoadingData) {\n                this.isLoadingData = true;\n                ajax.request(editor.getActionUrl(editor.getOpt('fileManagerActionName')), {\n                    timeout: 100000,\n                    data: utils.extend({\n                            start: this.listIndex,\n                            size: this.listSize\n                        }, editor.queryCommandValue('serverparam')),\n                    method: 'get',\n                    onsuccess: function (r) {\n                        try {\n                            var json = eval('(' + r.responseText + ')');\n                            if (json.state == 'SUCCESS') {\n                                _this.pushData(json.list);\n                                _this.listIndex = parseInt(json.start) + parseInt(json.list.length);\n                                if(_this.listIndex >= json.total) {\n                                    _this.listEnd = true;\n                                }\n                                _this.isLoadingData = false;\n                            }\n                        } catch (e) {\n                            if(r.responseText.indexOf('ue_separate_ue') != -1) {\n                                var list = r.responseText.split(r.responseText);\n                                _this.pushData(list);\n                                _this.listIndex = parseInt(list.length);\n                                _this.listEnd = true;\n                                _this.isLoadingData = false;\n                            }\n                        }\n                    },\n                    onerror: function () {\n                        _this.isLoadingData = false;\n                    }\n                });\n            }\n        },\n        /* 添加图片到列表界面上 */\n        pushData: function (list) {\n            var i, item, img, filetype, preview, icon, _this = this,\n                urlPrefix = editor.getOpt('fileManagerUrlPrefix');\n            for (i = 0; i < list.length; i++) {\n                if(list[i] && list[i].url) {\n                    item = document.createElement('li');\n                    icon = document.createElement('span');\n                    filetype = list[i].url.substr(list[i].url.lastIndexOf('.') + 1);\n\n                    if ( \"png|jpg|jpeg|gif|bmp\".indexOf(filetype) != -1 ) {\n                        preview = document.createElement('img');\n                        domUtils.on(preview, 'load', (function(image){\n                            return function(){\n                                _this.scale(image, image.parentNode.offsetWidth, image.parentNode.offsetHeight);\n                            };\n                        })(preview));\n                        preview.width = 113;\n                        preview.setAttribute('src', urlPrefix + list[i].url + (list[i].url.indexOf('?') == -1 ? '?noCache=':'&noCache=') + (+new Date()).toString(36) );\n                    } else {\n                        var ic = document.createElement('i'),\n                            textSpan = document.createElement('span');\n                        textSpan.innerHTML = list[i].url.substr(list[i].url.lastIndexOf('/') + 1);\n                        preview = document.createElement('div');\n                        preview.appendChild(ic);\n                        preview.appendChild(textSpan);\n                        domUtils.addClass(preview, 'file-wrapper');\n                        domUtils.addClass(textSpan, 'file-title');\n                        domUtils.addClass(ic, 'file-type-' + filetype);\n                        domUtils.addClass(ic, 'file-preview');\n                    }\n                    domUtils.addClass(icon, 'icon');\n                    item.setAttribute('data-url', urlPrefix + list[i].url);\n                    if (list[i].original) {\n                        item.setAttribute('data-title', list[i].original);\n                    }\n\n                    item.appendChild(preview);\n                    item.appendChild(icon);\n                    this.list.insertBefore(item, this.clearFloat);\n                }\n            }\n        },\n        /* 改变图片大小 */\n        scale: function (img, w, h, type) {\n            var ow = img.width,\n                oh = img.height;\n\n            if (type == 'justify') {\n                if (ow >= oh) {\n                    img.width = w;\n                    img.height = h * oh / ow;\n                    img.style.marginLeft = '-' + parseInt((img.width - w) / 2) + 'px';\n                } else {\n                    img.width = w * ow / oh;\n                    img.height = h;\n                    img.style.marginTop = '-' + parseInt((img.height - h) / 2) + 'px';\n                }\n            } else {\n                if (ow >= oh) {\n                    img.width = w * ow / oh;\n                    img.height = h;\n                    img.style.marginLeft = '-' + parseInt((img.width - w) / 2) + 'px';\n                } else {\n                    img.width = w;\n                    img.height = h * oh / ow;\n                    img.style.marginTop = '-' + parseInt((img.height - h) / 2) + 'px';\n                }\n            }\n        },\n        getInsertList: function () {\n            var i, lis = this.list.children, list = [];\n            for (i = 0; i < lis.length; i++) {\n                if (domUtils.hasClass(lis[i], 'selected')) {\n                    var url = lis[i].getAttribute('data-url');\n                    var title = lis[i].getAttribute('data-title') || url.substr(url.lastIndexOf('/') + 1);\n                    list.push({\n                        title: title,\n                        url: url\n                    });\n                }\n            }\n            return list;\n        }\n    };\n\n\n})();"]}