{"version":3,"sources":["music.js"],"names":[],"mappings":"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","file":"music-compiled.js","sourcesContent":["function Music() {\r\n    this.init();\r\n}\r\n(function () {\r\n    var pages = [],\r\n        panels = [],\r\n        selectedItem = null;\r\n    Music.prototype = {\r\n        total:70,\r\n        pageSize:10,\r\n        dataUrl:\"http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.search.common\",\r\n        playerUrl:\"http://box.baidu.com/widget/flash/bdspacesong.swf\",\r\n\r\n        init:function () {\r\n            var me = this;\r\n            domUtils.on($G(\"J_searchName\"), \"keyup\", function (event) {\r\n                var e = window.event || event;\r\n                if (e.keyCode == 13) {\r\n                    me.dosearch();\r\n                }\r\n            });\r\n            domUtils.on($G(\"J_searchBtn\"), \"click\", function () {\r\n                me.dosearch();\r\n            });\r\n        },\r\n        callback:function (data) {\r\n            var me = this;\r\n            me.data = data.song_list;\r\n            setTimeout(function () {\r\n                $G('J_resultBar').innerHTML = me._renderTemplate(data.song_list);\r\n            }, 300);\r\n        },\r\n        dosearch:function () {\r\n            var me = this;\r\n            selectedItem = null;\r\n            var key = $G('J_searchName').value;\r\n            if (utils.trim(key) == \"\")return false;\r\n            key = encodeURIComponent(key);\r\n            me._sent(key);\r\n        },\r\n        doselect:function (i) {\r\n            var me = this;\r\n            if (typeof i == 'object') {\r\n                selectedItem = i;\r\n            } else if (typeof i == 'number') {\r\n                selectedItem = me.data[i];\r\n            }\r\n        },\r\n        onpageclick:function (id) {\r\n            var me = this;\r\n            for (var i = 0; i < pages.length; i++) {\r\n                $G(pages[i]).className = 'pageoff';\r\n                $G(panels[i]).className = 'paneloff';\r\n            }\r\n            $G('page' + id).className = 'pageon';\r\n            $G('panel' + id).className = 'panelon';\r\n        },\r\n        listenTest:function (elem) {\r\n            var me = this,\r\n                view = $G('J_preview'),\r\n                is_play_action = (elem.className == 'm-try'),\r\n                old_trying = me._getTryingElem();\r\n\r\n            if (old_trying) {\r\n                old_trying.className = 'm-try';\r\n                view.innerHTML = '';\r\n            }\r\n            if (is_play_action) {\r\n                elem.className = 'm-trying';\r\n                view.innerHTML = me._buildMusicHtml(me._getUrl(true));\r\n            }\r\n        },\r\n        _sent:function (param) {\r\n            var me = this;\r\n            $G('J_resultBar').innerHTML = '<div class=\"loading\"></div>';\r\n\r\n            utils.loadFile(document, {\r\n                src:me.dataUrl + '&query=' + param + '&page_size=' + me.total + '&callback=music.callback&.r=' + Math.random(),\r\n                tag:\"script\",\r\n                type:\"text/javascript\",\r\n                defer:\"defer\"\r\n            });\r\n        },\r\n        _removeHtml:function (str) {\r\n            var reg = /<\\s*\\/?\\s*[^>]*\\s*>/gi;\r\n            return str.replace(reg, \"\");\r\n        },\r\n        _getUrl:function (isTryListen) {\r\n            var me = this;\r\n            var param = 'from=tiebasongwidget&url=&name=' + encodeURIComponent(me._removeHtml(selectedItem.title)) + '&artist='\r\n                + encodeURIComponent(me._removeHtml(selectedItem.author)) + '&extra='\r\n                + encodeURIComponent(me._removeHtml(selectedItem.album_title))\r\n                + '&autoPlay='+isTryListen+'' + '&loop=true';\r\n            return  me.playerUrl + \"?\" + param;\r\n        },\r\n        _getTryingElem:function () {\r\n            var s = $G('J_listPanel').getElementsByTagName('span');\r\n\r\n            for (var i = 0; i < s.length; i++) {\r\n                if (s[i].className == 'm-trying')\r\n                    return s[i];\r\n            }\r\n            return null;\r\n        },\r\n        _buildMusicHtml:function (playerUrl) {\r\n            var html = '<embed class=\"BDE_try_Music\" allowfullscreen=\"false\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\"';\r\n            html += ' src=\"' + playerUrl + '\"';\r\n            html += ' width=\"1\" height=\"1\" style=\"position:absolute;left:-2000px;\"';\r\n            html += ' type=\"application/x-shockwave-flash\" wmode=\"transparent\" play=\"true\" loop=\"false\"';\r\n            html += ' menu=\"false\" allowscriptaccess=\"never\" scale=\"noborder\">';\r\n            return html;\r\n        },\r\n        _byteLength:function (str) {\r\n            return str.replace(/[^\\u0000-\\u007f]/g, \"\\u0061\\u0061\").length;\r\n        },\r\n        _getMaxText:function (s) {\r\n            var me = this;\r\n            s = me._removeHtml(s);\r\n            if (me._byteLength(s) > 12)\r\n                return s.substring(0, 5) + '...';\r\n            if (!s) s = \"&nbsp;\";\r\n            return s;\r\n        },\r\n        _rebuildData:function (data) {\r\n            var me = this,\r\n                newData = [],\r\n                d = me.pageSize,\r\n                itembox;\r\n            for (var i = 0; i < data.length; i++) {\r\n                if ((i + d) % d == 0) {\r\n                    itembox = [];\r\n                    newData.push(itembox)\r\n                }\r\n                itembox.push(data[i]);\r\n            }\r\n            return newData;\r\n        },\r\n        _renderTemplate:function (data) {\r\n            var me = this;\r\n            if (data.length == 0)return '<div class=\"empty\">' + lang.emptyTxt + '</div>';\r\n            data = me._rebuildData(data);\r\n            var s = [], p = [], t = [];\r\n            s.push('<div id=\"J_listPanel\" class=\"listPanel\">');\r\n            p.push('<div class=\"page\">');\r\n            for (var i = 0, tmpList; tmpList = data[i++];) {\r\n                panels.push('panel' + i);\r\n                pages.push('page' + i);\r\n                if (i == 1) {\r\n                    s.push('<div id=\"panel' + i + '\" class=\"panelon\">');\r\n                    if (data.length != 1) {\r\n                        t.push('<div id=\"page' + i + '\" onclick=\"music.onpageclick(' + i + ')\" class=\"pageon\">' + (i ) + '</div>');\r\n                    }\r\n                } else {\r\n                    s.push('<div id=\"panel' + i + '\" class=\"paneloff\">');\r\n                    t.push('<div id=\"page' + i + '\" onclick=\"music.onpageclick(' + i + ')\" class=\"pageoff\">' + (i ) + '</div>');\r\n                }\r\n                s.push('<div class=\"m-box\">');\r\n                s.push('<div class=\"m-h\"><span class=\"m-t\">' + lang.chapter + '</span><span class=\"m-s\">' + lang.singer\r\n                    + '</span><span class=\"m-z\">' + lang.special + '</span><span class=\"m-try-t\">' + lang.listenTest + '</span></div>');\r\n                for (var j = 0, tmpObj; tmpObj = tmpList[j++];) {\r\n                    s.push('<label for=\"radio-' + i + '-' + j + '\" class=\"m-m\">');\r\n                    s.push('<input type=\"radio\" id=\"radio-' + i + '-' + j + '\" name=\"musicId\" class=\"m-l\" onclick=\"music.doselect(' + (me.pageSize * (i-1) + (j-1)) + ')\"/>');\r\n                    s.push('<span class=\"m-t\">' + me._getMaxText(tmpObj.title) + '</span>');\r\n                    s.push('<span class=\"m-s\">' + me._getMaxText(tmpObj.author) + '</span>');\r\n                    s.push('<span class=\"m-z\">' + me._getMaxText(tmpObj.album_title) + '</span>');\r\n                    s.push('<span class=\"m-try\" onclick=\"music.doselect(' + (me.pageSize * (i-1) + (j-1)) + ');music.listenTest(this)\"></span>');\r\n                    s.push('</label>');\r\n                }\r\n                s.push('</div>');\r\n                s.push('</div>');\r\n            }\r\n            t.reverse();\r\n            p.push(t.join(''));\r\n            s.push('</div>');\r\n            p.push('</div>');\r\n            return s.join('') + p.join('');\r\n        },\r\n        exec:function () {\r\n            var me = this;\r\n            if (selectedItem == null)   return;\r\n            $G('J_preview').innerHTML = \"\";\r\n            editor.execCommand('music', {\r\n                url:me._getUrl(false),\r\n                width:400,\r\n                height:95\r\n            });\r\n        }\r\n    };\r\n})();\r\n\r\n\r\n\r\n"]}