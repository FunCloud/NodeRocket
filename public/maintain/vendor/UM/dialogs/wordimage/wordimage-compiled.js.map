{"version":3,"sources":["wordimage.js"],"names":[],"mappings":"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","file":"wordimage-compiled.js","sourcesContent":["/**\r\n * Created by JetBrains PhpStorm.\r\n * User: taoqili\r\n * Date: 12-1-30\r\n * Time: 下午12:50\r\n * To change this template use File | Settings | File Templates.\r\n */\r\n\r\n\r\n\r\nvar wordImage = {};\r\n//(function(){\r\nvar g = baidu.g,\r\n\tflashObj,flashContainer;\r\n\r\nwordImage.init = function(opt, callbacks) {\r\n\tshowLocalPath(\"localPath\");\r\n\t//createCopyButton(\"clipboard\",\"localPath\");\r\n\tcreateFlashUploader(opt, callbacks);\r\n\taddUploadListener();\r\n\taddOkListener();\r\n};\r\n\r\nfunction hideFlash(){\r\n    flashObj = null;\r\n    flashContainer.innerHTML = \"\";\r\n}\r\nfunction addOkListener() {\r\n\tdialog.onok = function() {\r\n\t\tif (!imageUrls.length) return;\r\n\t\tvar urlPrefix = editor.getOpt('imageUrlPrefix'),\r\n            images = domUtils.getElementsByTagName(editor.document,\"img\");\r\n        editor.fireEvent('saveScene');\r\n\t\tfor (var i = 0,img; img = images[i++];) {\r\n\t\t\tvar src = img.getAttribute(\"word_img\");\r\n\t\t\tif (!src) continue;\r\n\t\t\tfor (var j = 0,url; url = imageUrls[j++];) {\r\n\t\t\t\tif (src.indexOf(url.original.replace(\" \",\"\")) != -1) {\r\n\t\t\t\t\timg.src = urlPrefix + url.url;\r\n\t\t\t\t\timg.setAttribute(\"_src\", urlPrefix + url.url);  //同时修改\"_src\"属性\r\n\t\t\t\t\timg.setAttribute(\"title\",url.title);\r\n                    domUtils.removeAttributes(img, [\"word_img\",\"style\",\"width\",\"height\"]);\r\n\t\t\t\t\teditor.fireEvent(\"selectionchange\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n        editor.fireEvent('saveScene');\r\n        hideFlash();\r\n\t};\r\n    dialog.oncancel = function(){\r\n        hideFlash();\r\n    }\r\n}\r\n\r\n/**\r\n * 绑定开始上传事件\r\n */\r\nfunction addUploadListener() {\r\n\tg(\"upload\").onclick = function () {\r\n\t\tflashObj.upload();\r\n\t\tthis.style.display = \"none\";\r\n\t};\r\n}\r\n\r\nfunction showLocalPath(id) {\r\n    //单张编辑\r\n    var img = editor.selection.getRange().getClosedNode();\r\n    var images = editor.execCommand('wordimage');\r\n    if(images.length==1 || img && img.tagName == 'IMG'){\r\n        g(id).value = images[0];\r\n        return;\r\n    }\r\n\tvar path = images[0];\r\n    var leftSlashIndex  = path.lastIndexOf(\"/\")||0,  //不同版本的doc和浏览器都可能影响到这个符号，故直接判断两种\r\n        rightSlashIndex = path.lastIndexOf(\"\\\\\")||0,\r\n        separater = leftSlashIndex > rightSlashIndex ? \"/\":\"\\\\\" ;\r\n\r\n\tpath = path.substring(0, path.lastIndexOf(separater)+1);\r\n\tg(id).value = path;\r\n}\r\n\r\nfunction createFlashUploader(opt, callbacks) {\r\n    //由于lang.flashI18n是静态属性，不可以直接进行修改，否则会影响到后续内容\r\n    var i18n = utils.extend({},lang.flashI18n);\r\n    //处理图片资源地址的编码，补全等问题\r\n    for(var i in i18n){\r\n        if(!(i in {\"lang\":1,\"uploadingTF\":1,\"imageTF\":1,\"textEncoding\":1}) && i18n[i]){\r\n            i18n[i] = encodeURIComponent(editor.options.langPath + editor.options.lang + \"/images/\" + i18n[i]);\r\n        }\r\n    }\r\n    opt = utils.extend(opt,i18n,false);\r\n\tvar option = {\r\n\t\tcreateOptions:{\r\n\t\t\tid:'flash',\r\n\t\t\turl:opt.flashUrl,\r\n\t\t\twidth:opt.width,\r\n\t\t\theight:opt.height,\r\n\t\t\terrorMessage:lang.flashError,\r\n\t\t\twmode:browser.safari ? 'transparent' : 'window',\r\n\t\t\tver:'10.0.0',\r\n\t\t\tvars:opt,\r\n\t\t\tcontainer:opt.container\r\n\t\t}\r\n\t};\r\n\r\n\toption = extendProperty(callbacks, option);\r\n\tflashObj = new baidu.flash.imageUploader(option);\r\n    flashContainer = $G(opt.container);\r\n}\r\n\r\nfunction extendProperty(fromObj, toObj) {\r\n\tfor (var i in fromObj) {\r\n\t\tif (!toObj[i]) {\r\n\t\t\ttoObj[i] = fromObj[i];\r\n\t\t}\r\n\t}\r\n\treturn toObj;\r\n}\r\n\r\n//})();\r\n\r\nfunction getPasteData(id) {\r\n\tbaidu.g(\"msg\").innerHTML = lang.copySuccess + \"</br>\";\r\n\tsetTimeout(function() {\r\n\t\tbaidu.g(\"msg\").innerHTML = \"\";\r\n\t}, 5000);\r\n\treturn baidu.g(id).value;\r\n}\r\n\r\nfunction createCopyButton(id, dataFrom) {\r\n\tbaidu.swf.create({\r\n\t\t\tid:\"copyFlash\",\r\n\t\t\turl:\"fClipboard_ueditor.swf\",\r\n\t\t\twidth:\"58\",\r\n\t\t\theight:\"25\",\r\n\t\t\terrorMessage:\"\",\r\n\t\t\tbgColor:\"#CBCBCB\",\r\n\t\t\twmode:\"transparent\",\r\n\t\t\tver:\"10.0.0\",\r\n\t\t\tvars:{\r\n\t\t\t\ttid:dataFrom\r\n\t\t\t}\r\n\t\t}, id\r\n\t);\r\n\r\n\tvar clipboard = baidu.swf.getMovie(\"copyFlash\");\r\n\tvar clipinterval = setInterval(function() {\r\n\t\tif (clipboard && clipboard.flashInit) {\r\n\t\t\tclearInterval(clipinterval);\r\n\t\t\tclipboard.setHandCursor(true);\r\n\t\t\tclipboard.setContentFuncName(\"getPasteData\");\r\n\t\t\t//clipboard.setMEFuncName(\"mouseEventHandler\");\r\n\t\t}\r\n\t}, 500);\r\n}\r\ncreateCopyButton(\"clipboard\", \"localPath\");"]}