{"version":3,"sources":["webuploader.html5only.js"],"names":[],"mappings":";;;;GAQA,CAAC,SAAU,IAAV,CAAgB,OAAhB,CAA0B,CACvB,GAAI,SAAU,EAAd,C;;AAII,SAAW,SAAU,IAAV,CAAgB,QAAhB,CAA2B,CAClC,GAAI,KAAJ,CAAU,GAAV,CAAe,CAAf,C;AAGA,GAAK,MAAO,KAAP,GAAgB,QAArB,CAAgC,CAC5B,MAAO,WAAW,IAAX,CAAP,CACH,CAFD,IAEO,CACH,KAAO,EAAP,CACA,IAAK,IAAM,KAAK,MAAX,CAAmB,EAAI,CAA5B,CAA+B,EAAI,GAAnC,CAAwC,GAAxC,CAA8C,CAC1C,KAAK,IAAL,CAAW,UAAW,KAAM,CAAN,CAAX,CAAX,EACH,CAED,MAAO,UAAS,KAAT,CAAgB,IAAhB,CAAsB,IAAtB,CAAP,CACH,CACJ,CAlBL,C;AAqBI,QAAU,SAAU,EAAV,CAAc,IAAd,CAAoB,OAApB,CAA8B,CACpC,GAAK,UAAU,MAAV,GAAqB,CAA1B,CAA8B,CAC1B,QAAU,IAAV,CACA,KAAO,IAAP,CACH,CAED,SAAU,MAAQ,EAAlB,CAAsB,UAAW,CAC7B,UAAW,EAAX,CAAe,OAAf,CAAwB,SAAxB,EACH,CAFD,EAGH,CA9BL,C;AAiCI,UAAY,SAAU,EAAV,CAAc,OAAd,CAAuB,IAAvB,CAA8B,CACtC,GAAI,QAAS,CACL,QAAS,OADJ,CAAb,CAGI,QAHJ,CAKA,GAAK,MAAO,QAAP,GAAmB,UAAxB,CAAqC,CACjC,KAAK,MAAL,GAAgB,KAAO,CAAE,QAAF,CAAY,OAAO,OAAnB,CAA4B,MAA5B,CAAvB,EACA,SAAW,QAAQ,KAAR,CAAe,IAAf,CAAqB,IAArB,CAAX,CACA,WAAa,SAAb,GAA2B,OAAO,OAAP,CAAiB,QAA5C,EACH,CAED,QAAS,EAAT,EAAgB,OAAO,OAAvB,CACH,CA9CL,C;AAiDI,UAAY,SAAU,EAAV,CAAe,CACvB,GAAI,QAAS,QAAS,EAAT,GAAiB,KAAM,EAAN,CAA9B,CAEA,GAAK,CAAC,MAAN,CAAe,CACX,KAAM,IAAI,MAAJ,CAAW,IAAM,EAAN,CAAW,gBAAtB,CAAN,CACH,CAED,MAAO,OAAP,CACH,CAzDL,C;AA4DI,UAAY,SAAU,GAAV,CAAgB,CACxB,GAAI,IAAJ,CAAS,IAAT,CAAe,KAAf,CAAsB,IAAtB,CAA4B,IAA5B,CAAkC,OAAlC,C;AAGA,QAAU,SAAU,GAAV,CAAgB,CACtB,MAAO,MAAQ,IAAI,MAAJ,CAAY,CAAZ,EAAgB,WAAhB,GAAgC,IAAI,MAAJ,CAAY,CAAZ,CAA/C,CACH,CAFD,CAIA,IAAM,GAAN,GAAa,QAAb,CAAuB,CACnB,KAAO,GAAP,CAEA,GAAK,CAAC,QAAQ,cAAR,CAAwB,GAAxB,CAAN,CAAsC,CAClC,SACH,CAED,MAAQ,IAAI,KAAJ,CAAU,GAAV,CAAR,CACA,KAAO,QAAS,MAAM,GAAN,EAAT,CAAP,CAEA,MAAQ,KAAO,QAAS,MAAM,KAAN,EAAT,CAAf,CAA2C,CACvC,KAAM,IAAN,EAAe,KAAM,IAAN,GAAgB,EAA/B,CACA,KAAO,KAAM,IAAN,CAAP,CACH,CAED,KAAM,IAAN,EAAe,QAAS,GAAT,CAAf,CACH,CACJ,CArFL,CAuFI,QAAU,QAAS,IAAT,CAAe,OAAf,CAAwB,QAAxB,CAvFd,CAwFI,MAxFJ,C;AA2FA,UAAW,OAAX,EAEA,GAAK,MAAO,OAAP,GAAkB,QAAlB,EAA8B,MAAO,QAAO,OAAd,GAA0B,QAA7D,CAAwE,C;AAGpE,OAAO,OAAP,CAAiB,OAAjB,CACH,CAJD,IAIO,IAAK,MAAO,OAAP,GAAkB,UAAlB,EAAgC,OAAO,GAA5C,CAAkD,C;;;;AAMrD,OAAO,EAAP,CAAW,OAAX,EACH,CAPM,IAOA,C;;AAIH,OAAS,KAAK,WAAd,CACA,KAAK,WAAL,CAAmB,OAAnB,CACA,KAAK,WAAL,CAAiB,UAAjB,CAA8B,UAAW,CACrC,KAAK,WAAL,CAAmB,MAAnB,CACH,CAFD,CAGH,CACJ,CAnHD,EAmHI,IAnHJ,CAmHU,SAAU,MAAV,CAAkB,MAAlB,CAA0B,OAA1B,CAAoC,C;;OAM1C,OAAO,cAAP,CAAsB,EAAtB,CAAyB,UAAW,CAChC,MAAO,QAAO,MAAP,EAAiB,OAAO,KAA/B,CACH,CAFD,E;;OAMA,OAAO,QAAP,CAAgB,CACZ,cADY,CAAhB,CAEG,SAAU,CAAV,CAAc,CACb,MAAO,EAAP,CACH,CAJD,E;;OAQA,OAAO,eAAP,CAAuB,CACnB,QADmB,CAAvB,CAEG,SAAU,CAAV,CAAc,CACb,MAAO,CACH,SAAU,EAAE,QADT,CAEH,KAAM,EAAE,IAFL,CAIH,UAAW,SAAU,QAAV,CAAqB,CAC5B,MAAO,WAAY,MAAO,UAAS,IAAhB,GAAyB,UAA5C,CACH,CANE,CAAP,CAQH,CAXD,E;;OAeA,OAAO,SAAP,CAAiB,CACb,eADa,CAAjB,CAEG,SAAU,CAAV,CAAc,CACb,MAAO,EAAP,CACH,CAJD,E;;;;;;;;;;;;;;;;;OAyBA,OAAO,MAAP,CAAc,CACV,QADU,CAEV,SAFU,CAAd,CAGG,SAAU,CAAV,CAAa,OAAb,CAAuB,CAEtB,GAAI,MAAO,UAAW,CAAE,CAAxB,CACI,KAAO,SAAS,IADpB,C;;AAKA,QAAS,YAAT,CAAsB,EAAtB,CAA2B,CACvB,MAAO,WAAW,CACd,MAAO,MAAK,KAAL,CAAY,EAAZ,CAAgB,SAAhB,CAAP,CACH,CAFD,CAGH,CAED,QAAS,OAAT,CAAiB,EAAjB,CAAqB,OAArB,CAA+B,CAC3B,MAAO,WAAW,CACd,MAAO,IAAG,KAAH,CAAU,OAAV,CAAmB,SAAnB,CAAP,CACH,CAFD,CAGH,CAED,QAAS,aAAT,CAAuB,KAAvB,CAA+B,CAC3B,GAAI,EAAJ,CAEA,GAAK,OAAO,MAAZ,CAAqB,CACjB,MAAO,QAAO,MAAP,CAAe,KAAf,CAAP,CACH,CAFD,IAEO,CACH,EAAI,UAAW,CAAE,CAAjB,CACA,EAAE,SAAF,CAAc,KAAd,CACA,MAAO,IAAI,EAAJ,EAAP,CACH,CACJ,C;;;WAOD,MAAO,C;;eAKH,QAAS,OALN,C;;eAUH,EAAG,CAVA,CAYH,SAAU,QAAQ,QAZf,CAcH,UAAW,QAAQ,SAdhB,CAgBH,KAAM,QAAQ,IAhBX,C;;;;;;;;;;;eA8BH,QAAU,SAAU,EAAV,CAAe,CACrB,GAAI,KAAM,EAAV,CACI,OAAS,GAAG,KAAH,CAAU,kBAAV,CADb,CAEI,OAAS,GAAG,KAAH,CAAU,kBAAV,GACL,GAAG,KAAH,CAAU,iBAAV,CAHR,CAKI,GAAK,GAAG,KAAH,CAAU,iBAAV,GACD,GAAG,KAAH,CAAS,gCAAT,CANR,CAOI,QAAU,GAAG,KAAH,CAAU,mBAAV,CAPd,CAQI,OAAS,GAAG,KAAH,CAAU,kBAAV,CARb,CASI,MAAQ,GAAG,KAAH,CAAU,eAAV,CATZ,CAWA,SAAW,IAAI,MAAJ,CAAa,WAAY,OAAQ,CAAR,CAAZ,CAAxB,EACA,SAAW,IAAI,MAAJ,CAAa,WAAY,OAAQ,CAAR,CAAZ,CAAxB,EACA,KAAO,IAAI,EAAJ,CAAS,WAAY,GAAI,CAAJ,CAAZ,CAAhB,EACA,UAAY,IAAI,OAAJ,CAAc,WAAY,QAAS,CAAT,CAAZ,CAA1B,EACA,SAAW,IAAI,MAAJ,CAAa,WAAY,OAAQ,CAAR,CAAZ,CAAxB,EACA,QAAU,IAAI,KAAJ,CAAY,WAAY,MAAO,CAAP,CAAZ,CAAtB,EAEA,MAAO,IAAP,CACH,CApBQ,CAoBL,UAAU,SApBL,CA9BN,C;;;;;;eA2DH,GAAK,SAAU,EAAV,CAAe,CAChB,GAAI,KAAM,EAAV,C;AAGI,QAAU,GAAG,KAAH,CAAU,+BAAV,CAHd,CAII,IAAM,GAAG,KAAH,CAAU,oCAAV,CAJV,C;AAOA,UAAY,IAAI,OAAJ,CAAc,WAAY,QAAS,CAAT,CAAZ,CAA1B,EACA,MAAQ,IAAI,GAAJ,CAAU,WAAY,IAAK,CAAL,EAAS,OAAT,CAAkB,IAAlB,CAAwB,GAAxB,CAAZ,CAAlB,EAEA,MAAO,IAAP,CACH,CAZG,CAYA,UAAU,SAZV,CA3DD,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eA4GH,SAAU,SAAU,KAAV,CAAiB,MAAjB,CAAyB,YAAzB,CAAwC,CAC9C,GAAI,MAAJ,CAEA,GAAK,MAAO,OAAP,GAAkB,UAAvB,CAAoC,CAChC,MAAQ,MAAR,CACA,OAAS,IAAT,CACH,CAHD,IAGO,IAAK,QAAU,OAAO,cAAP,CAAsB,aAAtB,CAAf,CAAsD,CACzD,MAAQ,OAAO,WAAf,CACH,CAFM,IAEA,CACH,MAAQ,UAAW,CACf,MAAO,OAAM,KAAN,CAAa,IAAb,CAAmB,SAAnB,CAAP,CACH,CAFD,CAGH,C;AAGD,EAAE,MAAF,CAAU,IAAV,CAAgB,KAAhB,CAAuB,KAAvB,CAA8B,cAAgB,EAA9C,E;AAKA,MAAM,SAAN,CAAkB,MAAM,SAAxB,C;;AAIA,MAAM,SAAN,CAAkB,aAAc,MAAM,SAApB,CAAlB,CACA,QAAU,EAAE,MAAF,CAAU,IAAV,CAAgB,MAAM,SAAtB,CAAiC,MAAjC,CAAV,CAEA,MAAO,MAAP,CACH,CAxIE,C;;;eA8IH,KAAM,IA9IH,C;;;;;;;;;;;;;;;eAgKH,OAAQ,MAhKL,C;;;;eAuKH,IAAM,UAAW,CACb,GAAK,OAAO,OAAZ,CAAsB,CAClB,MAAO,QAAQ,QAAQ,GAAhB,CAAqB,OAArB,CAAP,CACH,CACD,MAAO,KAAP,CACH,CALI,EAvKF,CA8KH,SAAW,UAAW,CAElB,MAAO,UAAU,EAAV,CAAe,CAClB,WAAY,EAAZ,CAAgB,CAAhB,EACH,CAFD,C;;;;;;;;;AAcH,CAhBS,EA9KP,C;;;;;;;;;;;;eA6MH,MAAO,YAAa,GAAG,KAAhB,CA7MJ,C;;;;;eAqNH,KAAO,UAAW,CACd,GAAI,SAAU,CAAd,CAEA,MAAO,UAAU,MAAV,CAAmB,CACtB,GAAI,MAAO,CAAC,CAAC,GAAI,KAAJ,EAAF,EAAc,QAAd,CAAwB,EAAxB,CAAX,CACI,EAAI,CADR,CAGA,KAAQ,EAAI,CAAZ,CAAe,GAAf,CAAqB,CACjB,MAAQ,KAAK,KAAL,CAAY,KAAK,MAAL,GAAgB,KAA5B,EAAoC,QAApC,CAA8C,EAA9C,CAAR,CACH,CAED,MAAO,CAAC,QAAU,KAAX,EAAoB,IAApB,CAA2B,CAAC,SAAD,EAAY,QAAZ,CAAsB,EAAtB,CAAlC,CACH,CATD,CAUH,CAbK,EArNH,C;;;;;;;;;;;;;;;;eAqPH,WAAY,SAAU,IAAV,CAAgB,WAAhB,CAA6B,KAA7B,CAAqC,CAC7C,GAAI,KAAJ,CAEA,MAAQ,OAAS,CAAE,GAAF,CAAO,GAAP,CAAY,GAAZ,CAAiB,GAAjB,CAAsB,IAAtB,CAAjB,CAEA,MAAQ,CAAC,KAAO,MAAM,KAAN,EAAR,GAA0B,KAAO,IAAzC,CAAgD,CAC5C,KAAO,KAAO,IAAd,CACH,CAED,MAAO,CAAC,OAAS,GAAT,CAAe,IAAf,CAAsB,KAAK,OAAL,CAAc,aAAe,CAA7B,CAAvB,EACC,IADR,CAEH,CAhQE,CAAP,CAkQH,CAzSD,E;;;OA8SA,OAAO,UAAP,CAAkB,CACd,MADc,CAAlB,CAEG,SAAU,IAAV,CAAiB,CAChB,GAAI,GAAI,KAAK,CAAb,CACI,MAAQ,GAAG,KADf,CAEI,UAAY,KAFhB,CAGI,MAHJ,C;AAMA,QAAS,aAAT,CAAuB,GAAvB,CAA4B,IAA5B,CAAkC,QAAlC,CAA4C,OAA5C,CAAsD,CAClD,MAAO,GAAE,IAAF,CAAQ,GAAR,CAAa,SAAU,OAAV,CAAoB,CACpC,MAAO,WACE,CAAC,IAAD,EAAS,QAAQ,CAAR,GAAc,IADzB,IAEE,CAAC,QAAD,EAAa,QAAQ,EAAR,GAAe,QAA5B,EACD,QAAQ,EAAR,CAAW,GAAX,GAAmB,QAHpB,IAIE,CAAC,OAAD,EAAY,QAAQ,GAAR,GAAgB,OAJ9B,CAAP,CAKH,CANM,CAAP,CAOH,CAED,QAAS,UAAT,CAAoB,MAApB,CAA4B,QAA5B,CAAsC,QAAtC,CAAiD,C;AAE7C,EAAE,IAAF,CAAQ,CAAC,QAAU,EAAX,EAAe,KAAf,CAAsB,SAAtB,CAAR,CAA2C,SAAU,CAAV,CAAa,GAAb,CAAmB,CAC1D,SAAU,GAAV,CAAe,QAAf,EACH,CAFD,EAGH,CAED,QAAS,eAAT,CAAyB,MAAzB,CAAiC,IAAjC,CAAwC,CACpC,GAAI,QAAS,KAAb,CACI,EAAI,CAAC,CADT,CAEI,IAAM,OAAO,MAFjB,CAGI,OAHJ,CAKA,MAAQ,EAAE,CAAF,CAAM,GAAd,CAAoB,CAChB,QAAU,OAAQ,CAAR,CAAV,CAEA,GAAK,QAAQ,EAAR,CAAW,KAAX,CAAkB,QAAQ,IAA1B,CAAgC,IAAhC,IAA2C,KAAhD,CAAwD,CACpD,OAAS,IAAT,CACA,MACH,CACJ,CAED,MAAO,CAAC,MAAR,CACH,CAED,OAAS,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAuCL,GAAI,SAAU,IAAV,CAAgB,QAAhB,CAA0B,OAA1B,CAAoC,CACpC,GAAI,IAAK,IAAT,CACI,GADJ,CAGA,GAAK,CAAC,QAAN,CAAiB,CACb,MAAO,KAAP,CACH,CAED,IAAM,KAAK,OAAL,GAAiB,KAAK,OAAL,CAAe,EAAhC,CAAN,CAEA,UAAW,IAAX,CAAiB,QAAjB,CAA2B,SAAU,IAAV,CAAgB,QAAhB,CAA2B,CAClD,GAAI,SAAU,CAAE,EAAG,IAAL,CAAd,CAEA,QAAQ,EAAR,CAAa,QAAb,CACA,QAAQ,GAAR,CAAc,OAAd,CACA,QAAQ,IAAR,CAAe,SAAW,EAA1B,CACA,QAAQ,EAAR,CAAa,IAAI,MAAjB,CAEA,IAAI,IAAJ,CAAU,OAAV,EACH,CATD,EAWA,MAAO,KAAP,CACH,CA7DI,C;;;;;;;;;eAyEL,KAAM,SAAU,IAAV,CAAgB,QAAhB,CAA0B,OAA1B,CAAoC,CACtC,GAAI,IAAK,IAAT,CAEA,GAAK,CAAC,QAAN,CAAiB,CACb,MAAO,GAAP,CACH,CAED,UAAW,IAAX,CAAiB,QAAjB,CAA2B,SAAU,IAAV,CAAgB,QAAhB,CAA2B,CAClD,GAAI,MAAO,UAAW,CACd,GAAG,GAAH,CAAQ,IAAR,CAAc,IAAd,EACA,MAAO,UAAS,KAAT,CAAgB,SAAW,EAA3B,CAA+B,SAA/B,CAAP,CACH,CAHL,CAKA,KAAK,GAAL,CAAW,QAAX,CACA,GAAG,EAAH,CAAO,IAAP,CAAa,IAAb,CAAmB,OAAnB,EACH,CARD,EAUA,MAAO,GAAP,CACH,CA3FI,C;;;;;;;;;eAuGL,IAAK,SAAU,IAAV,CAAgB,EAAhB,CAAoB,GAApB,CAA0B,CAC3B,GAAI,QAAS,KAAK,OAAlB,CAEA,GAAK,CAAC,MAAN,CAAe,CACX,MAAO,KAAP,CACH,CAED,GAAK,CAAC,IAAD,EAAS,CAAC,EAAV,EAAgB,CAAC,GAAtB,CAA4B,CACxB,KAAK,OAAL,CAAe,EAAf,CACA,MAAO,KAAP,CACH,CAED,UAAW,IAAX,CAAiB,EAAjB,CAAqB,SAAU,IAAV,CAAgB,EAAhB,CAAqB,CACtC,EAAE,IAAF,CAAQ,aAAc,MAAd,CAAsB,IAAtB,CAA4B,EAA5B,CAAgC,GAAhC,CAAR,CAA+C,UAAW,CACtD,MAAO,QAAQ,KAAK,EAAb,CAAP,CACH,CAFD,EAGH,CAJD,EAMA,MAAO,KAAP,CACH,CA1HI,C;;;;;;;eAoIL,QAAS,SAAU,IAAV,CAAiB,CACtB,GAAI,KAAJ,CAAU,MAAV,CAAkB,SAAlB,CAEA,GAAK,CAAC,KAAK,OAAN,EAAiB,CAAC,IAAvB,CAA8B,CAC1B,MAAO,KAAP,CACH,CAED,KAAO,MAAM,IAAN,CAAY,SAAZ,CAAuB,CAAvB,CAAP,CACA,OAAS,aAAc,KAAK,OAAnB,CAA4B,IAA5B,CAAT,CACA,UAAY,aAAc,KAAK,OAAnB,CAA4B,KAA5B,CAAZ,CAEA,MAAO,gBAAgB,MAAhB,CAAwB,IAAxB,GACC,eAAgB,SAAhB,CAA2B,SAA3B,CADR,CAEH,CAjJI,CAAT,C;;;;;WA0JA,MAAO,GAAE,MAAF,CAAS,C;;;;;eAQZ,UAAW,SAAU,GAAV,CAAgB,CACvB,MAAO,GAAE,MAAF,CAAU,GAAV,CAAe,MAAf,CAAP,CACH,CAVW,CAAT,CAYJ,MAZI,CAAP,CAaH,CAnND,E;;OAuNA,OAAO,UAAP,CAAkB,CACd,MADc,CAEd,UAFc,CAAlB,CAGG,SAAU,IAAV,CAAgB,QAAhB,CAA2B,CAE1B,GAAI,GAAI,KAAK,CAAb,C;;;;;;;;;;;;WAeA,QAAS,SAAT,CAAmB,IAAnB,CAA0B,CACtB,KAAK,OAAL,CAAe,EAAE,MAAF,CAAU,IAAV,CAAgB,EAAhB,CAAoB,SAAS,OAA7B,CAAsC,IAAtC,CAAf,CACA,KAAK,KAAL,CAAY,KAAK,OAAjB,EACH,C;;AAID,SAAS,OAAT,CAAmB,EAAnB,CACA,SAAS,SAAT,CAAoB,SAAS,SAA7B,E;AAGA,EAAE,IAAF,CAAO,CACH,OAAQ,cADL,CAEH,KAAM,aAFH,CAGH,QAAS,UAHN,CAIH,SAAU,WAJP,CAKH,QAAS,UALN,CAMH,SAAU,UANP,CAOH,KAAM,YAPH,CAQH,WAAY,aART,CASH,SAAU,WATP,CAUH,MAAO,OAVJ,CAWH,aAAc,gBAXX,CAYH,UAAW,YAZR,CAaH,aAAc,eAbX,CAcH,UAAW,SAdR,CAeH,eAAgB,kBAfb,CAgBH,QAAS,SAhBN,CAiBH,QAAS,SAjBN,CAkBH,OAAQ,QAlBL,CAmBH,MAAO,OAnBJ,CAAP,CAoBG,SAAU,EAAV,CAAc,OAAd,CAAwB,CACvB,SAAS,SAAT,CAAoB,EAApB,EAA2B,UAAW,CAClC,MAAO,MAAK,OAAL,CAAc,OAAd,CAAuB,SAAvB,CAAP,CACH,CAFD,CAGH,CAxBD,EA0BA,EAAE,MAAF,CAAU,SAAS,SAAnB,CAA8B,CAC1B,MAAO,SADmB,CAG1B,MAAO,SAAU,IAAV,CAAiB,CACpB,GAAI,IAAK,IAAT,CAEA,GAAG,OAAH,CAAY,MAAZ,CAAoB,IAApB,CAA0B,UAAW,CACjC,GAAG,KAAH,CAAW,OAAX,CACA,GAAG,OAAH,CAAW,OAAX,EACH,CAHD,EAIH,CAVyB,C;;;;;;;;;;;;;;;;;eA8B1B,OAAQ,SAAU,GAAV,CAAe,GAAf,CAAqB,CACzB,GAAI,MAAO,KAAK,OAAhB,C;AAGA,GAAK,UAAU,MAAV,CAAmB,CAAxB,CAA4B,CAExB,GAAK,EAAE,aAAF,CAAiB,GAAjB,GACG,EAAE,aAAF,CAAiB,KAAM,GAAN,CAAjB,CADR,CACyC,CACrC,EAAE,MAAF,CAAU,KAAM,GAAN,CAAV,CAAuB,GAAvB,EACH,CAHD,IAGO,CACH,KAAM,GAAN,EAAc,GAAd,CACH,CAEJ,CATD,IASO,C;AACH,MAAO,KAAM,KAAM,GAAN,CAAN,CAAoB,IAA3B,CACH,CACJ,CA9CyB,C;;;;;;;;;eA0D1B,SAAU,UAAW,C;AAEjB,GAAI,OAAQ,KAAK,OAAL,CAAa,WAAb,CAAZ,CAEA,MAAO,CACH,WAAY,MAAM,YADf,C;;AAKH,UAAW,MAAM,WALd,CAMH,WAAY,MAAM,YANf,CAOH,cAAe,MAAM,iBAPlB,CAQH,SAAU,MAAM,UARb,CAAP,CAUH,CAxEyB,C;AA2E1B,QAAS,SAAU,I,aAAV,CAA8B,CACnC,GAAI,MAAO,GAAG,KAAH,CAAS,IAAT,CAAe,SAAf,CAA0B,CAA1B,CAAX,CACI,KAAO,KAAK,OADhB,CAEI,KAAO,KAAO,KAAK,SAAL,CAAgB,CAAhB,CAAmB,CAAnB,EAAuB,WAAvB,EAAP,CACH,KAAK,SAAL,CAAgB,CAAhB,CAHR,CAKA,G;AAEQ,SAAS,OAAT,CAAiB,KAAjB,CAAwB,IAAxB,CAA8B,SAA9B,IAA8C,KAA9C,E;AAGA,EAAE,UAAF,CAAc,KAAM,IAAN,CAAd,GACA,KAAM,IAAN,EAAa,KAAb,CAAoB,IAApB,CAA0B,IAA1B,IAAqC,KAJrC,E;AAOA,EAAE,UAAF,CAAc,KAAM,IAAN,CAAd,GACA,KAAM,IAAN,EAAa,KAAb,CAAoB,IAApB,CAA0B,IAA1B,IAAqC,KARrC,E;AAWA,SAAS,OAAT,CAAiB,KAAjB,CAAwB,QAAxB,CACA,CAAE,IAAF,CAAQ,IAAR,EAAe,MAAf,CAAuB,IAAvB,CADA,IACoC,KAd5C,CAcoD,CAEhD,MAAO,MAAP,CACH,CAED,MAAO,KAAP,CACH,CArGyB,C;AAwG1B,QAAS,KAAK,IAxGY,CAA9B,E;;;;;;WAkHA,KAAK,MAAL,CAAc,SAAS,MAAT,CAAkB,SAAU,IAAV,CAAiB,CAC7C,MAAO,IAAI,SAAJ,CAAc,IAAd,CAAP,CACH,CAFD,C;AAKA,KAAK,QAAL,CAAgB,QAAhB,CAEA,MAAO,SAAP,CACH,CAnLD,E;;OAuLA,OAAO,iBAAP,CAAyB,CACrB,MADqB,CAErB,UAFqB,CAAzB,CAGG,SAAU,IAAV,CAAgB,QAAhB,CAA2B,CAE1B,GAAI,GAAI,KAAK,CAAb,CACI,UAAY,EADhB,C;AAII,YAAc,SAAU,GAAV,CAAgB,CAC1B,IAAM,GAAI,IAAV,GAAiB,IAAjB,CAAuB,CACnB,GAAK,IAAI,cAAJ,CAAoB,GAApB,CAAL,CAAiC,CAC7B,MAAO,IAAP,CACH,CACJ,CACD,MAAO,KAAP,CACH,CAXL,C;AAcA,QAAS,QAAT,CAAkB,OAAlB,CAA4B,CACxB,KAAK,OAAL,CAAe,EAAE,MAAF,CAAS,CACpB,UAAW,SAAS,IADA,CAAT,CAEZ,OAFY,CAAf,CAGA,KAAK,GAAL,CAAW,KAAK,IAAL,CAAU,KAAV,CAAX,CACH,CAED,EAAE,MAAF,CAAU,QAAQ,SAAlB,CAA6B,CAEzB,aAAc,UAAW,CACrB,GAAI,MAAO,KAAK,OAAhB,CACI,MADJ,CACY,SADZ,CAGA,GAAK,KAAK,UAAV,CAAuB,CACnB,MAAO,MAAK,UAAZ,CACH,CAED,OAAS,EAAG,KAAK,SAAL,EAAkB,SAAS,IAA9B,CAAT,CACA,UAAY,EAAG,SAAS,aAAT,CAAuB,KAAvB,CAAH,CAAZ,CAEA,UAAU,IAAV,CAAgB,IAAhB,CAAsB,MAAQ,KAAK,GAAnC,EACA,UAAU,GAAV,CAAc,CACV,SAAU,UADA,CAEV,IAAK,KAFK,CAGV,KAAM,KAHI,CAIV,MAAO,KAJG,CAKV,OAAQ,KALE,CAMV,SAAU,QANA,CAAd,EASA,OAAO,MAAP,CAAe,SAAf,EACA,OAAO,QAAP,CAAgB,uBAAhB,EACA,KAAK,UAAL,CAAkB,SAAlB,CACA,MAAO,UAAP,CACH,CA3BwB,CA6BzB,KAAM,KAAK,IA7Bc,CA8BzB,KAAM,KAAK,IA9Bc,CAgCzB,QAAS,UAAW,CAChB,GAAK,KAAK,UAAV,CAAuB,CACnB,KAAK,UAAL,CAAgB,UAAhB,CAA2B,WAA3B,CAAwC,KAAK,WAA7C,EACH,CAED,KAAK,GAAL,GACH,CAtCwB,CAA7B,EAyCA,QAAQ,MAAR,CAAiB,aAAjB,C;;;;WAQA,QAAQ,UAAR,CAAqB,SAAU,IAAV,CAAgB,OAAhB,CAA0B,CAC3C,UAAW,IAAX,EAAoB,OAApB,CACH,CAFD,CAIA,QAAQ,UAAR,CAAqB,SAAU,IAAV,CAAiB,CAClC,MAAO,CAAC,EAAE,KAAO,UAAW,IAAX,CAAP,CAA2B,YAAa,SAAb,CAA7B,CAAR,CACH,CAFD,CAIA,QAAQ,MAAR,CAAiB,SAAU,IAAV,CAAgB,MAAhB,CAAyB,CACtC,GAAI,KAAJ,CAAU,OAAV,CAEA,OAAS,QAAU,QAAQ,MAA3B,CACA,EAAE,IAAF,CAAQ,OAAO,KAAP,CAAc,UAAd,CAAR,CAAoC,UAAW,CAC3C,GAAK,UAAW,IAAX,CAAL,CAAyB,CACrB,KAAO,IAAP,CACA,MAAO,MAAP,CACH,CACJ,CALD,EAOA,KAAO,MAAQ,YAAa,SAAb,CAAf,CAEA,GAAK,CAAC,IAAN,CAAa,CACT,KAAM,IAAI,MAAJ,CAAU,eAAV,CAAN,CACH,CAED,QAAU,GAAI,WAAW,IAAX,CAAJ,CAAuB,IAAvB,CAAV,CACA,MAAO,QAAP,CACH,CAnBD,CAqBA,SAAS,SAAT,CAAoB,QAAQ,SAA5B,EACA,MAAO,QAAP,CACH,CA1GD,E;;OA+GA,OAAO,gBAAP,CAAwB,CACpB,MADoB,CAEpB,UAFoB,CAGpB,iBAHoB,CAAxB,CAIG,SAAU,IAAV,CAAgB,QAAhB,CAA0B,OAA1B,CAAoC,CAEnC,GAAI,MAAJ,CAEA,MAAS,UAAW,CAChB,GAAI,KAAM,EAAV,CAEA,MAAO,CACH,IAAK,SAAU,OAAV,CAAoB,CACrB,IAAK,QAAQ,GAAb,EAAqB,OAArB,CACH,CAHE,CAKH,IAAK,SAAU,IAAV,CAAgB,UAAhB,CAA6B,CAC9B,GAAI,EAAJ,CAEA,GAAK,IAAL,CAAY,CACR,MAAO,KAAK,IAAL,CAAP,CACH,CAED,IAAM,CAAN,GAAW,IAAX,CAAiB,C;AAEb,GAAK,YAAc,IAAK,CAAL,EAAS,YAA5B,CAA2C,CACvC,SACH,CAED,MAAO,KAAK,CAAL,CAAP,CACH,CAED,MAAO,KAAP,CACH,CAtBE,CAwBH,OAAQ,SAAU,OAAV,CAAoB,CACxB,MAAO,KAAK,QAAQ,GAAb,CAAP,CACH,CA1BE,CAAP,CA4BH,CA/BO,EAAR,CAiCA,QAAS,cAAT,CAAwB,SAAxB,CAAmC,UAAnC,CAAgD,CAC5C,GAAI,UAAW,KAAK,QAAL,EAAf,CACI,OADJ,CAGA,KAAK,GAAL,CAAW,KAAK,IAAL,CAAU,SAAV,CAAX,C;AAGA,KAAK,YAAL,CAAoB,SAAU,EAAV,CAAe,CAC/B,MAAO,UAAS,IAAT,CAAe,EAAf,CAAP,CACH,CAFD,CAIA,KAAK,cAAL,CAAsB,SAAU,IAAV,CAAgB,EAAhB,CAAqB,C;AAGvC,GAAK,OAAL,CAAe,CACX,KAAM,IAAI,MAAJ,CAAU,oBAAV,CAAN,CACH,CAED,SAAS,IAAT,CAAe,EAAf,EAEA,GAAK,MAAO,KAAP,GAAgB,QAAhB,EAA4B,MAAM,GAAN,CAAW,IAAX,CAAjC,CAAqD,CACjD,QAAU,MAAM,GAAN,CAAW,IAAX,CAAV,CACH,C;AAGD,QAAU,SAAW,MAAM,GAAN,CAAW,IAAX,CAAiB,UAAjB,CAArB,C;AAGA,GAAK,CAAC,OAAN,CAAgB,CACZ,QAAU,QAAQ,MAAR,CAAgB,IAAhB,CAAsB,KAAK,YAA3B,CAAV,CACA,QAAQ,SAAR,CAAoB,SAAS,OAAT,EAApB,CACA,QAAQ,IAAR,CAAc,OAAd,CAAuB,SAAS,OAAhC,EACA,QAAQ,IAAR,GACA,MAAM,GAAN,CAAW,OAAX,EACA,QAAQ,QAAR,CAAmB,CAAnB,CACH,CAPD,IAOO,C;AAEH,KAAK,CAAL,CAAO,MAAP,CAAe,QAAQ,OAAvB,CAAgC,IAAhC,EACA,QAAQ,SAAR,CAAkB,IAAlB,CAAwB,SAAS,OAAjC,EACA,QAAQ,QAAR,GACH,CAED,aAAe,QAAQ,YAAR,CAAuB,UAAtC,EACA,MAAO,QAAP,CACH,CAjCD,CAmCA,KAAK,UAAL,CAAkB,UAAW,CACzB,MAAO,QAAP,CACH,CAFD,CAIA,KAAK,iBAAL,CAAyB,UAAW,CAChC,GAAK,CAAC,OAAN,CAAgB,CACZ,OACH,CAED,QAAQ,QAAR,GAEA,GAAK,QAAQ,QAAR,EAAoB,CAAzB,CAA6B,CACzB,MAAM,MAAN,CAAc,OAAd,EACA,MAAO,SAAQ,SAAf,CACA,QAAQ,OAAR,GACH,CAED,QAAU,IAAV,CACH,CAdD,CAgBA,KAAK,IAAL,CAAY,UAAW,CACnB,GAAK,CAAC,OAAN,CAAgB,CACZ,OACH,CAED,GAAI,MAAO,KAAK,KAAL,CAAY,SAAZ,CAAX,CACA,WAAa,KAAK,OAAL,CAAc,SAAd,CAAb,CAEA,MAAO,SAAQ,IAAR,CAAa,KAAb,CAAoB,IAApB,CAA0B,IAA1B,CAAP,CACH,CATD,CAWA,KAAK,OAAL,CAAe,UAAW,CACtB,MAAO,UAAW,QAAQ,GAA1B,CACH,CAFD,CAIA,KAAK,OAAL,CAAgB,SAAU,OAAV,CAAoB,CAChC,MAAO,WAAW,CACd,SAAW,QAAQ,KAAR,CAAe,IAAf,CAAqB,SAArB,CAAX,CACA,KAAK,OAAL,CAAa,SAAb,EACA,KAAK,GAAL,GACA,KAAK,IAAL,CAAU,SAAV,EACA,KAAK,iBAAL,GACH,CAND,CAOH,CARc,CAQX,KAAK,OARM,CAAf,CASH,CAED,SAAS,SAAT,CAAoB,cAAc,SAAlC,EACA,MAAO,cAAP,CACH,CAvID,E;;OA2IA,OAAO,SAAP,CAAiB,CACb,MADa,CAEb,UAFa,CAGb,gBAHa,CAAjB,CAIG,SAAU,IAAV,CAAgB,QAAhB,CAA0B,YAA1B,CAAyC,CAExC,GAAI,GAAI,KAAK,CAAb,CAEA,QAAS,YAAT,CAAsB,IAAtB,CAA6B,CACzB,KAAO,KAAK,OAAL,CAAe,EAAE,MAAF,CAAS,EAAT,CAAa,YAAY,OAAzB,CAAkC,IAAlC,CAAtB,CAEA,KAAK,SAAL,CAAiB,EAAG,KAAK,SAAR,CAAjB,CAEA,GAAK,CAAC,KAAK,SAAL,CAAe,MAArB,CAA8B,CAC1B,OACH,CAED,aAAa,IAAb,CAAmB,IAAnB,CAAyB,aAAzB,EACH,CAED,YAAY,OAAZ,CAAsB,CAClB,OAAQ,IADU,CAElB,iBAAkB,KAFA,CAAtB,CAKA,KAAK,QAAL,CAAe,YAAf,CAA6B,CACzB,YAAa,WADY,CAGzB,KAAM,UAAW,CACb,GAAI,IAAK,IAAT,CAEA,GAAG,cAAH,CAAmB,GAAG,OAAtB,CAA+B,UAAW,CACtC,GAAG,IAAH,CAAQ,MAAR,EACA,GAAG,OAAH,CAAW,OAAX,EACH,CAHD,EAIH,CAVwB,CAYzB,QAAS,UAAW,CAChB,KAAK,iBAAL,GACH,CAdwB,CAA7B,EAiBA,SAAS,SAAT,CAAoB,YAAY,SAAhC,EAEA,MAAO,YAAP,CACH,CA7CD,E;;OAiDA,OAAO,gBAAP,CAAwB,CACpB,MADoB,CAEpB,UAFoB,CAAxB,CAGG,SAAU,IAAV,CAAgB,QAAhB,CAA2B,CAE1B,GAAI,GAAI,KAAK,CAAb,CACI,MAAQ,SAAS,SAAT,CAAmB,KAD/B,CAEI,OAAS,EAFb,CAGI,YAAc,EAHlB,CAKA,QAAS,YAAT,CAAsB,GAAtB,CAA4B,CACxB,GAAK,CAAC,GAAN,CAAY,CACR,MAAO,MAAP,CACH,CAED,GAAI,QAAS,IAAI,MAAjB,CACI,KAAO,EAAE,IAAF,CAAQ,GAAR,CADX,CAGA,GAAK,IAAI,QAAJ,GAAiB,CAAjB,EAAsB,MAA3B,CAAoC,CAChC,MAAO,KAAP,CACH,CAED,MAAO,QAAS,OAAT,EAAoB,OAAS,UAAT,EAAuB,OAAS,QAAhC,GAClB,SAAW,CAAX,EAAgB,MAAO,OAAP,GAAkB,QAAlB,EAA8B,OAAS,CAAvC,EAChB,OAAS,CAAV,GAAgB,IAFG,CAA3B,CAGH,CAED,QAAS,OAAT,CAAiB,QAAjB,CAA4B,CACxB,KAAK,KAAL,CAAa,QAAb,CACA,KAAK,OAAL,CAAe,SAAS,OAAxB,CACH,CAED,EAAE,MAAF,CAAU,OAAO,SAAjB,CAA4B,CAExB,KAAM,KAAK,IAFa,C;;AAMxB,OAAQ,SAAU,OAAV,CAAmB,IAAnB,CAA0B,C;;;;mBAO9B,GAAI,KAAM,KAAK,WAAf,C;AAGA,GAAK,CAAC,GAAD,EAAQ,EAAE,UAAW,IAAb,CAAR,EAA6B,EAAE,IAAK,OAAL,GAAkB,KAApB,CAA7B,EACG,CAAC,EAAE,UAAF,CAAc,KAAM,IAAK,OAAL,CAAN,CAAd,CADT,CACkD,CAE9C,MAAO,OAAP,CACH,CAED,MAAO,MAAM,IAAK,OAAL,CAAN,EAAuB,KAAvB,CAA8B,IAA9B,CAAoC,IAApC,CAAP,CAEH,CAxBuB,C;;;;;;eAiCxB,QAAS,UAAW,CAChB,MAAO,MAAK,KAAL,CAAW,OAAX,CAAmB,KAAnB,CAA0B,KAAK,KAA/B,CAAsC,SAAtC,CAAP,CACH,CAnCuB,CAA5B,E;AAuCA,EAAE,MAAF,CAAU,SAAS,SAAnB,CAA8B,C;AAG1B,MAAO,UAAW,CACd,GAAI,IAAK,IAAT,CACI,QAAU,GAAG,QAAH,CAAc,EAD5B,CAGA,EAAE,IAAF,CAAQ,WAAR,CAAqB,SAAU,CAAV,CAAa,KAAb,CAAqB,CACtC,QAAQ,IAAR,CAAc,GAAI,MAAJ,CAAW,EAAX,CAAd,EACH,CAFD,EAIA,MAAO,OAAM,KAAN,CAAa,EAAb,CAAiB,SAAjB,CAAP,CACH,CAZyB,CAc1B,QAAS,SAAU,OAAV,CAAmB,IAAnB,CAAyB,QAAzB,CAAoC,CACzC,GAAI,GAAI,CAAR,CACI,QAAU,KAAK,QADnB,CAEI,IAAM,QAAQ,MAFlB,CAGI,KAAO,EAHX,CAII,KAAO,EAJX,CAKI,MALJ,CAKY,GALZ,CAKiB,OALjB,CAK0B,GAL1B,CAOA,KAAO,YAAa,IAAb,EAAsB,IAAtB,CAA6B,CAAE,IAAF,CAApC,CAEA,KAAQ,EAAI,GAAZ,CAAiB,GAAjB,CAAuB,CACnB,OAAS,QAAS,CAAT,CAAT,CACA,IAAM,OAAO,MAAP,CAAe,OAAf,CAAwB,IAAxB,CAAN,CAEA,GAAK,MAAQ,MAAb,CAAsB,C;AAGlB,GAAK,KAAK,SAAL,CAAgB,GAAhB,CAAL,CAA6B,CACzB,KAAK,IAAL,CAAW,GAAX,EACH,CAFD,IAEO,CACH,KAAK,IAAL,CAAW,GAAX,EACH,CACJ,CACJ,C;AAGD,GAAK,UAAY,KAAK,MAAtB,CAA+B,CAC3B,QAAU,KAAK,IAAL,CAAU,KAAV,CAAiB,IAAjB,CAAuB,IAAvB,CAAV,CACA,IAAM,QAAQ,IAAR,CAAe,MAAf,CAAwB,MAA9B,C;;AAIA,MAAO,SAAS,GAAT,EAAe,UAAW,CACrB,GAAI,UAAW,KAAK,QAAL,EAAf,CACI,KAAO,SADX,CAGA,WAAW,UAAW,CAClB,SAAS,OAAT,CAAiB,KAAjB,CAAwB,QAAxB,CAAkC,IAAlC,EACH,CAFD,CAEG,CAFH,EAIA,MAAO,UAAS,OAAT,EAAP,CACH,CATF,EASK,GATL,EASY,UAAY,KAAK,IAT7B,CAAP,CAUH,CAhBD,IAgBO,CACH,MAAO,MAAM,CAAN,CAAP,CACH,CACJ,CA3DyB,CAA9B,E;;;;;;;;;;;WA0EA,SAAS,QAAT,CAAoB,OAAO,QAAP,CAAkB,SAAU,WAAV,CAAuB,WAAvB,CAAqC,CACvE,GAAI,KAAM,CAAE,KAAM,MAAR,CAAV,CACI,KADJ,CAGA,GAAK,UAAU,MAAV,GAAqB,CAA1B,CAA8B,CAC1B,YAAc,WAAd,CACA,YAAY,WAAZ,CAA0B,GAA1B,CACH,CAHD,IAGO,CACH,YAAY,WAAZ,CAA0B,EAAE,MAAF,CAAU,GAAV,CAAe,WAAf,CAA1B,CACH,CAED,MAAQ,KAAK,QAAL,CAAe,MAAf,CAAuB,WAAvB,CAAR,CACA,YAAY,IAAZ,CAAkB,KAAlB,EAEA,MAAO,MAAP,CACH,CAfD,CAiBA,MAAO,OAAP,CACH,CAnKD,E;;OAuKA,OAAO,iBAAP,CAAyB,CACrB,MADqB,CAErB,UAFqB,CAGrB,SAHqB,CAIrB,gBAJqB,CAAzB,CAKG,SAAU,IAAV,CAAgB,QAAhB,CAA0B,GAA1B,CAAgC,CAC/B,GAAI,GAAI,KAAK,CAAb,CAEA,SAAS,OAAT,CAAiB,GAAjB,CAAuB,EAAvB,C;;;;;;;;;WAcA,MAAO,UAAS,QAAT,CAAkB,CACrB,KAAM,SAAU,IAAV,CAAiB,CAEnB,GAAK,CAAC,KAAK,GAAN,EACG,KAAK,OAAL,CAAa,sBAAb,IAAyC,OADjD,CAC2D,CACvD,OACH,CAED,GAAI,IAAK,IAAT,CACI,SAAW,KAAK,QAAL,EADf,CAEI,QAAU,EAAE,MAAF,CAAS,EAAT,CAAa,CACnB,iBAAkB,KAAK,gBADJ,CAEnB,UAAW,KAAK,GAFG,CAGnB,OAAQ,KAAK,MAHM,CAAb,CAFd,CAOI,GAPJ,CASA,IAAM,GAAI,IAAJ,CAAS,OAAT,CAAN,CAEA,IAAI,IAAJ,CAAU,OAAV,CAAmB,SAAS,OAA5B,EACA,IAAI,EAAJ,CAAQ,MAAR,CAAgB,SAAU,KAAV,CAAkB,CAC9B,GAAG,OAAH,CAAY,UAAZ,CAAwB,CAAE,KAAF,CAAxB,EACH,CAFD,E;AAKA,IAAI,EAAJ,CAAQ,QAAR,CAAkB,SAAU,KAAV,CAAkB,CAChC,MAAO,IAAG,KAAH,CAAS,OAAT,CAAkB,WAAlB,CAA+B,KAA/B,CAAP,CACH,CAFD,EAIA,IAAI,IAAJ,GAEA,MAAO,UAAS,OAAT,EAAP,CACH,CAhCoB,CAAlB,CAAP,CAkCH,CAxDD,E;;OA6DA,OAAO,eAAP,CAAuB,CACnB,MADmB,CAEnB,UAFmB,CAGnB,gBAHmB,CAAvB,CAIG,SAAU,IAAV,CAAgB,QAAhB,CAA0B,YAA1B,CAAyC,CAExC,GAAI,GAAI,KAAK,CAAb,CAEA,QAAS,UAAT,CAAoB,IAApB,CAA2B,CACvB,KAAO,KAAK,OAAL,CAAe,EAAE,MAAF,CAAS,EAAT,CAAa,IAAb,CAAtB,CACA,KAAK,SAAL,CAAiB,EAAG,KAAK,SAAL,EAAkB,SAAS,IAA9B,CAAjB,CACA,aAAa,IAAb,CAAmB,IAAnB,CAAyB,WAAzB,EACH,CAED,KAAK,QAAL,CAAe,YAAf,CAA6B,CACzB,YAAa,SADY,CAGzB,KAAM,UAAW,CACb,GAAI,IAAK,IAAT,CAEA,GAAG,cAAH,CAAmB,GAAG,OAAtB,CAA+B,UAAW,CACtC,GAAG,IAAH,CAAQ,MAAR,EACA,GAAG,OAAH,CAAW,OAAX,EACH,CAHD,EAIH,CAVwB,CAYzB,QAAS,UAAW,CAChB,KAAK,IAAL,CAAU,SAAV,EACA,KAAK,iBAAL,GACA,KAAK,GAAL,GACH,CAhBwB,CAA7B,EAmBA,SAAS,SAAT,CAAoB,UAAU,SAA9B,EAEA,MAAO,UAAP,CACH,CApCD,E;;OAwCA,OAAO,mBAAP,CAA2B,CACvB,MADuB,CAEvB,UAFuB,CAGvB,eAHuB,CAIvB,gBAJuB,CAA3B,CAKG,SAAU,IAAV,CAAgB,QAAhB,CAA0B,SAA1B,CAAsC,CACrC,GAAI,GAAI,KAAK,CAAb,C;;;;WAOA,MAAO,UAAS,QAAT,CAAkB,CACrB,KAAM,SAAU,IAAV,CAAiB,CAEnB,GAAK,CAAC,KAAK,KAAN,EACG,KAAK,OAAL,CAAa,sBAAb,IAAyC,OADjD,CAC2D,CACvD,OACH,CAED,GAAI,IAAK,IAAT,CACI,SAAW,KAAK,QAAL,EADf,CAEI,QAAU,EAAE,MAAF,CAAS,EAAT,CAAa,CACnB,UAAW,KAAK,KADG,CAEnB,OAAQ,KAAK,MAFM,CAAb,CAFd,CAMI,KANJ,CAQA,MAAQ,GAAI,UAAJ,CAAe,OAAf,CAAR,CAEA,MAAM,IAAN,CAAY,OAAZ,CAAqB,SAAS,OAA9B,EACA,MAAM,EAAN,CAAU,OAAV,CAAmB,SAAU,KAAV,CAAkB,CACjC,GAAG,KAAH,CAAS,OAAT,CAAkB,UAAlB,CAA8B,CAAE,KAAF,CAA9B,EACH,CAFD,EAGA,MAAM,IAAN,GAEA,MAAO,UAAS,OAAT,EAAP,CACH,CAzBoB,CAAlB,CAAP,CA2BH,CAxCD,E;;OA4CA,OAAO,UAAP,CAAkB,CACd,MADc,CAEd,gBAFc,CAAlB,CAGG,SAAU,IAAV,CAAgB,aAAhB,CAAgC,CAE/B,QAAS,KAAT,CAAe,IAAf,CAAqB,MAArB,CAA8B,CAC1B,GAAI,IAAK,IAAT,CAEA,GAAG,MAAH,CAAY,MAAZ,CACA,GAAG,IAAH,CAAU,IAAV,CAEA,cAAc,IAAd,CAAoB,EAApB,CAAwB,MAAxB,EAEA,KAAK,GAAL,CAAW,OAAO,GAAP,EAAc,KAAK,GAA9B,CACA,KAAK,IAAL,CAAY,OAAO,IAAP,EAAe,EAA3B,CACA,KAAK,IAAL,CAAY,OAAO,IAAP,EAAe,CAA3B,CAEA,GAAK,IAAL,CAAY,CACR,GAAG,cAAH,CAAmB,IAAnB,EACH,CACJ,CAED,KAAK,QAAL,CAAe,aAAf,CAA8B,CAC1B,YAAa,IADa,CAG1B,MAAO,SAAU,KAAV,CAAiB,GAAjB,CAAuB,CAC1B,MAAO,MAAK,IAAL,CAAW,OAAX,CAAoB,KAApB,CAA2B,GAA3B,CAAP,CACH,CALyB,CAO1B,UAAW,UAAW,CAClB,MAAO,MAAK,MAAZ,CACH,CATyB,CAA9B,EAYA,MAAO,KAAP,CACH,CAnCD,E;;;;OAyCA,OAAO,UAAP,CAAkB,CACd,MADc,CAEd,UAFc,CAAlB,CAGG,SAAU,IAAV,CAAgB,IAAhB,CAAuB,CAEtB,GAAI,KAAM,CAAV,CACI,KAAO,YADX,CAGA,QAAS,KAAT,CAAe,IAAf,CAAqB,IAArB,CAA4B,CACxB,GAAI,IAAJ,CAEA,KAAK,KAAL,CAAY,IAAZ,CAAkB,SAAlB,EACA,KAAK,IAAL,CAAY,KAAK,IAAL,EAAc,WAAa,KAAvC,CACA,IAAM,KAAK,IAAL,CAAW,KAAK,IAAhB,EAAyB,OAAO,EAAP,CAAU,WAAV,EAAzB,CAAmD,EAAzD,C;;AAKA,GAAK,CAAC,GAAD,EAAQ,KAAK,IAAlB,CAAyB,CACrB,IAAM,6BAA6B,IAA7B,CAAmC,KAAK,IAAxC,EACE,OAAO,EAAP,CAAU,WAAV,EADF,CAC4B,EADlC,CAEA,KAAK,IAAL,EAAa,IAAM,GAAnB,CACH,C;AAGD,GAAK,CAAC,KAAK,IAAN,EAAe,CAAC,uBAAuB,OAAvB,CAAgC,GAAhC,CAArB,CAA6D,CACzD,KAAK,IAAL,CAAY,UAAY,MAAQ,KAAR,CAAgB,MAAhB,CAAyB,GAArC,CAAZ,CACH,CAED,KAAK,GAAL,CAAW,GAAX,CACA,KAAK,gBAAL,CAAwB,KAAK,gBAAL,EACf,GAAI,KAAJ,EAAD,CAAa,cAAb,EADR,CAEH,CAED,MAAO,MAAK,QAAL,CAAe,IAAf,CAAqB,IAArB,CAAP,CACH,CAnCD,E;;OAwCA,OAAO,gBAAP,CAAwB,CACpB,MADoB,CAEpB,gBAFoB,CAGpB,UAHoB,CAAxB,CAIG,SAAU,IAAV,CAAgB,YAAhB,CAA8B,IAA9B,CAAqC,CAEpC,GAAI,GAAI,KAAK,CAAb,CAEA,QAAS,WAAT,CAAqB,IAArB,CAA4B,CACxB,KAAO,KAAK,OAAL,CAAe,EAAE,MAAF,CAAS,EAAT,CAAa,WAAW,OAAxB,CAAiC,IAAjC,CAAtB,CAEA,KAAK,SAAL,CAAiB,EAAG,KAAK,EAAR,CAAjB,CAEA,GAAK,CAAC,KAAK,SAAL,CAAe,MAArB,CAA8B,CAC1B,KAAM,IAAI,MAAJ,CAAU,QAAV,CAAN,CACH,CAED,KAAK,SAAL,CAAiB,KAAK,SAAL,EAAkB,KAAK,KAAvB,EACT,KAAK,SAAL,CAAe,IAAf,EADS,EACgB,EADjC,CAGA,KAAK,MAAL,CAAc,EAAG,KAAK,MAAL,EAAe,SAAS,aAAT,CAAuB,KAAvB,CAAlB,CAAd,CACA,KAAK,MAAL,CAAY,IAAZ,CAAkB,KAAK,SAAvB,EACA,KAAK,SAAL,CAAe,IAAf,CAAqB,KAAK,MAA1B,EAEA,aAAa,IAAb,CAAmB,IAAnB,CAAyB,YAAzB,CAAuC,IAAvC,EACH,CAED,WAAW,OAAX,CAAqB,CACjB,OAAQ,IADS,CAEjB,UAAW,IAFM,CAGjB,MAAO,IAHU,CAIjB,UAAW,IAJM,CAKjB,SAAU,IALO,CAMjB,OAAQ,IANS,CAOjB,KAAM,MAPW,CAArB,CAUA,KAAK,QAAL,CAAe,YAAf,CAA6B,CACzB,YAAa,UADY,CAGzB,KAAM,UAAW,CACb,GAAI,IAAK,IAAT,CACI,KAAO,GAAG,OADd,CAEI,OAAS,KAAK,MAFlB,CAIA,OAAO,QAAP,CAAgB,kBAAhB,EAEA,GAAG,EAAH,CAAO,KAAP,CAAc,SAAU,IAAV,CAAiB,CAC3B,GAAI,MAAJ,CAEA,OAAS,IAAT,EACI,IAAK,YAAL,CACI,OAAO,QAAP,CAAgB,wBAAhB,EACA,MAEJ,IAAK,YAAL,CACI,OAAO,WAAP,CAAmB,wBAAnB,EACA,MAEJ,IAAK,QAAL,CACI,MAAQ,GAAG,IAAH,CAAQ,UAAR,CAAR,CACA,GAAG,OAAH,CAAY,QAAZ,CAAsB,EAAE,GAAF,CAAO,KAAP,CAAc,SAAU,IAAV,CAAiB,CACjD,KAAO,GAAI,KAAJ,CAAU,GAAG,OAAH,EAAV,CAAwB,IAAxB,CAAP,C;AAGA,KAAK,MAAL,CAAc,KAAK,SAAnB,CACA,MAAO,KAAP,CACH,CANqB,CAAtB,CAMI,KAAK,SANT,EAOA,MAlBR,CAoBH,CAvBD,EAyBA,GAAG,cAAH,CAAmB,IAAnB,CAAyB,UAAW,CAChC,GAAG,OAAH,GACA,GAAG,IAAH,CAAS,MAAT,CAAiB,IAAjB,EACA,GAAG,OAAH,CAAW,OAAX,EACH,CAJD,EAMA,EAAG,MAAH,EAAY,EAAZ,CAAgB,QAAhB,CAA0B,UAAW,CACjC,GAAG,OAAH,GACH,CAFD,EAGH,CA5CwB,CA8CzB,QAAS,UAAW,CAChB,GAAI,eAAgB,KAAK,UAAL,GAAkB,YAAlB,EAApB,CACI,OAAS,KAAK,OAAL,CAAa,MAD1B,CAEI,MAAQ,OAAO,UAAP,CACA,OAAO,UAAP,EADA,CACsB,OAAO,KAAP,EAHlC,CAKI,OAAS,OAAO,WAAP,CACD,OAAO,WAAP,EADC,CACsB,OAAO,MAAP,EANnC,CAQI,IAAM,OAAO,MAAP,EARV,CAUA,OAAS,MAAT,EAAmB,cAAc,GAAd,CAAkB,CACjC,OAAQ,MADyB,CAEjC,MAAO,MAF0B,CAGjC,MAAO,MAAQ,IAHkB,CAIjC,OAAQ,OAAS,IAJgB,CAAlB,EAKhB,MALgB,CAKR,GALQ,CAAnB,CAMH,CA/DwB,CAiEzB,OAAQ,UAAW,CACf,GAAI,KAAM,KAAK,OAAL,CAAa,MAAvB,CAEA,IAAI,WAAJ,CAAgB,0BAAhB,EACA,KAAK,OAAL,GACH,CAtEwB,CAwEzB,QAAS,UAAW,CAChB,GAAI,KAAM,KAAK,OAAL,CAAa,MAAvB,CAEA,KAAK,UAAL,GAAkB,YAAlB,GAAiC,GAAjC,CAAqC,CACjC,IAAK,UAD4B,CAArC,EAIA,IAAI,QAAJ,CAAa,0BAAb,EACH,CAhFwB,CAkFzB,QAAS,UAAW,CAChB,GAAK,KAAK,OAAV,CAAoB,CAChB,KAAK,IAAL,CAAU,SAAV,EACA,KAAK,iBAAL,GACH,CACJ,CAvFwB,CAA7B,EA0FA,MAAO,WAAP,CACH,CAhID,E;;OAqIA,OAAO,oBAAP,CAA4B,CACxB,MADwB,CAExB,UAFwB,CAGxB,gBAHwB,CAIxB,gBAJwB,CAA5B,CAKG,SAAU,IAAV,CAAgB,QAAhB,CAA0B,UAA1B,CAAuC,CACtC,GAAI,GAAI,KAAK,CAAb,CAEA,EAAE,MAAF,CAAU,SAAS,OAAnB,CAA4B,C;;;;;;;;;;eAaxB,KAAM,IAbkB,C;;;;;;;;;;;;;;;;;;;eAmCxB,OAAQ,I;;;;eAnCgB,CAA5B,EA0CA,MAAO,UAAS,QAAT,CAAkB,CACrB,UAAW,WADU,CAErB,QAAS,SAFY,CAGrB,QAAS,SAHY,CAIrB,OAAQ,QAJa,CAAlB,CAKJ,CAEC,KAAM,SAAU,IAAV,CAAiB,CACnB,KAAK,OAAL,CAAe,EAAf,CACA,MAAO,MAAK,IAAL,EAAa,KAAK,SAAL,CAAgB,KAAK,IAArB,CAApB,CACH,CALF,CAOC,QAAS,UAAW,CAChB,EAAE,IAAF,CAAQ,KAAK,OAAb,CAAsB,UAAW,CAC7B,KAAK,OAAL,GACH,CAFD,EAGH,CAXF,C;;;;;;;;;;;eAyBC,UAAW,SAAU,IAAV,CAAiB,CACxB,GAAI,IAAK,IAAT,CACI,KAAO,GAAG,OADd,CAEI,OAAS,KAAK,MAFlB,CAGI,OAHJ,CAGa,MAHb,CAGqB,QAHrB,CAKA,GAAK,CAAC,IAAN,CAAa,CACT,OACH,CAED,SAAW,KAAK,QAAL,EAAX,CACA,EAAE,aAAF,CAAiB,IAAjB,IAA4B,KAAO,CAC/B,GAAI,IAD2B,CAAnC,EAIA,QAAU,EAAE,MAAF,CAAS,EAAT,CAAa,IAAb,CAAmB,CACzB,OAAQ,EAAE,aAAF,CAAiB,MAAjB,EAA4B,CAAE,MAAF,CAA5B,CAAyC,MADxB,CAEzB,IAAK,KAAK,GAFe,CAGzB,aAAc,KAAK,YAHM,CAAnB,CAAV,CAMA,OAAS,GAAI,WAAJ,CAAgB,OAAhB,CAAT,CAEA,OAAO,IAAP,CAAa,OAAb,CAAsB,SAAS,OAA/B,EACA,OAAO,EAAP,CAAW,QAAX,CAAqB,SAAU,KAAV,CAAkB,CACnC,GAAG,KAAH,CAAS,OAAT,CAAkB,UAAlB,CAA8B,CAAE,KAAF,CAA9B,EACH,CAFD,EAGA,OAAO,IAAP,GAEA,KAAK,OAAL,CAAa,IAAb,CAAmB,MAAnB,EAEA,MAAO,UAAS,OAAT,EAAP,CACH,CAzDF,CA2DC,QAAS,UAAW,CAChB,EAAE,IAAF,CAAQ,KAAK,OAAb,CAAsB,UAAW,CAC7B,KAAK,OAAL,GACH,CAFD,EAGH,CA/DF,CAiEC,OAAQ,UAAW,CACf,EAAE,IAAF,CAAQ,KAAK,OAAb,CAAsB,UAAW,CAC7B,KAAK,MAAL,GACH,CAFD,EAGH,CArEF,CALI,CAAP,CA4EH,CA9HD,E;;OAkIA,OAAO,WAAP,CAAmB,CACf,MADe,CAEf,gBAFe,CAGf,UAHe,CAAnB,CAIG,SAAU,IAAV,CAAgB,aAAhB,CAA+B,IAA/B,CAAsC,CACrC,GAAI,GAAI,KAAK,CAAb,C;AAGA,QAAS,MAAT,CAAgB,IAAhB,CAAuB,CACnB,KAAK,OAAL,CAAe,EAAE,MAAF,CAAS,EAAT,CAAa,MAAM,OAAnB,CAA4B,IAA5B,CAAf,CACA,cAAc,IAAd,CAAoB,IAApB,CAA0B,OAA1B,EAEA,KAAK,EAAL,CAAS,MAAT,CAAiB,UAAW,CACxB,KAAK,KAAL,CAAa,KAAK,IAAL,CAAU,MAAV,CAAb,CACA,KAAK,KAAL,CAAa,KAAK,IAAL,CAAU,MAAV,CAAb,CACH,CAHD,EAIH,C;AAGD,MAAM,OAAN,CAAgB,C;AAGZ,QAAS,EAHG,C;AAMZ,KAAM,KANM,C;AASZ,gBAAiB,IATL,C;AAYZ,aAAc,IAZF,CAAhB,C;AAgBA,KAAK,QAAL,CAAe,aAAf,CAA8B,CAC1B,YAAa,KADa,CAG1B,KAAM,SAAU,GAAV,CAAgB,C;AAGlB,GAAK,GAAL,CAAW,CACP,KAAK,KAAL,CAAa,GAAb,CACA,MAAO,KAAP,CACH,C;AAGD,MAAO,MAAK,KAAZ,CACH,CAbyB,CAe1B,KAAM,SAAU,GAAV,CAAgB,C;AAGlB,GAAK,GAAL,CAAW,CACP,KAAK,KAAL,CAAa,GAAb,CACA,MAAO,KAAP,CACH,C;AAGD,MAAO,MAAK,KAAZ,CACH,CAzByB,CA2B1B,aAAc,SAAU,IAAV,CAAiB,CAC3B,GAAI,IAAK,IAAT,CACI,KAAO,KAAK,OAAL,EADX,CAGA,KAAK,cAAL,CAAqB,IAArB,CAA2B,UAAW,CAClC,GAAG,IAAH,CAAS,MAAT,CAAiB,GAAG,OAApB,EACA,GAAG,IAAH,CAAS,cAAT,CAAyB,IAAzB,EACH,CAHD,EAIH,CAnCyB,CAqC1B,OAAQ,UAAW,CACf,GAAI,MAAO,KAAK,KAAL,CAAY,SAAZ,CAAX,CACA,MAAO,MAAK,IAAL,CAAU,KAAV,CAAiB,IAAjB,CAAuB,CAAE,QAAF,EAAa,MAAb,CAAqB,IAArB,CAAvB,CAAP,CACH,CAxCyB,CA0C1B,aAAc,SAAU,IAAV,CAAiB,CAC3B,MAAO,MAAK,IAAL,CAAW,cAAX,CAA2B,IAA3B,CAAP,CACH,CA5CyB,CA8C1B,UAAW,SAAU,IAAV,CAAiB,CACxB,GAAI,MAAO,KAAK,IAAL,CAAW,WAAX,CAAwB,IAAxB,CAAX,CAEA,MAAO,IAAI,KAAJ,CAAU,KAAK,OAAL,EAAV,CAA0B,IAA1B,CAAP,CACH,CAlDyB,CAA9B,EAqDA,MAAO,MAAP,CACH,CAzFD,E;;OA6FA,OAAO,eAAP,CAAuB,CACnB,MADmB,CAEnB,UAFmB,CAGnB,WAHmB,CAInB,gBAJmB,CAAvB,CAKG,SAAU,IAAV,CAAgB,QAAhB,CAA0B,KAA1B,CAAkC,CAEjC,GAAI,GAAI,KAAK,CAAb,CACI,QADJ,C;AAIA,SAAY,SAAU,GAAV,CAAgB,CACxB,GAAI,UAAW,CAAf,CACI,QAAU,EADd,CAEI,KAAO,UAAW,CACd,GAAI,KAAJ,CAEA,MAAQ,QAAQ,MAAR,EAAkB,SAAW,GAArC,CAA2C,CACvC,KAAO,QAAQ,KAAR,EAAP,CACA,UAAY,KAAM,CAAN,CAAZ,CACA,KAAM,CAAN,IACH,CACJ,CAVL,CAYA,MAAO,UAAU,MAAV,CAAkB,IAAlB,CAAwB,EAAxB,CAA6B,CAChC,QAAQ,IAAR,CAAa,CAAE,IAAF,CAAQ,EAAR,CAAb,EACA,OAAO,IAAP,CAAa,SAAb,CAAwB,UAAW,CAC/B,UAAY,IAAZ,CACA,WAAY,IAAZ,CAAkB,CAAlB,EACH,CAHD,EAIA,WAAY,IAAZ,CAAkB,CAAlB,EACH,CAPD,CAQH,CArBU,CAqBP,EAAI,IAAJ,CAAW,IArBJ,CAAX,CAuBA,EAAE,MAAF,CAAU,SAAS,OAAnB,CAA4B,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAiCxB,MAAO,CACH,MAAO,GADJ,CAEH,OAAQ,GAFL,CAGH,QAAS,EAHN,CAIH,aAAc,IAJX,CAKH,KAAM,IALH,CAMH,gBAAiB,KANd,C;;;;AAYH,KAAM,YAZH,CAjCiB,C;;;;;;;;;;;;;;;;;;;;;;;;;;eA2ExB,SAAU,CACN,MAAO,IADD,CAEN,OAAQ,IAFF,CAGN,QAAS,EAHH,CAIN,aAAc,KAJR,CAKN,KAAM,KALA,CAMN,gBAAiB,IANX,CA3Ec,CAA5B,EAqFA,MAAO,UAAS,QAAT,CAAkB,CACrB,aAAc,WADO,CAErB,mBAAoB,eAFC,CAAlB,CAGJ,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAkCC,UAAW,SAAU,IAAV,CAAgB,EAAhB,CAAoB,KAApB,CAA2B,MAA3B,CAAoC,CAC3C,GAAI,KAAJ,CAAU,KAAV,CAEA,KAAO,KAAK,OAAL,CAAc,UAAd,CAA0B,IAA1B,CAAP,C;AAGA,GAAK,CAAC,KAAK,IAAL,CAAU,KAAV,CAAiB,QAAjB,CAAN,CAAoC,CAChC,GAAI,IAAJ,EACA,OACH,CAED,KAAO,EAAE,MAAF,CAAS,EAAT,CAAa,KAAK,OAAL,CAAa,KAA1B,CAAP,C;AAGA,GAAK,EAAE,aAAF,CAAiB,KAAjB,CAAL,CAAgC,CAC5B,KAAO,EAAE,MAAF,CAAU,IAAV,CAAgB,KAAhB,CAAP,CACA,MAAQ,IAAR,CACH,CAED,MAAQ,OAAS,KAAK,KAAtB,CACA,OAAS,QAAU,KAAK,MAAxB,CAEA,MAAQ,GAAI,MAAJ,CAAW,IAAX,CAAR,CAEA,MAAM,IAAN,CAAY,MAAZ,CAAoB,UAAW,CAC3B,KAAK,KAAL,CAAa,KAAK,KAAL,EAAc,MAAM,IAAN,EAA3B,CACA,KAAK,KAAL,CAAa,KAAK,KAAL,EAAc,MAAM,IAAN,EAA3B,CACA,MAAM,MAAN,CAAc,KAAd,CAAqB,MAArB,EACH,CAJD,EAMA,MAAM,IAAN,CAAY,UAAZ,CAAwB,UAAW,CAC/B,GAAI,KAAJ,CAAW,MAAM,YAAN,CAAoB,KAAK,IAAzB,CAAX,EACA,MAAM,OAAN,GACH,CAHD,EAKA,MAAM,IAAN,CAAY,OAAZ,CAAqB,UAAW,CAC5B,GAAI,IAAJ,EACA,MAAM,OAAN,GACH,CAHD,EAKA,SAAU,KAAV,CAAiB,KAAK,MAAL,CAAY,IAA7B,CAAmC,UAAW,CAC1C,KAAK,KAAL,EAAc,MAAM,IAAN,CAAY,KAAK,KAAjB,CAAd,CACA,KAAK,KAAL,EAAc,MAAM,IAAN,CAAY,KAAK,KAAjB,CAAd,CACA,MAAM,YAAN,CAAoB,KAAK,MAAzB,EACH,CAJD,EAKH,CA/EF,CAiFC,cAAe,SAAU,IAAV,CAAiB,CAC5B,GAAI,MAAO,KAAK,OAAL,CAAa,QAAb,EAAyB,KAAK,OAAL,CAAa,MAAjD,CACI,aAAe,MAAQ,KAAK,YAAb,EAA6B,IAAM,IADtD,CAEI,KAFJ,CAEW,QAFX,CAIA,KAAO,KAAK,OAAL,CAAc,UAAd,CAA0B,IAA1B,CAAP,C;AAGA,GAAK,CAAC,IAAD,EAAS,CAAC,CAAC,uBAAuB,OAAvB,CAAgC,KAAK,IAArC,CAAX,EACG,KAAK,IAAL,CAAY,YADf,EAEG,KAAK,WAFb,CAE2B,CACvB,OACH,CAED,KAAO,EAAE,MAAF,CAAS,EAAT,CAAa,IAAb,CAAP,CACA,SAAW,KAAK,QAAL,EAAX,CAEA,MAAQ,GAAI,MAAJ,CAAW,IAAX,CAAR,CAEA,SAAS,MAAT,CAAgB,UAAW,CACvB,MAAM,OAAN,GACA,MAAQ,IAAR,CACH,CAHD,EAIA,MAAM,IAAN,CAAY,OAAZ,CAAqB,SAAS,MAA9B,EACA,MAAM,IAAN,CAAY,MAAZ,CAAoB,UAAW,CAC3B,KAAK,KAAL,CAAa,KAAK,KAAL,EAAc,MAAM,IAAN,EAA3B,CACA,KAAK,KAAL,CAAa,KAAK,KAAL,EAAc,MAAM,IAAN,EAA3B,CACA,MAAM,MAAN,CAAc,KAAK,KAAnB,CAA0B,KAAK,MAA/B,EACH,CAJD,EAMA,MAAM,IAAN,CAAY,UAAZ,CAAwB,UAAW,CAC/B,GAAI,KAAJ,CAAU,IAAV,C;;;AAKA,GAAI,CACA,KAAO,MAAM,SAAN,CAAiB,KAAK,IAAtB,CAAP,CAEA,KAAO,KAAK,IAAZ,C;AAGA,GAAK,KAAK,IAAL,CAAY,IAAjB,CAAwB,C;AAEpB,KAAK,MAAL,CAAc,IAAd,CACA,KAAK,IAAL,CAAY,KAAK,IAAjB,CAEA,KAAK,OAAL,CAAc,QAAd,CAAwB,KAAK,IAA7B,CAAmC,IAAnC,EACH,C;AAGD,KAAK,WAAL,CAAmB,IAAnB,CACA,SAAS,OAAT,GACH,CAAC,MAAQ,CAAR,CAAY,C;AAEV,SAAS,OAAT,GACH,CACJ,CA3BD,EA6BA,KAAK,KAAL,EAAc,MAAM,IAAN,CAAY,KAAK,KAAjB,CAAd,CACA,KAAK,KAAL,EAAc,MAAM,IAAN,CAAY,KAAK,KAAjB,CAAd,CAEA,MAAM,YAAN,CAAoB,KAAK,MAAzB,EACA,MAAO,UAAS,OAAT,EAAP,CACH,CAjJF,CAHI,CAAP,CAsJH,CA7QD,E;;OAiRA,OAAO,MAAP,CAAc,CACV,MADU,CAEV,UAFU,CAAd,CAGG,SAAU,IAAV,CAAgB,QAAhB,CAA2B,CAE1B,GAAI,GAAI,KAAK,CAAb,CACI,SAAW,UADf,CAEI,SAAW,CAFf,CAGI,KAAO,YAHX,CAII,UAAY,EAJhB,CAMA,QAAS,IAAT,EAAe,CACX,MAAO,UAAW,UAAlB,CACH,C;;;;;;WASD,QAAS,OAAT,CAAiB,MAAjB,CAA0B,C;;;;eAOtB,KAAK,IAAL,CAAY,OAAO,IAAP,EAAe,UAA3B,C;;;;;eAQA,KAAK,IAAL,CAAY,OAAO,IAAP,EAAe,CAA3B,C;;;;;eAQA,KAAK,IAAL,CAAY,OAAO,IAAP,EAAe,aAA3B,C;;;;;eAQA,KAAK,gBAAL,CAAwB,OAAO,gBAAP,EAA4B,GAAI,KAAJ,GAAa,CAAjE,C;;;;eAOA,KAAK,EAAL,CAAU,KAAV,C;;;;eAOA,KAAK,GAAL,CAAW,KAAK,IAAL,CAAW,KAAK,IAAhB,EAAyB,OAAO,EAAhC,CAAqC,EAAhD,C;;;;eAQA,KAAK,UAAL,CAAkB,EAAlB,C;AAGA,UAAW,KAAK,EAAhB,EAAuB,OAAO,MAAP,CAAc,MAArC,CAEA,KAAK,MAAL,CAAc,MAAd,CACA,KAAK,MAAL,CAAc,CAAd,CAEA,KAAK,EAAL,CAAS,OAAT,CAAkB,SAAU,GAAV,CAAgB,CAC9B,KAAK,SAAL,CAAgB,OAAO,MAAP,CAAc,KAA9B,CAAqC,GAArC,EACH,CAFD,EAGH,CAED,EAAE,MAAF,CAAU,OAAO,SAAjB,CAA4B,C;;;;;;eASxB,UAAW,SAAU,MAAV,CAAkB,IAAlB,CAAyB,CAEhC,GAAI,YAAa,UAAW,KAAK,EAAhB,CAAjB,CAEA,MAAO,KAAP,GAAgB,WAAhB,GAAgC,KAAK,UAAL,CAAkB,IAAlD,EAEA,GAAK,SAAW,UAAhB,CAA6B,CACzB,UAAW,KAAK,EAAhB,EAAuB,MAAvB,C;;;uBAKA,KAAK,OAAL,CAAc,cAAd,CAA8B,MAA9B,CAAsC,UAAtC,EACH,CAEJ,CAxBuB,C;;;;;;;;;;;;;;;;;;;eA8CxB,UAAW,UAAW,CAClB,MAAO,WAAW,KAAK,EAAhB,CAAP,CACH,CAhDuB,C;;;eAsDxB,UAAW,UAAW,CAClB,MAAO,MAAK,MAAZ,CACH,CAxDuB,CA0DxB,QAAS,UAAW,CAChB,MAAO,WAAW,KAAK,EAAhB,CAAP,CACH,CA5DuB,CAA5B,EA+DA,SAAS,SAAT,CAAoB,OAAO,SAA3B,E;;;;;;;;;;;;;;WAiBA,OAAO,MAAP,CAAgB,CACZ,OAAY,QADA,C;AAEZ,OAAY,QAFA,C;AAGZ,SAAY,UAHA,C;AAIZ,MAAY,OAJA,C;AAKZ,SAAY,UALA,C;AAMZ,UAAY,WANA,C;AAOZ,UAAY,WAPA,C;AAQZ,QAAY,S;AARA,CAAhB,CAWA,MAAO,OAAP,CACH,CApLD,E;;OAyLA,OAAO,OAAP,CAAe,CACX,MADW,CAEX,UAFW,CAGX,MAHW,CAAf,CAIG,SAAU,IAAV,CAAgB,QAAhB,CAA0B,MAA1B,CAAmC,CAElC,GAAI,GAAI,KAAK,CAAb,CACI,OAAS,OAAO,MADpB,C;;;;WAQA,QAAS,MAAT,EAAiB,C;;;;;;;;;eAYb,KAAK,KAAL,CAAa,CACT,WAAY,CADH,CAET,aAAc,CAFL,CAGT,YAAa,CAHJ,CAIT,cAAe,CAJN,CAKT,kBAAmB,CALV,CAMT,aAAc,CANL,CAAb,C;AAUA,KAAK,MAAL,CAAc,EAAd,C;AAGA,KAAK,IAAL,CAAY,EAAZ,CACH,CAED,EAAE,MAAF,CAAU,MAAM,SAAhB,CAA2B,C;;;;;eAQvB,OAAQ,SAAU,IAAV,CAAiB,CACrB,KAAK,MAAL,CAAY,IAAZ,CAAkB,IAAlB,EACA,KAAK,UAAL,CAAiB,IAAjB,EACA,MAAO,KAAP,CACH,CAZsB,C;;;;;eAoBvB,QAAS,SAAU,IAAV,CAAiB,CACtB,KAAK,MAAL,CAAY,OAAZ,CAAqB,IAArB,EACA,KAAK,UAAL,CAAiB,IAAjB,EACA,MAAO,KAAP,CACH,CAxBsB,C;;;;;;eAiCvB,QAAS,SAAU,MAAV,CAAmB,CACxB,GAAK,MAAO,OAAP,GAAkB,QAAvB,CAAkC,CAC9B,MAAO,OAAP,CACH,CACD,MAAO,MAAK,IAAL,CAAW,MAAX,CAAP,CACH,CAtCsB,C;;;;;;eA+CvB,MAAO,SAAU,MAAV,CAAmB,CACtB,GAAI,KAAM,KAAK,MAAL,CAAY,MAAtB,CACI,CADJ,CACO,IADP,CAGA,OAAS,QAAU,OAAO,MAA1B,CAEA,IAAM,EAAI,CAAV,CAAa,EAAI,GAAjB,CAAsB,GAAtB,CAA4B,CACxB,KAAO,KAAK,MAAL,CAAa,CAAb,CAAP,CAEA,GAAK,SAAW,KAAK,SAAL,EAAhB,CAAmC,CAC/B,MAAO,KAAP,CACH,CACJ,CAED,MAAO,KAAP,CACH,CA9DsB,C;;;;;eAsEvB,KAAM,SAAU,EAAV,CAAe,CACjB,GAAK,MAAO,GAAP,GAAc,UAAnB,CAAgC,CAC5B,KAAK,MAAL,CAAY,IAAZ,CAAkB,EAAlB,EACH,CACJ,CA1EsB,C;;;;;eAkFvB,SAAU,UAAW,CACjB,GAAI,KAAM,GAAG,KAAH,CAAS,IAAT,CAAe,SAAf,CAA0B,CAA1B,CAAV,CACI,IAAM,EADV,CAEI,EAAI,CAFR,CAGI,IAAM,KAAK,MAAL,CAAY,MAHtB,CAII,IAJJ,CAMA,KAAQ,EAAI,GAAZ,CAAiB,GAAjB,CAAuB,CACnB,KAAO,KAAK,MAAL,CAAa,CAAb,CAAP,CAEA,GAAK,IAAI,MAAJ,EAAc,CAAC,CAAC,EAAE,OAAF,CAAW,KAAK,SAAL,EAAX,CAA6B,GAA7B,CAArB,CAA0D,CACtD,SACH,CAED,IAAI,IAAJ,CAAU,IAAV,EACH,CAED,MAAO,IAAP,CACH,CApGsB,CAsGvB,WAAY,SAAU,IAAV,CAAiB,CACzB,GAAI,IAAK,IAAT,CACI,SAAW,KAAK,IAAL,CAAW,KAAK,EAAhB,CADf,CAGA,GAAK,CAAC,QAAN,CAAiB,CACb,KAAK,IAAL,CAAW,KAAK,EAAhB,EAAuB,IAAvB,CAEA,KAAK,EAAL,CAAS,cAAT,CAAyB,SAAU,GAAV,CAAe,GAAf,CAAqB,CAC1C,GAAG,mBAAH,CAAwB,GAAxB,CAA6B,GAA7B,EACH,CAFD,EAGH,CAED,KAAK,SAAL,CAAgB,OAAO,MAAvB,EACH,CAnHsB,CAqHvB,oBAAqB,SAAU,SAAV,CAAqB,SAArB,CAAiC,CAClD,GAAI,OAAQ,KAAK,KAAjB,CAEA,OAAS,SAAT,EACI,IAAK,QAAO,QAAZ,CACI,MAAM,aAAN,GACA,MAEJ,IAAK,QAAO,MAAZ,CACI,MAAM,UAAN,GACA,MAEJ,IAAK,QAAO,KAAZ,CACI,MAAM,iBAAN,GACA,MAEJ,IAAK,QAAO,OAAZ,CACI,MAAM,YAAN,GACA,MAfR,CAkBA,OAAS,SAAT,EACI,IAAK,QAAO,MAAZ,CACI,MAAM,UAAN,GACA,MAEJ,IAAK,QAAO,QAAZ,CACI,MAAM,aAAN,GACA,MAEJ,IAAK,QAAO,KAAZ,CACI,MAAM,iBAAN,GACA,MAEJ,IAAK,QAAO,QAAZ,CACI,MAAM,YAAN,GACA,MAEJ,IAAK,QAAO,SAAZ,CACI,MAAM,WAAN,GACA,MAEJ,IAAK,QAAO,OAAZ,CACI,MAAM,YAAN,GACA,MAvBR,CAyBH,CAnKsB,CAA3B,EAuKA,SAAS,SAAT,CAAoB,MAAM,SAA1B,EAEA,MAAO,MAAP,CACH,CApND,E;;OAwNA,OAAO,eAAP,CAAuB,CACnB,MADmB,CAEnB,UAFmB,CAGnB,OAHmB,CAInB,MAJmB,CAKnB,UALmB,CAMnB,gBANmB,CAOnB,gBAPmB,CAAvB,CAQG,SAAU,IAAV,CAAgB,QAAhB,CAA0B,KAA1B,CAAiC,MAAjC,CAAyC,IAAzC,CAA+C,aAA/C,CAA+D,CAE9D,GAAI,GAAI,KAAK,CAAb,CACI,KAAO,QADX,CAEI,OAAS,OAAO,MAFpB,CAIA,MAAO,UAAS,QAAT,CAAkB,CACrB,aAAc,WADO,CAErB,WAAY,UAFS,CAGrB,WAAY,SAHS,CAIrB,aAAc,WAJO,CAKrB,YAAa,UALQ,CAMrB,YAAa,UANQ,CAOrB,cAAe,YAPM,CAQrB,QAAS,OARY,CASrB,QAAS,OATY,CAUrB,cAAe,YAVM,CAAlB,CAWJ,CAEC,KAAM,SAAU,IAAV,CAAiB,CACnB,GAAI,IAAK,IAAT,CACI,QADJ,CACc,GADd,CACmB,CADnB,CACsB,IADtB,CAC4B,GAD5B,CACiC,MADjC,CACyC,OADzC,CAGA,GAAK,EAAE,aAAF,CAAiB,KAAK,MAAtB,CAAL,CAAsC,CAClC,KAAK,MAAL,CAAc,CAAE,KAAK,MAAP,CAAd,CACH,C;AAGD,GAAK,KAAK,MAAV,CAAmB,CACf,IAAM,EAAN,CAEA,IAAM,EAAI,CAAJ,CAAO,IAAM,KAAK,MAAL,CAAY,MAA/B,CAAuC,EAAI,GAA3C,CAAgD,GAAhD,CAAsD,CAClD,KAAO,KAAK,MAAL,CAAa,CAAb,EAAiB,UAAxB,CACA,MAAQ,IAAI,IAAJ,CAAU,IAAV,CAAR,CACH,CAED,GAAK,IAAI,MAAT,CAAkB,CACd,OAAS,MAAQ,IAAI,IAAJ,CAAS,GAAT,EACR,OADQ,CACC,IADD,CACO,OADP,EAER,OAFQ,CAEC,KAFD,CAEQ,IAFR,CAAR,CAEyB,GAFlC,CAGH,CAED,GAAG,MAAH,CAAY,GAAI,OAAJ,CAAY,MAAZ,CAAoB,GAApB,CAAZ,CACH,CAED,GAAG,KAAH,CAAW,GAAI,MAAJ,EAAX,CACA,GAAG,KAAH,CAAW,GAAG,KAAH,CAAS,KAApB,C;;AAIA,GAAK,KAAK,OAAL,CAAa,sBAAb,IAAyC,OAA9C,CAAwD,CACpD,OACH,C;;AAID,SAAW,KAAK,QAAL,EAAX,CACA,QAAU,GAAI,cAAJ,CAAkB,aAAlB,CAAV,CACA,QAAQ,cAAR,CAAuB,CACnB,aAAc,OADK,CAAvB,CAEG,UAAW,CACV,GAAG,KAAH,CAAW,QAAQ,OAAR,EAAX,CACA,SAAS,OAAT,GACH,CALD,EAMA,MAAO,UAAS,OAAT,EAAP,CACH,CAhDF,C;AAoDC,UAAW,SAAU,IAAV,CAAiB,CACxB,GAAK,EAAE,eAAgB,OAAlB,CAAL,CAAiC,CAE7B,GAAK,EAAE,eAAgB,KAAlB,CAAL,CAA+B,CAC3B,GAAK,CAAC,KAAK,KAAX,CAAmB,CACf,KAAM,IAAI,MAAJ,CAAU,4BAAV,CAAN,CACH,CACD,KAAO,GAAI,KAAJ,CAAU,KAAK,KAAf,CAAsB,IAAtB,CAAP,CACH,CAED,KAAO,GAAI,OAAJ,CAAY,IAAZ,CAAP,CACH,CAED,MAAO,KAAP,CACH,CAlEF,C;AAqEC,WAAY,SAAU,IAAV,CAAiB,CACzB,GAAI,SAAU,CAAC,IAAD,EAAS,KAAK,IAAL,CAAY,CAArB,EAA0B,KAAK,MAAL,E;AAGhC,KAAK,IAAL,CAAW,KAAK,IAAhB,CAHgC,EAGN,CAAC,KAAK,MAAL,CAAY,IAAZ,CAAkB,KAAK,IAAvB,CAHnC,CAKA,MAAO,CAAC,OAAR,CACH,CA5EF,C;;;;;;;;;;eA6FC,SAAU,SAAU,IAAV,CAAiB,CACvB,GAAI,IAAK,IAAT,CAEA,KAAO,GAAG,SAAH,CAAc,IAAd,CAAP,C;AAGA,GAAK,CAAC,GAAG,KAAH,CAAS,OAAT,CAAkB,kBAAlB,CAAsC,IAAtC,CAAN,CAAqD,CACjD,OACH,C;AAGD,GAAK,CAAC,GAAG,UAAH,CAAe,IAAf,CAAN,CAA8B,CAC1B,GAAG,KAAH,CAAS,OAAT,CAAkB,OAAlB,CAA2B,eAA3B,CAA4C,IAA5C,EACA,OACH,CAED,GAAG,KAAH,CAAS,MAAT,CAAiB,IAAjB,EACA,GAAG,KAAH,CAAS,OAAT,CAAkB,YAAlB,CAAgC,IAAhC,EACA,MAAO,KAAP,CACH,CAhHF,CAkHC,QAAS,SAAU,MAAV,CAAmB,CACxB,MAAO,MAAK,KAAL,CAAW,OAAX,CAAoB,MAApB,CAAP,CACH,CApHF,C;;;;;;;;;;;;eAqIC,SAAU,SAAU,KAAV,CAAkB,CACxB,GAAI,IAAK,IAAT,CAEA,GAAK,CAAC,MAAM,MAAZ,CAAqB,CACjB,MAAQ,CAAE,KAAF,CAAR,CACH,CAED,MAAQ,EAAE,GAAF,CAAO,KAAP,CAAc,SAAU,IAAV,CAAiB,CACnC,MAAO,IAAG,QAAH,CAAa,IAAb,CAAP,CACH,CAFO,CAAR,CAIA,GAAG,KAAH,CAAS,OAAT,CAAkB,aAAlB,CAAiC,KAAjC,EAEA,GAAK,GAAG,OAAH,CAAW,IAAhB,CAAuB,CACnB,GAAG,OAAH,CAAW,cAAX,EACH,CACJ,CArJF,CAuJC,SAAU,UAAW,CACjB,MAAO,MAAK,KAAZ,CACH,CAzJF,C;;;;;;;;;;;;;;;;;eA+KC,WAAY,SAAU,IAAV,CAAiB,CACzB,GAAI,IAAK,IAAT,CAEA,KAAO,KAAK,EAAL,CAAU,IAAV,CAAiB,GAAG,KAAH,CAAS,OAAT,CAAkB,IAAlB,CAAxB,CAEA,KAAK,SAAL,CAAgB,OAAO,SAAvB,EACA,GAAG,KAAH,CAAS,OAAT,CAAkB,cAAlB,CAAkC,IAAlC,EACH,CAtLF,C;;;;;;;;;eAkMC,SAAU,UAAW,CACjB,MAAO,MAAK,KAAL,CAAW,QAAX,CAAoB,KAApB,CAA2B,KAAK,KAAhC,CAAuC,SAAvC,CAAP,CACH,CApMF,CAsMC,UAAW,UAAW,CAClB,MAAO,MAAK,KAAL,CAAW,KAAX,CAAiB,KAAjB,CAAwB,KAAK,KAA7B,CAAoC,SAApC,CAAP,CACH,CAxMF,C;;;;;;;;;;eAqNC,MAAO,SAAU,IAAV,CAAgB,YAAhB,CAA+B,CAClC,GAAI,IAAK,IAAT,CACI,KADJ,CACW,CADX,CACc,GADd,CAGA,GAAK,IAAL,CAAY,CACR,KAAO,KAAK,EAAL,CAAU,IAAV,CAAiB,GAAG,KAAH,CAAS,OAAT,CAAkB,IAAlB,CAAxB,CACA,KAAK,SAAL,CAAgB,OAAO,MAAvB,EACA,cAAgB,GAAG,OAAH,CAAW,cAAX,CAAhB,CACA,OACH,CAED,MAAQ,GAAG,KAAH,CAAS,QAAT,CAAmB,OAAO,KAA1B,CAAR,CACA,EAAI,CAAJ,CACA,IAAM,MAAM,MAAZ,CAEA,KAAQ,EAAI,GAAZ,CAAiB,GAAjB,CAAuB,CACnB,KAAO,MAAO,CAAP,CAAP,CACA,KAAK,SAAL,CAAgB,OAAO,MAAvB,EACH,CAED,GAAG,OAAH,CAAW,cAAX,EACH,CA1OF,C;;;;;eAkPC,UAAW,UAAW,CAClB,MAAO,MAAK,KAAL,CAAW,IAAX,CAAgB,KAAhB,CAAuB,KAAK,KAA5B,CAAmC,SAAnC,CAAP,CACH,CApPF,C;;;;;;;eA8PC,MAAO,UAAW,CACd,KAAK,KAAL,CAAa,GAAI,MAAJ,EAAb,CACA,KAAK,KAAL,CAAa,KAAK,KAAL,CAAW,KAAxB,CACH,CAjQF,CAXI,CAAP,CA+QH,CA7RD,E;;OAiSA,OAAO,iBAAP,CAAyB,CACrB,UADqB,CAErB,iBAFqB,CAGrB,gBAHqB,CAAzB,CAIG,SAAU,QAAV,CAAoB,OAApB,CAA8B,CAE7B,SAAS,OAAT,CAAmB,UAAW,CAC1B,MAAO,SAAQ,UAAR,CAAmB,KAAnB,CAA0B,OAA1B,CAAmC,SAAnC,CAAP,CACH,CAFD,CAIA,MAAO,UAAS,QAAT,CAAkB,CACrB,uBAAwB,mBADH,CAAlB,CAEJ,CAEC,KAAM,UAAW,CACb,GAAK,CAAC,KAAK,iBAAL,EAAN,CAAiC,CAC7B,KAAM,OAAM,eAAN,CAAN,CACH,CACJ,CANF,C;;;;;eAcC,kBAAmB,UAAW,CAC1B,GAAI,QAAS,KAAK,OAAL,CAAa,YAAb,EAA6B,QAAQ,MAAlD,CACI,KAAO,KAAK,IADhB,CAEI,CAFJ,CAEO,GAFP,CAIA,GAAK,CAAC,IAAN,CAAa,CACT,OAAS,OAAO,KAAP,CAAc,UAAd,CAAT,CAEA,IAAM,EAAI,CAAJ,CAAO,IAAM,OAAO,MAA1B,CAAkC,EAAI,GAAtC,CAA2C,GAA3C,CAAiD,CAC7C,GAAK,QAAQ,UAAR,CAAoB,OAAQ,CAAR,CAApB,CAAL,CAAyC,CACrC,KAAK,IAAL,CAAY,KAAO,OAAQ,CAAR,CAAnB,CACA,MACH,CACJ,CACJ,CAED,MAAO,KAAP,CACH,CA/BF,CAFI,CAAP,CAmCH,CA7CD,E;;OAiDA,OAAO,eAAP,CAAuB,CACnB,MADmB,CAEnB,gBAFmB,CAGnB,UAHmB,CAAvB,CAIG,SAAU,IAAV,CAAgB,aAAhB,CAA+B,QAA/B,CAA0C,CAEzC,GAAI,GAAI,KAAK,CAAb,CAEA,QAAS,UAAT,CAAoB,IAApB,CAA2B,CACvB,GAAI,IAAK,IAAT,CAEA,KAAO,GAAG,OAAH,CAAa,EAAE,MAAF,CAAU,IAAV,CAAgB,EAAhB,CAAoB,UAAU,OAA9B,CAAuC,MAAQ,EAA/C,CAApB,CACA,cAAc,IAAd,CAAoB,IAApB,CAA0B,WAA1B,EAEA,KAAK,KAAL,CAAa,IAAb,CACA,KAAK,SAAL,CAAiB,KAAK,QAAL,EAAiB,EAAlC,CACA,KAAK,QAAL,CAAgB,KAAK,OAAL,EAAgB,EAAhC,CAEA,KAAK,EAAL,CAAS,UAAT,CAAqB,KAAK,QAA1B,EACA,KAAK,EAAL,CAAS,YAAT,CAAuB,UAAW,CAC9B,GAAG,OAAH,CAAY,UAAZ,CAAwB,CAAxB,EACA,aAAc,GAAG,MAAjB,EACH,CAHD,EAIH,CAED,UAAU,OAAV,CAAoB,CAChB,OAAQ,EADQ,CAEhB,OAAQ,MAFQ,C;AAKhB,gBAAiB,KALD,CAMhB,QAAS,MANO,CAOhB,QAAS,EAAI,EAAJ,CAAS,IAPF,C;AAQhB,SAAU,EARM,CAShB,QAAS,EATO,CAUhB,aAAc,KAVE,CAApB,CAaA,EAAE,MAAF,CAAU,UAAU,SAApB,CAA+B,C;AAG3B,WAAY,SAAU,GAAV,CAAe,IAAf,CAAqB,QAArB,CAAgC,CACxC,GAAI,IAAK,IAAT,CACI,KAAO,GAAG,OADd,CAGA,GAAK,GAAG,OAAH,EAAL,CAAoB,CAChB,GAAG,iBAAH,GACH,C;AAGD,GAAG,cAAH,CAAmB,KAAK,IAAxB,CAA8B,UAAW,CACrC,GAAG,IAAH,CAAQ,MAAR,EACH,CAFD,EAIA,GAAG,KAAH,CAAW,IAAX,CACA,KAAK,OAAL,CAAe,KAAO,KAAK,OAA3B,CACA,KAAK,QAAL,CAAgB,UAAY,KAAK,QAAjC,CACH,CAnB0B,C;AAsB3B,OAAQ,SAAU,GAAV,CAAe,KAAf,CAAuB,CAC3B,GAAK,MAAO,IAAP,GAAe,QAApB,CAA+B,CAC3B,EAAE,MAAF,CAAU,KAAK,SAAf,CAA0B,GAA1B,EACH,CAFD,IAEO,CACH,KAAK,SAAL,CAAgB,GAAhB,EAAwB,KAAxB,CACH,CACJ,CA5B0B,CA8B3B,iBAAkB,SAAU,GAAV,CAAe,KAAf,CAAuB,CACrC,GAAK,MAAO,IAAP,GAAe,QAApB,CAA+B,CAC3B,EAAE,MAAF,CAAU,KAAK,QAAf,CAAyB,GAAzB,EACH,CAFD,IAEO,CACH,KAAK,QAAL,CAAe,GAAf,EAAuB,KAAvB,CACH,CACJ,CApC0B,CAsC3B,KAAM,SAAU,MAAV,CAAmB,CACrB,KAAK,IAAL,CAAW,MAAX,CAAmB,MAAnB,EACA,KAAK,QAAL,GACH,CAzC0B,CA2C3B,MAAO,UAAW,CACd,aAAc,KAAK,MAAnB,EACA,MAAO,MAAK,IAAL,CAAU,OAAV,CAAP,CACH,CA9C0B,CAgD3B,QAAS,UAAW,CAChB,KAAK,OAAL,CAAa,SAAb,EACA,KAAK,GAAL,GACA,KAAK,IAAL,CAAU,SAAV,EACA,KAAK,iBAAL,GACH,CArD0B,CAuD3B,YAAa,UAAW,CACpB,MAAO,MAAK,IAAL,CAAU,aAAV,CAAP,CACH,CAzD0B,CA2D3B,kBAAmB,UAAW,CAC1B,MAAO,MAAK,IAAL,CAAU,mBAAV,CAAP,CACH,CA7D0B,CA+D3B,UAAW,UAAW,CAClB,MAAO,MAAK,IAAL,CAAU,WAAV,CAAP,CACH,CAjE0B,CAmE3B,SAAU,UAAW,CACjB,GAAI,IAAK,IAAT,CACI,SAAW,GAAG,OAAH,CAAW,OAD1B,CAGA,GAAK,CAAC,QAAN,CAAiB,CACb,OACH,CAED,aAAc,GAAG,MAAjB,EACA,GAAG,MAAH,CAAY,WAAW,UAAW,CAC9B,GAAG,KAAH,GACA,GAAG,OAAH,CAAY,OAAZ,CAAqB,SAArB,EACH,CAHW,CAGT,QAHS,CAAZ,CAIH,CAhF0B,CAA/B,E;AAqFA,SAAS,SAAT,CAAoB,UAAU,SAA9B,EAEA,MAAO,UAAP,CACH,CA9HD,E;;OAkIA,OAAO,gBAAP,CAAwB,CACpB,MADoB,CAEpB,UAFoB,CAGpB,MAHoB,CAIpB,eAJoB,CAKpB,gBALoB,CAAxB,CAMG,SAAU,IAAV,CAAgB,QAAhB,CAA0B,MAA1B,CAAkC,SAAlC,CAA8C,CAE7C,GAAI,GAAI,KAAK,CAAb,CACI,UAAY,KAAK,SADrB,CAEI,OAAS,OAAO,MAFpB,C;AAKA,EAAE,MAAF,CAAU,SAAS,OAAnB,CAA4B,C;;;;;;;eAWxB,gBAAiB,KAXO,C;;;;;eAmBxB,QAAS,KAnBe,C;;;;;eA2BxB,UAAW,EAAI,IAAJ,CAAW,IA3BE,C;;;;;eAmCxB,WAAY,CAnCY,C;;;;;eA2CxB,QAAS,CA3Ce,C;;;;;eAoDxB,SAAU,I;;;;;;;;;;;;;;;;eApDc,CAA5B,E;AA8EA,QAAS,SAAT,CAAmB,IAAnB,CAAyB,SAAzB,CAAqC,CACjC,GAAI,SAAU,EAAd,CACI,KAAO,KAAK,MADhB,CAEI,MAAQ,KAAK,IAFjB,CAGI,OAAS,UAAY,KAAK,IAAL,CAAW,MAAQ,SAAnB,CAAZ,CAA6C,CAH1D,CAII,MAAQ,CAJZ,CAKI,MAAQ,CALZ,CAMI,GANJ,CAQA,MAAQ,MAAQ,MAAhB,CAAyB,CACrB,IAAM,KAAK,GAAL,CAAU,SAAV,CAAqB,MAAQ,KAA7B,CAAN,CAEA,QAAQ,IAAR,CAAa,CACT,KAAM,IADG,CAET,MAAO,KAFE,CAGT,IAAK,UAAa,MAAQ,GAArB,CAA4B,KAHxB,CAIT,MAAO,KAJE,CAKT,OAAQ,MALC,CAMT,MAAO,OANE,CAAb,EAQA,OAAS,GAAT,CACH,CAED,KAAK,MAAL,CAAc,QAAQ,MAAR,EAAd,CACA,KAAK,QAAL,CAAgB,QAAQ,MAAxB,CAEA,MAAO,CACH,KAAM,IADH,CAGH,IAAK,UAAW,CACZ,MAAO,CAAC,CAAC,QAAQ,MAAjB,CACH,CALE,CAOH,MAAO,UAAW,CACd,MAAO,SAAQ,KAAR,EAAP,CACH,CATE,CAAP,CAWH,CAED,SAAS,QAAT,CAAkB,CACd,eAAgB,OADF,CAEd,cAAe,MAFD,CAGd,YAAa,UAHC,CAId,iBAAkB,cAJJ,CAAlB,CAKG,CAEC,KAAM,UAAW,CACb,GAAI,OAAQ,KAAK,KAAjB,CAEA,KAAK,MAAL,CAAc,KAAd,C;AAGA,KAAK,IAAL,CAAY,EAAZ,C;AAGA,KAAK,OAAL,CAAe,EAAf,C;AAGA,KAAK,QAAL,CAAgB,CAAhB,CACA,KAAK,MAAL,CAAc,KAAK,MAAL,CAAa,KAAK,KAAlB,CAAyB,IAAzB,CAAd,CAEA,MAAM,EAAN,CAAU,gBAAV,CAA4B,SAAU,IAAV,CAAiB,C;AAEzC,KAAK,MAAL,EAAe,EAAE,IAAF,CAAQ,KAAK,MAAb,CAAqB,SAAU,CAAV,CAAa,CAAb,CAAiB,CACjD,EAAE,SAAF,GAAgB,EAAE,SAAF,CAAY,KAAZ,GAAqB,EAAE,SAAF,CAAY,OAAZ,EAArC,EACA,MAAO,GAAE,SAAT,CACH,CAHc,CAAf,CAKA,MAAO,MAAK,MAAZ,CACA,MAAO,MAAK,QAAZ,CACH,CATD,EAUH,CA3BF,C;;;;;;;;;eAyCC,MAAO,UAAW,CACd,GAAI,IAAK,IAAT,C;AAGA,EAAE,IAAF,CAAQ,GAAG,OAAH,CAAY,WAAZ,CAAyB,OAAO,OAAhC,CAAR,CAAmD,UAAW,CAC1D,GAAG,OAAH,CAAY,aAAZ,CAA2B,IAA3B,EACH,CAFD,EAIA,GAAK,GAAG,MAAR,CAAiB,CACb,OACH,CAED,GAAG,MAAH,CAAY,IAAZ,C;AAGA,EAAE,IAAF,CAAQ,GAAG,IAAX,CAAiB,SAAU,CAAV,CAAa,CAAb,CAAiB,CAC9B,GAAI,MAAO,EAAE,IAAb,CAEA,GAAK,KAAK,SAAL,KAAqB,OAAO,SAAjC,CAA6C,CACzC,KAAK,SAAL,CAAgB,OAAO,QAAvB,EACA,GAAG,QAAH,CAAc,KAAd,CACA,EAAE,SAAF,EAAe,EAAE,SAAF,CAAY,IAAZ,EAAf,CACH,CACJ,CARD,EAUA,GAAG,QAAH,CAAc,KAAd,CACA,GAAG,KAAH,CAAS,OAAT,CAAiB,aAAjB,EACA,KAAK,QAAL,CAAe,GAAG,MAAlB,EACH,CArEF,C;;;;;;;;;;eAoFC,KAAM,SAAU,SAAV,CAAsB,CACxB,GAAI,IAAK,IAAT,CAEA,GAAK,GAAG,MAAH,GAAc,KAAnB,CAA2B,CACvB,OACH,CAED,GAAG,MAAH,CAAY,KAAZ,CAEA,WAAa,EAAE,IAAF,CAAQ,GAAG,IAAX,CAAiB,SAAU,CAAV,CAAa,CAAb,CAAiB,CAC3C,EAAE,SAAF,EAAe,EAAE,SAAF,CAAY,KAAZ,EAAf,CACA,EAAE,IAAF,CAAO,SAAP,CAAkB,OAAO,SAAzB,EACH,CAHY,CAAb,CAKA,GAAG,KAAH,CAAS,OAAT,CAAiB,YAAjB,EACH,CAnGF,C;;;;;eA2GC,aAAc,UAAW,CACrB,MAAO,CAAC,CAAC,KAAK,MAAd,CACH,CA7GF,CA+GC,SAAU,UAAW,CACjB,MAAO,MAAK,OAAL,CAAa,WAAb,CAAP,CACH,CAjHF,C;;;;;eAyHC,SAAU,SAAU,IAAV,CAAgB,MAAhB,CAAyB,CAC/B,KAAO,KAAK,OAAL,CAAc,UAAd,CAA0B,IAA1B,CAAP,CAEA,KAAK,SAAL,CAAgB,QAAU,OAAO,QAAjC,EACA,KAAK,OAAL,CAAe,IAAf,C;AAGA,KAAK,MAAL,EAAe,EAAE,IAAF,CAAQ,KAAK,MAAb,CAAqB,SAAU,CAAV,CAAa,CAAb,CAAiB,CACjD,GAAI,KAAM,EAAE,SAAZ,CAEA,GAAK,GAAL,CAAW,CACP,IAAI,KAAJ,GACA,IAAI,OAAJ,GACA,MAAO,GAAE,SAAT,CACH,CACJ,CARc,CAAf,CAUA,KAAK,KAAL,CAAW,OAAX,CAAoB,YAApB,CAAkC,IAAlC,EACH,CA3IF,C;;;;eAkJC,MAAO,UAAW,CACd,GAAI,IAAK,IAAT,CACI,KAAO,GAAG,OADd,CAEI,EAFJ,CAEQ,GAFR,C;AAKA,GAAK,GAAG,QAAR,CAAmB,CACf,MAAO,IAAG,QAAH,CAAY,MAAZ,CAAoB,GAAG,MAAvB,CAAP,CACH,C;AAGD,GAAK,GAAG,IAAH,CAAQ,MAAR,CAAiB,KAAK,OAAtB,GAAkC,IAAM,GAAG,UAAH,EAAxC,CAAL,CAAgE,CAC5D,GAAG,QAAH,CAAc,KAAd,CAEA,GAAK,SAAU,GAAV,CAAgB,CACjB,GAAG,QAAH,CAAc,IAAd,C;AAGA,KAAO,IAAI,IAAX,EAAmB,GAAG,UAAH,CAAe,GAAf,CAAnB,CACA,KAAK,QAAL,CAAe,GAAG,MAAlB,EACH,CAND,CAQA,GAAG,QAAH,CAAc,UAAW,GAAX,EAAmB,IAAI,MAAJ,CAAY,EAAZ,CAAnB,CAAsC,GAAI,GAAJ,CAApD,C;AAGH,CAdD,IAcO,IAAK,CAAC,GAAG,QAAJ,EAAgB,CAAC,GAAG,QAAH,GAAc,UAApC,CAAiD,CACpD,GAAG,MAAH,CAAY,KAAZ,CAEA,GAAG,QAAH,EAAe,KAAK,QAAL,CAAc,UAAW,CACpC,GAAG,KAAH,CAAS,OAAT,CAAiB,gBAAjB,EACH,CAFc,CAAf,CAGA,GAAG,QAAH,CAAc,IAAd,CACH,CACJ,CAnLF,CAqLC,WAAY,UAAW,CACnB,GAAI,IAAK,IAAT,CACI,IAAM,GAAG,IADb,CAEI,KAAO,GAAG,OAFd,CAGI,IAHJ,CAGU,IAHV,C;AAMA,GAAK,KAAO,IAAI,GAAJ,EAAP,EACG,IAAI,IAAJ,CAAS,SAAT,KAAyB,OAAO,QADxC,CACmD,C;AAG/C,GAAK,KAAK,eAAL,EAAwB,CAAC,GAAG,OAAH,CAAW,MAAzC,CAAkD,CAC9C,GAAG,gBAAH,GACH,CAED,MAAO,KAAI,KAAJ,EAAP,C;AAGH,CAXD,IAWO,IAAK,GAAG,MAAR,CAAiB,C;AAGpB,GAAK,CAAC,GAAG,OAAH,CAAW,MAAZ,EAAsB,GAAG,QAAH,GAAc,UAAzC,CAAsD,CAClD,GAAG,gBAAH,GACH,CAED,KAAO,GAAG,OAAH,CAAW,KAAX,EAAP,CACA,KAAO,SAAU,IAAV,CAAiB,CACpB,GAAK,CAAC,IAAN,CAAa,CACT,MAAO,KAAP,CACH,CAED,IAAM,SAAU,IAAV,CAAgB,KAAK,OAAL,CAAe,KAAK,SAApB,CAAgC,CAAhD,CAAN,CACA,GAAG,IAAH,CAAU,GAAV,CACA,MAAO,KAAI,KAAJ,EAAP,CACH,CARD,C;AAWA,MAAO,WAAW,IAAX,EACC,KAAM,KAAK,IAAL,CAAY,MAAZ,CAAqB,MAA3B,EAAoC,IAApC,CADD,CAEC,KAAM,IAAN,CAFR,CAGH,CACJ,CA9NF,C;;;;;eAuOC,iBAAkB,UAAW,CACzB,GAAI,IAAK,IAAT,CACI,KAAO,GAAG,OAAH,CAAW,YAAX,CADX,CAEI,QAAU,GAAG,OAFjB,CAGI,OAHJ,CAKA,GAAK,IAAL,CAAY,CACR,QAAU,GAAG,OAAH,CAAY,kBAAZ,CAAgC,IAAhC,CAAsC,UAAW,C;AAGvD,GAAK,KAAK,SAAL,KAAqB,OAAO,MAAjC,CAA0C,CACtC,GAAG,KAAH,CAAS,OAAT,CAAkB,aAAlB,CAAiC,IAAjC,EACA,KAAK,SAAL,CAAgB,OAAO,QAAvB,EACA,MAAO,KAAP,CACH,CAED,MAAO,IAAG,WAAH,CAAgB,IAAhB,CAAP,CACH,CAVS,CAAV,C;AAaA,QAAQ,IAAR,CAAa,UAAW,CACpB,GAAI,KAAM,EAAE,OAAF,CAAW,OAAX,CAAoB,OAApB,CAAV,CAEA,CAAC,GAAD,EAAQ,QAAQ,MAAR,CAAgB,GAAhB,CAAqB,CAArB,CAAwB,IAAxB,CAAR,CACH,CAJD,E;AAOA,QAAQ,IAAR,CAAa,SAAU,MAAV,CAAmB,CAC5B,KAAK,SAAL,CAAgB,OAAO,KAAvB,CAA8B,MAA9B,EACA,GAAG,KAAH,CAAS,OAAT,CAAkB,aAAlB,CAAiC,IAAjC,CAAuC,MAAvC,EACA,GAAG,KAAH,CAAS,OAAT,CAAkB,gBAAlB,CAAoC,IAApC,EACH,CAJD,EAMA,QAAQ,IAAR,CAAc,OAAd,EACH,CACJ,CA1QF,C;AA6QC,UAAW,SAAU,KAAV,CAAkB,CACzB,GAAI,KAAM,EAAE,OAAF,CAAW,KAAX,CAAkB,KAAK,IAAvB,CAAV,CAEA,KAAK,IAAL,CAAU,MAAV,CAAkB,GAAlB,CAAuB,CAAvB,EACA,MAAM,IAAN,CAAW,QAAX,GACA,KAAK,QAAL,GACH,CAnRF,C;AAsRC,WAAY,SAAU,KAAV,CAAkB,CAC1B,GAAI,IAAK,IAAT,CACI,KAAO,MAAM,IADjB,CAEI,OAFJ,CAIA,GAAG,IAAH,CAAQ,IAAR,CAAc,KAAd,EACA,GAAG,QAAH,G;;AAIA,MAAM,IAAN,CAAa,MAAM,MAAN,GAAiB,CAAjB,CAAqB,KAAK,MAA1B,CACL,KAAK,MAAL,CAAY,KAAZ,CAAmB,MAAM,KAAzB,CAAgC,MAAM,GAAtC,CADR,C;AAIA,QAAU,GAAG,OAAH,CAAY,aAAZ,CAA2B,KAA3B,CAAkC,UAAW,C;AAGnD,GAAK,KAAK,SAAL,KAAqB,OAAO,QAAjC,CAA4C,CACxC,GAAG,OAAH,CAAY,KAAZ,EACH,CAFD,IAEO,CACH,GAAG,SAAH,CAAc,KAAd,EACA,KAAK,QAAL,CAAe,GAAG,MAAlB,EACH,CACJ,CATS,CAAV,C;AAYA,QAAQ,IAAR,CAAa,UAAW,CACpB,GAAK,KAAK,QAAL,GAAkB,CAAvB,CAA2B,CACvB,GAAG,WAAH,CAAgB,IAAhB,EAAuB,MAAvB,CAA8B,UAAW,CACrC,MAAM,UAAN,CAAmB,CAAnB,CACA,GAAG,SAAH,CAAc,KAAd,EACA,GAAG,KAAH,CAAS,OAAT,CAAkB,gBAAlB,CAAoC,IAApC,EACA,KAAK,QAAL,CAAe,GAAG,MAAlB,EACH,CALD,EAMH,CAPD,IAOO,CACH,MAAM,UAAN,CAAmB,CAAnB,CACA,GAAG,SAAH,CAAc,KAAd,EACA,KAAK,QAAL,CAAe,GAAG,MAAlB,EACH,CACJ,CAbD,EAcH,CA9TF,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkXC,QAAS,SAAU,KAAV,CAAkB,CACvB,GAAI,IAAK,IAAT,CACI,MAAQ,GAAG,KADf,CAEI,KAAO,GAAG,OAFd,CAGI,KAAO,MAAM,IAHjB,CAII,GAAK,GAAI,UAAJ,CAAe,IAAf,CAJT,CAKI,KAAO,EAAE,MAAF,CAAS,EAAT,CAAa,KAAK,QAAlB,CALX,CAMI,QAAU,EAAE,MAAF,CAAS,EAAT,CAAa,KAAK,OAAlB,CANd,CAOI,aAPJ,CAOmB,GAPnB,CASA,MAAM,SAAN,CAAkB,EAAlB,CAEA,GAAG,EAAH,CAAO,SAAP,CAAkB,UAAW,CACzB,MAAO,OAAM,SAAb,CACA,GAAG,SAAH,CAAc,KAAd,EACA,KAAK,QAAL,CAAe,GAAG,MAAlB,EACH,CAJD,E;AAOA,GAAG,EAAH,CAAO,UAAP,CAAmB,SAAU,UAAV,CAAuB,CACtC,GAAI,cAAe,CAAnB,CACI,SAAW,CADf,C;;;;AAQA,aAAe,MAAM,UAAN,CAAmB,UAAlC,CAEA,GAAK,MAAM,MAAN,CAAe,CAApB,CAAwB,C;AACpB,EAAE,IAAF,CAAQ,KAAK,MAAb,CAAqB,SAAU,CAAV,CAAa,CAAb,CAAiB,CAClC,UAAY,CAAC,EAAE,UAAF,EAAgB,CAAjB,GAAuB,EAAE,GAAF,CAAQ,EAAE,KAAjC,CAAZ,CACH,CAFD,EAIA,aAAe,SAAW,KAAK,IAA/B,CACH,CAED,MAAM,OAAN,CAAe,gBAAf,CAAiC,IAAjC,CAAuC,cAAgB,CAAvD,EACH,CApBD,E;AAuBA,cAAgB,SAAU,MAAV,CAAmB,CAC/B,GAAI,GAAJ,CAEA,IAAM,GAAG,iBAAH,IAA0B,EAAhC,CACA,IAAI,IAAJ,CAAW,GAAG,WAAH,EAAX,CACA,GAAK,SAAU,KAAV,CAAkB,CACnB,OAAS,KAAT,CACH,CAFD,C;AAKA,GAAK,CAAC,MAAM,OAAN,CAAe,cAAf,CAA+B,KAA/B,CAAsC,GAAtC,CAA2C,EAA3C,CAAN,CAAwD,CACpD,OAAS,QAAU,QAAnB,CACH,CAED,MAAO,OAAP,CACH,CAfD,C;AAkBA,GAAG,EAAH,CAAO,OAAP,CAAgB,SAAU,IAAV,CAAgB,IAAhB,CAAuB,CACnC,MAAM,OAAN,CAAgB,MAAM,OAAN,EAAiB,CAAjC,C;AAGA,GAAK,MAAM,MAAN,CAAe,CAAf,EAAoB,CAAC,aAAa,OAAb,CAAsB,IAAtB,CAArB,EACG,MAAM,OAAN,CAAgB,KAAK,UAD7B,CAC0C,CAEtC,MAAM,OAAN,GACA,GAAG,IAAH,GAEH,CAND,IAMO,C;AAGH,GAAK,CAAC,IAAD,EAAS,OAAS,QAAvB,CAAkC,CAC9B,KAAO,cAAe,IAAf,CAAP,CACH,CAED,KAAK,SAAL,CAAgB,OAAO,KAAvB,CAA8B,IAA9B,EACA,MAAM,OAAN,CAAe,aAAf,CAA8B,IAA9B,CAAoC,IAApC,EACA,MAAM,OAAN,CAAe,gBAAf,CAAiC,IAAjC,EACH,CACJ,CArBD,E;AAwBA,GAAG,EAAH,CAAO,MAAP,CAAe,UAAW,CACtB,GAAI,OAAJ,C;AAGA,GAAM,OAAS,eAAf,CAAkC,CAC9B,GAAG,OAAH,CAAY,OAAZ,CAAqB,MAArB,CAA6B,IAA7B,EACA,OACH,C;AAGD,GAAK,KAAK,QAAL,GAAkB,CAAvB,CAA2B,CACvB,GAAG,WAAH,CAAgB,IAAhB,CAAsB,GAAtB,EACH,CAFD,IAEO,CACH,GAAG,OAAH,GACH,CACJ,CAfD,E;AAkBA,KAAO,EAAE,MAAF,CAAU,IAAV,CAAgB,CACnB,GAAI,KAAK,EADU,CAEnB,KAAM,KAAK,IAFQ,CAGnB,KAAM,KAAK,IAHQ,CAInB,iBAAkB,KAAK,gBAJJ,CAKnB,KAAM,KAAK,IALQ,CAAhB,CAAP,CAQA,MAAM,MAAN,CAAe,CAAf,EAAoB,EAAE,MAAF,CAAU,IAAV,CAAgB,CAChC,OAAQ,MAAM,MADkB,CAEhC,MAAO,MAAM,KAFmB,CAAhB,CAApB,C;;AAOA,MAAM,OAAN,CAAe,kBAAf,CAAmC,KAAnC,CAA0C,IAA1C,CAAgD,OAAhD,E;AAGA,GAAG,UAAH,CAAe,KAAK,OAApB,CAA6B,MAAM,IAAnC,CAAyC,KAAK,IAA9C,EACA,GAAG,MAAH,CAAW,IAAX,EACA,GAAG,gBAAH,CAAqB,OAArB,EACA,GAAG,IAAH,GACH,CA9eF,C;AAifC,YAAa,SAAU,IAAV,CAAgB,GAAhB,CAAqB,GAArB,CAA2B,CACpC,GAAI,OAAQ,KAAK,KAAjB,CAEA,MAAO,OACE,OADF,CACW,iBADX,CAC8B,SAD9B,CACyC,UAAW,CAC/C,KAAK,SAAL,CAAgB,OAAO,QAAvB,EACA,MAAM,OAAN,CAAe,eAAf,CAAgC,IAAhC,CAAsC,GAAtC,CAA2C,GAA3C,EACH,CAJF,EAKE,IALF,CAKO,SAAU,MAAV,CAAmB,C;AAGrB,GAAK,KAAK,SAAL,KAAqB,OAAO,QAAjC,CAA4C,CACxC,KAAK,SAAL,CAAgB,OAAO,KAAvB,CAA8B,MAA9B,EACH,CAED,MAAM,OAAN,CAAe,aAAf,CAA8B,IAA9B,CAAoC,MAApC,EACH,CAbF,EAcE,MAdF,CAcS,UAAW,CACf,MAAM,OAAN,CAAe,gBAAf,CAAiC,IAAjC,EACH,CAhBF,CAAP,CAiBH,CArgBF,CALH,EA6gBH,CA/oBD,E;;OAopBA,OAAO,mBAAP,CAA2B,CACvB,MADuB,CAEvB,UAFuB,CAGvB,MAHuB,CAIvB,gBAJuB,CAA3B,CAKG,SAAU,IAAV,CAAgB,QAAhB,CAA0B,MAA1B,CAAmC,CAElC,GAAI,GAAI,KAAK,CAAb,CACI,WAAa,EADjB,CAEI,GAFJ,C;;;;;;;;;AAeA,IAAM,C;AAGF,aAAc,SAAU,IAAV,CAAgB,EAAhB,CAAqB,CAC/B,WAAY,IAAZ,EAAqB,EAArB,CACH,CALC,C;AAQF,gBAAiB,SAAU,IAAV,CAAiB,CAC9B,MAAO,YAAY,IAAZ,CAAP,CACH,CAVC,CAAN,C;AAcA,SAAS,QAAT,CAAkB,CACd,KAAM,UAAW,CACb,GAAI,IAAK,IAAT,CACA,EAAE,IAAF,CAAQ,UAAR,CAAoB,UAAW,CAC3B,KAAK,IAAL,CAAW,GAAG,KAAd,EACH,CAFD,EAGH,CANa,CAAlB,E;;;;;WAeA,IAAI,YAAJ,CAAkB,cAAlB,CAAkC,UAAW,CACzC,GAAI,UAAW,IAAf,CACI,KAAO,SAAS,OADpB,CAEI,MAAQ,CAFZ,CAGI,IAAM,KAAK,YAAL,EAAqB,CAH/B,CAII,KAAO,IAJX,CAMA,GAAK,CAAC,GAAN,CAAY,CACR,OACH,CAED,SAAS,EAAT,CAAa,kBAAb,CAAiC,SAAU,IAAV,CAAiB,CAE9C,GAAK,OAAS,GAAT,EAAgB,IAArB,CAA4B,CACxB,KAAO,KAAP,CACA,KAAK,OAAL,CAAc,OAAd,CAAuB,oBAAvB,CAA6C,GAA7C,CAAkD,IAAlD,EACA,WAAW,UAAW,CAClB,KAAO,IAAP,CACH,CAFD,CAEG,CAFH,EAGH,CAED,MAAO,QAAS,GAAT,CAAe,KAAf,CAAuB,IAA9B,CACH,CAXD,EAaA,SAAS,EAAT,CAAa,YAAb,CAA2B,UAAW,CAClC,QACH,CAFD,EAIA,SAAS,EAAT,CAAa,cAAb,CAA6B,UAAW,CACpC,QACH,CAFD,EAIA,SAAS,EAAT,CAAa,gBAAb,CAA+B,UAAW,CACtC,MAAQ,CAAR,CACH,CAFD,EAGH,CAnCD,E;;;;;WA4CA,IAAI,YAAJ,CAAkB,eAAlB,CAAmC,UAAW,CAC1C,GAAI,UAAW,IAAf,CACI,KAAO,SAAS,OADpB,CAEI,MAAQ,CAFZ,CAGI,IAAM,KAAK,aAAL,EAAsB,CAHhC,CAII,KAAO,IAJX,CAMA,GAAK,CAAC,GAAN,CAAY,CACR,OACH,CAED,SAAS,EAAT,CAAa,kBAAb,CAAiC,SAAU,IAAV,CAAiB,CAC9C,GAAI,SAAU,MAAQ,KAAK,IAAb,CAAoB,GAAlC,CAEA,GAAK,SAAW,IAAhB,CAAuB,CACnB,KAAO,KAAP,CACA,KAAK,OAAL,CAAc,OAAd,CAAuB,qBAAvB,CAA8C,GAA9C,CAAmD,IAAnD,EACA,WAAW,UAAW,CAClB,KAAO,IAAP,CACH,CAFD,CAEG,CAFH,EAGH,CAED,MAAO,SAAU,KAAV,CAAkB,IAAzB,CACH,CAZD,EAcA,SAAS,EAAT,CAAa,YAAb,CAA2B,SAAU,IAAV,CAAiB,CACxC,OAAS,KAAK,IAAd,CACH,CAFD,EAIA,SAAS,EAAT,CAAa,cAAb,CAA6B,SAAU,IAAV,CAAiB,CAC1C,OAAS,KAAK,IAAd,CACH,CAFD,EAIA,SAAS,EAAT,CAAa,gBAAb,CAA+B,UAAW,CACtC,MAAQ,CAAR,CACH,CAFD,EAGH,CApCD,E;;;;;WA4CA,IAAI,YAAJ,CAAkB,qBAAlB,CAAyC,UAAW,CAChD,GAAI,UAAW,IAAf,CACI,KAAO,SAAS,OADpB,CAEI,IAAM,KAAK,mBAFf,CAIA,GAAK,CAAC,GAAN,CAAY,CACR,OACH,CAED,SAAS,EAAT,CAAa,kBAAb,CAAiC,SAAU,IAAV,CAAiB,CAE9C,GAAK,KAAK,IAAL,CAAY,GAAjB,CAAuB,CACnB,KAAK,SAAL,CAAgB,OAAO,MAAP,CAAc,OAA9B,CAAuC,aAAvC,EACA,KAAK,OAAL,CAAc,OAAd,CAAuB,eAAvB,CAAwC,IAAxC,EACA,MAAO,MAAP,CACH,CAEJ,CARD,EAUH,CAnBD,E;;;;;WA2BA,IAAI,YAAJ,CAAkB,WAAlB,CAA+B,UAAW,CACtC,GAAI,UAAW,IAAf,CACI,KAAO,SAAS,OADpB,CAEI,QAAU,EAFd,CAIA,GAAK,KAAK,SAAV,CAAsB,CAClB,OACH,CAED,QAAS,WAAT,CAAqB,GAArB,CAA2B,CACvB,GAAI,MAAO,CAAX,CACI,EAAI,CADR,CAEI,IAAM,IAAI,MAFd,CAGI,KAHJ,CAKA,KAAQ,EAAI,GAAZ,CAAiB,GAAjB,CAAuB,CACnB,MAAQ,IAAI,UAAJ,CAAgB,CAAhB,CAAR,CACA,KAAO,OAAS,MAAQ,CAAjB,GAAuB,MAAQ,EAA/B,EAAqC,IAA5C,CACH,CAED,MAAO,KAAP,CACH,CAED,SAAS,EAAT,CAAa,kBAAb,CAAiC,SAAU,IAAV,CAAiB,CAC9C,GAAI,MAAO,KAAK,MAAL,GAAgB,KAAK,MAAL,CAAc,WAAY,KAAK,IAAL,CAC7C,KAAK,IADwC,CACjC,KAAK,gBADgB,CAA9B,CAAX,C;AAIA,GAAK,QAAS,IAAT,CAAL,CAAuB,CACnB,KAAK,OAAL,CAAc,OAAd,CAAuB,aAAvB,CAAsC,IAAtC,EACA,MAAO,MAAP,CACH,CACJ,CATD,EAWA,SAAS,EAAT,CAAa,YAAb,CAA2B,SAAU,IAAV,CAAiB,CACxC,GAAI,MAAO,KAAK,MAAhB,CAEA,OAAS,QAAS,IAAT,EAAkB,IAA3B,EACH,CAJD,EAMA,SAAS,EAAT,CAAa,cAAb,CAA6B,SAAU,IAAV,CAAiB,CAC1C,GAAI,MAAO,KAAK,MAAhB,CAEA,MAAS,MAAO,SAAS,IAAT,CAAhB,CACH,CAJD,EAKH,CA7CD,EA+CA,MAAO,IAAP,CACH,CAtND,E;;OA2NA,OAAO,kBAAP,CAA0B,EAA1B,CAA6B,UAAW,CAEpC,QAAS,SAAT,CAAmB,KAAnB,CAA0B,OAA1B,CAAoC,CAEhC,KAAK,KAAL,CAAa,KAAb,CACA,KAAK,OAAL,CAAe,MAAM,OAArB,CAEA,KAAK,UAAL,CAAkB,UAAW,CACzB,MAAO,QAAP,CACH,CAFD,CAIA,KAAK,OAAL,CAAe,UAAW,CACtB,MAAO,SAAQ,GAAf,CACH,CAFD,CAIA,KAAK,OAAL,CAAe,UAAW,CACtB,MAAO,OAAM,OAAN,CAAc,KAAd,CAAqB,KAArB,CAA4B,SAA5B,CAAP,CACH,CAFD,CAGH,CAED,MAAO,SAAP,CACH,CArBD,E;;OAyBA,OAAO,uBAAP,CAA+B,CAC3B,MAD2B,CAE3B,iBAF2B,CAG3B,kBAH2B,CAA/B,CAIG,SAAU,IAAV,CAAgB,OAAhB,CAAyB,QAAzB,CAAoC,CAEnC,GAAI,MAAO,OAAX,CACI,WAAa,EADjB,CAGA,QAAS,aAAT,EAAwB,CACpB,GAAI,MAAO,EAAX,CACI,GAAK,IADT,CAEI,QAAU,KAAK,OAFnB,CAIA,QAAQ,KAAR,CAAe,EAAf,CAAmB,SAAnB,EACA,GAAG,IAAH,CAAU,IAAV,C;AAIA,GAAG,IAAH,CAAU,SAAU,IAAV,CAAgB,E,aAAhB,CAAiC,CACvC,GAAI,QAAS,IAAb,CACI,IAAM,OAAO,GADjB,CAEI,KAAO,KAAK,KAAL,CAAY,SAAZ,CAAuB,CAAvB,CAFX,CAGI,QAHJ,CAKA,GAAK,WAAY,IAAZ,CAAL,CAA0B,CACtB,SAAW,KAAM,GAAN,EAAc,KAAM,GAAN,GACjB,GAAI,YAAY,IAAZ,CAAJ,CAAwB,MAAxB,CAAgC,EAAhC,CADR,CAGA,GAAK,SAAU,EAAV,CAAL,CAAsB,CAClB,MAAO,UAAU,EAAV,EAAe,KAAf,CAAsB,QAAtB,CAAgC,IAAhC,CAAP,CACH,CACJ,CACJ,CAdD,CAgBA,GAAG,OAAH,CAAa,UAAW,C;AAEpB,MAAO,UAAW,QAAQ,KAAR,CAAe,IAAf,CAAqB,SAArB,CAAlB,CACH,CAHD,CAIH,CAED,KAAK,QAAL,CAAe,OAAf,CAAwB,CACpB,YAAa,YADO,C;AAIpB,KAAM,UAAW,CACb,GAAI,IAAK,IAAT,CACA,WAAW,UAAW,CAClB,GAAG,OAAH,CAAW,OAAX,EACH,CAFD,CAEG,CAFH,EAGH,CATmB,CAAxB,E;AAcA,aAAa,QAAb,CAAwB,SAAU,IAAV,CAAgB,SAAhB,CAA4B,CAChD,GAAI,OAAQ,WAAY,IAAZ,EAAqB,KAAK,QAAL,CAAe,QAAf,CAAyB,SAAzB,CAAjC,CACA,MAAO,MAAP,CACH,CAHD,C;;AAOA,GAAK,OAAO,IAAP,EAAe,OAAO,UAAtB,EAAoC,OAAO,QAAhD,CAA2D,CACvD,QAAQ,UAAR,CAAoB,IAApB,CAA0B,YAA1B,EACH,CAED,MAAO,aAAP,CACH,CAnED,E;;OAuEA,OAAO,oBAAP,CAA4B,CACxB,uBADwB,CAExB,UAFwB,CAA5B,CAGG,SAAU,YAAV,CAAwB,IAAxB,CAA+B,CAE9B,MAAO,cAAa,QAAb,CAAuB,MAAvB,CAA+B,CAClC,MAAO,SAAU,KAAV,CAAiB,GAAjB,CAAuB,CAC1B,GAAI,MAAO,KAAK,KAAL,CAAW,MAAtB,CACI,MAAQ,KAAK,KAAL,EAAc,KAAK,WAAnB,EAAkC,KAAK,QADnD,CAGA,KAAO,MAAM,IAAN,CAAY,IAAZ,CAAkB,KAAlB,CAAyB,GAAzB,CAAP,CAEA,MAAO,IAAI,KAAJ,CAAU,KAAK,OAAL,EAAV,CAA0B,IAA1B,CAAP,CACH,CARiC,CAA/B,CAAP,CAUH,CAfD,E;;OAmBA,OAAO,mBAAP,CAA2B,CACvB,MADuB,CAEvB,uBAFuB,CAGvB,UAHuB,CAA3B,CAIG,SAAU,IAAV,CAAgB,YAAhB,CAA8B,IAA9B,CAAqC,CAEpC,GAAI,GAAI,KAAK,CAAb,CACI,OAAS,kBADb,CAGA,MAAO,cAAa,QAAb,CAAuB,aAAvB,CAAsC,CACzC,KAAM,UAAW,CACb,GAAI,MAAO,KAAK,IAAL,CAAY,KAAK,OAAL,CAAa,SAApC,CAEA,KAAK,gBAAL,CAAwB,KAAK,MAAL,CAAa,KAAK,iBAAlB,CAAqC,IAArC,CAAxB,CACA,KAAK,eAAL,CAAuB,KAAK,MAAL,CAAa,KAAK,gBAAlB,CAAoC,IAApC,CAAvB,CACA,KAAK,gBAAL,CAAwB,KAAK,MAAL,CAAa,KAAK,iBAAlB,CAAqC,IAArC,CAAxB,CACA,KAAK,WAAL,CAAmB,KAAK,MAAL,CAAa,KAAK,YAAlB,CAAgC,IAAhC,CAAnB,CACA,KAAK,OAAL,CAAe,KAAf,CAEA,KAAK,EAAL,CAAS,WAAT,CAAsB,KAAK,gBAA3B,EACA,KAAK,EAAL,CAAS,UAAT,CAAqB,KAAK,eAA1B,EACA,KAAK,EAAL,CAAS,WAAT,CAAsB,KAAK,gBAA3B,EACA,KAAK,EAAL,CAAS,MAAT,CAAiB,KAAK,WAAtB,EAEA,GAAK,KAAK,OAAL,CAAa,gBAAlB,CAAqC,CACjC,EAAG,QAAH,EAAc,EAAd,CAAkB,UAAlB,CAA8B,KAAK,eAAnC,EACA,EAAG,QAAH,EAAc,EAAd,CAAkB,MAAlB,CAA0B,KAAK,WAA/B,EACH,CACJ,CAnBwC,CAqBzC,kBAAmB,SAAU,CAAV,CAAc,CAC7B,GAAI,IAAK,IAAT,CACI,OAAS,GAAG,OAAH,EAAc,KAD3B,CAEI,KAFJ,CAIA,EAAI,EAAE,aAAF,EAAmB,CAAvB,CAEA,GAAK,CAAC,GAAG,OAAT,CAAmB,CACf,GAAG,OAAH,CAAa,IAAb,C;AAGA,MAAQ,EAAE,YAAF,CAAe,KAAvB,CAEA,GAAK,OAAS,MAAM,MAApB,CAA6B,CACzB,GAAG,OAAH,CAAa,OAAS,CAAC,GAAG,OAAH,CAAY,QAAZ,CAAsB,KAAtB,CAAvB,CACH,CAED,GAAG,IAAH,CAAQ,QAAR,CAAkB,OAAS,MAA3B,EACA,GAAG,IAAH,CAAS,OAAS,UAAT,CACD,aADR,EACyB,OAAS,QADlC,EAEH,CAGD,EAAE,YAAF,CAAe,UAAf,CAA4B,OAAS,MAAT,CAAkB,MAA9C,CAEA,MAAO,MAAP,CACH,CA/CwC,CAiDzC,iBAAkB,SAAU,CAAV,CAAc,C;AAE5B,GAAI,YAAa,KAAK,IAAL,CAAU,MAAV,GAAmB,GAAnB,CAAwB,CAAxB,CAAjB,CACA,GAAK,YAAc,CAAC,EAAE,QAAF,CAAY,UAAZ,CAAwB,EAAE,aAA1B,CAApB,CAAgE,CAC5D,MAAO,MAAP,CACH,CAED,aAAc,KAAK,WAAnB,EACA,KAAK,iBAAL,CAAuB,IAAvB,CAA6B,IAA7B,CAAmC,CAAnC,EAEA,MAAO,MAAP,CACH,CA5DwC,CA8DzC,kBAAmB,UAAW,CAC1B,GAAI,IAAK,IAAT,CACI,OADJ,CAGA,QAAU,UAAW,CACjB,GAAG,OAAH,CAAa,KAAb,CACA,GAAG,IAAH,CAAQ,WAAR,CAAqB,OAAS,OAAT,CAAmB,MAAnB,CAA4B,QAAjD,EACH,CAHD,CAKA,aAAc,GAAG,WAAjB,EACA,GAAG,WAAH,CAAiB,WAAY,OAAZ,CAAqB,GAArB,CAAjB,CACA,MAAO,MAAP,CACH,CA1EwC,CA4EzC,aAAc,SAAU,CAAV,CAAc,CACxB,GAAI,IAAK,IAAT,CACI,KAAO,GAAG,OAAH,EADX,CAEI,WAAa,GAAG,IAAH,CAAQ,MAAR,GAAiB,GAAjB,CAAsB,CAAtB,CAFjB,C;AAKA,GAAK,YAAc,CAAC,EAAE,QAAF,CAAY,UAAZ,CAAwB,EAAE,aAA1B,CAApB,CAAgE,CAC5D,MAAO,MAAP,CACH,CAED,GAAG,gBAAH,CAAqB,CAArB,CAAwB,SAAU,OAAV,CAAoB,CACxC,GAAG,OAAH,CAAY,MAAZ,CAAoB,EAAE,GAAF,CAAO,OAAP,CAAgB,SAAU,IAAV,CAAiB,CACjD,MAAO,IAAI,KAAJ,CAAU,IAAV,CAAgB,IAAhB,CAAP,CACH,CAFmB,CAApB,EAGH,CAJD,EAMA,GAAG,OAAH,CAAa,KAAb,CACA,GAAG,IAAH,CAAQ,WAAR,CAAqB,OAAS,MAA9B,EACA,MAAO,MAAP,CACH,CA/FwC,C;AAkGzC,iBAAkB,SAAU,CAAV,CAAa,QAAb,CAAwB,CACtC,GAAI,SAAW,EAAf,CACI,SAAW,EADf,CAEI,KAFJ,CAEW,KAFX,CAEkB,YAFlB,CAEgC,IAFhC,CAEsC,IAFtC,CAE4C,CAF5C,CAE+C,GAF/C,CAEoD,eAFpD,CAIA,EAAI,EAAE,aAAF,EAAmB,CAAvB,CAEA,aAAe,EAAE,YAAjB,CACA,MAAQ,aAAa,KAArB,CACA,MAAQ,aAAa,KAArB,CAEA,gBAAkB,CAAC,EAAE,OAAS,MAAO,CAAP,EAAW,gBAAtB,CAAnB,CAEA,IAAM,EAAI,CAAJ,CAAO,IAAM,MAAM,MAAzB,CAAiC,EAAI,GAArC,CAA0C,GAA1C,CAAgD,CAC5C,KAAO,MAAO,CAAP,CAAP,CACA,KAAO,OAAS,MAAO,CAAP,CAAhB,CAEA,GAAK,iBAAmB,KAAK,gBAAL,GAAwB,WAAhD,CAA8D,CAE1D,SAAS,IAAT,CAAe,KAAK,sBAAL,CACP,KAAK,gBAAL,EADO,CACkB,OADlB,CAAf,EAEH,CAJD,IAIO,CACH,QAAQ,IAAR,CAAc,IAAd,EACH,CACJ,CAED,KAAK,IAAL,CAAU,KAAV,CAAiB,IAAjB,CAAuB,QAAvB,EAAkC,IAAlC,CAAuC,UAAW,CAE9C,GAAK,CAAC,QAAQ,MAAd,CAAuB,CACnB,OACH,CAED,SAAU,OAAV,EACH,CAPD,EAQH,CApIwC,CAsIzC,uBAAwB,SAAU,KAAV,CAAiB,OAAjB,CAA2B,CAC/C,GAAI,UAAW,KAAK,QAAL,EAAf,CACI,GAAK,IADT,CAGA,GAAK,MAAM,MAAX,CAAoB,CAChB,MAAM,IAAN,CAAW,SAAU,IAAV,CAAiB,CACxB,QAAQ,IAAR,CAAc,IAAd,EACA,SAAS,OAAT,GACH,CAHD,EAIH,CALD,IAKO,IAAK,MAAM,WAAX,CAAyB,CAC5B,MAAM,YAAN,GAAqB,WAArB,CAAiC,SAAU,OAAV,CAAoB,CACjD,GAAI,KAAM,QAAQ,MAAlB,CACI,SAAW,EADf,CAEI,IAAM,EAFV,C;AAGI,CAHJ,CAKA,IAAM,EAAI,CAAV,CAAa,EAAI,GAAjB,CAAsB,GAAtB,CAA4B,CACxB,SAAS,IAAT,CAAe,GAAG,sBAAH,CACP,QAAS,CAAT,CADO,CACO,GADP,CAAf,EAEH,CAED,KAAK,IAAL,CAAU,KAAV,CAAiB,IAAjB,CAAuB,QAAvB,EAAkC,IAAlC,CAAuC,UAAW,CAC9C,QAAQ,IAAR,CAAa,KAAb,CAAoB,OAApB,CAA6B,GAA7B,EACA,SAAS,OAAT,GACH,CAHD,CAGG,SAAS,MAHZ,EAIH,CAfD,EAgBH,CAED,MAAO,UAAS,OAAT,EAAP,CACH,CAnKwC,CAqKzC,QAAS,UAAW,CAChB,GAAI,MAAO,KAAK,IAAhB,CAEA,KAAK,GAAL,CAAU,WAAV,CAAuB,KAAK,gBAA5B,EACA,KAAK,GAAL,CAAU,UAAV,CAAsB,KAAK,gBAA3B,EACA,KAAK,GAAL,CAAU,WAAV,CAAuB,KAAK,gBAA5B,EACA,KAAK,GAAL,CAAU,MAAV,CAAkB,KAAK,WAAvB,EAEA,GAAK,KAAK,OAAL,CAAa,gBAAlB,CAAqC,CACjC,EAAG,QAAH,EAAc,GAAd,CAAmB,UAAnB,CAA+B,KAAK,eAApC,EACA,EAAG,QAAH,EAAc,GAAd,CAAmB,MAAnB,CAA2B,KAAK,WAAhC,EACH,CACJ,CAjLwC,CAAtC,CAAP,CAmLH,CA5LD,E;;OAiMA,OAAO,yBAAP,CAAiC,CAC7B,MAD6B,CAE7B,uBAF6B,CAG7B,UAH6B,CAAjC,CAIG,SAAU,IAAV,CAAgB,YAAhB,CAA8B,IAA9B,CAAqC,CAEpC,MAAO,cAAa,QAAb,CAAuB,WAAvB,CAAoC,CACvC,KAAM,UAAW,CACb,GAAI,MAAO,KAAK,OAAhB,CACI,KAAO,KAAK,IAAL,CAAY,KAAK,SAD5B,CAEI,OAAS,IAFb,CAGI,GAHJ,CAGS,CAHT,CAGY,GAHZ,CAGiB,IAHjB,C;AAMA,GAAK,KAAK,MAAV,CAAmB,CACf,IAAM,EAAN,CAEA,IAAM,EAAI,CAAJ,CAAO,IAAM,KAAK,MAAL,CAAY,MAA/B,CAAuC,EAAI,GAA3C,CAAgD,GAAhD,CAAsD,CAClD,KAAO,KAAK,MAAL,CAAa,CAAb,EAAiB,SAAxB,CACA,MAAQ,IAAI,IAAJ,CAAU,IAAV,CAAR,CACH,CAED,GAAK,IAAI,MAAT,CAAkB,CACd,OAAS,IAAI,IAAJ,CAAS,GAAT,CAAT,CACA,OAAS,OAAO,OAAP,CAAgB,IAAhB,CAAsB,GAAtB,EAA4B,OAA5B,CAAqC,KAArC,CAA4C,IAA5C,CAAT,CACH,CACJ,CACD,KAAK,MAAL,CAAc,OAAS,GAAI,OAAJ,CAAY,MAAZ,CAAoB,GAApB,CAAvB,CACA,KAAK,MAAL,CAAc,KAAK,MAAL,CAAa,KAAK,YAAlB,CAAgC,IAAhC,CAAd,CACA,KAAK,EAAL,CAAS,OAAT,CAAkB,KAAK,MAAvB,EACH,CAxBsC,CA0BvC,aAAc,SAAU,CAAV,CAAc,CACxB,GAAI,SAAU,EAAd,CACI,KAAO,KAAK,OAAL,EADX,CAEI,KAFJ,CAEW,IAFX,CAEiB,IAFjB,CAEuB,CAFvB,CAE0B,GAF1B,CAIA,EAAI,EAAE,aAAF,EAAmB,CAAvB,CACA,MAAQ,EAAE,aAAF,CAAgB,KAAxB,CAEA,IAAM,EAAI,CAAJ,CAAO,IAAM,MAAM,MAAzB,CAAiC,EAAI,GAArC,CAA0C,GAA1C,CAAgD,CAC5C,KAAO,MAAO,CAAP,CAAP,CAEA,GAAK,KAAK,IAAL,GAAc,MAAd,EAAwB,EAAE,KAAO,KAAK,SAAL,EAAT,CAA7B,CAA0D,CACtD,SACH,CAED,QAAQ,IAAR,CAAc,GAAI,KAAJ,CAAU,IAAV,CAAgB,IAAhB,CAAd,EACH,CAED,GAAK,QAAQ,MAAb,CAAsB,C;AAElB,EAAE,cAAF,GACA,EAAE,eAAF,GACA,KAAK,OAAL,CAAc,OAAd,CAAuB,OAAvB,EACH,CACJ,CAlDsC,CAoDvC,QAAS,UAAW,CAChB,KAAK,IAAL,CAAU,GAAV,CAAe,OAAf,CAAwB,KAAK,MAA7B,EACH,CAtDsC,CAApC,CAAP,CAwDH,CA9DD,E;;OAmEA,OAAO,0BAAP,CAAkC,CAC9B,MAD8B,CAE9B,uBAF8B,CAAlC,CAGG,SAAU,IAAV,CAAgB,YAAhB,CAA+B,CAE9B,GAAI,GAAI,KAAK,CAAb,CAEA,MAAO,cAAa,QAAb,CAAuB,YAAvB,CAAqC,CACxC,KAAM,UAAW,CACb,GAAI,WAAY,KAAK,UAAL,GAAkB,YAAlB,EAAhB,CACI,GAAK,IADT,CAEI,MAAQ,GAAG,KAFf,CAGI,KAAO,GAAG,OAHd,CAII,MAAQ,EAAG,SAAS,aAAT,CAAuB,OAAvB,CAAH,CAJZ,CAKI,MAAQ,EAAG,SAAS,aAAT,CAAuB,OAAvB,CAAH,CALZ,CAMI,GANJ,CAMS,CANT,CAMY,GANZ,CAMiB,YANjB,CAQA,MAAM,IAAN,CAAY,MAAZ,CAAoB,MAApB,EACA,MAAM,IAAN,CAAY,MAAZ,CAAoB,KAAK,IAAzB,EACA,MAAM,QAAN,CAAe,+BAAf,EAEA,MAAM,EAAN,CAAU,OAAV,CAAmB,UAAW,CAC1B,MAAM,OAAN,CAAc,OAAd,EACH,CAFD,EAIA,MAAM,GAAN,CAAU,CACN,QAAS,CADH,CAEN,MAAO,MAFD,CAGN,OAAQ,MAHF,CAIN,QAAS,OAJH,CAKN,OAAQ,SALF,CAMN,WAAY,SANN,CAAV,EASA,GAAK,KAAK,QAAV,CAAqB,CACjB,MAAM,IAAN,CAAY,UAAZ,CAAwB,UAAxB,EACH,C;AAGD,GAAK,KAAK,MAAL,EAAe,KAAK,MAAL,CAAY,MAAZ,CAAqB,CAAzC,CAA6C,CACzC,IAAM,EAAN,CAEA,IAAM,EAAI,CAAJ,CAAO,IAAM,KAAK,MAAL,CAAY,MAA/B,CAAuC,EAAI,GAA3C,CAAgD,GAAhD,CAAsD,CAClD,IAAI,IAAJ,CAAU,KAAK,MAAL,CAAa,CAAb,EAAiB,SAA3B,EACH,CAED,MAAM,IAAN,CAAY,QAAZ,CAAsB,IAAI,IAAJ,CAAS,GAAT,CAAtB,EACH,CAED,UAAU,MAAV,CAAkB,KAAlB,EACA,UAAU,MAAV,CAAkB,KAAlB,EAEA,aAAe,SAAU,CAAV,CAAc,CACzB,MAAM,OAAN,CAAe,EAAE,IAAjB,EACH,CAFD,CAIA,MAAM,EAAN,CAAU,QAAV,CAAoB,SAAU,CAAV,CAAc,CAC9B,GAAI,IAAK,UAAU,MAAnB,CACI,KADJ,CAGA,GAAG,KAAH,CAAW,EAAE,MAAF,CAAS,KAApB,C;AAGA,MAAQ,KAAK,SAAL,CAAgB,IAAhB,CAAR,CACA,KAAK,UAAL,CAAgB,YAAhB,CAA8B,KAA9B,CAAqC,IAArC,EAEA,MAAM,GAAN,GACA,MAAQ,EAAG,KAAH,EAAW,EAAX,CAAe,QAAf,CAAyB,EAAzB,EACC,EADD,CACK,uBADL,CAC8B,YAD9B,CAAR,CAGA,MAAM,OAAN,CAAc,QAAd,EACH,CAfD,EAiBA,MAAM,EAAN,CAAU,uBAAV,CAAmC,YAAnC,EAEH,CApEuC,CAuExC,SAAU,UAAW,CACjB,MAAO,MAAK,KAAZ,CACH,CAzEuC,CA2ExC,QAAS,UAAW,C;AAEnB,CA7EuC,CAArC,CAAP,CA+EH,CAtFD,E;;;;;OA6FA,OAAO,oBAAP,CAA4B,CACxB,MADwB,CAA5B,CAEG,SAAU,IAAV,CAAiB,CAEhB,GAAI,QAAS,OAAO,eAAP,EAA0B,MAA1B,EACL,OAAO,GAAP,EAAc,IAAI,eAAlB,EAAqC,GADhC,EAEL,OAAO,SAFf,CAGI,gBAAkB,KAAK,IAH3B,CAII,gBAAkB,eAJtB,CAMA,GAAK,MAAL,CAAc,C;AAGV,gBAAkB,UAAW,CACzB,MAAO,QAAO,eAAP,CAAuB,KAAvB,CAA8B,MAA9B,CAAsC,SAAtC,CAAP,CACH,CAFD,CAIA,gBAAkB,UAAW,CACzB,MAAO,QAAO,eAAP,CAAuB,KAAvB,CAA8B,MAA9B,CAAsC,SAAtC,CAAP,CACH,CAFD,CAGH,CAED,MAAO,CACH,gBAAiB,eADd,CAEH,gBAAiB,eAFd,CAIH,aAAc,SAAU,OAAV,CAAoB,CAC9B,GAAI,QAAJ,CAAa,QAAb,CAAuB,EAAvB,CAA2B,CAA3B,CAA8B,QAA9B,CAAwC,KAAxC,CAEA,MAAQ,QAAQ,KAAR,CAAc,GAAd,CAAR,CAEA,GAAK,CAAC,MAAO,CAAP,EAAW,OAAX,CAAmB,QAAnB,CAAN,CAAqC,CACjC,QAAU,KAAM,MAAO,CAAP,CAAN,CAAV,CACH,CAFD,IAEO,CACH,QAAU,mBAAoB,MAAO,CAAP,CAApB,CAAV,CACH,CAED,GAAK,GAAI,YAAJ,CAAiB,QAAQ,MAAzB,CAAL,CACA,SAAW,GAAI,WAAJ,CAAgB,EAAhB,CAAX,CAEA,IAAM,EAAI,CAAV,CAAa,EAAI,QAAQ,MAAzB,CAAiC,GAAjC,CAAuC,CACnC,SAAU,CAAV,EAAgB,QAAQ,UAAR,CAAoB,CAApB,CAAhB,CACH,CAED,SAAW,MAAO,CAAP,EAAW,KAAX,CAAiB,GAAjB,EAAuB,CAAvB,EAA2B,KAA3B,CAAiC,GAAjC,EAAuC,CAAvC,CAAX,CAEA,MAAO,MAAK,iBAAL,CAAwB,EAAxB,CAA4B,QAA5B,CAAP,CACH,CAzBE,CA2BH,oBAAqB,SAAU,OAAV,CAAoB,CACrC,GAAI,QAAJ,CAAa,QAAb,CAAuB,CAAvB,CAA0B,KAA1B,CAEA,MAAQ,QAAQ,KAAR,CAAc,GAAd,CAAR,CAEA,GAAK,CAAC,MAAO,CAAP,EAAW,OAAX,CAAmB,QAAnB,CAAN,CAAqC,CACjC,QAAU,KAAM,MAAO,CAAP,CAAN,CAAV,CACH,CAFD,IAEO,CACH,QAAU,mBAAoB,MAAO,CAAP,CAApB,CAAV,CACH,CAED,SAAW,GAAI,WAAJ,CAAgB,QAAQ,MAAxB,CAAX,CAEA,IAAM,EAAI,CAAV,CAAa,EAAI,QAAQ,MAAzB,CAAiC,GAAjC,CAAuC,CACnC,SAAU,CAAV,EAAgB,QAAQ,UAAR,CAAoB,CAApB,CAAhB,CACH,CAED,MAAO,UAAS,MAAhB,CACH,CA7CE,CA+CH,kBAAmB,SAAU,MAAV,CAAkB,IAAlB,CAAyB,CACxC,GAAI,SAAU,OAAO,WAAP,EAAsB,OAAO,iBAA3C,CACI,EADJ,C;AAIA,GAAK,OAAL,CAAe,CACX,GAAK,GAAI,QAAJ,EAAL,CACA,GAAG,MAAH,CAAW,MAAX,EACA,MAAO,IAAG,OAAH,CAAY,IAAZ,CAAP,CACH,CAED,MAAO,IAAI,KAAJ,CAAS,CAAE,MAAF,CAAT,CAAqB,KAAO,CAAE,KAAM,IAAR,CAAP,CAAwB,EAA7C,CAAP,CACH,CA3DE,C;;AA+DH,gBAAiB,SAAU,MAAV,CAAkB,IAAlB,CAAwB,OAAxB,CAAkC,CAC/C,MAAO,QAAO,SAAP,CAAkB,IAAlB,CAAwB,QAAU,GAAlC,CAAP,CACH,CAjEE,C;AAoEH,UAAW,SAAU,IAAV,CAAgB,QAAhB,CAA2B,CAClC,SAAU,KAAV,CAAiB,EAAjB,EACH,CAtEE,C;AAyEH,gBAAiB,SAAU,IAAV,CAAiB,CAC9B,MAAO,KAAP,CACH,CA3EE,CAAP,CA6EH,CAnGD,E;;;;;OA0GA,OAAO,yBAAP,CAAiC,CAC7B,oBAD6B,CAAjC,CAEG,SAAU,IAAV,CAAiB,CAEhB,GAAI,IAAJ,CAEA,IAAM,CACF,QAAS,CACL,OAAQ,EADH,CADP,CAKF,gBAAiB,MALf,CAOF,MAAO,SAAU,IAAV,CAAgB,EAAhB,CAAqB,CACxB,GAAI,IAAK,IAAT,CACI,GAAK,GAAI,WAAJ,EADT,CAGA,GAAG,MAAH,CAAY,UAAW,CACnB,GAAI,KAAJ,CAAW,GAAG,MAAH,CAAW,KAAK,MAAhB,CAAX,EACA,GAAK,GAAG,MAAH,CAAY,GAAG,OAAH,CAAa,IAA9B,CACH,CAHD,CAKA,GAAG,OAAH,CAAa,SAAU,CAAV,CAAc,CACvB,GAAI,EAAE,OAAN,EACA,GAAK,GAAG,MAAH,CAAY,GAAG,OAAH,CAAa,IAA9B,CACH,CAHD,CAKA,KAAO,KAAK,KAAL,CAAY,CAAZ,CAAe,GAAG,eAAlB,CAAP,CACA,GAAG,iBAAH,CAAsB,KAAK,SAAL,EAAtB,EACH,CAvBC,CAyBF,OAAQ,SAAU,MAAV,CAAkB,OAAlB,CAA4B,CAChC,GAAK,OAAO,UAAP,CAAoB,CAAzB,CAA6B,CACzB,OACH,CAED,GAAI,UAAW,GAAI,SAAJ,CAAc,MAAd,CAAf,CACI,OAAS,CADb,CAEI,UAAY,SAAS,UAAT,CAAsB,CAFtC,CAGI,WAAa,MAHjB,CAII,IAAM,EAJV,CAKI,WALJ,CAKiB,YALjB,CAK+B,OAL/B,CAKwC,CALxC,CAOA,GAAK,SAAS,SAAT,CAAoB,CAApB,IAA4B,MAAjC,CAA0C,CAEtC,MAAQ,OAAS,SAAjB,CAA6B,CACzB,YAAc,SAAS,SAAT,CAAoB,MAApB,CAAd,CAEA,GAAK,aAAe,MAAf,EAAyB,aAAe,MAAxC,EACG,cAAgB,MADxB,CACiC,CAE7B,aAAe,SAAS,SAAT,CAAoB,OAAS,CAA7B,EAAmC,CAAlD,CAEA,GAAK,OAAS,YAAT,CAAwB,SAAS,UAAtC,CAAmD,CAC/C,MACH,CAED,QAAU,IAAI,OAAJ,CAAa,WAAb,CAAV,CAEA,GAAK,CAAC,OAAD,EAAY,OAAjB,CAA2B,CACvB,IAAM,EAAI,CAAV,CAAa,EAAI,QAAQ,MAAzB,CAAiC,GAAK,CAAtC,CAA0C,CACtC,QAAS,CAAT,EAAa,IAAb,CAAmB,GAAnB,CAAwB,QAAxB,CAAkC,MAAlC,CACQ,YADR,CACsB,GADtB,EAEH,CACJ,CAED,QAAU,YAAV,CACA,WAAa,MAAb,CACH,CApBD,IAoBO,CACH,MACH,CACJ,CAED,GAAK,WAAa,CAAlB,CAAsB,CAClB,GAAK,OAAO,KAAZ,CAAoB,CAChB,IAAI,SAAJ,CAAgB,OAAO,KAAP,CAAc,CAAd,CAAiB,UAAjB,CAAhB,CACH,CAFD,IAEO,C;;AAGH,IAAI,SAAJ,CAAgB,GAAI,WAAJ,CAAgB,MAAhB,EACP,QADO,CACG,CADH,CACM,UADN,CAAhB,CAEH,CACJ,CACJ,CAED,MAAO,IAAP,CACH,CAhFC,CAkFF,gBAAiB,SAAU,MAAV,CAAkB,IAAlB,CAAyB,CACtC,GAAI,MAAO,KAAK,MAAL,CAAa,MAAb,CAAqB,IAArB,CAAX,CACI,IADJ,CACU,IADV,CACgB,UADhB,CAIA,WAAa,CAAb,CACA,GAAK,KAAK,SAAV,CAAsB,CAClB,WAAa,EAAI,KAAK,SAAL,CAAe,UAAhC,CACH,CAED,GAAK,OAAO,KAAZ,CAAoB,CAChB,KAAO,OAAO,KAAP,CAAc,UAAd,CAAP,CACH,CAFD,IAEO,CACH,KAAO,GAAI,WAAJ,CAAgB,MAAhB,EAAyB,QAAzB,CAAmC,UAAnC,CAAP,CACH,CAED,KAAO,GAAI,WAAJ,CAAgB,KAAK,UAAL,CAAkB,CAAlB,CAAsB,KAAK,UAA3C,CAAP,CAEA,KAAM,CAAN,EAAY,IAAZ,CACA,KAAM,CAAN,EAAY,IAAZ,CACA,KAAK,GAAL,CAAU,GAAI,WAAJ,CAAgB,IAAhB,CAAV,CAAkC,CAAlC,EACA,KAAK,GAAL,CAAU,GAAI,WAAJ,CAAgB,IAAhB,CAAV,CAAkC,KAAK,UAAL,CAAkB,CAApD,EAEA,MAAO,MAAK,MAAZ,CACH,CA1GC,CAAN,CA6GA,KAAK,SAAL,CAAiB,UAAW,CACxB,MAAO,KAAI,KAAJ,CAAU,KAAV,CAAiB,GAAjB,CAAsB,SAAtB,CAAP,CACH,CAFD,CAIA,KAAK,eAAL,CAAuB,UAAW,CAC9B,MAAO,KAAI,eAAJ,CAAoB,KAApB,CAA2B,GAA3B,CAAgC,SAAhC,CAAP,CACH,CAFD,CAIA,MAAO,IAAP,CACH,CA5HD,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwKA,OAAO,8BAAP,CAAsC,CAClC,MADkC,CAElC,yBAFkC,CAAtC,CAGG,SAAU,IAAV,CAAgB,SAAhB,CAA4B,CAE3B,GAAI,MAAO,EAAX,CAEA,KAAK,OAAL,CAAe,UAAW,CACtB,MAAO,KAAP,CACH,CAFD,CAIA,KAAK,OAAL,CAAa,SAAb,CAAuB,GAAvB,CAA6B,CACzB,cAAe,MADU,CAA7B,CAIA,KAAK,OAAL,CAAa,SAAb,CAAuB,GAAvB,CAA6B,SAAU,EAAV,CAAe,CACxC,MAAO,MAAM,EAAN,GAAc,KAAM,KAAK,GAAL,CAAU,EAAV,CAAN,CAArB,CACH,CAFD,CAIA,KAAK,YAAL,CAAoB,C;AAEhB,EAAG,CACC,SAAU,SAAU,QAAV,CAAoB,UAApB,CAAiC,CACvC,MAAO,UAAS,QAAT,CAAmB,UAAnB,CAAP,CACH,CAHF,CAIC,KAAM,CAJP,CAFa,C;AAUhB,EAAG,CACC,SAAU,SAAU,QAAV,CAAoB,UAApB,CAAiC,CACvC,MAAO,QAAO,YAAP,CAAqB,SAAS,QAAT,CAAmB,UAAnB,CAArB,CAAP,CACH,CAHF,CAIC,KAAM,CAJP,CAKC,MAAO,IALR,CAVa,C;AAmBhB,EAAG,CACC,SAAU,SAAU,QAAV,CAAoB,UAApB,CAAgC,YAAhC,CAA+C,CACrD,MAAO,UAAS,SAAT,CAAoB,UAApB,CAAgC,YAAhC,CAAP,CACH,CAHF,CAIC,KAAM,CAJP,CAnBa,C;AA2BhB,EAAG,CACC,SAAU,SAAU,QAAV,CAAoB,UAApB,CAAgC,YAAhC,CAA+C,CACrD,MAAO,UAAS,SAAT,CAAoB,UAApB,CAAgC,YAAhC,CAAP,CACH,CAHF,CAIC,KAAM,CAJP,CA3Ba,C;;AAoChB,EAAG,CACC,SAAU,SAAU,QAAV,CAAoB,UAApB,CAAgC,YAAhC,CAA+C,CACrD,MAAO,UAAS,SAAT,CAAoB,UAApB,CAAgC,YAAhC,EACH,SAAS,SAAT,CAAoB,WAAa,CAAjC,CAAoC,YAApC,CADJ,CAEH,CAJF,CAKC,KAAM,CALP,CApCa,C;AA6ChB,EAAG,CACC,SAAU,SAAU,QAAV,CAAoB,UAApB,CAAgC,YAAhC,CAA+C,CACrD,MAAO,UAAS,QAAT,CAAmB,UAAnB,CAA+B,YAA/B,CAAP,CACH,CAHF,CAIC,KAAM,CAJP,CA7Ca,C;AAqDhB,GAAI,CACA,SAAU,SAAU,QAAV,CAAoB,UAApB,CAAgC,YAAhC,CAA+C,CACrD,MAAO,UAAS,QAAT,CAAmB,UAAnB,CAA+B,YAA/B,EACH,SAAS,QAAT,CAAmB,WAAa,CAAhC,CAAmC,YAAnC,CADJ,CAEH,CAJD,CAKA,KAAM,CALN,CArDY,CAApB,C;AA+DA,KAAK,YAAL,CAAmB,CAAnB,EAAyB,KAAK,YAAL,CAAmB,CAAnB,CAAzB,CAEA,KAAK,YAAL,CAAoB,SAAU,QAAV,CAAoB,UAApB,CAAgC,MAAhC,CAAwC,IAAxC,CAA8C,MAA9C,CACZ,YADY,CACG,CAEnB,GAAI,SAAU,KAAK,YAAL,CAAmB,IAAnB,CAAd,CACI,OADJ,CACa,UADb,CACyB,MADzB,CACiC,CADjC,CACoC,GADpC,CACyC,CADzC,CAGA,GAAK,CAAC,OAAN,CAAgB,CACZ,KAAK,GAAL,CAAS,sCAAT,EACA,OACH,CAED,QAAU,QAAQ,IAAR,CAAe,MAAzB,C;;AAIA,WAAa,QAAU,CAAV,CAAc,WAAa,SAAS,SAAT,CAAoB,OAAS,CAA7B,CAChC,YADgC,CAA3B,CACa,OAAS,CADnC,CAGA,GAAK,WAAa,OAAb,CAAuB,SAAS,UAArC,CAAkD,CAC9C,KAAK,GAAL,CAAS,yCAAT,EACA,OACH,CAED,GAAK,SAAW,CAAhB,CAAoB,CAChB,MAAO,SAAQ,QAAR,CAAkB,QAAlB,CAA4B,UAA5B,CAAwC,YAAxC,CAAP,CACH,CAED,OAAS,EAAT,CAEA,IAAM,EAAI,CAAV,CAAa,EAAI,MAAjB,CAAyB,GAAK,CAA9B,CAAkC,CAC9B,OAAQ,CAAR,EAAc,QAAQ,QAAR,CAAkB,QAAlB,CACN,WAAa,EAAI,QAAQ,IADnB,CACyB,YADzB,CAAd,CAEH,CAED,GAAK,QAAQ,KAAb,CAAqB,CACjB,IAAM,EAAN,C;AAGA,IAAM,EAAI,CAAV,CAAa,EAAI,OAAO,MAAxB,CAAgC,GAAK,CAArC,CAAyC,CACrC,EAAI,OAAQ,CAAR,CAAJ,C;AAGA,GAAK,IAAM,QAAX,CAAsB,CAClB,MACH,CACD,KAAO,CAAP,CACH,CAED,MAAO,IAAP,CACH,CACD,MAAO,OAAP,CACH,CAnDD,CAqDA,KAAK,YAAL,CAAoB,SAAU,QAAV,CAAoB,UAApB,CAAgC,MAAhC,CAAwC,YAAxC,CACZ,IADY,CACL,CAEX,GAAI,KAAM,SAAS,SAAT,CAAoB,MAApB,CAA4B,YAA5B,CAAV,CACA,KAAK,IAAL,CAAW,GAAX,EAAmB,KAAK,YAAL,CAAmB,QAAnB,CAA6B,UAA7B,CAAyC,MAAzC,CACX,SAAS,SAAT,CAAoB,OAAS,CAA7B,CAAgC,YAAhC,CADW,C;AAEX,SAAS,SAAT,CAAoB,OAAS,CAA7B,CAAgC,YAAhC,CAFW,C;AAGX,YAHW,CAAnB,CAIH,CARD,CAUA,KAAK,aAAL,CAAqB,SAAU,QAAV,CAAoB,UAApB,CAAgC,SAAhC,CACb,YADa,CACC,IADD,CACQ,CAEzB,GAAI,WAAJ,CAAgB,YAAhB,CAA8B,CAA9B,CAEA,GAAK,UAAY,CAAZ,CAAgB,SAAS,UAA9B,CAA2C,CACvC,KAAK,GAAL,CAAS,8CAAT,EACA,OACH,CAED,WAAa,SAAS,SAAT,CAAoB,SAApB,CAA+B,YAA/B,CAAb,CACA,aAAe,UAAY,CAAZ,CAAgB,GAAK,UAApC,CAEA,GAAK,aAAe,CAAf,CAAmB,SAAS,UAAjC,CAA8C,CAC1C,KAAK,GAAL,CAAS,4CAAT,EACA,OACH,CAED,IAAM,EAAI,CAAV,CAAa,EAAI,UAAjB,CAA6B,GAAK,CAAlC,CAAsC,CAClC,KAAK,YAAL,CAAmB,QAAnB,CAA6B,UAA7B,CACQ,UAAY,CAAZ,CAAgB,GAAK,CAD7B,C;AAEQ,YAFR,CAEsB,IAFtB,EAGH,C;AAGD,MAAO,UAAS,SAAT,CAAoB,YAApB,CAAkC,YAAlC,CAAP,CACH,CA1BD,C;;;;;;;;;;;;;;;AA4CA,KAAK,aAAL,CAAqB,SAAU,QAAV,CAAoB,MAApB,CAA4B,MAA5B,CAAoC,IAApC,CAA2C,CAE5D,GAAI,YAAa,OAAS,EAA1B,CACI,YADJ,CACkB,SADlB,C;AAIA,GAAK,SAAS,SAAT,CAAoB,OAAS,CAA7B,IAAqC,UAA1C,CAAuD,C;AAEnD,OACH,CACD,GAAK,WAAa,CAAb,CAAiB,SAAS,UAA/B,CAA4C,CACxC,KAAK,GAAL,CAAS,0CAAT,EACA,OACH,C;AAGD,GAAK,SAAS,SAAT,CAAoB,OAAS,CAA7B,IAAqC,MAA1C,CAAmD,CAC/C,KAAK,GAAL,CAAS,mDAAT,EACA,OACH,C;AAGD,OAAS,SAAS,SAAT,CAAoB,UAApB,CAAT,EACI,IAAK,OAAL,CACI,aAAe,IAAf,CACA,MAEJ,IAAK,OAAL,CACI,aAAe,KAAf,CACA,MAEJ,QACI,KAAK,GAAL,CAAS,mDAAT,EACA,OAXR,C;AAeA,GAAK,SAAS,SAAT,CAAoB,WAAa,CAAjC,CAAoC,YAApC,IAAuD,MAA5D,CAAqE,CACjE,KAAK,GAAL,CAAS,yCAAT,EACA,OACH,C;AAGD,UAAY,SAAS,SAAT,CAAoB,WAAa,CAAjC,CAAoC,YAApC,CAAZ,C;AAEA,KAAK,IAAL,CAAY,GAAI,MAAK,OAAT,EAAZ,C;;AAGA,UAAY,KAAK,aAAL,CAAoB,QAApB,CAA8B,UAA9B,CACJ,WAAa,SADT,CACoB,YADpB,CACkC,IADlC,CAAZ,C;;;;;;;;;;;;;;;;;;;AAuBH,CAvED,CAyEA,UAAU,OAAV,CAAmB,MAAnB,EAA4B,IAA5B,CAAkC,KAAK,aAAvC,EACA,MAAO,KAAP,CACH,CA1QD,E;;OA8QA,OAAO,qBAAP,CAA6B,CACzB,MADyB,CAEzB,uBAFyB,CAGzB,oBAHyB,CAA7B,CAIG,SAAU,IAAV,CAAgB,YAAhB,CAA8B,IAA9B,CAAqC,CAEpC,GAAI,OAAQ,8DAAZ,CAEA,MAAO,cAAa,QAAb,CAAuB,OAAvB,CAAgC,C;AAGnC,SAAU,KAHyB,CAKnC,KAAM,UAAW,CACb,GAAI,IAAK,IAAT,CACI,IAAM,GAAI,MAAJ,EADV,CAGA,IAAI,MAAJ,CAAa,UAAW,CAEpB,GAAG,KAAH,CAAW,CACP,KAAM,GAAG,IADF,CAEP,MAAO,KAAK,KAFL,CAGP,OAAQ,KAAK,MAHN,CAAX,C;AAOA,GAAK,CAAC,GAAG,MAAJ,EAAc,eAAiB,GAAG,IAAvC,CAA8C,CAC1C,KAAK,SAAL,CAAgB,GAAG,KAAnB,CAA0B,SAAU,KAAV,CAAiB,GAAjB,CAAuB,CAC7C,GAAG,MAAH,CAAY,GAAZ,CACA,GAAG,KAAH,CAAS,OAAT,CAAiB,MAAjB,EACH,CAHD,EAIH,CALD,IAKO,CACH,GAAG,KAAH,CAAS,OAAT,CAAiB,MAAjB,EACH,CACJ,CAjBD,CAmBA,IAAI,OAAJ,CAAc,UAAW,CACrB,GAAG,KAAH,CAAS,OAAT,CAAiB,OAAjB,EACH,CAFD,CAIA,GAAG,IAAH,CAAU,GAAV,CACH,CAjCkC,CAmCnC,aAAc,SAAU,IAAV,CAAiB,CAC3B,GAAI,IAAK,IAAT,CACI,IAAM,GAAG,IADb,CAGA,GAAG,KAAH,CAAW,IAAX,CACA,GAAG,IAAH,CAAU,KAAK,IAAf,CACA,IAAI,GAAJ,CAAU,KAAK,eAAL,CAAsB,KAAK,SAAL,EAAtB,CAAV,CACA,GAAG,KAAH,CAAS,IAAT,CAAe,MAAf,CAAuB,UAAW,CAC9B,KAAK,eAAL,CAAsB,IAAI,GAA1B,EACH,CAFD,EAGH,CA7CkC,CA+CnC,OAAQ,SAAU,KAAV,CAAiB,MAAjB,CAA0B,CAC9B,GAAI,QAAS,KAAK,OAAL,GACJ,KAAK,OAAL,CAAe,SAAS,aAAT,CAAuB,QAAvB,CADX,CAAb,CAGA,KAAK,OAAL,CAAc,KAAK,IAAnB,CAAyB,MAAzB,CAAiC,KAAjC,CAAwC,MAAxC,EACA,KAAK,KAAL,CAAa,IAAb,C;AACA,KAAK,QAAL,CAAgB,IAAhB,CACA,KAAK,KAAL,CAAW,OAAX,CAAmB,UAAnB,EACH,CAvDkC,CAyDnC,UAAW,SAAU,IAAV,CAAiB,CACxB,GAAI,MAAO,KAAK,KAAhB,CACI,KAAO,KAAK,OADhB,CAEI,MAFJ,CAIA,KAAO,MAAQ,KAAK,IAApB,C;AAGA,GAAK,KAAK,QAAL,EAAiB,KAAK,IAAL,GAAc,IAApC,CAA2C,CACvC,OAAS,KAAK,OAAd,CAEA,GAAK,OAAS,YAAd,CAA6B,CAEzB,KAAO,KAAK,eAAL,CAAsB,MAAtB,CAA8B,YAA9B,CACC,KAAK,OADN,CAAP,CAGA,GAAK,KAAK,eAAL,EAAwB,KAAK,MAA7B,EACG,KAAK,MAAL,CAAY,SADpB,CACgC,CAE5B,KAAO,KAAK,mBAAL,CAA0B,IAA1B,CAAP,CACA,KAAO,KAAK,eAAL,CAAsB,IAAtB,CACC,KAAK,MAAL,CAAY,SADb,CAAP,CAEA,KAAO,KAAK,iBAAL,CAAwB,IAAxB,CAA8B,IAA9B,CAAP,CACA,MAAO,KAAP,CACH,CACJ,CAdD,IAcO,CACH,KAAO,KAAK,eAAL,CAAsB,MAAtB,CAA8B,IAA9B,CAAP,CACH,CAED,KAAO,KAAK,YAAL,CAAmB,IAAnB,CAAP,CACH,CAED,MAAO,KAAP,CACH,CA1FkC,CA4FnC,aAAc,SAAU,IAAV,CAAiB,CAC3B,GAAI,MAAO,KAAK,OAAhB,CAEA,KAAO,MAAQ,KAAK,IAApB,CAEA,GAAK,OAAS,YAAd,CAA6B,CACzB,MAAO,MAAK,eAAL,CAAsB,KAAK,OAA3B,CAAoC,IAApC,CAA0C,KAAK,OAA/C,CAAP,CACH,CAFD,IAEO,CACH,MAAO,MAAK,OAAL,CAAa,SAAb,CAAwB,IAAxB,CAAP,CACH,CACJ,CAtGkC,CAwGnC,eAAgB,UAAW,CACvB,MAAO,MAAK,MAAL,EAAe,KAAK,MAAL,CAAY,IAA3B,EACC,KAAK,MAAL,CAAY,IAAZ,CAAiB,GAAjB,CAAqB,aAArB,CADD,EACwC,CAD/C,CAEH,CA3GkC,CA6GnC,KAAM,SAAU,GAAV,CAAgB,C;AAGlB,GAAK,GAAL,CAAW,CACP,KAAK,KAAL,CAAa,GAAb,CACA,MAAO,KAAP,CACH,C;AAGD,MAAO,MAAK,KAAZ,CACH,CAvHkC,CAyHnC,KAAM,SAAU,GAAV,CAAgB,C;AAGlB,GAAK,GAAL,CAAW,CACP,KAAK,KAAL,CAAa,GAAb,CACA,MAAO,KAAP,CACH,C;AAGD,MAAO,MAAK,KAAZ,CACH,CAnIkC,CAqInC,QAAS,UAAW,CAChB,GAAI,QAAS,KAAK,OAAlB,CACA,KAAK,IAAL,CAAU,MAAV,CAAmB,IAAnB,CAEA,GAAK,MAAL,CAAc,CACV,OAAO,UAAP,CAAkB,IAAlB,EACS,SADT,CACoB,CADpB,CACuB,CADvB,CAC0B,OAAO,KADjC,CACwC,OAAO,MAD/C,EAEA,OAAO,KAAP,CAAe,OAAO,MAAP,CAAgB,CAA/B,CACA,KAAK,OAAL,CAAe,IAAf,CACH,C;AAGD,KAAK,IAAL,CAAU,GAAV,CAAgB,KAAhB,CACA,KAAK,IAAL,CAAY,KAAK,KAAL,CAAa,IAAzB,CACH,CAnJkC,CAqJnC,QAAS,SAAU,GAAV,CAAe,GAAf,CAAoB,KAApB,CAA2B,MAA3B,CAAoC,CACzC,GAAI,MAAO,KAAK,OAAhB,CACI,aAAe,IAAI,KADvB,CAEI,cAAgB,IAAI,MAFxB,CAGI,YAAc,KAAK,cAAL,EAHlB,CAII,KAJJ,CAIW,CAJX,CAIc,CAJd,CAIiB,CAJjB,CAIoB,CAJpB,C;AAOA,GAAK,CAAC,CAAE,CAAF,CAAK,CAAL,CAAQ,CAAR,CAAW,CAAX,EAAe,OAAf,CAAwB,WAAxB,CAAN,CAA8C,C;AAG1C,OAAS,MAAT,CACA,QAAU,KAAV,CACA,OAAS,MAAT,CACH,CAED,MAAQ,KAAM,KAAK,IAAL,CAAY,KAAZ,CAAoB,KAA1B,EAAmC,MAAQ,YAA3C,CACA,OAAS,aADT,CAAR,C;AAIA,KAAK,YAAL,GAAsB,MAAQ,KAAK,GAAL,CAAU,CAAV,CAAa,KAAb,CAA9B,EAEA,EAAI,aAAe,KAAnB,CACA,EAAI,cAAgB,KAApB,CAEA,GAAK,KAAK,IAAV,CAAiB,CACb,IAAI,KAAJ,CAAY,KAAZ,CACA,IAAI,MAAJ,CAAa,MAAb,CACH,CAHD,IAGO,CACH,IAAI,KAAJ,CAAY,CAAZ,CACA,IAAI,MAAJ,CAAa,CAAb,CACH,CAED,EAAI,CAAC,IAAI,KAAJ,CAAY,CAAb,EAAkB,CAAtB,CACA,EAAI,CAAC,IAAI,MAAJ,CAAa,CAAd,EAAmB,CAAvB,CAEA,KAAK,eAAL,EAAwB,KAAK,kBAAL,CAAyB,GAAzB,CAA8B,WAA9B,CAAxB,CAEA,KAAK,oBAAL,CAA2B,GAA3B,CAAgC,GAAhC,CAAqC,CAArC,CAAwC,CAAxC,CAA2C,CAA3C,CAA8C,CAA9C,EACH,CA5LkC,CA8LnC,mBAAoB,SAAU,MAAV,CAAkB,WAAlB,CAAgC,CAChD,GAAI,OAAQ,OAAO,KAAnB,CACI,OAAS,OAAO,MADpB,CAEI,IAAM,OAAO,UAAP,CAAkB,IAAlB,CAFV,CAIA,OAAS,WAAT,EACI,IAAK,EAAL,CACA,IAAK,EAAL,CACA,IAAK,EAAL,CACA,IAAK,EAAL,CACI,OAAO,KAAP,CAAe,MAAf,CACA,OAAO,MAAP,CAAgB,KAAhB,CACA,MAPR,CAUA,OAAS,WAAT,EACI,IAAK,EAAL,C;AACI,IAAI,SAAJ,CAAe,KAAf,CAAsB,CAAtB,EACA,IAAI,KAAJ,CAAW,CAAC,CAAZ,CAAe,CAAf,EACA,MAEJ,IAAK,EAAL,C;AACI,IAAI,SAAJ,CAAe,KAAf,CAAsB,MAAtB,EACA,IAAI,MAAJ,CAAY,KAAK,EAAjB,EACA,MAEJ,IAAK,EAAL,C;AACI,IAAI,SAAJ,CAAe,CAAf,CAAkB,MAAlB,EACA,IAAI,KAAJ,CAAW,CAAX,CAAc,CAAC,CAAf,EACA,MAEJ,IAAK,EAAL,C;AACI,IAAI,MAAJ,CAAY,IAAM,KAAK,EAAvB,EACA,IAAI,KAAJ,CAAW,CAAX,CAAc,CAAC,CAAf,EACA,MAEJ,IAAK,EAAL,C;AACI,IAAI,MAAJ,CAAY,IAAM,KAAK,EAAvB,EACA,IAAI,SAAJ,CAAe,CAAf,CAAkB,CAAC,MAAnB,EACA,MAEJ,IAAK,EAAL,C;AACI,IAAI,MAAJ,CAAY,IAAM,KAAK,EAAvB,EACA,IAAI,SAAJ,CAAe,KAAf,CAAsB,CAAC,MAAvB,EACA,IAAI,KAAJ,CAAW,CAAC,CAAZ,CAAe,CAAf,EACA,MAEJ,IAAK,EAAL,C;AACI,IAAI,MAAJ,CAAY,CAAC,GAAD,CAAO,KAAK,EAAxB,EACA,IAAI,SAAJ,CAAe,CAAC,KAAhB,CAAuB,CAAvB,EACA,MAnCR,CAqCH,CAlPkC,C;;AAsPnC,qBAAuB,UAAW,C;AAG9B,GAAK,CAAC,KAAK,EAAL,CAAQ,GAAd,CAAoB,CAChB,MAAO,UAAU,MAAV,CAAkB,GAAlB,CAAuB,CAAvB,CAA0B,CAA1B,CAA6B,CAA7B,CAAgC,CAAhC,CAAoC,CACvC,OAAO,UAAP,CAAkB,IAAlB,EAAwB,SAAxB,CAAmC,GAAnC,CAAwC,CAAxC,CAA2C,CAA3C,CAA8C,CAA9C,CAAiD,CAAjD,EACH,CAFD,CAGH,C;;;;mBAOD,QAAS,qBAAT,CAA+B,GAA/B,CAAoC,EAApC,CAAwC,EAAxC,CAA6C,CACzC,GAAI,QAAS,SAAS,aAAT,CAAuB,QAAvB,CAAb,CACI,IAAM,OAAO,UAAP,CAAkB,IAAlB,CADV,CAEI,GAAK,CAFT,CAGI,GAAK,EAHT,CAII,GAAK,EAJT,CAKI,IALJ,CAKU,KALV,CAKiB,KALjB,CAQA,OAAO,KAAP,CAAe,CAAf,CACA,OAAO,MAAP,CAAgB,EAAhB,CACA,IAAI,SAAJ,CAAe,GAAf,CAAoB,CAApB,CAAuB,CAAvB,EACA,KAAO,IAAI,YAAJ,CAAkB,CAAlB,CAAqB,CAArB,CAAwB,CAAxB,CAA2B,EAA3B,EAAgC,IAAvC,C;;AAIA,MAAQ,GAAK,EAAb,CAAkB,CACd,MAAQ,KAAM,CAAC,GAAK,CAAN,EAAW,CAAX,CAAe,CAArB,CAAR,CAEA,GAAK,QAAU,CAAf,CAAmB,CACf,GAAK,EAAL,CACH,CAFD,IAEO,CACH,GAAK,EAAL,CACH,CAED,GAAM,GAAK,EAAN,EAAa,CAAlB,CACH,CAED,MAAS,GAAK,EAAd,CACA,MAAQ,SAAU,CAAX,CAAgB,CAAhB,CAAoB,KAA3B,CACH,C;;;AAKD,GAAK,KAAK,EAAL,CAAQ,GAAR,EAAe,CAApB,CAAwB,CACpB,MAAO,UAAU,MAAV,CAAkB,GAAlB,CAAuB,CAAvB,CAA0B,CAA1B,CAA6B,CAA7B,CAAgC,CAAhC,CAAoC,CACvC,GAAI,IAAK,IAAI,YAAb,CACI,GAAK,IAAI,aADb,CAEI,gBAAkB,qBAAsB,GAAtB,CAA2B,EAA3B,CAA+B,EAA/B,CAFtB,CAIA,MAAO,QAAO,UAAP,CAAkB,IAAlB,EAAwB,SAAxB,CAAmC,GAAnC,CAAwC,CAAxC,CAA2C,CAA3C,CACH,GAAK,eADF,CACmB,GAAK,eADxB,CAEH,CAFG,CAEA,CAFA,CAEG,CAFH,CAEM,CAFN,CAAP,CAGH,CARD,CASH,C;;;;mBAOD,QAAS,kBAAT,CAA4B,GAA5B,CAAkC,CAC9B,GAAI,IAAK,IAAI,YAAb,CACI,GAAK,IAAI,aADb,CAEI,MAFJ,CAEY,GAFZ,C;AAKA,GAAK,GAAK,EAAL,CAAU,KAAO,IAAtB,CAA6B,CACzB,OAAS,SAAS,aAAT,CAAuB,QAAvB,CAAT,CACA,OAAO,KAAP,CAAe,OAAO,MAAP,CAAgB,CAA/B,CACA,IAAM,OAAO,UAAP,CAAkB,IAAlB,CAAN,CACA,IAAI,SAAJ,CAAe,GAAf,CAAoB,CAAC,EAAD,CAAM,CAA1B,CAA6B,CAA7B,E;;;;AAMA,MAAO,KAAI,YAAJ,CAAkB,CAAlB,CAAqB,CAArB,CAAwB,CAAxB,CAA2B,CAA3B,EAA+B,IAA/B,CAAqC,CAArC,IAA6C,CAApD,CACH,CAXD,IAWO,CACH,MAAO,MAAP,CACH,CACJ,CAGD,MAAO,UAAU,MAAV,CAAkB,GAAlB,CAAuB,CAAvB,CAA0B,CAA1B,CAA6B,KAA7B,CAAoC,MAApC,CAA6C,CAChD,GAAI,IAAK,IAAI,YAAb,CACI,GAAK,IAAI,aADb,CAEI,IAAM,OAAO,UAAP,CAAkB,IAAlB,CAFV,CAGI,WAAa,kBAAmB,GAAnB,CAHjB,CAII,SAAW,KAAK,IAAL,GAAc,YAJ7B,CAKI,EAAI,IALR,CAMI,GAAK,CANT,CAOI,GAAK,CAPT,CAQI,SARJ,CAQe,MARf,CAQuB,eARvB,CAQwC,EARxC,CAQ4C,EAR5C,CAQgD,EARhD,CAQoD,EARpD,CAUA,GAAK,UAAL,CAAkB,CACd,IAAM,CAAN,CACA,IAAM,CAAN,CACH,CAED,IAAI,IAAJ,GACA,UAAY,SAAS,aAAT,CAAuB,QAAvB,CAAZ,CACA,UAAU,KAAV,CAAkB,UAAU,MAAV,CAAmB,CAArC,CAEA,OAAS,UAAU,UAAV,CAAqB,IAArB,CAAT,CACA,gBAAkB,SACV,qBAAsB,GAAtB,CAA2B,EAA3B,CAA+B,EAA/B,CADU,CAC4B,CAD9C,CAGA,GAAK,KAAK,IAAL,CAAW,EAAI,KAAJ,CAAY,EAAvB,CAAL,CACA,GAAK,KAAK,IAAL,CAAW,EAAI,MAAJ,CAAa,EAAb,CAAkB,eAA7B,CAAL,CAEA,MAAQ,GAAK,EAAb,CAAkB,CACd,GAAK,CAAL,CACA,GAAK,CAAL,CACA,MAAQ,GAAK,EAAb,CAAkB,CACd,OAAO,SAAP,CAAkB,CAAlB,CAAqB,CAArB,CAAwB,CAAxB,CAA2B,CAA3B,EACA,OAAO,SAAP,CAAkB,GAAlB,CAAuB,CAAC,EAAxB,CAA4B,CAAC,EAA7B,EACA,IAAI,SAAJ,CAAe,SAAf,CAA0B,CAA1B,CAA6B,CAA7B,CAAgC,CAAhC,CAAmC,CAAnC,CACQ,EAAI,EADZ,CACgB,EAAI,EADpB,CACwB,EADxB,CAC4B,EAD5B,EAEA,IAAM,CAAN,CACA,IAAM,EAAN,CACH,CACD,IAAM,CAAN,CACA,IAAM,EAAN,CACH,CACD,IAAI,OAAJ,GACA,UAAY,OAAS,IAArB,CACH,CA3CD,CA4CH,CArIqB,EAtPa,CAAhC,CAAP,CA6XH,CArYD,E;;;;;OA4YA,OAAO,yBAAP,CAAiC,CAC7B,MAD6B,CAE7B,uBAF6B,CAAjC,CAGG,SAAU,IAAV,CAAgB,YAAhB,CAA+B,CAE9B,GAAI,MAAO,KAAK,IAAhB,CACI,EAAI,KAAK,CADb,CAGA,MAAO,cAAa,QAAb,CAAuB,WAAvB,CAAoC,CACvC,KAAM,UAAW,CACb,KAAK,OAAL,CAAe,CAAf,CACA,KAAK,SAAL,CAAiB,IAAjB,CACH,CAJsC,CAMvC,KAAM,UAAW,CACb,GAAI,OAAQ,KAAK,KAAjB,CACI,KAAO,KAAK,OADhB,CAEI,IAAM,KAAK,SAAL,EAFV,CAGI,KAAO,MAAM,KAHjB,CAII,OAAS,KAAK,MAJlB,CAKI,QALJ,CAKc,MALd,CAKsB,EALtB,CAOA,GAAK,KAAK,YAAV,CAAyB,CACrB,QAAU,CAAC,KAAK,IAAL,CAAW,MAAX,EAAsB,GAAtB,CAA4B,GAA7B,EACF,EAAE,KAAF,CAAS,MAAM,SAAf,CADR,CAGA,OAAS,KAAK,SAAL,EAAT,CACH,CALD,IAKO,CACH,SAAW,GAAI,SAAJ,EAAX,CACA,EAAE,IAAF,CAAQ,MAAM,SAAd,CAAyB,SAAU,CAAV,CAAa,CAAb,CAAiB,CACtC,SAAS,MAAT,CAAiB,CAAjB,CAAoB,CAApB,EACH,CAFD,EAIA,SAAS,MAAT,CAAiB,KAAK,OAAtB,CAA+B,KAAK,SAAL,EAA/B,CACQ,KAAK,QAAL,EAAiB,MAAM,SAAN,CAAgB,IAAjC,EAAyC,EADjD,EAEH,CAED,GAAK,KAAK,eAAL,EAAwB,mBAAqB,IAAlD,CAAwD,CACpD,IAAI,IAAJ,CAAU,KAAK,MAAf,CAAuB,MAAvB,CAA+B,IAA/B,EACA,IAAI,eAAJ,CAAsB,IAAtB,CACH,CAHD,IAGO,CACH,IAAI,IAAJ,CAAU,KAAK,MAAf,CAAuB,MAAvB,EACH,CAED,KAAK,iBAAL,CAAwB,GAAxB,CAA6B,KAAK,OAAlC,EAEA,GAAK,MAAL,CAAc,CACV,IAAI,gBAAJ,CAAqB,0BAArB,E;;;;AAMA,GAAK,KAAK,EAAL,CAAQ,OAAb,CAAuB,CACnB,GAAK,GAAI,WAAJ,EAAL,CAEA,GAAG,MAAH,CAAY,UAAW,CACnB,IAAI,IAAJ,CAAU,KAAK,MAAf,EACA,GAAK,GAAG,MAAH,CAAY,IAAjB,CACH,CAHD,CAKA,GAAG,iBAAH,CAAsB,MAAtB,EACH,CATD,IASO,CACH,IAAI,IAAJ,CAAU,MAAV,EACH,CACJ,CAnBD,IAmBO,CACH,IAAI,IAAJ,CAAU,QAAV,EACH,CACJ,CA5DsC,CA8DvC,YAAa,UAAW,CACpB,MAAO,MAAK,SAAZ,CACH,CAhEsC,CAkEvC,kBAAmB,UAAW,CAC1B,MAAO,MAAK,UAAL,CAAiB,KAAK,SAAtB,CAAP,CACH,CApEsC,CAsEvC,UAAW,UAAW,CAClB,MAAO,MAAK,OAAZ,CACH,CAxEsC,CA0EvC,MAAO,UAAW,CACd,GAAI,KAAM,KAAK,IAAf,CAEA,GAAK,GAAL,CAAW,CACP,IAAI,MAAJ,CAAW,UAAX,CAAwB,IAAxB,CACA,IAAI,kBAAJ,CAAyB,IAAzB,CACA,IAAI,KAAJ,GAEA,KAAK,IAAL,CAAY,IAAM,IAAlB,CACH,CACJ,CApFsC,CAsFvC,QAAS,UAAW,CAChB,KAAK,KAAL,GACH,CAxFsC,CA0FvC,UAAW,UAAW,CAClB,GAAI,IAAK,IAAT,CACI,IAAM,GAAI,eAAJ,EADV,CAEI,KAAO,KAAK,OAFhB,CAIA,GAAK,KAAK,eAAL,EAAwB,EAAE,mBAAqB,IAAvB,CAAxB,EACG,MAAO,eAAP,GAA0B,WADlC,CACgD,CAC5C,IAAM,GAAI,eAAJ,EAAN,CACH,CAED,IAAI,MAAJ,CAAW,UAAX,CAAwB,SAAU,CAAV,CAAc,CAClC,GAAI,YAAa,CAAjB,CAEA,GAAK,EAAE,gBAAP,CAA0B,CACtB,WAAa,EAAE,MAAF,CAAW,EAAE,KAA1B,CACH,CAED,MAAO,IAAG,OAAH,CAAY,UAAZ,CAAwB,UAAxB,CAAP,CACH,CARD,CAUA,IAAI,kBAAJ,CAAyB,UAAW,CAEhC,GAAK,IAAI,UAAJ,GAAmB,CAAxB,CAA4B,CACxB,OACH,CAED,IAAI,MAAJ,CAAW,UAAX,CAAwB,IAAxB,CACA,IAAI,kBAAJ,CAAyB,IAAzB,CACA,GAAG,IAAH,CAAU,IAAV,CACA,GAAG,OAAH,CAAa,IAAI,MAAjB,CAEA,GAAK,IAAI,MAAJ,EAAc,GAAd,EAAqB,IAAI,MAAJ,CAAa,GAAvC,CAA6C,CACzC,GAAG,SAAH,CAAe,IAAI,YAAnB,CACA,MAAO,IAAG,OAAH,CAAW,MAAX,CAAP,CACH,CAHD,IAGO,IAAK,IAAI,MAAJ,EAAc,GAAd,EAAqB,IAAI,MAAJ,CAAa,GAAvC,CAA6C,CAChD,GAAG,SAAH,CAAe,IAAI,YAAnB,CACA,MAAO,IAAG,OAAH,CAAY,OAAZ,CAAqB,QAArB,CAAP,CACH,CAGD,MAAO,IAAG,OAAH,CAAY,OAAZ,CAAqB,GAAG,OAAH,CAAa,MAAb,CAAsB,OAA3C,CAAP,CACH,CArBD,CAuBA,GAAG,IAAH,CAAU,GAAV,CACA,MAAO,IAAP,CACH,CAvIsC,CAyIvC,kBAAmB,SAAU,GAAV,CAAe,OAAf,CAAyB,CACxC,EAAE,IAAF,CAAQ,OAAR,CAAiB,SAAU,GAAV,CAAe,GAAf,CAAqB,CAClC,IAAI,gBAAJ,CAAsB,GAAtB,CAA2B,GAA3B,EACH,CAFD,EAGH,CA7IsC,CA+IvC,WAAY,SAAU,GAAV,CAAgB,CACxB,GAAI,KAAJ,CAEA,GAAI,CACA,KAAO,KAAK,KAAL,CAAY,GAAZ,CAAP,CACH,CAAC,MAAQ,EAAR,CAAa,CACX,KAAO,EAAP,CACH,CAED,MAAO,KAAP,CACH,CAzJsC,CAApC,CAAP,CA2JH,CAnKD,E;;OAuKA,OAAO,kBAAP,CAA0B,CACtB,MADsB,C;AAItB,iBAJsB,CAKtB,mBALsB,CAMtB,oBANsB,CAOtB,eAPsB,CAQtB,eARsB,CAStB,iBATsB,CAUtB,gBAVsB,CAWtB,mBAXsB,C;;AAetB,oBAfsB,CAgBtB,mBAhBsB,CAiBtB,yBAjBsB,CAkBtB,0BAlBsB,CAmBtB,8BAnBsB,CAoBtB,qBApBsB,CAqBtB,yBArBsB,CAA1B,CAsBG,SAAU,IAAV,CAAiB,CAChB,MAAO,KAAP,CACH,CAxBD,EAyBA,OAAO,aAAP,CAAqB,CACjB,kBADiB,CAArB,CAEG,SAAU,MAAV,CAAmB,CAClB,MAAO,OAAP,CACH,CAJD,EAKA,MAAO,SAAQ,aAAR,CAAP,CACH,CA96KD","file":"webuploader.html5only-compiled.js","sourcesContent":["/*! WebUploader 0.1.2 */\n\n\n/**\n * @fileOverview 让内部各个部件的代码可以用[amd](https://github.com/amdjs/amdjs-api/wiki/AMD)模块定义方式组织起来。\n *\n * AMD API 内部的简单不完全实现，请忽略。只有当WebUploader被合并成一个文件的时候才会引入。\n */\n(function( root, factory ) {\n    var modules = {},\n\n        // 内部require, 简单不完全实现。\n        // https://github.com/amdjs/amdjs-api/wiki/require\n        _require = function( deps, callback ) {\n            var args, len, i;\n\n            // 如果deps不是数组，则直接返回指定module\n            if ( typeof deps === 'string' ) {\n                return getModule( deps );\n            } else {\n                args = [];\n                for( len = deps.length, i = 0; i < len; i++ ) {\n                    args.push( getModule( deps[ i ] ) );\n                }\n\n                return callback.apply( null, args );\n            }\n        },\n\n        // 内部define，暂时不支持不指定id.\n        _define = function( id, deps, factory ) {\n            if ( arguments.length === 2 ) {\n                factory = deps;\n                deps = null;\n            }\n\n            _require( deps || [], function() {\n                setModule( id, factory, arguments );\n            });\n        },\n\n        // 设置module, 兼容CommonJs写法。\n        setModule = function( id, factory, args ) {\n            var module = {\n                    exports: factory\n                },\n                returned;\n\n            if ( typeof factory === 'function' ) {\n                args.length || (args = [ _require, module.exports, module ]);\n                returned = factory.apply( null, args );\n                returned !== undefined && (module.exports = returned);\n            }\n\n            modules[ id ] = module.exports;\n        },\n\n        // 根据id获取module\n        getModule = function( id ) {\n            var module = modules[ id ] || root[ id ];\n\n            if ( !module ) {\n                throw new Error( '`' + id + '` is undefined' );\n            }\n\n            return module;\n        },\n\n        // 将所有modules，将路径ids装换成对象。\n        exportsTo = function( obj ) {\n            var key, host, parts, part, last, ucFirst;\n\n            // make the first character upper case.\n            ucFirst = function( str ) {\n                return str && (str.charAt( 0 ).toUpperCase() + str.substr( 1 ));\n            };\n\n            for ( key in modules ) {\n                host = obj;\n\n                if ( !modules.hasOwnProperty( key ) ) {\n                    continue;\n                }\n\n                parts = key.split('/');\n                last = ucFirst( parts.pop() );\n\n                while( (part = ucFirst( parts.shift() )) ) {\n                    host[ part ] = host[ part ] || {};\n                    host = host[ part ];\n                }\n\n                host[ last ] = modules[ key ];\n            }\n        },\n\n        exports = factory( root, _define, _require ),\n        origin;\n\n    // exports every module.\n    exportsTo( exports );\n\n    if ( typeof module === 'object' && typeof module.exports === 'object' ) {\n\n        // For CommonJS and CommonJS-like environments where a proper window is present,\n        module.exports = exports;\n    } else if ( typeof define === 'function' && define.amd ) {\n\n        // Allow using this built library as an AMD module\n        // in another project. That other project will only\n        // see this AMD call, not the internal modules in\n        // the closure below.\n        define([], exports );\n    } else {\n\n        // Browser globals case. Just assign the\n        // result to a property on the global.\n        origin = root.WebUploader;\n        root.WebUploader = exports;\n        root.WebUploader.noConflict = function() {\n            root.WebUploader = origin;\n        };\n    }\n})( this, function( window, define, require ) {\n\n\n    /**\n     * @fileOverview jQuery or Zepto\n     */\n    define('dollar-third',[],function() {\n        return window.jQuery || window.Zepto;\n    });\n    /**\n     * @fileOverview Dom 操作相关\n     */\n    define('dollar',[\n        'dollar-third'\n    ], function( _ ) {\n        return _;\n    });\n    /**\n     * @fileOverview 使用jQuery的Promise\n     */\n    define('promise-third',[\n        'dollar'\n    ], function( $ ) {\n        return {\n            Deferred: $.Deferred,\n            when: $.when,\n    \n            isPromise: function( anything ) {\n                return anything && typeof anything.then === 'function';\n            }\n        };\n    });\n    /**\n     * @fileOverview Promise/A+\n     */\n    define('promise',[\n        'promise-third'\n    ], function( _ ) {\n        return _;\n    });\n    /**\n     * @fileOverview 基础类方法。\n     */\n    \n    /**\n     * Web Uploader内部类的详细说明，以下提及的功能类，都可以在`WebUploader`这个变量中访问到。\n     *\n     * As you know, Web Uploader的每个文件都是用过[AMD](https://github.com/amdjs/amdjs-api/wiki/AMD)规范中的`define`组织起来的, 每个Module都会有个module id.\n     * 默认module id该文件的路径，而此路径将会转化成名字空间存放在WebUploader中。如：\n     *\n     * * module `base`：WebUploader.Base\n     * * module `file`: WebUploader.File\n     * * module `lib/dnd`: WebUploader.Lib.Dnd\n     * * module `runtime/html5/dnd`: WebUploader.Runtime.Html5.Dnd\n     *\n     *\n     * 以下文档将可能省略`WebUploader`前缀。\n     * @module WebUploader\n     * @title WebUploader API文档\n     */\n    define('base',[\n        'dollar',\n        'promise'\n    ], function( $, promise ) {\n    \n        var noop = function() {},\n            call = Function.call;\n    \n        // http://jsperf.com/uncurrythis\n        // 反科里化\n        function uncurryThis( fn ) {\n            return function() {\n                return call.apply( fn, arguments );\n            };\n        }\n    \n        function bindFn( fn, context ) {\n            return function() {\n                return fn.apply( context, arguments );\n            };\n        }\n    \n        function createObject( proto ) {\n            var f;\n    \n            if ( Object.create ) {\n                return Object.create( proto );\n            } else {\n                f = function() {};\n                f.prototype = proto;\n                return new f();\n            }\n        }\n    \n    \n        /**\n         * 基础类，提供一些简单常用的方法。\n         * @class Base\n         */\n        return {\n    \n            /**\n             * @property {String} version 当前版本号。\n             */\n            version: '0.1.2',\n    \n            /**\n             * @property {jQuery|Zepto} $ 引用依赖的jQuery或者Zepto对象。\n             */\n            $: $,\n    \n            Deferred: promise.Deferred,\n    \n            isPromise: promise.isPromise,\n    \n            when: promise.when,\n    \n            /**\n             * @description  简单的浏览器检查结果。\n             *\n             * * `webkit`  webkit版本号，如果浏览器为非webkit内核，此属性为`undefined`。\n             * * `chrome`  chrome浏览器版本号，如果浏览器为chrome，此属性为`undefined`。\n             * * `ie`  ie浏览器版本号，如果浏览器为非ie，此属性为`undefined`。**暂不支持ie10+**\n             * * `firefox`  firefox浏览器版本号，如果浏览器为非firefox，此属性为`undefined`。\n             * * `safari`  safari浏览器版本号，如果浏览器为非safari，此属性为`undefined`。\n             * * `opera`  opera浏览器版本号，如果浏览器为非opera，此属性为`undefined`。\n             *\n             * @property {Object} [browser]\n             */\n            browser: (function( ua ) {\n                var ret = {},\n                    webkit = ua.match( /WebKit\\/([\\d.]+)/ ),\n                    chrome = ua.match( /Chrome\\/([\\d.]+)/ ) ||\n                        ua.match( /CriOS\\/([\\d.]+)/ ),\n    \n                    ie = ua.match( /MSIE\\s([\\d\\.]+)/ ) ||\n                        ua.match(/(?:trident)(?:.*rv:([\\w.]+))?/i),\n                    firefox = ua.match( /Firefox\\/([\\d.]+)/ ),\n                    safari = ua.match( /Safari\\/([\\d.]+)/ ),\n                    opera = ua.match( /OPR\\/([\\d.]+)/ );\n    \n                webkit && (ret.webkit = parseFloat( webkit[ 1 ] ));\n                chrome && (ret.chrome = parseFloat( chrome[ 1 ] ));\n                ie && (ret.ie = parseFloat( ie[ 1 ] ));\n                firefox && (ret.firefox = parseFloat( firefox[ 1 ] ));\n                safari && (ret.safari = parseFloat( safari[ 1 ] ));\n                opera && (ret.opera = parseFloat( opera[ 1 ] ));\n    \n                return ret;\n            })( navigator.userAgent ),\n    \n            /**\n             * @description  操作系统检查结果。\n             *\n             * * `android`  如果在android浏览器环境下，此值为对应的android版本号，否则为`undefined`。\n             * * `ios` 如果在ios浏览器环境下，此值为对应的ios版本号，否则为`undefined`。\n             * @property {Object} [os]\n             */\n            os: (function( ua ) {\n                var ret = {},\n    \n                    // osx = !!ua.match( /\\(Macintosh\\; Intel / ),\n                    android = ua.match( /(?:Android);?[\\s\\/]+([\\d.]+)?/ ),\n                    ios = ua.match( /(?:iPad|iPod|iPhone).*OS\\s([\\d_]+)/ );\n    \n                // osx && (ret.osx = true);\n                android && (ret.android = parseFloat( android[ 1 ] ));\n                ios && (ret.ios = parseFloat( ios[ 1 ].replace( /_/g, '.' ) ));\n    \n                return ret;\n            })( navigator.userAgent ),\n    \n            /**\n             * 实现类与类之间的继承。\n             * @method inherits\n             * @grammar Base.inherits( super ) => child\n             * @grammar Base.inherits( super, protos ) => child\n             * @grammar Base.inherits( super, protos, statics ) => child\n             * @param  {Class} super 父类\n             * @param  {Object | Function} [protos] 子类或者对象。如果对象中包含constructor，子类将是用此属性值。\n             * @param  {Function} [protos.constructor] 子类构造器，不指定的话将创建个临时的直接执行父类构造器的方法。\n             * @param  {Object} [statics] 静态属性或方法。\n             * @return {Class} 返回子类。\n             * @example\n             * function Person() {\n             *     console.log( 'Super' );\n             * }\n             * Person.prototype.hello = function() {\n             *     console.log( 'hello' );\n             * };\n             *\n             * var Manager = Base.inherits( Person, {\n             *     world: function() {\n             *         console.log( 'World' );\n             *     }\n             * });\n             *\n             * // 因为没有指定构造器，父类的构造器将会执行。\n             * var instance = new Manager();    // => Super\n             *\n             * // 继承子父类的方法\n             * instance.hello();    // => hello\n             * instance.world();    // => World\n             *\n             * // 子类的__super__属性指向父类\n             * console.log( Manager.__super__ === Person );    // => true\n             */\n            inherits: function( Super, protos, staticProtos ) {\n                var child;\n    \n                if ( typeof protos === 'function' ) {\n                    child = protos;\n                    protos = null;\n                } else if ( protos && protos.hasOwnProperty('constructor') ) {\n                    child = protos.constructor;\n                } else {\n                    child = function() {\n                        return Super.apply( this, arguments );\n                    };\n                }\n    \n                // 复制静态方法\n                $.extend( true, child, Super, staticProtos || {} );\n    \n                /* jshint camelcase: false */\n    \n                // 让子类的__super__属性指向父类。\n                child.__super__ = Super.prototype;\n    \n                // 构建原型，添加原型方法或属性。\n                // 暂时用Object.create实现。\n                child.prototype = createObject( Super.prototype );\n                protos && $.extend( true, child.prototype, protos );\n    \n                return child;\n            },\n    \n            /**\n             * 一个不做任何事情的方法。可以用来赋值给默认的callback.\n             * @method noop\n             */\n            noop: noop,\n    \n            /**\n             * 返回一个新的方法，此方法将已指定的`context`来执行。\n             * @grammar Base.bindFn( fn, context ) => Function\n             * @method bindFn\n             * @example\n             * var doSomething = function() {\n             *         console.log( this.name );\n             *     },\n             *     obj = {\n             *         name: 'Object Name'\n             *     },\n             *     aliasFn = Base.bind( doSomething, obj );\n             *\n             *  aliasFn();    // => Object Name\n             *\n             */\n            bindFn: bindFn,\n    \n            /**\n             * 引用Console.log如果存在的话，否则引用一个[空函数loop](#WebUploader:Base.log)。\n             * @grammar Base.log( args... ) => undefined\n             * @method log\n             */\n            log: (function() {\n                if ( window.console ) {\n                    return bindFn( console.log, console );\n                }\n                return noop;\n            })(),\n    \n            nextTick: (function() {\n    \n                return function( cb ) {\n                    setTimeout( cb, 1 );\n                };\n    \n                // @bug 当浏览器不在当前窗口时就停了。\n                // var next = window.requestAnimationFrame ||\n                //     window.webkitRequestAnimationFrame ||\n                //     window.mozRequestAnimationFrame ||\n                //     function( cb ) {\n                //         window.setTimeout( cb, 1000 / 60 );\n                //     };\n    \n                // // fix: Uncaught TypeError: Illegal invocation\n                // return bindFn( next, window );\n            })(),\n    \n            /**\n             * 被[uncurrythis](http://www.2ality.com/2011/11/uncurrying-this.html)的数组slice方法。\n             * 将用来将非数组对象转化成数组对象。\n             * @grammar Base.slice( target, start[, end] ) => Array\n             * @method slice\n             * @example\n             * function doSomthing() {\n             *     var args = Base.slice( arguments, 1 );\n             *     console.log( args );\n             * }\n             *\n             * doSomthing( 'ignored', 'arg2', 'arg3' );    // => Array [\"arg2\", \"arg3\"]\n             */\n            slice: uncurryThis( [].slice ),\n    \n            /**\n             * 生成唯一的ID\n             * @method guid\n             * @grammar Base.guid() => String\n             * @grammar Base.guid( prefx ) => String\n             */\n            guid: (function() {\n                var counter = 0;\n    \n                return function( prefix ) {\n                    var guid = (+new Date()).toString( 32 ),\n                        i = 0;\n    \n                    for ( ; i < 5; i++ ) {\n                        guid += Math.floor( Math.random() * 65535 ).toString( 32 );\n                    }\n    \n                    return (prefix || 'wu_') + guid + (counter++).toString( 32 );\n                };\n            })(),\n    \n            /**\n             * 格式化文件大小, 输出成带单位的字符串\n             * @method formatSize\n             * @grammar Base.formatSize( size ) => String\n             * @grammar Base.formatSize( size, pointLength ) => String\n             * @grammar Base.formatSize( size, pointLength, units ) => String\n             * @param {Number} size 文件大小\n             * @param {Number} [pointLength=2] 精确到的小数点数。\n             * @param {Array} [units=[ 'B', 'K', 'M', 'G', 'TB' ]] 单位数组。从字节，到千字节，一直往上指定。如果单位数组里面只指定了到了K(千字节)，同时文件大小大于M, 此方法的输出将还是显示成多少K.\n             * @example\n             * console.log( Base.formatSize( 100 ) );    // => 100B\n             * console.log( Base.formatSize( 1024 ) );    // => 1.00K\n             * console.log( Base.formatSize( 1024, 0 ) );    // => 1K\n             * console.log( Base.formatSize( 1024 * 1024 ) );    // => 1.00M\n             * console.log( Base.formatSize( 1024 * 1024 * 1024 ) );    // => 1.00G\n             * console.log( Base.formatSize( 1024 * 1024 * 1024, 0, ['B', 'KB', 'MB'] ) );    // => 1024MB\n             */\n            formatSize: function( size, pointLength, units ) {\n                var unit;\n    \n                units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\n    \n                while ( (unit = units.shift()) && size > 1024 ) {\n                    size = size / 1024;\n                }\n    \n                return (unit === 'B' ? size : size.toFixed( pointLength || 2 )) +\n                        unit;\n            }\n        };\n    });\n    /**\n     * 事件处理类，可以独立使用，也可以扩展给对象使用。\n     * @fileOverview Mediator\n     */\n    define('mediator',[\n        'base'\n    ], function( Base ) {\n        var $ = Base.$,\n            slice = [].slice,\n            separator = /\\s+/,\n            protos;\n    \n        // 根据条件过滤出事件handlers.\n        function findHandlers( arr, name, callback, context ) {\n            return $.grep( arr, function( handler ) {\n                return handler &&\n                        (!name || handler.e === name) &&\n                        (!callback || handler.cb === callback ||\n                        handler.cb._cb === callback) &&\n                        (!context || handler.ctx === context);\n            });\n        }\n    \n        function eachEvent( events, callback, iterator ) {\n            // 不支持对象，只支持多个event用空格隔开\n            $.each( (events || '').split( separator ), function( _, key ) {\n                iterator( key, callback );\n            });\n        }\n    \n        function triggerHanders( events, args ) {\n            var stoped = false,\n                i = -1,\n                len = events.length,\n                handler;\n    \n            while ( ++i < len ) {\n                handler = events[ i ];\n    \n                if ( handler.cb.apply( handler.ctx2, args ) === false ) {\n                    stoped = true;\n                    break;\n                }\n            }\n    \n            return !stoped;\n        }\n    \n        protos = {\n    \n            /**\n             * 绑定事件。\n             *\n             * `callback`方法在执行时，arguments将会来源于trigger的时候携带的参数。如\n             * ```javascript\n             * var obj = {};\n             *\n             * // 使得obj有事件行为\n             * Mediator.installTo( obj );\n             *\n             * obj.on( 'testa', function( arg1, arg2 ) {\n             *     console.log( arg1, arg2 ); // => 'arg1', 'arg2'\n             * });\n             *\n             * obj.trigger( 'testa', 'arg1', 'arg2' );\n             * ```\n             *\n             * 如果`callback`中，某一个方法`return false`了，则后续的其他`callback`都不会被执行到。\n             * 切会影响到`trigger`方法的返回值，为`false`。\n             *\n             * `on`还可以用来添加一个特殊事件`all`, 这样所有的事件触发都会响应到。同时此类`callback`中的arguments有一个不同处，\n             * 就是第一个参数为`type`，记录当前是什么事件在触发。此类`callback`的优先级比脚低，会再正常`callback`执行完后触发。\n             * ```javascript\n             * obj.on( 'all', function( type, arg1, arg2 ) {\n             *     console.log( type, arg1, arg2 ); // => 'testa', 'arg1', 'arg2'\n             * });\n             * ```\n             *\n             * @method on\n             * @grammar on( name, callback[, context] ) => self\n             * @param  {String}   name     事件名，支持多个事件用空格隔开\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             * @class Mediator\n             */\n            on: function( name, callback, context ) {\n                var me = this,\n                    set;\n    \n                if ( !callback ) {\n                    return this;\n                }\n    \n                set = this._events || (this._events = []);\n    \n                eachEvent( name, callback, function( name, callback ) {\n                    var handler = { e: name };\n    \n                    handler.cb = callback;\n                    handler.ctx = context;\n                    handler.ctx2 = context || me;\n                    handler.id = set.length;\n    \n                    set.push( handler );\n                });\n    \n                return this;\n            },\n    \n            /**\n             * 绑定事件，且当handler执行完后，自动解除绑定。\n             * @method once\n             * @grammar once( name, callback[, context] ) => self\n             * @param  {String}   name     事件名\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n            once: function( name, callback, context ) {\n                var me = this;\n    \n                if ( !callback ) {\n                    return me;\n                }\n    \n                eachEvent( name, callback, function( name, callback ) {\n                    var once = function() {\n                            me.off( name, once );\n                            return callback.apply( context || me, arguments );\n                        };\n    \n                    once._cb = callback;\n                    me.on( name, once, context );\n                });\n    \n                return me;\n            },\n    \n            /**\n             * 解除事件绑定\n             * @method off\n             * @grammar off( [name[, callback[, context] ] ] ) => self\n             * @param  {String}   [name]     事件名\n             * @param  {Function} [callback] 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n            off: function( name, cb, ctx ) {\n                var events = this._events;\n    \n                if ( !events ) {\n                    return this;\n                }\n    \n                if ( !name && !cb && !ctx ) {\n                    this._events = [];\n                    return this;\n                }\n    \n                eachEvent( name, cb, function( name, cb ) {\n                    $.each( findHandlers( events, name, cb, ctx ), function() {\n                        delete events[ this.id ];\n                    });\n                });\n    \n                return this;\n            },\n    \n            /**\n             * 触发事件\n             * @method trigger\n             * @grammar trigger( name[, args...] ) => self\n             * @param  {String}   type     事件名\n             * @param  {*} [...] 任意参数\n             * @return {Boolean} 如果handler中return false了，则返回false, 否则返回true\n             */\n            trigger: function( type ) {\n                var args, events, allEvents;\n    \n                if ( !this._events || !type ) {\n                    return this;\n                }\n    \n                args = slice.call( arguments, 1 );\n                events = findHandlers( this._events, type );\n                allEvents = findHandlers( this._events, 'all' );\n    \n                return triggerHanders( events, args ) &&\n                        triggerHanders( allEvents, arguments );\n            }\n        };\n    \n        /**\n         * 中介者，它本身是个单例，但可以通过[installTo](#WebUploader:Mediator:installTo)方法，使任何对象具备事件行为。\n         * 主要目的是负责模块与模块之间的合作，降低耦合度。\n         *\n         * @class Mediator\n         */\n        return $.extend({\n    \n            /**\n             * 可以通过这个接口，使任何对象具备事件功能。\n             * @method installTo\n             * @param  {Object} obj 需要具备事件行为的对象。\n             * @return {Object} 返回obj.\n             */\n            installTo: function( obj ) {\n                return $.extend( obj, protos );\n            }\n    \n        }, protos );\n    });\n    /**\n     * @fileOverview Uploader上传类\n     */\n    define('uploader',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n    \n        var $ = Base.$;\n    \n        /**\n         * 上传入口类。\n         * @class Uploader\n         * @constructor\n         * @grammar new Uploader( opts ) => Uploader\n         * @example\n         * var uploader = WebUploader.Uploader({\n         *     swf: 'path_of_swf/Uploader.swf',\n         *\n         *     // 开起分片上传。\n         *     chunked: true\n         * });\n         */\n        function Uploader( opts ) {\n            this.options = $.extend( true, {}, Uploader.options, opts );\n            this._init( this.options );\n        }\n    \n        // default Options\n        // widgets中有相应扩展\n        Uploader.options = {};\n        Mediator.installTo( Uploader.prototype );\n    \n        // 批量添加纯命令式方法。\n        $.each({\n            upload: 'start-upload',\n            stop: 'stop-upload',\n            getFile: 'get-file',\n            getFiles: 'get-files',\n            addFile: 'add-file',\n            addFiles: 'add-file',\n            sort: 'sort-files',\n            removeFile: 'remove-file',\n            skipFile: 'skip-file',\n            retry: 'retry',\n            isInProgress: 'is-in-progress',\n            makeThumb: 'make-thumb',\n            getDimension: 'get-dimension',\n            addButton: 'add-btn',\n            getRuntimeType: 'get-runtime-type',\n            refresh: 'refresh',\n            disable: 'disable',\n            enable: 'enable',\n            reset: 'reset'\n        }, function( fn, command ) {\n            Uploader.prototype[ fn ] = function() {\n                return this.request( command, arguments );\n            };\n        });\n    \n        $.extend( Uploader.prototype, {\n            state: 'pending',\n    \n            _init: function( opts ) {\n                var me = this;\n    \n                me.request( 'init', opts, function() {\n                    me.state = 'ready';\n                    me.trigger('ready');\n                });\n            },\n    \n            /**\n             * 获取或者设置Uploader配置项。\n             * @method option\n             * @grammar option( key ) => *\n             * @grammar option( key, val ) => self\n             * @example\n             *\n             * // 初始状态图片上传前不会压缩\n             * var uploader = new WebUploader.Uploader({\n             *     resize: null;\n             * });\n             *\n             * // 修改后图片上传前，尝试将图片压缩到1600 * 1600\n             * uploader.options( 'resize', {\n             *     width: 1600,\n             *     height: 1600\n             * });\n             */\n            option: function( key, val ) {\n                var opts = this.options;\n    \n                // setter\n                if ( arguments.length > 1 ) {\n    \n                    if ( $.isPlainObject( val ) &&\n                            $.isPlainObject( opts[ key ] ) ) {\n                        $.extend( opts[ key ], val );\n                    } else {\n                        opts[ key ] = val;\n                    }\n    \n                } else {    // getter\n                    return key ? opts[ key ] : opts;\n                }\n            },\n    \n            /**\n             * 获取文件统计信息。返回一个包含一下信息的对象。\n             * * `successNum` 上传成功的文件数\n             * * `uploadFailNum` 上传失败的文件数\n             * * `cancelNum` 被删除的文件数\n             * * `invalidNum` 无效的文件数\n             * * `queueNum` 还在队列中的文件数\n             * @method getStats\n             * @grammar getStats() => Object\n             */\n            getStats: function() {\n                // return this._mgr.getStats.apply( this._mgr, arguments );\n                var stats = this.request('get-stats');\n    \n                return {\n                    successNum: stats.numOfSuccess,\n    \n                    // who care?\n                    // queueFailNum: 0,\n                    cancelNum: stats.numOfCancel,\n                    invalidNum: stats.numOfInvalid,\n                    uploadFailNum: stats.numOfUploadFailed,\n                    queueNum: stats.numOfQueue\n                };\n            },\n    \n            // 需要重写此方法来来支持opts.onEvent和instance.onEvent的处理器\n            trigger: function( type/*, args...*/ ) {\n                var args = [].slice.call( arguments, 1 ),\n                    opts = this.options,\n                    name = 'on' + type.substring( 0, 1 ).toUpperCase() +\n                        type.substring( 1 );\n    \n                if (\n                        // 调用通过on方法注册的handler.\n                        Mediator.trigger.apply( this, arguments ) === false ||\n    \n                        // 调用opts.onEvent\n                        $.isFunction( opts[ name ] ) &&\n                        opts[ name ].apply( this, args ) === false ||\n    \n                        // 调用this.onEvent\n                        $.isFunction( this[ name ] ) &&\n                        this[ name ].apply( this, args ) === false ||\n    \n                        // 广播所有uploader的事件。\n                        Mediator.trigger.apply( Mediator,\n                        [ this, type ].concat( args ) ) === false ) {\n    \n                    return false;\n                }\n    \n                return true;\n            },\n    \n            // widgets/widget.js将补充此方法的详细文档。\n            request: Base.noop\n        });\n    \n        /**\n         * 创建Uploader实例，等同于new Uploader( opts );\n         * @method create\n         * @class Base\n         * @static\n         * @grammar Base.create( opts ) => Uploader\n         */\n        Base.create = Uploader.create = function( opts ) {\n            return new Uploader( opts );\n        };\n    \n        // 暴露Uploader，可以通过它来扩展业务逻辑。\n        Base.Uploader = Uploader;\n    \n        return Uploader;\n    });\n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/runtime',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n    \n        var $ = Base.$,\n            factories = {},\n    \n            // 获取对象的第一个key\n            getFirstKey = function( obj ) {\n                for ( var key in obj ) {\n                    if ( obj.hasOwnProperty( key ) ) {\n                        return key;\n                    }\n                }\n                return null;\n            };\n    \n        // 接口类。\n        function Runtime( options ) {\n            this.options = $.extend({\n                container: document.body\n            }, options );\n            this.uid = Base.guid('rt_');\n        }\n    \n        $.extend( Runtime.prototype, {\n    \n            getContainer: function() {\n                var opts = this.options,\n                    parent, container;\n    \n                if ( this._container ) {\n                    return this._container;\n                }\n    \n                parent = $( opts.container || document.body );\n                container = $( document.createElement('div') );\n    \n                container.attr( 'id', 'rt_' + this.uid );\n                container.css({\n                    position: 'absolute',\n                    top: '0px',\n                    left: '0px',\n                    width: '1px',\n                    height: '1px',\n                    overflow: 'hidden'\n                });\n    \n                parent.append( container );\n                parent.addClass('webuploader-container');\n                this._container = container;\n                return container;\n            },\n    \n            init: Base.noop,\n            exec: Base.noop,\n    \n            destroy: function() {\n                if ( this._container ) {\n                    this._container.parentNode.removeChild( this.__container );\n                }\n    \n                this.off();\n            }\n        });\n    \n        Runtime.orders = 'html5,flash';\n    \n    \n        /**\n         * 添加Runtime实现。\n         * @param {String} type    类型\n         * @param {Runtime} factory 具体Runtime实现。\n         */\n        Runtime.addRuntime = function( type, factory ) {\n            factories[ type ] = factory;\n        };\n    \n        Runtime.hasRuntime = function( type ) {\n            return !!(type ? factories[ type ] : getFirstKey( factories ));\n        };\n    \n        Runtime.create = function( opts, orders ) {\n            var type, runtime;\n    \n            orders = orders || Runtime.orders;\n            $.each( orders.split( /\\s*,\\s*/g ), function() {\n                if ( factories[ this ] ) {\n                    type = this;\n                    return false;\n                }\n            });\n    \n            type = type || getFirstKey( factories );\n    \n            if ( !type ) {\n                throw new Error('Runtime Error');\n            }\n    \n            runtime = new factories[ type ]( opts );\n            return runtime;\n        };\n    \n        Mediator.installTo( Runtime.prototype );\n        return Runtime;\n    });\n    \n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/client',[\n        'base',\n        'mediator',\n        'runtime/runtime'\n    ], function( Base, Mediator, Runtime ) {\n    \n        var cache;\n    \n        cache = (function() {\n            var obj = {};\n    \n            return {\n                add: function( runtime ) {\n                    obj[ runtime.uid ] = runtime;\n                },\n    \n                get: function( ruid, standalone ) {\n                    var i;\n    \n                    if ( ruid ) {\n                        return obj[ ruid ];\n                    }\n    \n                    for ( i in obj ) {\n                        // 有些类型不能重用，比如filepicker.\n                        if ( standalone && obj[ i ].__standalone ) {\n                            continue;\n                        }\n    \n                        return obj[ i ];\n                    }\n    \n                    return null;\n                },\n    \n                remove: function( runtime ) {\n                    delete obj[ runtime.uid ];\n                }\n            };\n        })();\n    \n        function RuntimeClient( component, standalone ) {\n            var deferred = Base.Deferred(),\n                runtime;\n    \n            this.uid = Base.guid('client_');\n    \n            // 允许runtime没有初始化之前，注册一些方法在初始化后执行。\n            this.runtimeReady = function( cb ) {\n                return deferred.done( cb );\n            };\n    \n            this.connectRuntime = function( opts, cb ) {\n    \n                // already connected.\n                if ( runtime ) {\n                    throw new Error('already connected!');\n                }\n    \n                deferred.done( cb );\n    \n                if ( typeof opts === 'string' && cache.get( opts ) ) {\n                    runtime = cache.get( opts );\n                }\n    \n                // 像filePicker只能独立存在，不能公用。\n                runtime = runtime || cache.get( null, standalone );\n    \n                // 需要创建\n                if ( !runtime ) {\n                    runtime = Runtime.create( opts, opts.runtimeOrder );\n                    runtime.__promise = deferred.promise();\n                    runtime.once( 'ready', deferred.resolve );\n                    runtime.init();\n                    cache.add( runtime );\n                    runtime.__client = 1;\n                } else {\n                    // 来自cache\n                    Base.$.extend( runtime.options, opts );\n                    runtime.__promise.then( deferred.resolve );\n                    runtime.__client++;\n                }\n    \n                standalone && (runtime.__standalone = standalone);\n                return runtime;\n            };\n    \n            this.getRuntime = function() {\n                return runtime;\n            };\n    \n            this.disconnectRuntime = function() {\n                if ( !runtime ) {\n                    return;\n                }\n    \n                runtime.__client--;\n    \n                if ( runtime.__client <= 0 ) {\n                    cache.remove( runtime );\n                    delete runtime.__promise;\n                    runtime.destroy();\n                }\n    \n                runtime = null;\n            };\n    \n            this.exec = function() {\n                if ( !runtime ) {\n                    return;\n                }\n    \n                var args = Base.slice( arguments );\n                component && args.unshift( component );\n    \n                return runtime.exec.apply( this, args );\n            };\n    \n            this.getRuid = function() {\n                return runtime && runtime.uid;\n            };\n    \n            this.destroy = (function( destroy ) {\n                return function() {\n                    destroy && destroy.apply( this, arguments );\n                    this.trigger('destroy');\n                    this.off();\n                    this.exec('destroy');\n                    this.disconnectRuntime();\n                };\n            })( this.destroy );\n        }\n    \n        Mediator.installTo( RuntimeClient.prototype );\n        return RuntimeClient;\n    });\n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/dnd',[\n        'base',\n        'mediator',\n        'runtime/client'\n    ], function( Base, Mediator, RuntimeClent ) {\n    \n        var $ = Base.$;\n    \n        function DragAndDrop( opts ) {\n            opts = this.options = $.extend({}, DragAndDrop.options, opts );\n    \n            opts.container = $( opts.container );\n    \n            if ( !opts.container.length ) {\n                return;\n            }\n    \n            RuntimeClent.call( this, 'DragAndDrop' );\n        }\n    \n        DragAndDrop.options = {\n            accept: null,\n            disableGlobalDnd: false\n        };\n    \n        Base.inherits( RuntimeClent, {\n            constructor: DragAndDrop,\n    \n            init: function() {\n                var me = this;\n    \n                me.connectRuntime( me.options, function() {\n                    me.exec('init');\n                    me.trigger('ready');\n                });\n            },\n    \n            destroy: function() {\n                this.disconnectRuntime();\n            }\n        });\n    \n        Mediator.installTo( DragAndDrop.prototype );\n    \n        return DragAndDrop;\n    });\n    /**\n     * @fileOverview 组件基类。\n     */\n    define('widgets/widget',[\n        'base',\n        'uploader'\n    ], function( Base, Uploader ) {\n    \n        var $ = Base.$,\n            _init = Uploader.prototype._init,\n            IGNORE = {},\n            widgetClass = [];\n    \n        function isArrayLike( obj ) {\n            if ( !obj ) {\n                return false;\n            }\n    \n            var length = obj.length,\n                type = $.type( obj );\n    \n            if ( obj.nodeType === 1 && length ) {\n                return true;\n            }\n    \n            return type === 'array' || type !== 'function' && type !== 'string' &&\n                    (length === 0 || typeof length === 'number' && length > 0 &&\n                    (length - 1) in obj);\n        }\n    \n        function Widget( uploader ) {\n            this.owner = uploader;\n            this.options = uploader.options;\n        }\n    \n        $.extend( Widget.prototype, {\n    \n            init: Base.noop,\n    \n            // 类Backbone的事件监听声明，监听uploader实例上的事件\n            // widget直接无法监听事件，事件只能通过uploader来传递\n            invoke: function( apiName, args ) {\n    \n                /*\n                    {\n                        'make-thumb': 'makeThumb'\n                    }\n                 */\n                var map = this.responseMap;\n    \n                // 如果无API响应声明则忽略\n                if ( !map || !(apiName in map) || !(map[ apiName ] in this) ||\n                        !$.isFunction( this[ map[ apiName ] ] ) ) {\n    \n                    return IGNORE;\n                }\n    \n                return this[ map[ apiName ] ].apply( this, args );\n    \n            },\n    \n            /**\n             * 发送命令。当传入`callback`或者`handler`中返回`promise`时。返回一个当所有`handler`中的promise都完成后完成的新`promise`。\n             * @method request\n             * @grammar request( command, args ) => * | Promise\n             * @grammar request( command, args, callback ) => Promise\n             * @for  Uploader\n             */\n            request: function() {\n                return this.owner.request.apply( this.owner, arguments );\n            }\n        });\n    \n        // 扩展Uploader.\n        $.extend( Uploader.prototype, {\n    \n            // 覆写_init用来初始化widgets\n            _init: function() {\n                var me = this,\n                    widgets = me._widgets = [];\n    \n                $.each( widgetClass, function( _, klass ) {\n                    widgets.push( new klass( me ) );\n                });\n    \n                return _init.apply( me, arguments );\n            },\n    \n            request: function( apiName, args, callback ) {\n                var i = 0,\n                    widgets = this._widgets,\n                    len = widgets.length,\n                    rlts = [],\n                    dfds = [],\n                    widget, rlt, promise, key;\n    \n                args = isArrayLike( args ) ? args : [ args ];\n    \n                for ( ; i < len; i++ ) {\n                    widget = widgets[ i ];\n                    rlt = widget.invoke( apiName, args );\n    \n                    if ( rlt !== IGNORE ) {\n    \n                        // Deferred对象\n                        if ( Base.isPromise( rlt ) ) {\n                            dfds.push( rlt );\n                        } else {\n                            rlts.push( rlt );\n                        }\n                    }\n                }\n    \n                // 如果有callback，则用异步方式。\n                if ( callback || dfds.length ) {\n                    promise = Base.when.apply( Base, dfds );\n                    key = promise.pipe ? 'pipe' : 'then';\n    \n                    // 很重要不能删除。删除了会死循环。\n                    // 保证执行顺序。让callback总是在下一个tick中执行。\n                    return promise[ key ](function() {\n                                var deferred = Base.Deferred(),\n                                    args = arguments;\n    \n                                setTimeout(function() {\n                                    deferred.resolve.apply( deferred, args );\n                                }, 1 );\n    \n                                return deferred.promise();\n                            })[ key ]( callback || Base.noop );\n                } else {\n                    return rlts[ 0 ];\n                }\n            }\n        });\n    \n        /**\n         * 添加组件\n         * @param  {object} widgetProto 组件原型，构造函数通过constructor属性定义\n         * @param  {object} responseMap API名称与函数实现的映射\n         * @example\n         *     Uploader.register( {\n         *         init: function( options ) {},\n         *         makeThumb: function() {}\n         *     }, {\n         *         'make-thumb': 'makeThumb'\n         *     } );\n         */\n        Uploader.register = Widget.register = function( responseMap, widgetProto ) {\n            var map = { init: 'init' },\n                klass;\n    \n            if ( arguments.length === 1 ) {\n                widgetProto = responseMap;\n                widgetProto.responseMap = map;\n            } else {\n                widgetProto.responseMap = $.extend( map, responseMap );\n            }\n    \n            klass = Base.inherits( Widget, widgetProto );\n            widgetClass.push( klass );\n    \n            return klass;\n        };\n    \n        return Widget;\n    });\n    /**\n     * @fileOverview DragAndDrop Widget。\n     */\n    define('widgets/filednd',[\n        'base',\n        'uploader',\n        'lib/dnd',\n        'widgets/widget'\n    ], function( Base, Uploader, Dnd ) {\n        var $ = Base.$;\n    \n        Uploader.options.dnd = '';\n    \n        /**\n         * @property {Selector} [dnd=undefined]  指定Drag And Drop拖拽的容器，如果不指定，则不启动。\n         * @namespace options\n         * @for Uploader\n         */\n    \n        /**\n         * @event dndAccept\n         * @param {DataTransferItemList} items DataTransferItem\n         * @description 阻止此事件可以拒绝某些类型的文件拖入进来。目前只有 chrome 提供这样的 API，且只能通过 mime-type 验证。\n         * @for  Uploader\n         */\n        return Uploader.register({\n            init: function( opts ) {\n    \n                if ( !opts.dnd ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n    \n                var me = this,\n                    deferred = Base.Deferred(),\n                    options = $.extend({}, {\n                        disableGlobalDnd: opts.disableGlobalDnd,\n                        container: opts.dnd,\n                        accept: opts.accept\n                    }),\n                    dnd;\n    \n                dnd = new Dnd( options );\n    \n                dnd.once( 'ready', deferred.resolve );\n                dnd.on( 'drop', function( files ) {\n                    me.request( 'add-file', [ files ]);\n                });\n    \n                // 检测文件是否全部允许添加。\n                dnd.on( 'accept', function( items ) {\n                    return me.owner.trigger( 'dndAccept', items );\n                });\n    \n                dnd.init();\n    \n                return deferred.promise();\n            }\n        });\n    });\n    \n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/filepaste',[\n        'base',\n        'mediator',\n        'runtime/client'\n    ], function( Base, Mediator, RuntimeClent ) {\n    \n        var $ = Base.$;\n    \n        function FilePaste( opts ) {\n            opts = this.options = $.extend({}, opts );\n            opts.container = $( opts.container || document.body );\n            RuntimeClent.call( this, 'FilePaste' );\n        }\n    \n        Base.inherits( RuntimeClent, {\n            constructor: FilePaste,\n    \n            init: function() {\n                var me = this;\n    \n                me.connectRuntime( me.options, function() {\n                    me.exec('init');\n                    me.trigger('ready');\n                });\n            },\n    \n            destroy: function() {\n                this.exec('destroy');\n                this.disconnectRuntime();\n                this.off();\n            }\n        });\n    \n        Mediator.installTo( FilePaste.prototype );\n    \n        return FilePaste;\n    });\n    /**\n     * @fileOverview 组件基类。\n     */\n    define('widgets/filepaste',[\n        'base',\n        'uploader',\n        'lib/filepaste',\n        'widgets/widget'\n    ], function( Base, Uploader, FilePaste ) {\n        var $ = Base.$;\n    \n        /**\n         * @property {Selector} [paste=undefined]  指定监听paste事件的容器，如果不指定，不启用此功能。此功能为通过粘贴来添加截屏的图片。建议设置为`document.body`.\n         * @namespace options\n         * @for Uploader\n         */\n        return Uploader.register({\n            init: function( opts ) {\n    \n                if ( !opts.paste ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n    \n                var me = this,\n                    deferred = Base.Deferred(),\n                    options = $.extend({}, {\n                        container: opts.paste,\n                        accept: opts.accept\n                    }),\n                    paste;\n    \n                paste = new FilePaste( options );\n    \n                paste.once( 'ready', deferred.resolve );\n                paste.on( 'paste', function( files ) {\n                    me.owner.request( 'add-file', [ files ]);\n                });\n                paste.init();\n    \n                return deferred.promise();\n            }\n        });\n    });\n    /**\n     * @fileOverview Blob\n     */\n    define('lib/blob',[\n        'base',\n        'runtime/client'\n    ], function( Base, RuntimeClient ) {\n    \n        function Blob( ruid, source ) {\n            var me = this;\n    \n            me.source = source;\n            me.ruid = ruid;\n    \n            RuntimeClient.call( me, 'Blob' );\n    \n            this.uid = source.uid || this.uid;\n            this.type = source.type || '';\n            this.size = source.size || 0;\n    \n            if ( ruid ) {\n                me.connectRuntime( ruid );\n            }\n        }\n    \n        Base.inherits( RuntimeClient, {\n            constructor: Blob,\n    \n            slice: function( start, end ) {\n                return this.exec( 'slice', start, end );\n            },\n    \n            getSource: function() {\n                return this.source;\n            }\n        });\n    \n        return Blob;\n    });\n    /**\n     * 为了统一化Flash的File和HTML5的File而存在。\n     * 以至于要调用Flash里面的File，也可以像调用HTML5版本的File一下。\n     * @fileOverview File\n     */\n    define('lib/file',[\n        'base',\n        'lib/blob'\n    ], function( Base, Blob ) {\n    \n        var uid = 1,\n            rExt = /\\.([^.]+)$/;\n    \n        function File( ruid, file ) {\n            var ext;\n    \n            Blob.apply( this, arguments );\n            this.name = file.name || ('untitled' + uid++);\n            ext = rExt.exec( file.name ) ? RegExp.$1.toLowerCase() : '';\n    \n            // todo 支持其他类型文件的转换。\n    \n            // 如果有mimetype, 但是文件名里面没有找出后缀规律\n            if ( !ext && this.type ) {\n                ext = /\\/(jpg|jpeg|png|gif|bmp)$/i.exec( this.type ) ?\n                        RegExp.$1.toLowerCase() : '';\n                this.name += '.' + ext;\n            }\n    \n            // 如果没有指定mimetype, 但是知道文件后缀。\n            if ( !this.type &&  ~'jpg,jpeg,png,gif,bmp'.indexOf( ext ) ) {\n                this.type = 'image/' + (ext === 'jpg' ? 'jpeg' : ext);\n            }\n    \n            this.ext = ext;\n            this.lastModifiedDate = file.lastModifiedDate ||\n                    (new Date()).toLocaleString();\n        }\n    \n        return Base.inherits( Blob, File );\n    });\n    \n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/filepicker',[\n        'base',\n        'runtime/client',\n        'lib/file'\n    ], function( Base, RuntimeClent, File ) {\n    \n        var $ = Base.$;\n    \n        function FilePicker( opts ) {\n            opts = this.options = $.extend({}, FilePicker.options, opts );\n    \n            opts.container = $( opts.id );\n    \n            if ( !opts.container.length ) {\n                throw new Error('按钮指定错误');\n            }\n    \n            opts.innerHTML = opts.innerHTML || opts.label ||\n                    opts.container.html() || '';\n    \n            opts.button = $( opts.button || document.createElement('div') );\n            opts.button.html( opts.innerHTML );\n            opts.container.html( opts.button );\n    \n            RuntimeClent.call( this, 'FilePicker', true );\n        }\n    \n        FilePicker.options = {\n            button: null,\n            container: null,\n            label: null,\n            innerHTML: null,\n            multiple: true,\n            accept: null,\n            name: 'file'\n        };\n    \n        Base.inherits( RuntimeClent, {\n            constructor: FilePicker,\n    \n            init: function() {\n                var me = this,\n                    opts = me.options,\n                    button = opts.button;\n    \n                button.addClass('webuploader-pick');\n    \n                me.on( 'all', function( type ) {\n                    var files;\n    \n                    switch ( type ) {\n                        case 'mouseenter':\n                            button.addClass('webuploader-pick-hover');\n                            break;\n    \n                        case 'mouseleave':\n                            button.removeClass('webuploader-pick-hover');\n                            break;\n    \n                        case 'change':\n                            files = me.exec('getFiles');\n                            me.trigger( 'select', $.map( files, function( file ) {\n                                file = new File( me.getRuid(), file );\n    \n                                // 记录来源。\n                                file._refer = opts.container;\n                                return file;\n                            }), opts.container );\n                            break;\n                    }\n                });\n    \n                me.connectRuntime( opts, function() {\n                    me.refresh();\n                    me.exec( 'init', opts );\n                    me.trigger('ready');\n                });\n    \n                $( window ).on( 'resize', function() {\n                    me.refresh();\n                });\n            },\n    \n            refresh: function() {\n                var shimContainer = this.getRuntime().getContainer(),\n                    button = this.options.button,\n                    width = button.outerWidth ?\n                            button.outerWidth() : button.width(),\n    \n                    height = button.outerHeight ?\n                            button.outerHeight() : button.height(),\n    \n                    pos = button.offset();\n    \n                width && height && shimContainer.css({\n                    bottom: 'auto',\n                    right: 'auto',\n                    width: width + 'px',\n                    height: height + 'px'\n                }).offset( pos );\n            },\n    \n            enable: function() {\n                var btn = this.options.button;\n    \n                btn.removeClass('webuploader-pick-disable');\n                this.refresh();\n            },\n    \n            disable: function() {\n                var btn = this.options.button;\n    \n                this.getRuntime().getContainer().css({\n                    top: '-99999px'\n                });\n    \n                btn.addClass('webuploader-pick-disable');\n            },\n    \n            destroy: function() {\n                if ( this.runtime ) {\n                    this.exec('destroy');\n                    this.disconnectRuntime();\n                }\n            }\n        });\n    \n        return FilePicker;\n    });\n    \n    /**\n     * @fileOverview 文件选择相关\n     */\n    define('widgets/filepicker',[\n        'base',\n        'uploader',\n        'lib/filepicker',\n        'widgets/widget'\n    ], function( Base, Uploader, FilePicker ) {\n        var $ = Base.$;\n    \n        $.extend( Uploader.options, {\n    \n            /**\n             * @property {Selector | Object} [pick=undefined]\n             * @namespace options\n             * @for Uploader\n             * @description 指定选择文件的按钮容器，不指定则不创建按钮。\n             *\n             * * `id` {Seletor} 指定选择文件的按钮容器，不指定则不创建按钮。\n             * * `label` {String} 请采用 `innerHTML` 代替\n             * * `innerHTML` {String} 指定按钮文字。不指定时优先从指定的容器中看是否自带文字。\n             * * `multiple` {Boolean} 是否开起同时选择多个文件能力。\n             */\n            pick: null,\n    \n            /**\n             * @property {Arroy} [accept=null]\n             * @namespace options\n             * @for Uploader\n             * @description 指定接受哪些类型的文件。 由于目前还有ext转mimeType表，所以这里需要分开指定。\n             *\n             * * `title` {String} 文字描述\n             * * `extensions` {String} 允许的文件后缀，不带点，多个用逗号分割。\n             * * `mimeTypes` {String} 多个用逗号分割。\n             *\n             * 如：\n             *\n             * ```\n             * {\n             *     title: 'Images',\n             *     extensions: 'gif,jpg,jpeg,bmp,png',\n             *     mimeTypes: 'image/*'\n             * }\n             * ```\n             */\n            accept: null/*{\n                title: 'Images',\n                extensions: 'gif,jpg,jpeg,bmp,png',\n                mimeTypes: 'image/*'\n            }*/\n        });\n    \n        return Uploader.register({\n            'add-btn': 'addButton',\n            refresh: 'refresh',\n            disable: 'disable',\n            enable: 'enable'\n        }, {\n    \n            init: function( opts ) {\n                this.pickers = [];\n                return opts.pick && this.addButton( opts.pick );\n            },\n    \n            refresh: function() {\n                $.each( this.pickers, function() {\n                    this.refresh();\n                });\n            },\n    \n            /**\n             * @method addButton\n             * @for Uploader\n             * @grammar addButton( pick ) => Promise\n             * @description\n             * 添加文件选择按钮，如果一个按钮不够，需要调用此方法来添加。参数跟[options.pick](#WebUploader:Uploader:options)一致。\n             * @example\n             * uploader.addButton({\n             *     id: '#btnContainer',\n             *     innerHTML: '选择文件'\n             * });\n             */\n            addButton: function( pick ) {\n                var me = this,\n                    opts = me.options,\n                    accept = opts.accept,\n                    options, picker, deferred;\n    \n                if ( !pick ) {\n                    return;\n                }\n    \n                deferred = Base.Deferred();\n                $.isPlainObject( pick ) || (pick = {\n                    id: pick\n                });\n    \n                options = $.extend({}, pick, {\n                    accept: $.isPlainObject( accept ) ? [ accept ] : accept,\n                    swf: opts.swf,\n                    runtimeOrder: opts.runtimeOrder\n                });\n    \n                picker = new FilePicker( options );\n    \n                picker.once( 'ready', deferred.resolve );\n                picker.on( 'select', function( files ) {\n                    me.owner.request( 'add-file', [ files ]);\n                });\n                picker.init();\n    \n                this.pickers.push( picker );\n    \n                return deferred.promise();\n            },\n    \n            disable: function() {\n                $.each( this.pickers, function() {\n                    this.disable();\n                });\n            },\n    \n            enable: function() {\n                $.each( this.pickers, function() {\n                    this.enable();\n                });\n            }\n        });\n    });\n    /**\n     * @fileOverview Image\n     */\n    define('lib/image',[\n        'base',\n        'runtime/client',\n        'lib/blob'\n    ], function( Base, RuntimeClient, Blob ) {\n        var $ = Base.$;\n    \n        // 构造器。\n        function Image( opts ) {\n            this.options = $.extend({}, Image.options, opts );\n            RuntimeClient.call( this, 'Image' );\n    \n            this.on( 'load', function() {\n                this._info = this.exec('info');\n                this._meta = this.exec('meta');\n            });\n        }\n    \n        // 默认选项。\n        Image.options = {\n    \n            // 默认的图片处理质量\n            quality: 90,\n    \n            // 是否裁剪\n            crop: false,\n    \n            // 是否保留头部信息\n            preserveHeaders: true,\n    \n            // 是否允许放大。\n            allowMagnify: true\n        };\n    \n        // 继承RuntimeClient.\n        Base.inherits( RuntimeClient, {\n            constructor: Image,\n    \n            info: function( val ) {\n    \n                // setter\n                if ( val ) {\n                    this._info = val;\n                    return this;\n                }\n    \n                // getter\n                return this._info;\n            },\n    \n            meta: function( val ) {\n    \n                // setter\n                if ( val ) {\n                    this._meta = val;\n                    return this;\n                }\n    \n                // getter\n                return this._meta;\n            },\n    \n            loadFromBlob: function( blob ) {\n                var me = this,\n                    ruid = blob.getRuid();\n    \n                this.connectRuntime( ruid, function() {\n                    me.exec( 'init', me.options );\n                    me.exec( 'loadFromBlob', blob );\n                });\n            },\n    \n            resize: function() {\n                var args = Base.slice( arguments );\n                return this.exec.apply( this, [ 'resize' ].concat( args ) );\n            },\n    \n            getAsDataUrl: function( type ) {\n                return this.exec( 'getAsDataUrl', type );\n            },\n    \n            getAsBlob: function( type ) {\n                var blob = this.exec( 'getAsBlob', type );\n    \n                return new Blob( this.getRuid(), blob );\n            }\n        });\n    \n        return Image;\n    });\n    /**\n     * @fileOverview 图片操作, 负责预览图片和上传前压缩图片\n     */\n    define('widgets/image',[\n        'base',\n        'uploader',\n        'lib/image',\n        'widgets/widget'\n    ], function( Base, Uploader, Image ) {\n    \n        var $ = Base.$,\n            throttle;\n    \n        // 根据要处理的文件大小来节流，一次不能处理太多，会卡。\n        throttle = (function( max ) {\n            var occupied = 0,\n                waiting = [],\n                tick = function() {\n                    var item;\n    \n                    while ( waiting.length && occupied < max ) {\n                        item = waiting.shift();\n                        occupied += item[ 0 ];\n                        item[ 1 ]();\n                    }\n                };\n    \n            return function( emiter, size, cb ) {\n                waiting.push([ size, cb ]);\n                emiter.once( 'destroy', function() {\n                    occupied -= size;\n                    setTimeout( tick, 1 );\n                });\n                setTimeout( tick, 1 );\n            };\n        })( 5 * 1024 * 1024 );\n    \n        $.extend( Uploader.options, {\n    \n            /**\n             * @property {Object} [thumb]\n             * @namespace options\n             * @for Uploader\n             * @description 配置生成缩略图的选项。\n             *\n             * 默认为：\n             *\n             * ```javascript\n             * {\n             *     width: 110,\n             *     height: 110,\n             *\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\n             *     quality: 70,\n             *\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\n             *     allowMagnify: true,\n             *\n             *     // 是否允许裁剪。\n             *     crop: true,\n             *\n             *     // 是否保留头部meta信息。\n             *     preserveHeaders: false,\n             *\n             *     // 为空的话则保留原有图片格式。\n             *     // 否则强制转换成指定的类型。\n             *     type: 'image/jpeg'\n             * }\n             * ```\n             */\n            thumb: {\n                width: 110,\n                height: 110,\n                quality: 70,\n                allowMagnify: true,\n                crop: true,\n                preserveHeaders: false,\n    \n                // 为空的话则保留原有图片格式。\n                // 否则强制转换成指定的类型。\n                // IE 8下面 base64 大小不能超过 32K 否则预览失败，而非 jpeg 编码的图片很可\n                // 能会超过 32k, 所以这里设置成预览的时候都是 image/jpeg\n                type: 'image/jpeg'\n            },\n    \n            /**\n             * @property {Object} [compress]\n             * @namespace options\n             * @for Uploader\n             * @description 配置压缩的图片的选项。如果此选项为`false`, 则图片在上传前不进行压缩。\n             *\n             * 默认为：\n             *\n             * ```javascript\n             * {\n             *     width: 1600,\n             *     height: 1600,\n             *\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\n             *     quality: 90,\n             *\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\n             *     allowMagnify: false,\n             *\n             *     // 是否允许裁剪。\n             *     crop: false,\n             *\n             *     // 是否保留头部meta信息。\n             *     preserveHeaders: true\n             * }\n             * ```\n             */\n            compress: {\n                width: 1600,\n                height: 1600,\n                quality: 90,\n                allowMagnify: false,\n                crop: false,\n                preserveHeaders: true\n            }\n        });\n    \n        return Uploader.register({\n            'make-thumb': 'makeThumb',\n            'before-send-file': 'compressImage'\n        }, {\n    \n    \n            /**\n             * 生成缩略图，此过程为异步，所以需要传入`callback`。\n             * 通常情况在图片加入队里后调用此方法来生成预览图以增强交互效果。\n             *\n             * `callback`中可以接收到两个参数。\n             * * 第一个为error，如果生成缩略图有错误，此error将为真。\n             * * 第二个为ret, 缩略图的Data URL值。\n             *\n             * **注意**\n             * Date URL在IE6/7中不支持，所以不用调用此方法了，直接显示一张暂不支持预览图片好了。\n             *\n             *\n             * @method makeThumb\n             * @grammar makeThumb( file, callback ) => undefined\n             * @grammar makeThumb( file, callback, width, height ) => undefined\n             * @for Uploader\n             * @example\n             *\n             * uploader.on( 'fileQueued', function( file ) {\n             *     var $li = ...;\n             *\n             *     uploader.makeThumb( file, function( error, ret ) {\n             *         if ( error ) {\n             *             $li.text('预览错误');\n             *         } else {\n             *             $li.append('<img alt=\"\" src=\"' + ret + '\" />');\n             *         }\n             *     });\n             *\n             * });\n             */\n            makeThumb: function( file, cb, width, height ) {\n                var opts, image;\n    \n                file = this.request( 'get-file', file );\n    \n                // 只预览图片格式。\n                if ( !file.type.match( /^image/ ) ) {\n                    cb( true );\n                    return;\n                }\n    \n                opts = $.extend({}, this.options.thumb );\n    \n                // 如果传入的是object.\n                if ( $.isPlainObject( width ) ) {\n                    opts = $.extend( opts, width );\n                    width = null;\n                }\n    \n                width = width || opts.width;\n                height = height || opts.height;\n    \n                image = new Image( opts );\n    \n                image.once( 'load', function() {\n                    file._info = file._info || image.info();\n                    file._meta = file._meta || image.meta();\n                    image.resize( width, height );\n                });\n    \n                image.once( 'complete', function() {\n                    cb( false, image.getAsDataUrl( opts.type ) );\n                    image.destroy();\n                });\n    \n                image.once( 'error', function() {\n                    cb( true );\n                    image.destroy();\n                });\n    \n                throttle( image, file.source.size, function() {\n                    file._info && image.info( file._info );\n                    file._meta && image.meta( file._meta );\n                    image.loadFromBlob( file.source );\n                });\n            },\n    \n            compressImage: function( file ) {\n                var opts = this.options.compress || this.options.resize,\n                    compressSize = opts && opts.compressSize || 300 * 1024,\n                    image, deferred;\n    \n                file = this.request( 'get-file', file );\n    \n                // 只预览图片格式。\n                if ( !opts || !~'image/jpeg,image/jpg'.indexOf( file.type ) ||\n                        file.size < compressSize ||\n                        file._compressed ) {\n                    return;\n                }\n    \n                opts = $.extend({}, opts );\n                deferred = Base.Deferred();\n    \n                image = new Image( opts );\n    \n                deferred.always(function() {\n                    image.destroy();\n                    image = null;\n                });\n                image.once( 'error', deferred.reject );\n                image.once( 'load', function() {\n                    file._info = file._info || image.info();\n                    file._meta = file._meta || image.meta();\n                    image.resize( opts.width, opts.height );\n                });\n    \n                image.once( 'complete', function() {\n                    var blob, size;\n    \n                    // 移动端 UC / qq 浏览器的无图模式下\n                    // ctx.getImageData 处理大图的时候会报 Exception\n                    // INDEX_SIZE_ERR: DOM Exception 1\n                    try {\n                        blob = image.getAsBlob( opts.type );\n    \n                        size = file.size;\n    \n                        // 如果压缩后，比原来还大则不用压缩后的。\n                        if ( blob.size < size ) {\n                            // file.source.destroy && file.source.destroy();\n                            file.source = blob;\n                            file.size = blob.size;\n    \n                            file.trigger( 'resize', blob.size, size );\n                        }\n    \n                        // 标记，避免重复压缩。\n                        file._compressed = true;\n                        deferred.resolve();\n                    } catch ( e ) {\n                        // 出错了直接继续，让其上传原始图片\n                        deferred.resolve();\n                    }\n                });\n    \n                file._info && image.info( file._info );\n                file._meta && image.meta( file._meta );\n    \n                image.loadFromBlob( file.source );\n                return deferred.promise();\n            }\n        });\n    });\n    /**\n     * @fileOverview 文件属性封装\n     */\n    define('file',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n    \n        var $ = Base.$,\n            idPrefix = 'WU_FILE_',\n            idSuffix = 0,\n            rExt = /\\.([^.]+)$/,\n            statusMap = {};\n    \n        function gid() {\n            return idPrefix + idSuffix++;\n        }\n    \n        /**\n         * 文件类\n         * @class File\n         * @constructor 构造函数\n         * @grammar new File( source ) => File\n         * @param {Lib.File} source [lib.File](#Lib.File)实例, 此source对象是带有Runtime信息的。\n         */\n        function WUFile( source ) {\n    \n            /**\n             * 文件名，包括扩展名（后缀）\n             * @property name\n             * @type {string}\n             */\n            this.name = source.name || 'Untitled';\n    \n            /**\n             * 文件体积（字节）\n             * @property size\n             * @type {uint}\n             * @default 0\n             */\n            this.size = source.size || 0;\n    \n            /**\n             * 文件MIMETYPE类型，与文件类型的对应关系请参考[http://t.cn/z8ZnFny](http://t.cn/z8ZnFny)\n             * @property type\n             * @type {string}\n             * @default 'application'\n             */\n            this.type = source.type || 'application';\n    \n            /**\n             * 文件最后修改日期\n             * @property lastModifiedDate\n             * @type {int}\n             * @default 当前时间戳\n             */\n            this.lastModifiedDate = source.lastModifiedDate || (new Date() * 1);\n    \n            /**\n             * 文件ID，每个对象具有唯一ID，与文件名无关\n             * @property id\n             * @type {string}\n             */\n            this.id = gid();\n    \n            /**\n             * 文件扩展名，通过文件名获取，例如test.png的扩展名为png\n             * @property ext\n             * @type {string}\n             */\n            this.ext = rExt.exec( this.name ) ? RegExp.$1 : '';\n    \n    \n            /**\n             * 状态文字说明。在不同的status语境下有不同的用途。\n             * @property statusText\n             * @type {string}\n             */\n            this.statusText = '';\n    \n            // 存储文件状态，防止通过属性直接修改\n            statusMap[ this.id ] = WUFile.Status.INITED;\n    \n            this.source = source;\n            this.loaded = 0;\n    \n            this.on( 'error', function( msg ) {\n                this.setStatus( WUFile.Status.ERROR, msg );\n            });\n        }\n    \n        $.extend( WUFile.prototype, {\n    \n            /**\n             * 设置状态，状态变化时会触发`change`事件。\n             * @method setStatus\n             * @grammar setStatus( status[, statusText] );\n             * @param {File.Status|String} status [文件状态值](#WebUploader:File:File.Status)\n             * @param {String} [statusText=''] 状态说明，常在error时使用，用http, abort,server等来标记是由于什么原因导致文件错误。\n             */\n            setStatus: function( status, text ) {\n    \n                var prevStatus = statusMap[ this.id ];\n    \n                typeof text !== 'undefined' && (this.statusText = text);\n    \n                if ( status !== prevStatus ) {\n                    statusMap[ this.id ] = status;\n                    /**\n                     * 文件状态变化\n                     * @event statuschange\n                     */\n                    this.trigger( 'statuschange', status, prevStatus );\n                }\n    \n            },\n    \n            /**\n             * 获取文件状态\n             * @return {File.Status}\n             * @example\n                     文件状态具体包括以下几种类型：\n                     {\n                         // 初始化\n                        INITED:     0,\n                        // 已入队列\n                        QUEUED:     1,\n                        // 正在上传\n                        PROGRESS:     2,\n                        // 上传出错\n                        ERROR:         3,\n                        // 上传成功\n                        COMPLETE:     4,\n                        // 上传取消\n                        CANCELLED:     5\n                    }\n             */\n            getStatus: function() {\n                return statusMap[ this.id ];\n            },\n    \n            /**\n             * 获取文件原始信息。\n             * @return {*}\n             */\n            getSource: function() {\n                return this.source;\n            },\n    \n            destory: function() {\n                delete statusMap[ this.id ];\n            }\n        });\n    \n        Mediator.installTo( WUFile.prototype );\n    \n        /**\n         * 文件状态值，具体包括以下几种类型：\n         * * `inited` 初始状态\n         * * `queued` 已经进入队列, 等待上传\n         * * `progress` 上传中\n         * * `complete` 上传完成。\n         * * `error` 上传出错，可重试\n         * * `interrupt` 上传中断，可续传。\n         * * `invalid` 文件不合格，不能重试上传。会自动从队列中移除。\n         * * `cancelled` 文件被移除。\n         * @property {Object} Status\n         * @namespace File\n         * @class File\n         * @static\n         */\n        WUFile.Status = {\n            INITED:     'inited',    // 初始状态\n            QUEUED:     'queued',    // 已经进入队列, 等待上传\n            PROGRESS:   'progress',    // 上传中\n            ERROR:      'error',    // 上传出错，可重试\n            COMPLETE:   'complete',    // 上传完成。\n            CANCELLED:  'cancelled',    // 上传取消。\n            INTERRUPT:  'interrupt',    // 上传中断，可续传。\n            INVALID:    'invalid'    // 文件不合格，不能重试上传。\n        };\n    \n        return WUFile;\n    });\n    \n    /**\n     * @fileOverview 文件队列\n     */\n    define('queue',[\n        'base',\n        'mediator',\n        'file'\n    ], function( Base, Mediator, WUFile ) {\n    \n        var $ = Base.$,\n            STATUS = WUFile.Status;\n    \n        /**\n         * 文件队列, 用来存储各个状态中的文件。\n         * @class Queue\n         * @extends Mediator\n         */\n        function Queue() {\n    \n            /**\n             * 统计文件数。\n             * * `numOfQueue` 队列中的文件数。\n             * * `numOfSuccess` 上传成功的文件数\n             * * `numOfCancel` 被移除的文件数\n             * * `numOfProgress` 正在上传中的文件数\n             * * `numOfUploadFailed` 上传错误的文件数。\n             * * `numOfInvalid` 无效的文件数。\n             * @property {Object} stats\n             */\n            this.stats = {\n                numOfQueue: 0,\n                numOfSuccess: 0,\n                numOfCancel: 0,\n                numOfProgress: 0,\n                numOfUploadFailed: 0,\n                numOfInvalid: 0\n            };\n    \n            // 上传队列，仅包括等待上传的文件\n            this._queue = [];\n    \n            // 存储所有文件\n            this._map = {};\n        }\n    \n        $.extend( Queue.prototype, {\n    \n            /**\n             * 将新文件加入对队列尾部\n             *\n             * @method append\n             * @param  {File} file   文件对象\n             */\n            append: function( file ) {\n                this._queue.push( file );\n                this._fileAdded( file );\n                return this;\n            },\n    \n            /**\n             * 将新文件加入对队列头部\n             *\n             * @method prepend\n             * @param  {File} file   文件对象\n             */\n            prepend: function( file ) {\n                this._queue.unshift( file );\n                this._fileAdded( file );\n                return this;\n            },\n    \n            /**\n             * 获取文件对象\n             *\n             * @method getFile\n             * @param  {String} fileId   文件ID\n             * @return {File}\n             */\n            getFile: function( fileId ) {\n                if ( typeof fileId !== 'string' ) {\n                    return fileId;\n                }\n                return this._map[ fileId ];\n            },\n    \n            /**\n             * 从队列中取出一个指定状态的文件。\n             * @grammar fetch( status ) => File\n             * @method fetch\n             * @param {String} status [文件状态值](#WebUploader:File:File.Status)\n             * @return {File} [File](#WebUploader:File)\n             */\n            fetch: function( status ) {\n                var len = this._queue.length,\n                    i, file;\n    \n                status = status || STATUS.QUEUED;\n    \n                for ( i = 0; i < len; i++ ) {\n                    file = this._queue[ i ];\n    \n                    if ( status === file.getStatus() ) {\n                        return file;\n                    }\n                }\n    \n                return null;\n            },\n    \n            /**\n             * 对队列进行排序，能够控制文件上传顺序。\n             * @grammar sort( fn ) => undefined\n             * @method sort\n             * @param {Function} fn 排序方法\n             */\n            sort: function( fn ) {\n                if ( typeof fn === 'function' ) {\n                    this._queue.sort( fn );\n                }\n            },\n    \n            /**\n             * 获取指定类型的文件列表, 列表中每一个成员为[File](#WebUploader:File)对象。\n             * @grammar getFiles( [status1[, status2 ...]] ) => Array\n             * @method getFiles\n             * @param {String} [status] [文件状态值](#WebUploader:File:File.Status)\n             */\n            getFiles: function() {\n                var sts = [].slice.call( arguments, 0 ),\n                    ret = [],\n                    i = 0,\n                    len = this._queue.length,\n                    file;\n    \n                for ( ; i < len; i++ ) {\n                    file = this._queue[ i ];\n    \n                    if ( sts.length && !~$.inArray( file.getStatus(), sts ) ) {\n                        continue;\n                    }\n    \n                    ret.push( file );\n                }\n    \n                return ret;\n            },\n    \n            _fileAdded: function( file ) {\n                var me = this,\n                    existing = this._map[ file.id ];\n    \n                if ( !existing ) {\n                    this._map[ file.id ] = file;\n    \n                    file.on( 'statuschange', function( cur, pre ) {\n                        me._onFileStatusChange( cur, pre );\n                    });\n                }\n    \n                file.setStatus( STATUS.QUEUED );\n            },\n    \n            _onFileStatusChange: function( curStatus, preStatus ) {\n                var stats = this.stats;\n    \n                switch ( preStatus ) {\n                    case STATUS.PROGRESS:\n                        stats.numOfProgress--;\n                        break;\n    \n                    case STATUS.QUEUED:\n                        stats.numOfQueue --;\n                        break;\n    \n                    case STATUS.ERROR:\n                        stats.numOfUploadFailed--;\n                        break;\n    \n                    case STATUS.INVALID:\n                        stats.numOfInvalid--;\n                        break;\n                }\n    \n                switch ( curStatus ) {\n                    case STATUS.QUEUED:\n                        stats.numOfQueue++;\n                        break;\n    \n                    case STATUS.PROGRESS:\n                        stats.numOfProgress++;\n                        break;\n    \n                    case STATUS.ERROR:\n                        stats.numOfUploadFailed++;\n                        break;\n    \n                    case STATUS.COMPLETE:\n                        stats.numOfSuccess++;\n                        break;\n    \n                    case STATUS.CANCELLED:\n                        stats.numOfCancel++;\n                        break;\n    \n                    case STATUS.INVALID:\n                        stats.numOfInvalid++;\n                        break;\n                }\n            }\n    \n        });\n    \n        Mediator.installTo( Queue.prototype );\n    \n        return Queue;\n    });\n    /**\n     * @fileOverview 队列\n     */\n    define('widgets/queue',[\n        'base',\n        'uploader',\n        'queue',\n        'file',\n        'lib/file',\n        'runtime/client',\n        'widgets/widget'\n    ], function( Base, Uploader, Queue, WUFile, File, RuntimeClient ) {\n    \n        var $ = Base.$,\n            rExt = /\\.\\w+$/,\n            Status = WUFile.Status;\n    \n        return Uploader.register({\n            'sort-files': 'sortFiles',\n            'add-file': 'addFiles',\n            'get-file': 'getFile',\n            'fetch-file': 'fetchFile',\n            'get-stats': 'getStats',\n            'get-files': 'getFiles',\n            'remove-file': 'removeFile',\n            'retry': 'retry',\n            'reset': 'reset',\n            'accept-file': 'acceptFile'\n        }, {\n    \n            init: function( opts ) {\n                var me = this,\n                    deferred, len, i, item, arr, accept, runtime;\n    \n                if ( $.isPlainObject( opts.accept ) ) {\n                    opts.accept = [ opts.accept ];\n                }\n    \n                // accept中的中生成匹配正则。\n                if ( opts.accept ) {\n                    arr = [];\n    \n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n                        item = opts.accept[ i ].extensions;\n                        item && arr.push( item );\n                    }\n    \n                    if ( arr.length ) {\n                        accept = '\\\\.' + arr.join(',')\n                                .replace( /,/g, '$|\\\\.' )\n                                .replace( /\\*/g, '.*' ) + '$';\n                    }\n    \n                    me.accept = new RegExp( accept, 'i' );\n                }\n    \n                me.queue = new Queue();\n                me.stats = me.queue.stats;\n    \n                // 如果当前不是html5运行时，那就算了。\n                // 不执行后续操作\n                if ( this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n    \n                // 创建一个 html5 运行时的 placeholder\n                // 以至于外部添加原生 File 对象的时候能正确包裹一下供 webuploader 使用。\n                deferred = Base.Deferred();\n                runtime = new RuntimeClient('Placeholder');\n                runtime.connectRuntime({\n                    runtimeOrder: 'html5'\n                }, function() {\n                    me._ruid = runtime.getRuid();\n                    deferred.resolve();\n                });\n                return deferred.promise();\n            },\n    \n    \n            // 为了支持外部直接添加一个原生File对象。\n            _wrapFile: function( file ) {\n                if ( !(file instanceof WUFile) ) {\n    \n                    if ( !(file instanceof File) ) {\n                        if ( !this._ruid ) {\n                            throw new Error('Can\\'t add external files.');\n                        }\n                        file = new File( this._ruid, file );\n                    }\n    \n                    file = new WUFile( file );\n                }\n    \n                return file;\n            },\n    \n            // 判断文件是否可以被加入队列\n            acceptFile: function( file ) {\n                var invalid = !file || file.size < 6 || this.accept &&\n    \n                        // 如果名字中有后缀，才做后缀白名单处理。\n                        rExt.exec( file.name ) && !this.accept.test( file.name );\n    \n                return !invalid;\n            },\n    \n    \n            /**\n             * @event beforeFileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列之前触发，此事件的handler返回值为`false`，则此文件不会被添加进入队列。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event fileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列以后触发。\n             * @for  Uploader\n             */\n    \n            _addFile: function( file ) {\n                var me = this;\n    \n                file = me._wrapFile( file );\n    \n                // 不过类型判断允许不允许，先派送 `beforeFileQueued`\n                if ( !me.owner.trigger( 'beforeFileQueued', file ) ) {\n                    return;\n                }\n    \n                // 类型不匹配，则派送错误事件，并返回。\n                if ( !me.acceptFile( file ) ) {\n                    me.owner.trigger( 'error', 'Q_TYPE_DENIED', file );\n                    return;\n                }\n    \n                me.queue.append( file );\n                me.owner.trigger( 'fileQueued', file );\n                return file;\n            },\n    \n            getFile: function( fileId ) {\n                return this.queue.getFile( fileId );\n            },\n    \n            /**\n             * @event filesQueued\n             * @param {File} files 数组，内容为原始File(lib/File）对象。\n             * @description 当一批文件添加进队列以后触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * @method addFiles\n             * @grammar addFiles( file ) => undefined\n             * @grammar addFiles( [file1, file2 ...] ) => undefined\n             * @param {Array of File or File} [files] Files 对象 数组\n             * @description 添加文件到队列\n             * @for  Uploader\n             */\n            addFiles: function( files ) {\n                var me = this;\n    \n                if ( !files.length ) {\n                    files = [ files ];\n                }\n    \n                files = $.map( files, function( file ) {\n                    return me._addFile( file );\n                });\n    \n                me.owner.trigger( 'filesQueued', files );\n    \n                if ( me.options.auto ) {\n                    me.request('start-upload');\n                }\n            },\n    \n            getStats: function() {\n                return this.stats;\n            },\n    \n            /**\n             * @event fileDequeued\n             * @param {File} file File对象\n             * @description 当文件被移除队列后触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * @method removeFile\n             * @grammar removeFile( file ) => undefined\n             * @grammar removeFile( id ) => undefined\n             * @param {File|id} file File对象或这File对象的id\n             * @description 移除某一文件。\n             * @for  Uploader\n             * @example\n             *\n             * $li.on('click', '.remove-this', function() {\n             *     uploader.removeFile( file );\n             * })\n             */\n            removeFile: function( file ) {\n                var me = this;\n    \n                file = file.id ? file : me.queue.getFile( file );\n    \n                file.setStatus( Status.CANCELLED );\n                me.owner.trigger( 'fileDequeued', file );\n            },\n    \n            /**\n             * @method getFiles\n             * @grammar getFiles() => Array\n             * @grammar getFiles( status1, status2, status... ) => Array\n             * @description 返回指定状态的文件集合，不传参数将返回所有状态的文件。\n             * @for  Uploader\n             * @example\n             * console.log( uploader.getFiles() );    // => all files\n             * console.log( uploader.getFiles('error') )    // => all error files.\n             */\n            getFiles: function() {\n                return this.queue.getFiles.apply( this.queue, arguments );\n            },\n    \n            fetchFile: function() {\n                return this.queue.fetch.apply( this.queue, arguments );\n            },\n    \n            /**\n             * @method retry\n             * @grammar retry() => undefined\n             * @grammar retry( file ) => undefined\n             * @description 重试上传，重试指定文件，或者从出错的文件开始重新上传。\n             * @for  Uploader\n             * @example\n             * function retry() {\n             *     uploader.retry();\n             * }\n             */\n            retry: function( file, noForceStart ) {\n                var me = this,\n                    files, i, len;\n    \n                if ( file ) {\n                    file = file.id ? file : me.queue.getFile( file );\n                    file.setStatus( Status.QUEUED );\n                    noForceStart || me.request('start-upload');\n                    return;\n                }\n    \n                files = me.queue.getFiles( Status.ERROR );\n                i = 0;\n                len = files.length;\n    \n                for ( ; i < len; i++ ) {\n                    file = files[ i ];\n                    file.setStatus( Status.QUEUED );\n                }\n    \n                me.request('start-upload');\n            },\n    \n            /**\n             * @method sort\n             * @grammar sort( fn ) => undefined\n             * @description 排序队列中的文件，在上传之前调整可以控制上传顺序。\n             * @for  Uploader\n             */\n            sortFiles: function() {\n                return this.queue.sort.apply( this.queue, arguments );\n            },\n    \n            /**\n             * @method reset\n             * @grammar reset() => undefined\n             * @description 重置uploader。目前只重置了队列。\n             * @for  Uploader\n             * @example\n             * uploader.reset();\n             */\n            reset: function() {\n                this.queue = new Queue();\n                this.stats = this.queue.stats;\n            }\n        });\n    \n    });\n    /**\n     * @fileOverview 添加获取Runtime相关信息的方法。\n     */\n    define('widgets/runtime',[\n        'uploader',\n        'runtime/runtime',\n        'widgets/widget'\n    ], function( Uploader, Runtime ) {\n    \n        Uploader.support = function() {\n            return Runtime.hasRuntime.apply( Runtime, arguments );\n        };\n    \n        return Uploader.register({\n            'predict-runtime-type': 'predictRuntmeType'\n        }, {\n    \n            init: function() {\n                if ( !this.predictRuntmeType() ) {\n                    throw Error('Runtime Error');\n                }\n            },\n    \n            /**\n             * 预测Uploader将采用哪个`Runtime`\n             * @grammar predictRuntmeType() => String\n             * @method predictRuntmeType\n             * @for  Uploader\n             */\n            predictRuntmeType: function() {\n                var orders = this.options.runtimeOrder || Runtime.orders,\n                    type = this.type,\n                    i, len;\n    \n                if ( !type ) {\n                    orders = orders.split( /\\s*,\\s*/g );\n    \n                    for ( i = 0, len = orders.length; i < len; i++ ) {\n                        if ( Runtime.hasRuntime( orders[ i ] ) ) {\n                            this.type = type = orders[ i ];\n                            break;\n                        }\n                    }\n                }\n    \n                return type;\n            }\n        });\n    });\n    /**\n     * @fileOverview Transport\n     */\n    define('lib/transport',[\n        'base',\n        'runtime/client',\n        'mediator'\n    ], function( Base, RuntimeClient, Mediator ) {\n    \n        var $ = Base.$;\n    \n        function Transport( opts ) {\n            var me = this;\n    \n            opts = me.options = $.extend( true, {}, Transport.options, opts || {} );\n            RuntimeClient.call( this, 'Transport' );\n    \n            this._blob = null;\n            this._formData = opts.formData || {};\n            this._headers = opts.headers || {};\n    \n            this.on( 'progress', this._timeout );\n            this.on( 'load error', function() {\n                me.trigger( 'progress', 1 );\n                clearTimeout( me._timer );\n            });\n        }\n    \n        Transport.options = {\n            server: '',\n            method: 'POST',\n    \n            // 跨域时，是否允许携带cookie, 只有html5 runtime才有效\n            withCredentials: false,\n            fileVal: 'file',\n            timeout: 2 * 60 * 1000,    // 2分钟\n            formData: {},\n            headers: {},\n            sendAsBinary: false\n        };\n    \n        $.extend( Transport.prototype, {\n    \n            // 添加Blob, 只能添加一次，最后一次有效。\n            appendBlob: function( key, blob, filename ) {\n                var me = this,\n                    opts = me.options;\n    \n                if ( me.getRuid() ) {\n                    me.disconnectRuntime();\n                }\n    \n                // 连接到blob归属的同一个runtime.\n                me.connectRuntime( blob.ruid, function() {\n                    me.exec('init');\n                });\n    \n                me._blob = blob;\n                opts.fileVal = key || opts.fileVal;\n                opts.filename = filename || opts.filename;\n            },\n    \n            // 添加其他字段\n            append: function( key, value ) {\n                if ( typeof key === 'object' ) {\n                    $.extend( this._formData, key );\n                } else {\n                    this._formData[ key ] = value;\n                }\n            },\n    \n            setRequestHeader: function( key, value ) {\n                if ( typeof key === 'object' ) {\n                    $.extend( this._headers, key );\n                } else {\n                    this._headers[ key ] = value;\n                }\n            },\n    \n            send: function( method ) {\n                this.exec( 'send', method );\n                this._timeout();\n            },\n    \n            abort: function() {\n                clearTimeout( this._timer );\n                return this.exec('abort');\n            },\n    \n            destroy: function() {\n                this.trigger('destroy');\n                this.off();\n                this.exec('destroy');\n                this.disconnectRuntime();\n            },\n    \n            getResponse: function() {\n                return this.exec('getResponse');\n            },\n    \n            getResponseAsJson: function() {\n                return this.exec('getResponseAsJson');\n            },\n    \n            getStatus: function() {\n                return this.exec('getStatus');\n            },\n    \n            _timeout: function() {\n                var me = this,\n                    duration = me.options.timeout;\n    \n                if ( !duration ) {\n                    return;\n                }\n    \n                clearTimeout( me._timer );\n                me._timer = setTimeout(function() {\n                    me.abort();\n                    me.trigger( 'error', 'timeout' );\n                }, duration );\n            }\n    \n        });\n    \n        // 让Transport具备事件功能。\n        Mediator.installTo( Transport.prototype );\n    \n        return Transport;\n    });\n    /**\n     * @fileOverview 负责文件上传相关。\n     */\n    define('widgets/upload',[\n        'base',\n        'uploader',\n        'file',\n        'lib/transport',\n        'widgets/widget'\n    ], function( Base, Uploader, WUFile, Transport ) {\n    \n        var $ = Base.$,\n            isPromise = Base.isPromise,\n            Status = WUFile.Status;\n    \n        // 添加默认配置项\n        $.extend( Uploader.options, {\n    \n    \n            /**\n             * @property {Boolean} [prepareNextFile=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否允许在文件传输时提前把下一个文件准备好。\n             * 对于一个文件的准备工作比较耗时，比如图片压缩，md5序列化。\n             * 如果能提前在当前文件传输期处理，可以节省总体耗时。\n             */\n            prepareNextFile: false,\n    \n            /**\n             * @property {Boolean} [chunked=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否要分片处理大文件上传。\n             */\n            chunked: false,\n    \n            /**\n             * @property {Boolean} [chunkSize=5242880]\n             * @namespace options\n             * @for Uploader\n             * @description 如果要分片，分多大一片？ 默认大小为5M.\n             */\n            chunkSize: 5 * 1024 * 1024,\n    \n            /**\n             * @property {Boolean} [chunkRetry=2]\n             * @namespace options\n             * @for Uploader\n             * @description 如果某个分片由于网络问题出错，允许自动重传多少次？\n             */\n            chunkRetry: 2,\n    \n            /**\n             * @property {Boolean} [threads=3]\n             * @namespace options\n             * @for Uploader\n             * @description 上传并发数。允许同时最大上传进程数。\n             */\n            threads: 3,\n    \n    \n            /**\n             * @property {Object} [formData]\n             * @namespace options\n             * @for Uploader\n             * @description 文件上传请求的参数表，每次发送都会发送此对象中的参数。\n             */\n            formData: null\n    \n            /**\n             * @property {Object} [fileVal='file']\n             * @namespace options\n             * @for Uploader\n             * @description 设置文件上传域的name。\n             */\n    \n            /**\n             * @property {Object} [method='POST']\n             * @namespace options\n             * @for Uploader\n             * @description 文件上传方式，`POST`或者`GET`。\n             */\n    \n            /**\n             * @property {Object} [sendAsBinary=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否已二进制的流的方式发送文件，这样整个上传内容`php://input`都为文件内容，\n             * 其他参数在$_GET数组中。\n             */\n        });\n    \n        // 负责将文件切片。\n        function CuteFile( file, chunkSize ) {\n            var pending = [],\n                blob = file.source,\n                total = blob.size,\n                chunks = chunkSize ? Math.ceil( total / chunkSize ) : 1,\n                start = 0,\n                index = 0,\n                len;\n    \n            while ( index < chunks ) {\n                len = Math.min( chunkSize, total - start );\n    \n                pending.push({\n                    file: file,\n                    start: start,\n                    end: chunkSize ? (start + len) : total,\n                    total: total,\n                    chunks: chunks,\n                    chunk: index++\n                });\n                start += len;\n            }\n    \n            file.blocks = pending.concat();\n            file.remaning = pending.length;\n    \n            return {\n                file: file,\n    \n                has: function() {\n                    return !!pending.length;\n                },\n    \n                fetch: function() {\n                    return pending.shift();\n                }\n            };\n        }\n    \n        Uploader.register({\n            'start-upload': 'start',\n            'stop-upload': 'stop',\n            'skip-file': 'skipFile',\n            'is-in-progress': 'isInProgress'\n        }, {\n    \n            init: function() {\n                var owner = this.owner;\n    \n                this.runing = false;\n    \n                // 记录当前正在传的数据，跟threads相关\n                this.pool = [];\n    \n                // 缓存即将上传的文件。\n                this.pending = [];\n    \n                // 跟踪还有多少分片没有完成上传。\n                this.remaning = 0;\n                this.__tick = Base.bindFn( this._tick, this );\n    \n                owner.on( 'uploadComplete', function( file ) {\n                    // 把其他块取消了。\n                    file.blocks && $.each( file.blocks, function( _, v ) {\n                        v.transport && (v.transport.abort(), v.transport.destroy());\n                        delete v.transport;\n                    });\n    \n                    delete file.blocks;\n                    delete file.remaning;\n                });\n            },\n    \n            /**\n             * @event startUpload\n             * @description 当开始上传流程时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * 开始上传。此方法可以从初始状态调用开始上传流程，也可以从暂停状态调用，继续上传流程。\n             * @grammar upload() => undefined\n             * @method upload\n             * @for  Uploader\n             */\n            start: function() {\n                var me = this;\n    \n                // 移出invalid的文件\n                $.each( me.request( 'get-files', Status.INVALID ), function() {\n                    me.request( 'remove-file', this );\n                });\n    \n                if ( me.runing ) {\n                    return;\n                }\n    \n                me.runing = true;\n    \n                // 如果有暂停的，则续传\n                $.each( me.pool, function( _, v ) {\n                    var file = v.file;\n    \n                    if ( file.getStatus() === Status.INTERRUPT ) {\n                        file.setStatus( Status.PROGRESS );\n                        me._trigged = false;\n                        v.transport && v.transport.send();\n                    }\n                });\n    \n                me._trigged = false;\n                me.owner.trigger('startUpload');\n                Base.nextTick( me.__tick );\n            },\n    \n            /**\n             * @event stopUpload\n             * @description 当开始上传流程暂停时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * 暂停上传。第一个参数为是否中断上传当前正在上传的文件。\n             * @grammar stop() => undefined\n             * @grammar stop( true ) => undefined\n             * @method stop\n             * @for  Uploader\n             */\n            stop: function( interrupt ) {\n                var me = this;\n    \n                if ( me.runing === false ) {\n                    return;\n                }\n    \n                me.runing = false;\n    \n                interrupt && $.each( me.pool, function( _, v ) {\n                    v.transport && v.transport.abort();\n                    v.file.setStatus( Status.INTERRUPT );\n                });\n    \n                me.owner.trigger('stopUpload');\n            },\n    \n            /**\n             * 判断`Uplaode`r是否正在上传中。\n             * @grammar isInProgress() => Boolean\n             * @method isInProgress\n             * @for  Uploader\n             */\n            isInProgress: function() {\n                return !!this.runing;\n            },\n    \n            getStats: function() {\n                return this.request('get-stats');\n            },\n    \n            /**\n             * 掉过一个文件上传，直接标记指定文件为已上传状态。\n             * @grammar skipFile( file ) => undefined\n             * @method skipFile\n             * @for  Uploader\n             */\n            skipFile: function( file, status ) {\n                file = this.request( 'get-file', file );\n    \n                file.setStatus( status || Status.COMPLETE );\n                file.skipped = true;\n    \n                // 如果正在上传。\n                file.blocks && $.each( file.blocks, function( _, v ) {\n                    var _tr = v.transport;\n    \n                    if ( _tr ) {\n                        _tr.abort();\n                        _tr.destroy();\n                        delete v.transport;\n                    }\n                });\n    \n                this.owner.trigger( 'uploadSkip', file );\n            },\n    \n            /**\n             * @event uploadFinished\n             * @description 当所有文件上传结束时触发。\n             * @for  Uploader\n             */\n            _tick: function() {\n                var me = this,\n                    opts = me.options,\n                    fn, val;\n    \n                // 上一个promise还没有结束，则等待完成后再执行。\n                if ( me._promise ) {\n                    return me._promise.always( me.__tick );\n                }\n    \n                // 还有位置，且还有文件要处理的话。\n                if ( me.pool.length < opts.threads && (val = me._nextBlock()) ) {\n                    me._trigged = false;\n    \n                    fn = function( val ) {\n                        me._promise = null;\n    \n                        // 有可能是reject过来的，所以要检测val的类型。\n                        val && val.file && me._startSend( val );\n                        Base.nextTick( me.__tick );\n                    };\n    \n                    me._promise = isPromise( val ) ? val.always( fn ) : fn( val );\n    \n                // 没有要上传的了，且没有正在传输的了。\n                } else if ( !me.remaning && !me.getStats().numOfQueue ) {\n                    me.runing = false;\n    \n                    me._trigged || Base.nextTick(function() {\n                        me.owner.trigger('uploadFinished');\n                    });\n                    me._trigged = true;\n                }\n            },\n    \n            _nextBlock: function() {\n                var me = this,\n                    act = me._act,\n                    opts = me.options,\n                    next, done;\n    \n                // 如果当前文件还有没有需要传输的，则直接返回剩下的。\n                if ( act && act.has() &&\n                        act.file.getStatus() === Status.PROGRESS ) {\n    \n                    // 是否提前准备下一个文件\n                    if ( opts.prepareNextFile && !me.pending.length ) {\n                        me._prepareNextFile();\n                    }\n    \n                    return act.fetch();\n    \n                // 否则，如果正在运行，则准备下一个文件，并等待完成后返回下个分片。\n                } else if ( me.runing ) {\n    \n                    // 如果缓存中有，则直接在缓存中取，没有则去queue中取。\n                    if ( !me.pending.length && me.getStats().numOfQueue ) {\n                        me._prepareNextFile();\n                    }\n    \n                    next = me.pending.shift();\n                    done = function( file ) {\n                        if ( !file ) {\n                            return null;\n                        }\n    \n                        act = CuteFile( file, opts.chunked ? opts.chunkSize : 0 );\n                        me._act = act;\n                        return act.fetch();\n                    };\n    \n                    // 文件可能还在prepare中，也有可能已经完全准备好了。\n                    return isPromise( next ) ?\n                            next[ next.pipe ? 'pipe' : 'then']( done ) :\n                            done( next );\n                }\n            },\n    \n    \n            /**\n             * @event uploadStart\n             * @param {File} file File对象\n             * @description 某个文件开始上传前触发，一个文件只会触发一次。\n             * @for  Uploader\n             */\n            _prepareNextFile: function() {\n                var me = this,\n                    file = me.request('fetch-file'),\n                    pending = me.pending,\n                    promise;\n    \n                if ( file ) {\n                    promise = me.request( 'before-send-file', file, function() {\n    \n                        // 有可能文件被skip掉了。文件被skip掉后，状态坑定不是Queued.\n                        if ( file.getStatus() === Status.QUEUED ) {\n                            me.owner.trigger( 'uploadStart', file );\n                            file.setStatus( Status.PROGRESS );\n                            return file;\n                        }\n    \n                        return me._finishFile( file );\n                    });\n    \n                    // 如果还在pending中，则替换成文件本身。\n                    promise.done(function() {\n                        var idx = $.inArray( promise, pending );\n    \n                        ~idx && pending.splice( idx, 1, file );\n                    });\n    \n                    // befeore-send-file的钩子就有错误发生。\n                    promise.fail(function( reason ) {\n                        file.setStatus( Status.ERROR, reason );\n                        me.owner.trigger( 'uploadError', file, reason );\n                        me.owner.trigger( 'uploadComplete', file );\n                    });\n    \n                    pending.push( promise );\n                }\n            },\n    \n            // 让出位置了，可以让其他分片开始上传\n            _popBlock: function( block ) {\n                var idx = $.inArray( block, this.pool );\n    \n                this.pool.splice( idx, 1 );\n                block.file.remaning--;\n                this.remaning--;\n            },\n    \n            // 开始上传，可以被掉过。如果promise被reject了，则表示跳过此分片。\n            _startSend: function( block ) {\n                var me = this,\n                    file = block.file,\n                    promise;\n    \n                me.pool.push( block );\n                me.remaning++;\n    \n                // 如果没有分片，则直接使用原始的。\n                // 不会丢失content-type信息。\n                block.blob = block.chunks === 1 ? file.source :\n                        file.source.slice( block.start, block.end );\n    \n                // hook, 每个分片发送之前可能要做些异步的事情。\n                promise = me.request( 'before-send', block, function() {\n    \n                    // 有可能文件已经上传出错了，所以不需要再传输了。\n                    if ( file.getStatus() === Status.PROGRESS ) {\n                        me._doSend( block );\n                    } else {\n                        me._popBlock( block );\n                        Base.nextTick( me.__tick );\n                    }\n                });\n    \n                // 如果为fail了，则跳过此分片。\n                promise.fail(function() {\n                    if ( file.remaning === 1 ) {\n                        me._finishFile( file ).always(function() {\n                            block.percentage = 1;\n                            me._popBlock( block );\n                            me.owner.trigger( 'uploadComplete', file );\n                            Base.nextTick( me.__tick );\n                        });\n                    } else {\n                        block.percentage = 1;\n                        me._popBlock( block );\n                        Base.nextTick( me.__tick );\n                    }\n                });\n            },\n    \n    \n            /**\n             * @event uploadBeforeSend\n             * @param {Object} object\n             * @param {Object} data 默认的上传参数，可以扩展此对象来控制上传参数。\n             * @description 当某个文件的分块在发送前触发，主要用来询问是否要添加附带参数，大文件在开起分片上传的前提下此事件可能会触发多次。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadAccept\n             * @param {Object} object\n             * @param {Object} ret 服务端的返回数据，json格式，如果服务端不是json格式，从ret._raw中取数据，自行解析。\n             * @description 当某个文件上传到服务端响应后，会派送此事件来询问服务端响应是否有效。如果此事件handler返回值为`false`, 则此文件将派送`server`类型的`uploadError`事件。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadProgress\n             * @param {File} file File对象\n             * @param {Number} percentage 上传进度\n             * @description 上传过程中触发，携带上传进度。\n             * @for  Uploader\n             */\n    \n    \n            /**\n             * @event uploadError\n             * @param {File} file File对象\n             * @param {String} reason 出错的code\n             * @description 当文件上传出错时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadSuccess\n             * @param {File} file File对象\n             * @param {Object} response 服务端返回的数据\n             * @description 当文件上传成功时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadComplete\n             * @param {File} [file] File对象\n             * @description 不管成功或者失败，文件上传完成时触发。\n             * @for  Uploader\n             */\n    \n            // 做上传操作。\n            _doSend: function( block ) {\n                var me = this,\n                    owner = me.owner,\n                    opts = me.options,\n                    file = block.file,\n                    tr = new Transport( opts ),\n                    data = $.extend({}, opts.formData ),\n                    headers = $.extend({}, opts.headers ),\n                    requestAccept, ret;\n    \n                block.transport = tr;\n    \n                tr.on( 'destroy', function() {\n                    delete block.transport;\n                    me._popBlock( block );\n                    Base.nextTick( me.__tick );\n                });\n    \n                // 广播上传进度。以文件为单位。\n                tr.on( 'progress', function( percentage ) {\n                    var totalPercent = 0,\n                        uploaded = 0;\n    \n                    // 可能没有abort掉，progress还是执行进来了。\n                    // if ( !file.blocks ) {\n                    //     return;\n                    // }\n    \n                    totalPercent = block.percentage = percentage;\n    \n                    if ( block.chunks > 1 ) {    // 计算文件的整体速度。\n                        $.each( file.blocks, function( _, v ) {\n                            uploaded += (v.percentage || 0) * (v.end - v.start);\n                        });\n    \n                        totalPercent = uploaded / file.size;\n                    }\n    \n                    owner.trigger( 'uploadProgress', file, totalPercent || 0 );\n                });\n    \n                // 用来询问，是否返回的结果是有错误的。\n                requestAccept = function( reject ) {\n                    var fn;\n    \n                    ret = tr.getResponseAsJson() || {};\n                    ret._raw = tr.getResponse();\n                    fn = function( value ) {\n                        reject = value;\n                    };\n    \n                    // 服务端响应了，不代表成功了，询问是否响应正确。\n                    if ( !owner.trigger( 'uploadAccept', block, ret, fn ) ) {\n                        reject = reject || 'server';\n                    }\n    \n                    return reject;\n                };\n    \n                // 尝试重试，然后广播文件上传出错。\n                tr.on( 'error', function( type, flag ) {\n                    block.retried = block.retried || 0;\n    \n                    // 自动重试\n                    if ( block.chunks > 1 && ~'http,abort'.indexOf( type ) &&\n                            block.retried < opts.chunkRetry ) {\n    \n                        block.retried++;\n                        tr.send();\n    \n                    } else {\n    \n                        // http status 500 ~ 600\n                        if ( !flag && type === 'server' ) {\n                            type = requestAccept( type );\n                        }\n    \n                        file.setStatus( Status.ERROR, type );\n                        owner.trigger( 'uploadError', file, type );\n                        owner.trigger( 'uploadComplete', file );\n                    }\n                });\n    \n                // 上传成功\n                tr.on( 'load', function() {\n                    var reason;\n    \n                    // 如果非预期，转向上传出错。\n                    if ( (reason = requestAccept()) ) {\n                        tr.trigger( 'error', reason, true );\n                        return;\n                    }\n    \n                    // 全部上传完成。\n                    if ( file.remaning === 1 ) {\n                        me._finishFile( file, ret );\n                    } else {\n                        tr.destroy();\n                    }\n                });\n    \n                // 配置默认的上传字段。\n                data = $.extend( data, {\n                    id: file.id,\n                    name: file.name,\n                    type: file.type,\n                    lastModifiedDate: file.lastModifiedDate,\n                    size: file.size\n                });\n    \n                block.chunks > 1 && $.extend( data, {\n                    chunks: block.chunks,\n                    chunk: block.chunk\n                });\n    \n                // 在发送之间可以添加字段什么的。。。\n                // 如果默认的字段不够使用，可以通过监听此事件来扩展\n                owner.trigger( 'uploadBeforeSend', block, data, headers );\n    \n                // 开始发送。\n                tr.appendBlob( opts.fileVal, block.blob, file.name );\n                tr.append( data );\n                tr.setRequestHeader( headers );\n                tr.send();\n            },\n    \n            // 完成上传。\n            _finishFile: function( file, ret, hds ) {\n                var owner = this.owner;\n    \n                return owner\n                        .request( 'after-send-file', arguments, function() {\n                            file.setStatus( Status.COMPLETE );\n                            owner.trigger( 'uploadSuccess', file, ret, hds );\n                        })\n                        .fail(function( reason ) {\n    \n                            // 如果外部已经标记为invalid什么的，不再改状态。\n                            if ( file.getStatus() === Status.PROGRESS ) {\n                                file.setStatus( Status.ERROR, reason );\n                            }\n    \n                            owner.trigger( 'uploadError', file, reason );\n                        })\n                        .always(function() {\n                            owner.trigger( 'uploadComplete', file );\n                        });\n            }\n    \n        });\n    });\n    /**\n     * @fileOverview 各种验证，包括文件总大小是否超出、单文件是否超出和文件是否重复。\n     */\n    \n    define('widgets/validator',[\n        'base',\n        'uploader',\n        'file',\n        'widgets/widget'\n    ], function( Base, Uploader, WUFile ) {\n    \n        var $ = Base.$,\n            validators = {},\n            api;\n    \n        /**\n         * @event error\n         * @param {String} type 错误类型。\n         * @description 当validate不通过时，会以派送错误事件的形式通知调用者。通过`upload.on('error', handler)`可以捕获到此类错误，目前有以下错误会在特定的情况下派送错来。\n         *\n         * * `Q_EXCEED_NUM_LIMIT` 在设置了`fileNumLimit`且尝试给`uploader`添加的文件数量超出这个值时派送。\n         * * `Q_EXCEED_SIZE_LIMIT` 在设置了`Q_EXCEED_SIZE_LIMIT`且尝试给`uploader`添加的文件总大小超出这个值时派送。\n         * @for  Uploader\n         */\n    \n        // 暴露给外面的api\n        api = {\n    \n            // 添加验证器\n            addValidator: function( type, cb ) {\n                validators[ type ] = cb;\n            },\n    \n            // 移除验证器\n            removeValidator: function( type ) {\n                delete validators[ type ];\n            }\n        };\n    \n        // 在Uploader初始化的时候启动Validators的初始化\n        Uploader.register({\n            init: function() {\n                var me = this;\n                $.each( validators, function() {\n                    this.call( me.owner );\n                });\n            }\n        });\n    \n        /**\n         * @property {int} [fileNumLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总数量, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileNumLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                count = 0,\n                max = opts.fileNumLimit >> 0,\n                flag = true;\n    \n            if ( !max ) {\n                return;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n    \n                if ( count >= max && flag ) {\n                    flag = false;\n                    this.trigger( 'error', 'Q_EXCEED_NUM_LIMIT', max, file );\n                    setTimeout(function() {\n                        flag = true;\n                    }, 1 );\n                }\n    \n                return count >= max ? false : true;\n            });\n    \n            uploader.on( 'fileQueued', function() {\n                count++;\n            });\n    \n            uploader.on( 'fileDequeued', function() {\n                count--;\n            });\n    \n            uploader.on( 'uploadFinished', function() {\n                count = 0;\n            });\n        });\n    \n    \n        /**\n         * @property {int} [fileSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总大小是否超出限制, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileSizeLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                count = 0,\n                max = opts.fileSizeLimit >> 0,\n                flag = true;\n    \n            if ( !max ) {\n                return;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n                var invalid = count + file.size > max;\n    \n                if ( invalid && flag ) {\n                    flag = false;\n                    this.trigger( 'error', 'Q_EXCEED_SIZE_LIMIT', max, file );\n                    setTimeout(function() {\n                        flag = true;\n                    }, 1 );\n                }\n    \n                return invalid ? false : true;\n            });\n    \n            uploader.on( 'fileQueued', function( file ) {\n                count += file.size;\n            });\n    \n            uploader.on( 'fileDequeued', function( file ) {\n                count -= file.size;\n            });\n    \n            uploader.on( 'uploadFinished', function() {\n                count = 0;\n            });\n        });\n    \n        /**\n         * @property {int} [fileSingleSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证单个文件大小是否超出限制, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileSingleSizeLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                max = opts.fileSingleSizeLimit;\n    \n            if ( !max ) {\n                return;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n    \n                if ( file.size > max ) {\n                    file.setStatus( WUFile.Status.INVALID, 'exceed_size' );\n                    this.trigger( 'error', 'F_EXCEED_SIZE', file );\n                    return false;\n                }\n    \n            });\n    \n        });\n    \n        /**\n         * @property {int} [duplicate=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 去重， 根据文件名字、文件大小和最后修改时间来生成hash Key.\n         */\n        api.addValidator( 'duplicate', function() {\n            var uploader = this,\n                opts = uploader.options,\n                mapping = {};\n    \n            if ( opts.duplicate ) {\n                return;\n            }\n    \n            function hashString( str ) {\n                var hash = 0,\n                    i = 0,\n                    len = str.length,\n                    _char;\n    \n                for ( ; i < len; i++ ) {\n                    _char = str.charCodeAt( i );\n                    hash = _char + (hash << 6) + (hash << 16) - hash;\n                }\n    \n                return hash;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n                var hash = file.__hash || (file.__hash = hashString( file.name +\n                        file.size + file.lastModifiedDate ));\n    \n                // 已经重复了\n                if ( mapping[ hash ] ) {\n                    this.trigger( 'error', 'F_DUPLICATE', file );\n                    return false;\n                }\n            });\n    \n            uploader.on( 'fileQueued', function( file ) {\n                var hash = file.__hash;\n    \n                hash && (mapping[ hash ] = true);\n            });\n    \n            uploader.on( 'fileDequeued', function( file ) {\n                var hash = file.__hash;\n    \n                hash && (delete mapping[ hash ]);\n            });\n        });\n    \n        return api;\n    });\n    \n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/compbase',[],function() {\n    \n        function CompBase( owner, runtime ) {\n    \n            this.owner = owner;\n            this.options = owner.options;\n    \n            this.getRuntime = function() {\n                return runtime;\n            };\n    \n            this.getRuid = function() {\n                return runtime.uid;\n            };\n    \n            this.trigger = function() {\n                return owner.trigger.apply( owner, arguments );\n            };\n        }\n    \n        return CompBase;\n    });\n    /**\n     * @fileOverview Html5Runtime\n     */\n    define('runtime/html5/runtime',[\n        'base',\n        'runtime/runtime',\n        'runtime/compbase'\n    ], function( Base, Runtime, CompBase ) {\n    \n        var type = 'html5',\n            components = {};\n    \n        function Html5Runtime() {\n            var pool = {},\n                me = this,\n                destory = this.destory;\n    \n            Runtime.apply( me, arguments );\n            me.type = type;\n    \n    \n            // 这个方法的调用者，实际上是RuntimeClient\n            me.exec = function( comp, fn/*, args...*/) {\n                var client = this,\n                    uid = client.uid,\n                    args = Base.slice( arguments, 2 ),\n                    instance;\n    \n                if ( components[ comp ] ) {\n                    instance = pool[ uid ] = pool[ uid ] ||\n                            new components[ comp ]( client, me );\n    \n                    if ( instance[ fn ] ) {\n                        return instance[ fn ].apply( instance, args );\n                    }\n                }\n            };\n    \n            me.destory = function() {\n                // @todo 删除池子中的所有实例\n                return destory && destory.apply( this, arguments );\n            };\n        }\n    \n        Base.inherits( Runtime, {\n            constructor: Html5Runtime,\n    \n            // 不需要连接其他程序，直接执行callback\n            init: function() {\n                var me = this;\n                setTimeout(function() {\n                    me.trigger('ready');\n                }, 1 );\n            }\n    \n        });\n    \n        // 注册Components\n        Html5Runtime.register = function( name, component ) {\n            var klass = components[ name ] = Base.inherits( CompBase, component );\n            return klass;\n        };\n    \n        // 注册html5运行时。\n        // 只有在支持的前提下注册。\n        if ( window.Blob && window.FileReader && window.DataView ) {\n            Runtime.addRuntime( type, Html5Runtime );\n        }\n    \n        return Html5Runtime;\n    });\n    /**\n     * @fileOverview Blob Html实现\n     */\n    define('runtime/html5/blob',[\n        'runtime/html5/runtime',\n        'lib/blob'\n    ], function( Html5Runtime, Blob ) {\n    \n        return Html5Runtime.register( 'Blob', {\n            slice: function( start, end ) {\n                var blob = this.owner.source,\n                    slice = blob.slice || blob.webkitSlice || blob.mozSlice;\n    \n                blob = slice.call( blob, start, end );\n    \n                return new Blob( this.getRuid(), blob );\n            }\n        });\n    });\n    /**\n     * @fileOverview FilePaste\n     */\n    define('runtime/html5/dnd',[\n        'base',\n        'runtime/html5/runtime',\n        'lib/file'\n    ], function( Base, Html5Runtime, File ) {\n    \n        var $ = Base.$,\n            prefix = 'webuploader-dnd-';\n    \n        return Html5Runtime.register( 'DragAndDrop', {\n            init: function() {\n                var elem = this.elem = this.options.container;\n    \n                this.dragEnterHandler = Base.bindFn( this._dragEnterHandler, this );\n                this.dragOverHandler = Base.bindFn( this._dragOverHandler, this );\n                this.dragLeaveHandler = Base.bindFn( this._dragLeaveHandler, this );\n                this.dropHandler = Base.bindFn( this._dropHandler, this );\n                this.dndOver = false;\n    \n                elem.on( 'dragenter', this.dragEnterHandler );\n                elem.on( 'dragover', this.dragOverHandler );\n                elem.on( 'dragleave', this.dragLeaveHandler );\n                elem.on( 'drop', this.dropHandler );\n    \n                if ( this.options.disableGlobalDnd ) {\n                    $( document ).on( 'dragover', this.dragOverHandler );\n                    $( document ).on( 'drop', this.dropHandler );\n                }\n            },\n    \n            _dragEnterHandler: function( e ) {\n                var me = this,\n                    denied = me._denied || false,\n                    items;\n    \n                e = e.originalEvent || e;\n    \n                if ( !me.dndOver ) {\n                    me.dndOver = true;\n    \n                    // 注意只有 chrome 支持。\n                    items = e.dataTransfer.items;\n    \n                    if ( items && items.length ) {\n                        me._denied = denied = !me.trigger( 'accept', items );\n                    }\n    \n                    me.elem.addClass( prefix + 'over' );\n                    me.elem[ denied ? 'addClass' :\n                            'removeClass' ]( prefix + 'denied' );\n                }\n    \n    \n                e.dataTransfer.dropEffect = denied ? 'none' : 'copy';\n    \n                return false;\n            },\n    \n            _dragOverHandler: function( e ) {\n                // 只处理框内的。\n                var parentElem = this.elem.parent().get( 0 );\n                if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\n                    return false;\n                }\n    \n                clearTimeout( this._leaveTimer );\n                this._dragEnterHandler.call( this, e );\n    \n                return false;\n            },\n    \n            _dragLeaveHandler: function() {\n                var me = this,\n                    handler;\n    \n                handler = function() {\n                    me.dndOver = false;\n                    me.elem.removeClass( prefix + 'over ' + prefix + 'denied' );\n                };\n    \n                clearTimeout( me._leaveTimer );\n                me._leaveTimer = setTimeout( handler, 100 );\n                return false;\n            },\n    \n            _dropHandler: function( e ) {\n                var me = this,\n                    ruid = me.getRuid(),\n                    parentElem = me.elem.parent().get( 0 );\n    \n                // 只处理框内的。\n                if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\n                    return false;\n                }\n    \n                me._getTansferFiles( e, function( results ) {\n                    me.trigger( 'drop', $.map( results, function( file ) {\n                        return new File( ruid, file );\n                    }) );\n                });\n    \n                me.dndOver = false;\n                me.elem.removeClass( prefix + 'over' );\n                return false;\n            },\n    \n            // 如果传入 callback 则去查看文件夹，否则只管当前文件夹。\n            _getTansferFiles: function( e, callback ) {\n                var results  = [],\n                    promises = [],\n                    items, files, dataTransfer, file, item, i, len, canAccessFolder;\n    \n                e = e.originalEvent || e;\n    \n                dataTransfer = e.dataTransfer;\n                items = dataTransfer.items;\n                files = dataTransfer.files;\n    \n                canAccessFolder = !!(items && items[ 0 ].webkitGetAsEntry);\n    \n                for ( i = 0, len = files.length; i < len; i++ ) {\n                    file = files[ i ];\n                    item = items && items[ i ];\n    \n                    if ( canAccessFolder && item.webkitGetAsEntry().isDirectory ) {\n    \n                        promises.push( this._traverseDirectoryTree(\n                                item.webkitGetAsEntry(), results ) );\n                    } else {\n                        results.push( file );\n                    }\n                }\n    \n                Base.when.apply( Base, promises ).done(function() {\n    \n                    if ( !results.length ) {\n                        return;\n                    }\n    \n                    callback( results );\n                });\n            },\n    \n            _traverseDirectoryTree: function( entry, results ) {\n                var deferred = Base.Deferred(),\n                    me = this;\n    \n                if ( entry.isFile ) {\n                    entry.file(function( file ) {\n                        results.push( file );\n                        deferred.resolve();\n                    });\n                } else if ( entry.isDirectory ) {\n                    entry.createReader().readEntries(function( entries ) {\n                        var len = entries.length,\n                            promises = [],\n                            arr = [],    // 为了保证顺序。\n                            i;\n    \n                        for ( i = 0; i < len; i++ ) {\n                            promises.push( me._traverseDirectoryTree(\n                                    entries[ i ], arr ) );\n                        }\n    \n                        Base.when.apply( Base, promises ).then(function() {\n                            results.push.apply( results, arr );\n                            deferred.resolve();\n                        }, deferred.reject );\n                    });\n                }\n    \n                return deferred.promise();\n            },\n    \n            destroy: function() {\n                var elem = this.elem;\n    \n                elem.off( 'dragenter', this.dragEnterHandler );\n                elem.off( 'dragover', this.dragEnterHandler );\n                elem.off( 'dragleave', this.dragLeaveHandler );\n                elem.off( 'drop', this.dropHandler );\n    \n                if ( this.options.disableGlobalDnd ) {\n                    $( document ).off( 'dragover', this.dragOverHandler );\n                    $( document ).off( 'drop', this.dropHandler );\n                }\n            }\n        });\n    });\n    \n    /**\n     * @fileOverview FilePaste\n     */\n    define('runtime/html5/filepaste',[\n        'base',\n        'runtime/html5/runtime',\n        'lib/file'\n    ], function( Base, Html5Runtime, File ) {\n    \n        return Html5Runtime.register( 'FilePaste', {\n            init: function() {\n                var opts = this.options,\n                    elem = this.elem = opts.container,\n                    accept = '.*',\n                    arr, i, len, item;\n    \n                // accetp的mimeTypes中生成匹配正则。\n                if ( opts.accept ) {\n                    arr = [];\n    \n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n                        item = opts.accept[ i ].mimeTypes;\n                        item && arr.push( item );\n                    }\n    \n                    if ( arr.length ) {\n                        accept = arr.join(',');\n                        accept = accept.replace( /,/g, '|' ).replace( /\\*/g, '.*' );\n                    }\n                }\n                this.accept = accept = new RegExp( accept, 'i' );\n                this.hander = Base.bindFn( this._pasteHander, this );\n                elem.on( 'paste', this.hander );\n            },\n    \n            _pasteHander: function( e ) {\n                var allowed = [],\n                    ruid = this.getRuid(),\n                    items, item, blob, i, len;\n    \n                e = e.originalEvent || e;\n                items = e.clipboardData.items;\n    \n                for ( i = 0, len = items.length; i < len; i++ ) {\n                    item = items[ i ];\n    \n                    if ( item.kind !== 'file' || !(blob = item.getAsFile()) ) {\n                        continue;\n                    }\n    \n                    allowed.push( new File( ruid, blob ) );\n                }\n    \n                if ( allowed.length ) {\n                    // 不阻止非文件粘贴（文字粘贴）的事件冒泡\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.trigger( 'paste', allowed );\n                }\n            },\n    \n            destroy: function() {\n                this.elem.off( 'paste', this.hander );\n            }\n        });\n    });\n    \n    /**\n     * @fileOverview FilePicker\n     */\n    define('runtime/html5/filepicker',[\n        'base',\n        'runtime/html5/runtime'\n    ], function( Base, Html5Runtime ) {\n    \n        var $ = Base.$;\n    \n        return Html5Runtime.register( 'FilePicker', {\n            init: function() {\n                var container = this.getRuntime().getContainer(),\n                    me = this,\n                    owner = me.owner,\n                    opts = me.options,\n                    lable = $( document.createElement('label') ),\n                    input = $( document.createElement('input') ),\n                    arr, i, len, mouseHandler;\n    \n                input.attr( 'type', 'file' );\n                input.attr( 'name', opts.name );\n                input.addClass('webuploader-element-invisible');\n    \n                lable.on( 'click', function() {\n                    input.trigger('click');\n                });\n    \n                lable.css({\n                    opacity: 0,\n                    width: '100%',\n                    height: '100%',\n                    display: 'block',\n                    cursor: 'pointer',\n                    background: '#ffffff'\n                });\n    \n                if ( opts.multiple ) {\n                    input.attr( 'multiple', 'multiple' );\n                }\n    \n                // @todo Firefox不支持单独指定后缀\n                if ( opts.accept && opts.accept.length > 0 ) {\n                    arr = [];\n    \n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n                        arr.push( opts.accept[ i ].mimeTypes );\n                    }\n    \n                    input.attr( 'accept', arr.join(',') );\n                }\n    \n                container.append( input );\n                container.append( lable );\n    \n                mouseHandler = function( e ) {\n                    owner.trigger( e.type );\n                };\n    \n                input.on( 'change', function( e ) {\n                    var fn = arguments.callee,\n                        clone;\n    \n                    me.files = e.target.files;\n    \n                    // reset input\n                    clone = this.cloneNode( true );\n                    this.parentNode.replaceChild( clone, this );\n    \n                    input.off();\n                    input = $( clone ).on( 'change', fn )\n                            .on( 'mouseenter mouseleave', mouseHandler );\n    \n                    owner.trigger('change');\n                });\n    \n                lable.on( 'mouseenter mouseleave', mouseHandler );\n    \n            },\n    \n    \n            getFiles: function() {\n                return this.files;\n            },\n    \n            destroy: function() {\n                // todo\n            }\n        });\n    });\n    /**\n     * Terms:\n     *\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\n     * @fileOverview Image控件\n     */\n    define('runtime/html5/util',[\n        'base'\n    ], function( Base ) {\n    \n        var urlAPI = window.createObjectURL && window ||\n                window.URL && URL.revokeObjectURL && URL ||\n                window.webkitURL,\n            createObjectURL = Base.noop,\n            revokeObjectURL = createObjectURL;\n    \n        if ( urlAPI ) {\n    \n            // 更安全的方式调用，比如android里面就能把context改成其他的对象。\n            createObjectURL = function() {\n                return urlAPI.createObjectURL.apply( urlAPI, arguments );\n            };\n    \n            revokeObjectURL = function() {\n                return urlAPI.revokeObjectURL.apply( urlAPI, arguments );\n            };\n        }\n    \n        return {\n            createObjectURL: createObjectURL,\n            revokeObjectURL: revokeObjectURL,\n    \n            dataURL2Blob: function( dataURI ) {\n                var byteStr, intArray, ab, i, mimetype, parts;\n    \n                parts = dataURI.split(',');\n    \n                if ( ~parts[ 0 ].indexOf('base64') ) {\n                    byteStr = atob( parts[ 1 ] );\n                } else {\n                    byteStr = decodeURIComponent( parts[ 1 ] );\n                }\n    \n                ab = new ArrayBuffer( byteStr.length );\n                intArray = new Uint8Array( ab );\n    \n                for ( i = 0; i < byteStr.length; i++ ) {\n                    intArray[ i ] = byteStr.charCodeAt( i );\n                }\n    \n                mimetype = parts[ 0 ].split(':')[ 1 ].split(';')[ 0 ];\n    \n                return this.arrayBufferToBlob( ab, mimetype );\n            },\n    \n            dataURL2ArrayBuffer: function( dataURI ) {\n                var byteStr, intArray, i, parts;\n    \n                parts = dataURI.split(',');\n    \n                if ( ~parts[ 0 ].indexOf('base64') ) {\n                    byteStr = atob( parts[ 1 ] );\n                } else {\n                    byteStr = decodeURIComponent( parts[ 1 ] );\n                }\n    \n                intArray = new Uint8Array( byteStr.length );\n    \n                for ( i = 0; i < byteStr.length; i++ ) {\n                    intArray[ i ] = byteStr.charCodeAt( i );\n                }\n    \n                return intArray.buffer;\n            },\n    \n            arrayBufferToBlob: function( buffer, type ) {\n                var builder = window.BlobBuilder || window.WebKitBlobBuilder,\n                    bb;\n    \n                // android不支持直接new Blob, 只能借助blobbuilder.\n                if ( builder ) {\n                    bb = new builder();\n                    bb.append( buffer );\n                    return bb.getBlob( type );\n                }\n    \n                return new Blob([ buffer ], type ? { type: type } : {} );\n            },\n    \n            // 抽出来主要是为了解决android下面canvas.toDataUrl不支持jpeg.\n            // 你得到的结果是png.\n            canvasToDataUrl: function( canvas, type, quality ) {\n                return canvas.toDataURL( type, quality / 100 );\n            },\n    \n            // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\n            parseMeta: function( blob, callback ) {\n                callback( false, {});\n            },\n    \n            // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\n            updateImageHead: function( data ) {\n                return data;\n            }\n        };\n    });\n    /**\n     * Terms:\n     *\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\n     * @fileOverview Image控件\n     */\n    define('runtime/html5/imagemeta',[\n        'runtime/html5/util'\n    ], function( Util ) {\n    \n        var api;\n    \n        api = {\n            parsers: {\n                0xffe1: []\n            },\n    \n            maxMetaDataSize: 262144,\n    \n            parse: function( blob, cb ) {\n                var me = this,\n                    fr = new FileReader();\n    \n                fr.onload = function() {\n                    cb( false, me._parse( this.result ) );\n                    fr = fr.onload = fr.onerror = null;\n                };\n    \n                fr.onerror = function( e ) {\n                    cb( e.message );\n                    fr = fr.onload = fr.onerror = null;\n                };\n    \n                blob = blob.slice( 0, me.maxMetaDataSize );\n                fr.readAsArrayBuffer( blob.getSource() );\n            },\n    \n            _parse: function( buffer, noParse ) {\n                if ( buffer.byteLength < 6 ) {\n                    return;\n                }\n    \n                var dataview = new DataView( buffer ),\n                    offset = 2,\n                    maxOffset = dataview.byteLength - 4,\n                    headLength = offset,\n                    ret = {},\n                    markerBytes, markerLength, parsers, i;\n    \n                if ( dataview.getUint16( 0 ) === 0xffd8 ) {\n    \n                    while ( offset < maxOffset ) {\n                        markerBytes = dataview.getUint16( offset );\n    \n                        if ( markerBytes >= 0xffe0 && markerBytes <= 0xffef ||\n                                markerBytes === 0xfffe ) {\n    \n                            markerLength = dataview.getUint16( offset + 2 ) + 2;\n    \n                            if ( offset + markerLength > dataview.byteLength ) {\n                                break;\n                            }\n    \n                            parsers = api.parsers[ markerBytes ];\n    \n                            if ( !noParse && parsers ) {\n                                for ( i = 0; i < parsers.length; i += 1 ) {\n                                    parsers[ i ].call( api, dataview, offset,\n                                            markerLength, ret );\n                                }\n                            }\n    \n                            offset += markerLength;\n                            headLength = offset;\n                        } else {\n                            break;\n                        }\n                    }\n    \n                    if ( headLength > 6 ) {\n                        if ( buffer.slice ) {\n                            ret.imageHead = buffer.slice( 2, headLength );\n                        } else {\n                            // Workaround for IE10, which does not yet\n                            // support ArrayBuffer.slice:\n                            ret.imageHead = new Uint8Array( buffer )\n                                    .subarray( 2, headLength );\n                        }\n                    }\n                }\n    \n                return ret;\n            },\n    \n            updateImageHead: function( buffer, head ) {\n                var data = this._parse( buffer, true ),\n                    buf1, buf2, bodyoffset;\n    \n    \n                bodyoffset = 2;\n                if ( data.imageHead ) {\n                    bodyoffset = 2 + data.imageHead.byteLength;\n                }\n    \n                if ( buffer.slice ) {\n                    buf2 = buffer.slice( bodyoffset );\n                } else {\n                    buf2 = new Uint8Array( buffer ).subarray( bodyoffset );\n                }\n    \n                buf1 = new Uint8Array( head.byteLength + 2 + buf2.byteLength );\n    \n                buf1[ 0 ] = 0xFF;\n                buf1[ 1 ] = 0xD8;\n                buf1.set( new Uint8Array( head ), 2 );\n                buf1.set( new Uint8Array( buf2 ), head.byteLength + 2 );\n    \n                return buf1.buffer;\n            }\n        };\n    \n        Util.parseMeta = function() {\n            return api.parse.apply( api, arguments );\n        };\n    \n        Util.updateImageHead = function() {\n            return api.updateImageHead.apply( api, arguments );\n        };\n    \n        return api;\n    });\n    /**\n     * 代码来自于：https://github.com/blueimp/JavaScript-Load-Image\n     * 暂时项目中只用了orientation.\n     *\n     * 去除了 Exif Sub IFD Pointer, GPS Info IFD Pointer, Exif Thumbnail.\n     * @fileOverview EXIF解析\n     */\n    \n    // Sample\n    // ====================================\n    // Make : Apple\n    // Model : iPhone 4S\n    // Orientation : 1\n    // XResolution : 72 [72/1]\n    // YResolution : 72 [72/1]\n    // ResolutionUnit : 2\n    // Software : QuickTime 7.7.1\n    // DateTime : 2013:09:01 22:53:55\n    // ExifIFDPointer : 190\n    // ExposureTime : 0.058823529411764705 [1/17]\n    // FNumber : 2.4 [12/5]\n    // ExposureProgram : Normal program\n    // ISOSpeedRatings : 800\n    // ExifVersion : 0220\n    // DateTimeOriginal : 2013:09:01 22:52:51\n    // DateTimeDigitized : 2013:09:01 22:52:51\n    // ComponentsConfiguration : YCbCr\n    // ShutterSpeedValue : 4.058893515764426\n    // ApertureValue : 2.5260688216892597 [4845/1918]\n    // BrightnessValue : -0.3126686601998395\n    // MeteringMode : Pattern\n    // Flash : Flash did not fire, compulsory flash mode\n    // FocalLength : 4.28 [107/25]\n    // SubjectArea : [4 values]\n    // FlashpixVersion : 0100\n    // ColorSpace : 1\n    // PixelXDimension : 2448\n    // PixelYDimension : 3264\n    // SensingMethod : One-chip color area sensor\n    // ExposureMode : 0\n    // WhiteBalance : Auto white balance\n    // FocalLengthIn35mmFilm : 35\n    // SceneCaptureType : Standard\n    define('runtime/html5/imagemeta/exif',[\n        'base',\n        'runtime/html5/imagemeta'\n    ], function( Base, ImageMeta ) {\n    \n        var EXIF = {};\n    \n        EXIF.ExifMap = function() {\n            return this;\n        };\n    \n        EXIF.ExifMap.prototype.map = {\n            'Orientation': 0x0112\n        };\n    \n        EXIF.ExifMap.prototype.get = function( id ) {\n            return this[ id ] || this[ this.map[ id ] ];\n        };\n    \n        EXIF.exifTagTypes = {\n            // byte, 8-bit unsigned int:\n            1: {\n                getValue: function( dataView, dataOffset ) {\n                    return dataView.getUint8( dataOffset );\n                },\n                size: 1\n            },\n    \n            // ascii, 8-bit byte:\n            2: {\n                getValue: function( dataView, dataOffset ) {\n                    return String.fromCharCode( dataView.getUint8( dataOffset ) );\n                },\n                size: 1,\n                ascii: true\n            },\n    \n            // short, 16 bit int:\n            3: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getUint16( dataOffset, littleEndian );\n                },\n                size: 2\n            },\n    \n            // long, 32 bit int:\n            4: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getUint32( dataOffset, littleEndian );\n                },\n                size: 4\n            },\n    \n            // rational = two long values,\n            // first is numerator, second is denominator:\n            5: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getUint32( dataOffset, littleEndian ) /\n                        dataView.getUint32( dataOffset + 4, littleEndian );\n                },\n                size: 8\n            },\n    \n            // slong, 32 bit signed int:\n            9: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getInt32( dataOffset, littleEndian );\n                },\n                size: 4\n            },\n    \n            // srational, two slongs, first is numerator, second is denominator:\n            10: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getInt32( dataOffset, littleEndian ) /\n                        dataView.getInt32( dataOffset + 4, littleEndian );\n                },\n                size: 8\n            }\n        };\n    \n        // undefined, 8-bit byte, value depending on field:\n        EXIF.exifTagTypes[ 7 ] = EXIF.exifTagTypes[ 1 ];\n    \n        EXIF.getExifValue = function( dataView, tiffOffset, offset, type, length,\n                littleEndian ) {\n    \n            var tagType = EXIF.exifTagTypes[ type ],\n                tagSize, dataOffset, values, i, str, c;\n    \n            if ( !tagType ) {\n                Base.log('Invalid Exif data: Invalid tag type.');\n                return;\n            }\n    \n            tagSize = tagType.size * length;\n    \n            // Determine if the value is contained in the dataOffset bytes,\n            // or if the value at the dataOffset is a pointer to the actual data:\n            dataOffset = tagSize > 4 ? tiffOffset + dataView.getUint32( offset + 8,\n                    littleEndian ) : (offset + 8);\n    \n            if ( dataOffset + tagSize > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid data offset.');\n                return;\n            }\n    \n            if ( length === 1 ) {\n                return tagType.getValue( dataView, dataOffset, littleEndian );\n            }\n    \n            values = [];\n    \n            for ( i = 0; i < length; i += 1 ) {\n                values[ i ] = tagType.getValue( dataView,\n                        dataOffset + i * tagType.size, littleEndian );\n            }\n    \n            if ( tagType.ascii ) {\n                str = '';\n    \n                // Concatenate the chars:\n                for ( i = 0; i < values.length; i += 1 ) {\n                    c = values[ i ];\n    \n                    // Ignore the terminating NULL byte(s):\n                    if ( c === '\\u0000' ) {\n                        break;\n                    }\n                    str += c;\n                }\n    \n                return str;\n            }\n            return values;\n        };\n    \n        EXIF.parseExifTag = function( dataView, tiffOffset, offset, littleEndian,\n                data ) {\n    \n            var tag = dataView.getUint16( offset, littleEndian );\n            data.exif[ tag ] = EXIF.getExifValue( dataView, tiffOffset, offset,\n                    dataView.getUint16( offset + 2, littleEndian ),    // tag type\n                    dataView.getUint32( offset + 4, littleEndian ),    // tag length\n                    littleEndian );\n        };\n    \n        EXIF.parseExifTags = function( dataView, tiffOffset, dirOffset,\n                littleEndian, data ) {\n    \n            var tagsNumber, dirEndOffset, i;\n    \n            if ( dirOffset + 6 > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid directory offset.');\n                return;\n            }\n    \n            tagsNumber = dataView.getUint16( dirOffset, littleEndian );\n            dirEndOffset = dirOffset + 2 + 12 * tagsNumber;\n    \n            if ( dirEndOffset + 4 > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid directory size.');\n                return;\n            }\n    \n            for ( i = 0; i < tagsNumber; i += 1 ) {\n                this.parseExifTag( dataView, tiffOffset,\n                        dirOffset + 2 + 12 * i,    // tag offset\n                        littleEndian, data );\n            }\n    \n            // Return the offset to the next directory:\n            return dataView.getUint32( dirEndOffset, littleEndian );\n        };\n    \n        // EXIF.getExifThumbnail = function(dataView, offset, length) {\n        //     var hexData,\n        //         i,\n        //         b;\n        //     if (!length || offset + length > dataView.byteLength) {\n        //         Base.log('Invalid Exif data: Invalid thumbnail data.');\n        //         return;\n        //     }\n        //     hexData = [];\n        //     for (i = 0; i < length; i += 1) {\n        //         b = dataView.getUint8(offset + i);\n        //         hexData.push((b < 16 ? '0' : '') + b.toString(16));\n        //     }\n        //     return 'data:image/jpeg,%' + hexData.join('%');\n        // };\n    \n        EXIF.parseExifData = function( dataView, offset, length, data ) {\n    \n            var tiffOffset = offset + 10,\n                littleEndian, dirOffset;\n    \n            // Check for the ASCII code for \"Exif\" (0x45786966):\n            if ( dataView.getUint32( offset + 4 ) !== 0x45786966 ) {\n                // No Exif data, might be XMP data instead\n                return;\n            }\n            if ( tiffOffset + 8 > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid segment size.');\n                return;\n            }\n    \n            // Check for the two null bytes:\n            if ( dataView.getUint16( offset + 8 ) !== 0x0000 ) {\n                Base.log('Invalid Exif data: Missing byte alignment offset.');\n                return;\n            }\n    \n            // Check the byte alignment:\n            switch ( dataView.getUint16( tiffOffset ) ) {\n                case 0x4949:\n                    littleEndian = true;\n                    break;\n    \n                case 0x4D4D:\n                    littleEndian = false;\n                    break;\n    \n                default:\n                    Base.log('Invalid Exif data: Invalid byte alignment marker.');\n                    return;\n            }\n    \n            // Check for the TIFF tag marker (0x002A):\n            if ( dataView.getUint16( tiffOffset + 2, littleEndian ) !== 0x002A ) {\n                Base.log('Invalid Exif data: Missing TIFF marker.');\n                return;\n            }\n    \n            // Retrieve the directory offset bytes, usually 0x00000008 or 8 decimal:\n            dirOffset = dataView.getUint32( tiffOffset + 4, littleEndian );\n            // Create the exif object to store the tags:\n            data.exif = new EXIF.ExifMap();\n            // Parse the tags of the main image directory and retrieve the\n            // offset to the next directory, usually the thumbnail directory:\n            dirOffset = EXIF.parseExifTags( dataView, tiffOffset,\n                    tiffOffset + dirOffset, littleEndian, data );\n    \n            // 尝试读取缩略图\n            // if ( dirOffset ) {\n            //     thumbnailData = {exif: {}};\n            //     dirOffset = EXIF.parseExifTags(\n            //         dataView,\n            //         tiffOffset,\n            //         tiffOffset + dirOffset,\n            //         littleEndian,\n            //         thumbnailData\n            //     );\n    \n            //     // Check for JPEG Thumbnail offset:\n            //     if (thumbnailData.exif[0x0201]) {\n            //         data.exif.Thumbnail = EXIF.getExifThumbnail(\n            //             dataView,\n            //             tiffOffset + thumbnailData.exif[0x0201],\n            //             thumbnailData.exif[0x0202] // Thumbnail data length\n            //         );\n            //     }\n            // }\n        };\n    \n        ImageMeta.parsers[ 0xffe1 ].push( EXIF.parseExifData );\n        return EXIF;\n    });\n    /**\n     * @fileOverview Image\n     */\n    define('runtime/html5/image',[\n        'base',\n        'runtime/html5/runtime',\n        'runtime/html5/util'\n    ], function( Base, Html5Runtime, Util ) {\n    \n        var BLANK = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D';\n    \n        return Html5Runtime.register( 'Image', {\n    \n            // flag: 标记是否被修改过。\n            modified: false,\n    \n            init: function() {\n                var me = this,\n                    img = new Image();\n    \n                img.onload = function() {\n    \n                    me._info = {\n                        type: me.type,\n                        width: this.width,\n                        height: this.height\n                    };\n    \n                    // 读取meta信息。\n                    if ( !me._metas && 'image/jpeg' === me.type ) {\n                        Util.parseMeta( me._blob, function( error, ret ) {\n                            me._metas = ret;\n                            me.owner.trigger('load');\n                        });\n                    } else {\n                        me.owner.trigger('load');\n                    }\n                };\n    \n                img.onerror = function() {\n                    me.owner.trigger('error');\n                };\n    \n                me._img = img;\n            },\n    \n            loadFromBlob: function( blob ) {\n                var me = this,\n                    img = me._img;\n    \n                me._blob = blob;\n                me.type = blob.type;\n                img.src = Util.createObjectURL( blob.getSource() );\n                me.owner.once( 'load', function() {\n                    Util.revokeObjectURL( img.src );\n                });\n            },\n    \n            resize: function( width, height ) {\n                var canvas = this._canvas ||\n                        (this._canvas = document.createElement('canvas'));\n    \n                this._resize( this._img, canvas, width, height );\n                this._blob = null;    // 没用了，可以删掉了。\n                this.modified = true;\n                this.owner.trigger('complete');\n            },\n    \n            getAsBlob: function( type ) {\n                var blob = this._blob,\n                    opts = this.options,\n                    canvas;\n    \n                type = type || this.type;\n    \n                // blob需要重新生成。\n                if ( this.modified || this.type !== type ) {\n                    canvas = this._canvas;\n    \n                    if ( type === 'image/jpeg' ) {\n    \n                        blob = Util.canvasToDataUrl( canvas, 'image/jpeg',\n                                opts.quality );\n    \n                        if ( opts.preserveHeaders && this._metas &&\n                                this._metas.imageHead ) {\n    \n                            blob = Util.dataURL2ArrayBuffer( blob );\n                            blob = Util.updateImageHead( blob,\n                                    this._metas.imageHead );\n                            blob = Util.arrayBufferToBlob( blob, type );\n                            return blob;\n                        }\n                    } else {\n                        blob = Util.canvasToDataUrl( canvas, type );\n                    }\n    \n                    blob = Util.dataURL2Blob( blob );\n                }\n    \n                return blob;\n            },\n    \n            getAsDataUrl: function( type ) {\n                var opts = this.options;\n    \n                type = type || this.type;\n    \n                if ( type === 'image/jpeg' ) {\n                    return Util.canvasToDataUrl( this._canvas, type, opts.quality );\n                } else {\n                    return this._canvas.toDataURL( type );\n                }\n            },\n    \n            getOrientation: function() {\n                return this._metas && this._metas.exif &&\n                        this._metas.exif.get('Orientation') || 1;\n            },\n    \n            info: function( val ) {\n    \n                // setter\n                if ( val ) {\n                    this._info = val;\n                    return this;\n                }\n    \n                // getter\n                return this._info;\n            },\n    \n            meta: function( val ) {\n    \n                // setter\n                if ( val ) {\n                    this._meta = val;\n                    return this;\n                }\n    \n                // getter\n                return this._meta;\n            },\n    \n            destroy: function() {\n                var canvas = this._canvas;\n                this._img.onload = null;\n    \n                if ( canvas ) {\n                    canvas.getContext('2d')\n                            .clearRect( 0, 0, canvas.width, canvas.height );\n                    canvas.width = canvas.height = 0;\n                    this._canvas = null;\n                }\n    \n                // 释放内存。非常重要，否则释放不了image的内存。\n                this._img.src = BLANK;\n                this._img = this._blob = null;\n            },\n    \n            _resize: function( img, cvs, width, height ) {\n                var opts = this.options,\n                    naturalWidth = img.width,\n                    naturalHeight = img.height,\n                    orientation = this.getOrientation(),\n                    scale, w, h, x, y;\n    \n                // values that require 90 degree rotation\n                if ( ~[ 5, 6, 7, 8 ].indexOf( orientation ) ) {\n    \n                    // 交换width, height的值。\n                    width ^= height;\n                    height ^= width;\n                    width ^= height;\n                }\n    \n                scale = Math[ opts.crop ? 'max' : 'min' ]( width / naturalWidth,\n                        height / naturalHeight );\n    \n                // 不允许放大。\n                opts.allowMagnify || (scale = Math.min( 1, scale ));\n    \n                w = naturalWidth * scale;\n                h = naturalHeight * scale;\n    \n                if ( opts.crop ) {\n                    cvs.width = width;\n                    cvs.height = height;\n                } else {\n                    cvs.width = w;\n                    cvs.height = h;\n                }\n    \n                x = (cvs.width - w) / 2;\n                y = (cvs.height - h) / 2;\n    \n                opts.preserveHeaders || this._rotate2Orientaion( cvs, orientation );\n    \n                this._renderImageToCanvas( cvs, img, x, y, w, h );\n            },\n    \n            _rotate2Orientaion: function( canvas, orientation ) {\n                var width = canvas.width,\n                    height = canvas.height,\n                    ctx = canvas.getContext('2d');\n    \n                switch ( orientation ) {\n                    case 5:\n                    case 6:\n                    case 7:\n                    case 8:\n                        canvas.width = height;\n                        canvas.height = width;\n                        break;\n                }\n    \n                switch ( orientation ) {\n                    case 2:    // horizontal flip\n                        ctx.translate( width, 0 );\n                        ctx.scale( -1, 1 );\n                        break;\n    \n                    case 3:    // 180 rotate left\n                        ctx.translate( width, height );\n                        ctx.rotate( Math.PI );\n                        break;\n    \n                    case 4:    // vertical flip\n                        ctx.translate( 0, height );\n                        ctx.scale( 1, -1 );\n                        break;\n    \n                    case 5:    // vertical flip + 90 rotate right\n                        ctx.rotate( 0.5 * Math.PI );\n                        ctx.scale( 1, -1 );\n                        break;\n    \n                    case 6:    // 90 rotate right\n                        ctx.rotate( 0.5 * Math.PI );\n                        ctx.translate( 0, -height );\n                        break;\n    \n                    case 7:    // horizontal flip + 90 rotate right\n                        ctx.rotate( 0.5 * Math.PI );\n                        ctx.translate( width, -height );\n                        ctx.scale( -1, 1 );\n                        break;\n    \n                    case 8:    // 90 rotate left\n                        ctx.rotate( -0.5 * Math.PI );\n                        ctx.translate( -width, 0 );\n                        break;\n                }\n            },\n    \n            // https://github.com/stomita/ios-imagefile-megapixel/\n            // blob/master/src/megapix-image.js\n            _renderImageToCanvas: (function() {\n    \n                // 如果不是ios, 不需要这么复杂！\n                if ( !Base.os.ios ) {\n                    return function( canvas, img, x, y, w, h ) {\n                        canvas.getContext('2d').drawImage( img, x, y, w, h );\n                    };\n                }\n    \n                /**\n                 * Detecting vertical squash in loaded image.\n                 * Fixes a bug which squash image vertically while drawing into\n                 * canvas for some images.\n                 */\n                function detectVerticalSquash( img, iw, ih ) {\n                    var canvas = document.createElement('canvas'),\n                        ctx = canvas.getContext('2d'),\n                        sy = 0,\n                        ey = ih,\n                        py = ih,\n                        data, alpha, ratio;\n    \n    \n                    canvas.width = 1;\n                    canvas.height = ih;\n                    ctx.drawImage( img, 0, 0 );\n                    data = ctx.getImageData( 0, 0, 1, ih ).data;\n    \n                    // search image edge pixel position in case\n                    // it is squashed vertically.\n                    while ( py > sy ) {\n                        alpha = data[ (py - 1) * 4 + 3 ];\n    \n                        if ( alpha === 0 ) {\n                            ey = py;\n                        } else {\n                            sy = py;\n                        }\n    \n                        py = (ey + sy) >> 1;\n                    }\n    \n                    ratio = (py / ih);\n                    return (ratio === 0) ? 1 : ratio;\n                }\n    \n                // fix ie7 bug\n                // http://stackoverflow.com/questions/11929099/\n                // html5-canvas-drawimage-ratio-bug-ios\n                if ( Base.os.ios >= 7 ) {\n                    return function( canvas, img, x, y, w, h ) {\n                        var iw = img.naturalWidth,\n                            ih = img.naturalHeight,\n                            vertSquashRatio = detectVerticalSquash( img, iw, ih );\n    \n                        return canvas.getContext('2d').drawImage( img, 0, 0,\n                            iw * vertSquashRatio, ih * vertSquashRatio,\n                            x, y, w, h );\n                    };\n                }\n    \n                /**\n                 * Detect subsampling in loaded image.\n                 * In iOS, larger images than 2M pixels may be\n                 * subsampled in rendering.\n                 */\n                function detectSubsampling( img ) {\n                    var iw = img.naturalWidth,\n                        ih = img.naturalHeight,\n                        canvas, ctx;\n    \n                    // subsampling may happen overmegapixel image\n                    if ( iw * ih > 1024 * 1024 ) {\n                        canvas = document.createElement('canvas');\n                        canvas.width = canvas.height = 1;\n                        ctx = canvas.getContext('2d');\n                        ctx.drawImage( img, -iw + 1, 0 );\n    \n                        // subsampled image becomes half smaller in rendering size.\n                        // check alpha channel value to confirm image is covering\n                        // edge pixel or not. if alpha value is 0\n                        // image is not covering, hence subsampled.\n                        return ctx.getImageData( 0, 0, 1, 1 ).data[ 3 ] === 0;\n                    } else {\n                        return false;\n                    }\n                }\n    \n    \n                return function( canvas, img, x, y, width, height ) {\n                    var iw = img.naturalWidth,\n                        ih = img.naturalHeight,\n                        ctx = canvas.getContext('2d'),\n                        subsampled = detectSubsampling( img ),\n                        doSquash = this.type === 'image/jpeg',\n                        d = 1024,\n                        sy = 0,\n                        dy = 0,\n                        tmpCanvas, tmpCtx, vertSquashRatio, dw, dh, sx, dx;\n    \n                    if ( subsampled ) {\n                        iw /= 2;\n                        ih /= 2;\n                    }\n    \n                    ctx.save();\n                    tmpCanvas = document.createElement('canvas');\n                    tmpCanvas.width = tmpCanvas.height = d;\n    \n                    tmpCtx = tmpCanvas.getContext('2d');\n                    vertSquashRatio = doSquash ?\n                            detectVerticalSquash( img, iw, ih ) : 1;\n    \n                    dw = Math.ceil( d * width / iw );\n                    dh = Math.ceil( d * height / ih / vertSquashRatio );\n    \n                    while ( sy < ih ) {\n                        sx = 0;\n                        dx = 0;\n                        while ( sx < iw ) {\n                            tmpCtx.clearRect( 0, 0, d, d );\n                            tmpCtx.drawImage( img, -sx, -sy );\n                            ctx.drawImage( tmpCanvas, 0, 0, d, d,\n                                    x + dx, y + dy, dw, dh );\n                            sx += d;\n                            dx += dw;\n                        }\n                        sy += d;\n                        dy += dh;\n                    }\n                    ctx.restore();\n                    tmpCanvas = tmpCtx = null;\n                };\n            })()\n        });\n    });\n    /**\n     * @fileOverview Transport\n     * @todo 支持chunked传输，优势：\n     * 可以将大文件分成小块，挨个传输，可以提高大文件成功率，当失败的时候，也只需要重传那小部分，\n     * 而不需要重头再传一次。另外断点续传也需要用chunked方式。\n     */\n    define('runtime/html5/transport',[\n        'base',\n        'runtime/html5/runtime'\n    ], function( Base, Html5Runtime ) {\n    \n        var noop = Base.noop,\n            $ = Base.$;\n    \n        return Html5Runtime.register( 'Transport', {\n            init: function() {\n                this._status = 0;\n                this._response = null;\n            },\n    \n            send: function() {\n                var owner = this.owner,\n                    opts = this.options,\n                    xhr = this._initAjax(),\n                    blob = owner._blob,\n                    server = opts.server,\n                    formData, binary, fr;\n    \n                if ( opts.sendAsBinary ) {\n                    server += (/\\?/.test( server ) ? '&' : '?') +\n                            $.param( owner._formData );\n    \n                    binary = blob.getSource();\n                } else {\n                    formData = new FormData();\n                    $.each( owner._formData, function( k, v ) {\n                        formData.append( k, v );\n                    });\n    \n                    formData.append( opts.fileVal, blob.getSource(),\n                            opts.filename || owner._formData.name || '' );\n                }\n    \n                if ( opts.withCredentials && 'withCredentials' in xhr ) {\n                    xhr.open( opts.method, server, true );\n                    xhr.withCredentials = true;\n                } else {\n                    xhr.open( opts.method, server );\n                }\n    \n                this._setRequestHeader( xhr, opts.headers );\n    \n                if ( binary ) {\n                    xhr.overrideMimeType('application/octet-stream');\n    \n                    // android直接发送blob会导致服务端接收到的是空文件。\n                    // bug详情。\n                    // https://code.google.com/p/android/issues/detail?id=39882\n                    // 所以先用fileReader读取出来再通过arraybuffer的方式发送。\n                    if ( Base.os.android ) {\n                        fr = new FileReader();\n    \n                        fr.onload = function() {\n                            xhr.send( this.result );\n                            fr = fr.onload = null;\n                        };\n    \n                        fr.readAsArrayBuffer( binary );\n                    } else {\n                        xhr.send( binary );\n                    }\n                } else {\n                    xhr.send( formData );\n                }\n            },\n    \n            getResponse: function() {\n                return this._response;\n            },\n    \n            getResponseAsJson: function() {\n                return this._parseJson( this._response );\n            },\n    \n            getStatus: function() {\n                return this._status;\n            },\n    \n            abort: function() {\n                var xhr = this._xhr;\n    \n                if ( xhr ) {\n                    xhr.upload.onprogress = noop;\n                    xhr.onreadystatechange = noop;\n                    xhr.abort();\n    \n                    this._xhr = xhr = null;\n                }\n            },\n    \n            destroy: function() {\n                this.abort();\n            },\n    \n            _initAjax: function() {\n                var me = this,\n                    xhr = new XMLHttpRequest(),\n                    opts = this.options;\n    \n                if ( opts.withCredentials && !('withCredentials' in xhr) &&\n                        typeof XDomainRequest !== 'undefined' ) {\n                    xhr = new XDomainRequest();\n                }\n    \n                xhr.upload.onprogress = function( e ) {\n                    var percentage = 0;\n    \n                    if ( e.lengthComputable ) {\n                        percentage = e.loaded / e.total;\n                    }\n    \n                    return me.trigger( 'progress', percentage );\n                };\n    \n                xhr.onreadystatechange = function() {\n    \n                    if ( xhr.readyState !== 4 ) {\n                        return;\n                    }\n    \n                    xhr.upload.onprogress = noop;\n                    xhr.onreadystatechange = noop;\n                    me._xhr = null;\n                    me._status = xhr.status;\n    \n                    if ( xhr.status >= 200 && xhr.status < 300 ) {\n                        me._response = xhr.responseText;\n                        return me.trigger('load');\n                    } else if ( xhr.status >= 500 && xhr.status < 600 ) {\n                        me._response = xhr.responseText;\n                        return me.trigger( 'error', 'server' );\n                    }\n    \n    \n                    return me.trigger( 'error', me._status ? 'http' : 'abort' );\n                };\n    \n                me._xhr = xhr;\n                return xhr;\n            },\n    \n            _setRequestHeader: function( xhr, headers ) {\n                $.each( headers, function( key, val ) {\n                    xhr.setRequestHeader( key, val );\n                });\n            },\n    \n            _parseJson: function( str ) {\n                var json;\n    \n                try {\n                    json = JSON.parse( str );\n                } catch ( ex ) {\n                    json = {};\n                }\n    \n                return json;\n            }\n        });\n    });\n    /**\n     * @fileOverview 只有html5实现的文件版本。\n     */\n    define('preset/html5only',[\n        'base',\n    \n        // widgets\n        'widgets/filednd',\n        'widgets/filepaste',\n        'widgets/filepicker',\n        'widgets/image',\n        'widgets/queue',\n        'widgets/runtime',\n        'widgets/upload',\n        'widgets/validator',\n    \n        // runtimes\n        // html5\n        'runtime/html5/blob',\n        'runtime/html5/dnd',\n        'runtime/html5/filepaste',\n        'runtime/html5/filepicker',\n        'runtime/html5/imagemeta/exif',\n        'runtime/html5/image',\n        'runtime/html5/transport'\n    ], function( Base ) {\n        return Base;\n    });\n    define('webuploader',[\n        'preset/html5only'\n    ], function( preset ) {\n        return preset;\n    });\n    return require('webuploader');\n});\n"]}