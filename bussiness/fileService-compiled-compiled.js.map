{"version":3,"sources":["fileService-compiled.js"],"names":[],"mappings":"AAAA,IAAI,aAAa,QAAQ,YAAR,CAAjB;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT,C;;AAEA,cAAc;;AAEb,SAAQ,UAAU,GAAV,EAAe,GAAf,EAAoB,MAApB,EAA4B;AACnC,MAAI,UAAU,EAAd;AACA,MAAI,OAAO,IAAI,WAAW,YAAf,EAAX,C;AACA,OAAK,QAAL,GAAgB,OAAhB,C;AACA,OAAK,SAAL,GAAiB,yBAAjB,C;AACA,OAAK,cAAL,GAAsB,IAAtB,C;AACA,OAAK,aAAL,GAAqB,IAAI,IAAJ,GAAW,IAAhC,C;;AAEA,OAAK,KAAL,CAAW,GAAX,EAAgB,UAAU,GAAV,EAAe,MAAf,EAAuB,KAAvB,EAA8B;AAC7C,OAAI,GAAJ,EAAS;AACR,YAAQ,GAAR,CAAY,GAAZ;AACA,QAAI,IAAJ,CAAS,OAAO,YAAP,CAAoB,EAApB,EAAwB,aAAxB,EAAuC,KAAvC,CAAT;AACA;;AAED,OAAI,WAAW,MAAM,IAAN,CAAW,IAA1B;;;AAGA,OAAI,YAAY,SAAS,KAAT,CAAe,GAAf,CAAhB;AACA,OAAI,OAAO,UAAU,UAAU,MAAV,GAAmB,CAA7B,CAAX;AACA,OAAI,OAAO,EAAX;AACA,QAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,UAAU,MAAV,GAAmB,CAAvC,EAA0C,GAA1C,EAA+C;AAC9C,WAAO,OAAO,UAAU,CAAV,CAAd;AACA;AACD,OAAI,OAAO,KAAK,MAAL,KAAgB,GAAhB,GAAsB,GAAjC;AACA,OAAI,MAAM,IAAI,IAAJ,GAAW,OAAX,EAAV;;AAEA,OAAI,aAAa,OAAO,GAAP,GAAa,GAAb,GAAmB,IAApC;;AAEA,OAAI,UAAU,KAAK,SAAL,GAAiB,UAA/B;AACA,MAAG,UAAH,CAAc,MAAM,IAAN,CAAW,IAAzB,EAA+B,OAA/B,E;AACA,OAAI,IAAJ,CAAS,OAAO,YAAP,CAAoB,QAAQ,OAAR,CAAgB,SAAhB,EAA2B,GAA3B,CAApB,CAAT;AACA,GAvBD;AAwBA,EAlCY;AAmCb,WAAU,UAAU,GAAV,EAAe,GAAf,EAAoB,MAApB,EAA4B;AACrC,MAAI,OAAO,wBAAX,C;;;AAGA,MAAI,QAAJ,CAAa,QAAb,EAAuB,QAAvB;AACA;AAxCY,CAAd;;AA2CA,OAAO,OAAP,GAAiB,WAAjB","file":"fileService-compiled-compiled.js","sourcesContent":["var formidable = require('formidable');\nvar fs = require('fs'); //node.js核心的文件处理模块\n\nfileService = {\n\t//这里是保存实体\n\tupload: function (req, res, params) {\n\t\tvar message = '';\n\t\tvar form = new formidable.IncomingForm(); //创建上传表单\n\t\tform.encoding = 'utf-8'; //设置编码\n\t\tform.uploadDir = 'public/maintain/upload/'; //设置上传目录\n\t\tform.keepExtensions = true; //保留后缀\n\t\tform.maxFieldsSize = 2 * 1024 * 1024; //文件大小\n\n\t\tform.parse(req, function (err, fields, files) {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t\tres.send(global.configResult({}, \"服务器更新维护中请稍后\", false));\n\t\t\t}\n\n\t\t\tvar filename = files.file.name;\n\n\t\t\t// 对文件名进行处理，以应对上传同名文件的情况\n\t\t\tvar nameArray = filename.split('.');\n\t\t\tvar type = nameArray[nameArray.length - 1];\n\t\t\tvar name = '';\n\t\t\tfor (var i = 0; i < nameArray.length - 1; i++) {\n\t\t\t\tname = name + nameArray[i];\n\t\t\t}\n\t\t\tvar rand = Math.random() * 100 + 900;\n\t\t\tvar num = new Date().getTime();\n\n\t\t\tvar avatarName = name + num + '.' + type;\n\n\t\t\tvar newPath = form.uploadDir + avatarName;\n\t\t\tfs.renameSync(files.file.path, newPath); //重命名\n\t\t\tres.send(global.configResult(newPath.replace('public/', '/')));\n\t\t});\n\t},\n\tdownload: function (req, res, params) {\n\t\tvar path = 'public/upload/file.txt'; // 文件存储的路径\n\n\t\t// filename:设置下载时文件的文件名，可不填，则为原名称\n\t\tres.download(filepath, filename);\n\t}\n};\n\nmodule.exports = fileService;\n\n//# sourceMappingURL=fileService-compiled.js.map"]}