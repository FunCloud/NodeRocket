{"version":3,"sources":["excelFileService.js"],"names":[],"mappings":";;;;AAIA,IAAI,cAAe,QAAQ,yBAAR,CAAnB;AACA,IAAI,aAAa,QAAQ,YAAR,CAAjB;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT,C;AACA,IAAI,mBAAmB;AACnB,gBAAa,UAAS,GAAT,EAAc,GAAd,EAAmB,MAAnB,EAA0B;AACnC,YAAI,UAAU,EAAd;AACA,YAAI,OAAO,IAAI,WAAW,YAAf,EAAX,C;AACA,aAAK,QAAL,GAAgB,OAAhB,C;AACA,aAAK,SAAL,GAAiB,yBAAjB,C;AACA,aAAK,cAAL,GAAsB,IAAtB,C;AACA,aAAK,aAAL,GAAqB,IAAI,IAAJ,GAAW,IAAhC,C;;AAEA,aAAK,KAAL,CAAW,GAAX,EAAgB,UAAS,GAAT,EAAc,MAAd,EAAsB,KAAtB,EAA6B;AACzC,gBAAI,GAAJ,EAAS;AACL,wBAAQ,GAAR,CAAY,GAAZ;AACA,oBAAI,IAAJ,CAAS,OAAO,YAAP,CAAoB,EAApB,EAAuB,aAAvB,EAAqC,KAArC,CAAT;AACH;;AAED,gBAAI,WAAW,MAAM,IAAN,CAAW,IAA1B;;;AAGA,gBAAI,YAAY,SAAS,KAAT,CAAe,GAAf,CAAhB;AACA,gBAAI,OAAO,UAAU,UAAU,MAAV,GAAiB,CAA3B,CAAX;AACA,gBAAI,OAAO,EAAX;AACA,iBAAI,IAAI,IAAE,CAAV,EAAa,IAAE,UAAU,MAAV,GAAiB,CAAhC,EAAmC,GAAnC,EAAuC;AACnC,uBAAO,OAAO,UAAU,CAAV,CAAd;AACH;AACD,gBAAI,OAAO,KAAK,MAAL,KAAc,GAAd,GAAoB,GAA/B;AACA,gBAAI,MAAO,IAAI,IAAJ,EAAD,CAAa,OAAb,EAAV;;AAEA,gBAAI,aAAa,OAAO,GAAP,GAAc,GAAd,GAAoB,IAArC;AACA,gBAAI,UAAU,KAAK,SAAL,GAAiB,UAA/B;AACA,eAAG,UAAH,CAAc,MAAM,IAAN,CAAW,IAAzB,EAA+B,OAA/B,E;AACA,wBAAY,WAAZ,CAAwB,OAAxB;AACA,gBAAI,IAAJ,CAAS,OAAO,YAAP,CAAoB,QAAQ,OAAR,CAAgB,SAAhB,EAA0B,GAA1B,CAApB,CAAT;AAEH,SAxBD;AAyBH;AAlCkB,CAAvB;;AAqCA,OAAO,OAAP,GAAiB,gBAAjB","file":"excelFileService-compiled.js","sourcesContent":["/**\n * the service which deal with the excel\n * Created by dapaer on 16/10/6.\n */\nvar excelHelper =  require('../../utils/excelHelper');\nvar formidable = require('formidable');\nvar fs = require('fs');  //node.js核心的文件处理模块\nvar excelFileService = {\n    parseExcel : function(req, res, params){\n        var message = '';\n        var form = new formidable.IncomingForm();   //创建上传表单\n        form.encoding = 'utf-8';        //设置编码\n        form.uploadDir = 'public/maintain/upload/';     //设置上传目录\n        form.keepExtensions = true;     //保留后缀\n        form.maxFieldsSize = 2 * 1024 * 1024;   //文件大小\n\n        form.parse(req, function(err, fields, files) {\n            if (err) {\n                console.log(err);\n                res.send(global.configResult({},\"服务器更新维护中请稍后\",false));\n            }\n\n            var filename = files.file.name;\n\n            // 对文件名进行处理，以应对上传同名文件的情况\n            var nameArray = filename.split('.');\n            var type = nameArray[nameArray.length-1];\n            var name = '';\n            for(var i=0; i<nameArray.length-1; i++){\n                name = name + nameArray[i];\n            }\n            var rand = Math.random()*100 + 900;\n            var num = (new Date()).getTime();\n\n            var avatarName = name + num +  '.' + type;\n            var newPath = form.uploadDir + avatarName ;\n            fs.renameSync(files.file.path, newPath);  //重命名\n            excelHelper.importExcel(newPath)\n            res.send(global.configResult(newPath.replace('public/','/')));\n            \n        });\n    }\n}\n\nmodule.exports = excelFileService;"]}