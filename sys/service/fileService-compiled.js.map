{"version":3,"sources":["fileService.js"],"names":[],"mappings":"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","file":"fileService-compiled.js","sourcesContent":["var formidable = require('formidable');\nvar fs = require('fs');  //node.js核心的文件处理模块\n\nvar fileService = {\n\t//这里是保存实体\n\tueUpload:function(req, res, params){\n\t\tvar message = '';\n\t\tvar form = new formidable.IncomingForm();   //创建上传表单\n\t\tform.encoding = 'utf-8';        //设置编码\n\t\tform.uploadDir = 'public/maintain/upload/';     //设置上传目录\n\t\tform.keepExtensions = true;     //保留后缀\n\t\tform.maxFieldsSize = 2 * 1024 * 1024;   //文件大小\n\n\t\tform.parse(req, function(err, fields, files) {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t\tres.send(global.configResult({},\"服务器更新维护中请稍后\",false));\n\t\t\t}\n\n\t\t\tvar filename = files.file.name;\n\n\t\t\t// 对文件名进行处理，以应对上传同名文件的情况\n\t\t\tvar nameArray = filename.split('.');\n\t\t\tvar type = nameArray[nameArray.length-1];\n\t\t\tvar name = '';\n\t\t\tfor(var i=0; i<nameArray.length-1; i++){\n\t\t\t\tname = name + nameArray[i];\n\t\t\t}\n\t\t\tvar rand = Math.random()*100 + 900;\n\t\t\tvar num = (new Date()).getTime();\n\n\t\t\tvar avatarName = name + num +  '.' + type;\n\n\t\t\tvar newPath = form.uploadDir + avatarName ;\n\t\t\tfs.renameSync(files.file.path, newPath);  //重命名\n\t\t\tres.send(global.configUmResult(name+'.'+type,newPath.replace('public/','/'),name+'.'+type));\n\t\t});\n\t},\n\tupload:function(req, res, params){\n\t\tvar message = '';\n\t\tvar form = new formidable.IncomingForm();   //创建上传表单\n\t\tform.encoding = 'utf-8';        //设置编码\n\t\tform.uploadDir = 'public/maintain/upload/';     //设置上传目录\n\t\tform.keepExtensions = true;     //保留后缀\n\t\tform.maxFieldsSize = 2 * 1024 * 1024;   //文件大小\n\n\t\tform.parse(req, function(err, fields, files) {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t\tres.send(global.configResult({},\"服务器更新维护中请稍后\",false));\n\t\t\t}\n\n\t\t\tvar filename = files.file.name;\n\n\t\t\t// 对文件名进行处理，以应对上传同名文件的情况\n\t\t\tvar nameArray = filename.split('.');\n\t\t\tvar type = nameArray[nameArray.length-1];\n\t\t\tvar name = '';\n\t\t\tfor(var i=0; i<nameArray.length-1; i++){\n\t\t\t\tname = name + nameArray[i];\n\t\t\t}\n\t\t\tvar rand = Math.random()*100 + 900;\n\t\t\tvar num = (new Date()).getTime();\n\n\t\t\tvar avatarName = name + num +  '.' + type;\n\n\t\t\tvar newPath = form.uploadDir + avatarName ;\n\t\t\tfs.renameSync(files.file.path, newPath);  //重命名\n\t\t\tres.send(global.configResult(newPath.replace('public/','/')));\n\t\t});\n\t},\n\tdownload:function(req, res ,params){\n\t\tvar path = 'public/upload/file.txt';  // 文件存储的路径\n\n\t\t// filename:设置下载时文件的文件名，可不填，则为原名称\n\t\tres.download(filepath, filename);\n\t}\n}\n\nmodule.exports = fileService;"]}